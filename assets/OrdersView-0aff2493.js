import{a as X,r as U,X as he,av as ee,i as te,h as ae,d as re,Z as me,ak as pe,al as se,K as Z,P as m,f as e,$ as de,o as c,e as t,v as le,q as p,x as ue,y as fe,z as ge,j as a,B as j,C as s,a2 as J,E as D,a0 as G,n as W,p as Y,t as I,D as F,G as E,g as oe,s as Q,a3 as De,ai as ce,u as ke,Q as Oe,c as _e,W as we,N as R,l as Ce,m as xe,a4 as Me,a6 as $e,a7 as Ue,H as Ae}from"./index-089d6db5.js";import{u as Ee,a as Ne,_ as Te}from"./ElementsTable.vue_vue_type_script_setup_true_lang-47d145e8.js";import{u as ne}from"./useLogoutHandler-836ae1bd.js";import{u as ve,a as Ve,b as q}from"./useFormSchemas-a1be70e3.js";const Fe=(l,_,f)=>{const w=X(),b=U(!1),v=U(!1),y=U(!1),S=U([]),V=U("2023-01-01"),n=U("2024-01-01"),x=U(""),C=U(""),T=()=>{_.push({name:"orders-page",query:{startDate:V.value,endDate:n.value,customerName:x.value,productName:C.value}})},k=()=>{V.value="2023-01-01",n.value="2024-01-01",x.value="",C.value="",v.value=!1,S.value=[],_.push({name:"orders-page",query:{}})},M=async()=>{try{if(!l.query.startDate&&!l.query.endDate)return;y.value=!0;const{data:h}=await ee.getSerachedOrders({userId:f,product:l.query.productName,customer:l.query.customerName,startDate:l.query.startDate,endDate:l.query.endDate});S.value=h.orders,v.value=!0}catch(h){te(h)?w.showMessage("error",ae(h)):w.showMessage("error","Ошибка при поиске заказов")}finally{y.value=!1}};return he([()=>l.query.startDate,()=>l.query.endDate,()=>l.query.customerName,()=>l.query.productName],async()=>{!l.query.startDate&&!l.query.endDate||M()},{immediate:!0}),{isSearchLoading:y,isSearchFormActive:b,isSearchActive:v,startDate:V,endDate:n,customerName:x,productName:C,searchedOrders:S,resetSearch:k,addSearchQuery:T,searchOrders:M}},qe=Q("span",{class:"px-5 text-wrap"},"Очистить ",-1),Ie=re({__name:"OrdersAddDialog",props:{isOpened:{type:Boolean}},emits:["closeDialog"],setup(l,{emit:_}){const f=me(),w=pe(),b=se(),v=X(),{userProducts:y,productsErrorMessage:S}=Z(f),{customers:V,customersErrorMessage:n}=Z(w),{userOrderSchema:x}=ve(),{handleSubmit:C,isSubmitting:T,resetForm:k}=Ve({validationSchema:x}),{value:M,errorMessage:h}=q("customerId"),{value:N,errorMessage:P}=q("productId"),{value:B,errorMessage:L}=q("productCount"),{value:$,errorMessage:K}=q("date"),{handleLogout:z}=ne("orders-page"),H=C(async O=>{var o;try{const{data:i}=await ee.addOrder(O);O.date=O.date.split("-").reverse().join("-"),b.addOrder({...O,...i}),v.showMessage("success","Заказ был успешно добавлен!"),k()}catch(i){if(te(i)){if(((o=i.response)==null?void 0:o.status)===401){await z();return}v.showMessage("error",ae(i))}else v.showMessage("error","Ошибка при добавлении заказа")}finally{_("closeDialog")}});return(O,o)=>(c(),m(de,{"model-value":l.isOpened,"onUpdate:modelValue":o[6]||(o[6]=i=>O.$emit("closeDialog")),width:"auto",scrollable:"",transition:"dialog-bottom-transition"},{default:e(()=>[t(oe,{width:"450",color:"white",class:"pa-4"},{default:e(()=>[t(le,{class:"font-weight-bold text-h6 mb-3"},{default:e(()=>[p(" Добавление заказа ")]),_:1}),t(ue,null,{default:e(()=>[t(fe,{onSubmit:ge(a(H),["prevent"])},{default:e(()=>[t(j,null,{default:e(()=>[t(s,{cols:"12"},{default:e(()=>[a(n)?(c(),m(G,{key:1},{default:e(()=>[t(W,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:e(()=>[t(Y,{class:"text-h6"},{default:e(()=>[p(I(a(n)),1)]),_:1})]),_:1})]),_:1})):(c(),m(J,{key:0,modelValue:a(M),"onUpdate:modelValue":o[0]||(o[0]=i=>D(M)?M.value=i:null),"error-messages":a(h),label:"Клиент",items:a(V),"item-title":"fullName","item-value":"id","no-data-text":"Клиенты не найдены"},null,8,["modelValue","error-messages","items"]))]),_:1}),t(s,{cols:"12"},{default:e(()=>[a(S)?(c(),m(G,{key:1},{default:e(()=>[t(W,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:e(()=>[t(Y,{class:"text-h6"},{default:e(()=>[p(I(a(S)),1)]),_:1})]),_:1})]),_:1})):(c(),m(J,{key:0,modelValue:a(N),"onUpdate:modelValue":o[1]||(o[1]=i=>D(N)?N.value=i:null),"error-messages":a(P),label:"Товар",items:a(y),"item-title":"name","item-value":"id","no-data-text":"Товары не найдены"},null,8,["modelValue","error-messages","items"]))]),_:1}),t(s,{cols:"12"},{default:e(()=>[t(F,{type:"number",modelValue:a(B),"onUpdate:modelValue":o[2]||(o[2]=i=>D(B)?B.value=i:null),modelModifiers:{number:!0},label:"Количество товара","error-messages":a(L)},null,8,["modelValue","error-messages"])]),_:1}),t(s,{cols:"12"},{default:e(()=>[t(F,{modelValue:a($),"onUpdate:modelValue":o[3]||(o[3]=i=>D($)?$.value=i:null),"error-messages":a(K),type:"date"},null,8,["modelValue","error-messages"])]),_:1}),t(s,{cols:"12"},{default:e(()=>[t(j,null,{default:e(()=>[t(s,{sm:"auto",cols:"12"},{default:e(()=>[t(E,{color:"green-darken-4",variant:"flat",type:"submit",block:"",loading:a(T)},{default:e(()=>[p(" Добавить ")]),_:1},8,["loading"])]),_:1}),t(s,{sm:"5",cols:"6"},{default:e(()=>[t(E,{color:"error",variant:"flat",onClick:o[4]||(o[4]=i=>a(k)()),block:""},{default:e(()=>[qe]),_:1})]),_:1}),t(s,{sm:"auto",cols:"6"},{default:e(()=>[t(E,{color:"blue-darken-4",block:"",variant:"flat",onClick:o[5]||(o[5]=i=>O.$emit("closeDialog"))},{default:e(()=>[p(" Отмена ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),Pe={class:"text-h6"},Be={class:"text-error"},Le=re({__name:"OrdersDeleteDialog",props:{isOpened:{type:Boolean},order:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchOrders"],setup(l,{emit:_}){const f=l,w=U(!1),b=X(),v=se(),{handleLogout:y}=ne("orders-page"),S=async()=>{var V;try{w.value=!0,await ee.deleteOrder(f.order.id),v.deleteOrder(f.order.id),f.isSearchActive&&_("updateSearchOrders"),b.showMessage("success","Заказ был успешно удален!")}catch(n){te(n)?(((V=n.response)==null?void 0:V.status)===401&&await y(),b.showMessage("error",ae(n))):b.showMessage("error","Ошибка при удалении заказа")}finally{w.value=!1,_("closeDialog")}};return(V,n)=>(c(),m(de,{scrollable:"",width:"auto","model-value":l.isOpened,"onUpdate:modelValue":n[1]||(n[1]=x=>V.$emit("closeDialog")),persistent:""},{default:e(()=>[t(oe,{width:"450",elevation:"3",class:"pa-4"},{default:e(()=>[t(le,{class:"font-weight-bold text-h6 mb-4 pa-0"},{default:e(()=>[p("Удаление заказа")]),_:1}),t(De,{class:"mb-4 pa-0"},{default:e(()=>[Q("p",Pe,[p(" Вы уверены что хотите удалить заказ за "+I(l.order.date)+" клиента ",1),Q("span",Be,I(l.order.customerFullName),1),p(" ? ")])]),_:1}),t(ue,{class:"pa-0"},{default:e(()=>[t(E,{onClick:n[0]||(n[0]=x=>V.$emit("closeDialog")),height:"40",color:"blue-darken-4",variant:"flat"},{default:e(()=>[p(" Нет ")]),_:1}),t(E,{height:"40",color:"error",variant:"flat",loading:w.value,onClick:S},{default:e(()=>[p("Да")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),Re=re({__name:"OrdersEditDialog",props:{isOpened:{type:Boolean},order:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchOrders"],setup(l,{emit:_}){const f=l,w=ce(()=>{const d=f.order.date.split("-");return d[2]+"-"+d[1]+"-"+d[0]}),b=ce(()=>({productCount:f.order.productCount,productId:f.order.productId,customerId:f.order.customerId,date:w.value})),{userOrderSchema:v}=ve(),{isSubmitting:y,resetForm:S,handleSubmit:V}=Ve({validationSchema:v,initialValues:b}),{value:n,errorMessage:x}=q("customerId"),{value:C,errorMessage:T}=q("productId"),{value:k,errorMessage:M}=q("productCount"),{value:h,errorMessage:N}=q("date"),P=pe(),B=me(),L=se(),$=X(),{customers:K,customersErrorMessage:z}=Z(P),{userProducts:H,productsErrorMessage:O}=Z(B),{handleLogout:o}=ne("orders-page"),i=V(async A=>{var d;try{const{data:g}=await ee.updateOrder(A,f.order.id);A.date=A.date.split("-").reverse().join("-"),L.updateOrder({...A,...g}),f.isSearchActive&&_("updateSearchOrders"),$.showMessage("success","Заказ был успешно обновлен")}catch(g){if(te(g)){if(((d=g.response)==null?void 0:d.status)===401){await o();return}$.showMessage("error",ae(g))}else $.showMessage("error","Ошибка при добавлении заказа")}finally{_("closeDialog"),S()}});return(A,d)=>(c(),m(de,{"model-value":l.isOpened,"onUpdate:modelValue":d[5]||(d[5]=g=>A.$emit("closeDialog")),width:"auto",scrollable:"",transition:"dialog-bottom-transition"},{default:e(()=>[t(oe,{width:"450",color:"white",class:"pa-4"},{default:e(()=>[t(le,{class:"font-weight-bold text-h6 mb-3"},{default:e(()=>[p(" Редактирование заказа ")]),_:1}),t(ue,null,{default:e(()=>[t(fe,{onSubmit:ge(a(i),["prevent"])},{default:e(()=>[t(j,null,{default:e(()=>[t(s,{cols:"12"},{default:e(()=>[a(z)?(c(),m(G,{key:1},{default:e(()=>[t(W,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:e(()=>[t(Y,{class:"text-h6"},{default:e(()=>[p(I(a(z)),1)]),_:1})]),_:1})]),_:1})):(c(),m(J,{key:0,modelValue:a(n),"onUpdate:modelValue":d[0]||(d[0]=g=>D(n)?n.value=g:null),"error-messages":a(x),label:"Клиент",items:a(K),"item-title":"fullName","item-value":"id","no-data-text":"Клиенты не найдены"},null,8,["modelValue","error-messages","items"]))]),_:1}),t(s,{cols:"12"},{default:e(()=>[a(O)?(c(),m(G,{key:1},{default:e(()=>[t(W,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:e(()=>[t(Y,{class:"text-h6"},{default:e(()=>[p(I(a(O)),1)]),_:1})]),_:1})]),_:1})):(c(),m(J,{key:0,modelValue:a(C),"onUpdate:modelValue":d[1]||(d[1]=g=>D(C)?C.value=g:null),"error-messages":a(T),label:"Товар",items:a(H),"item-title":"name","item-value":"id","no-data-text":"Товары не найдены"},null,8,["modelValue","error-messages","items"]))]),_:1}),t(s,{cols:"12"},{default:e(()=>[t(F,{modelValue:a(k),"onUpdate:modelValue":d[2]||(d[2]=g=>D(k)?k.value=g:null),modelModifiers:{number:!0},label:"Количество товара","error-messages":a(M),type:"number"},null,8,["modelValue","error-messages"])]),_:1}),t(s,{cols:"12"},{default:e(()=>[t(F,{modelValue:a(h),"onUpdate:modelValue":d[3]||(d[3]=g=>D(h)?h.value=g:null),"error-messages":a(N),type:"date"},null,8,["modelValue","error-messages"])]),_:1}),t(s,{cols:"12"},{default:e(()=>[t(j,null,{default:e(()=>[t(s,{sm:"auto",cols:"12"},{default:e(()=>[t(E,{color:"green-darken-4",variant:"flat",type:"submit",block:"",loading:a(y)},{default:e(()=>[p(" Сохранить ")]),_:1},8,["loading"])]),_:1}),t(s,{sm:"auto",cols:"12"},{default:e(()=>[t(E,{color:"blue-darken-4",block:"",variant:"flat",onClick:d[4]||(d[4]=g=>A.$emit("closeDialog"))},{default:e(()=>[p(" Отмена ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),je={class:"text-h6"},Qe=Q("h2",{class:"title text-h2 mb-5"},"Заказы",-1),ze=Q("span",{class:"text-wrap"}," Сбросить поиск",-1),Xe=re({__name:"OrdersView",setup(l){const _=U([{fieldText:"Клиент",fieldName:"customerFullName"},{fieldText:"Товар",fieldName:"productName"},{fieldText:"Количество товара",fieldName:"productCount"},{fieldText:"Дата",fieldName:"date"}]),f=U("customerFullName"),w=ke(),b=se(),v=X(),{itemToEdit:y,isAddDialogActive:S,isEditDialogActive:V,isDeleteDialogActive:n,openDialog:x}=Ee(),C=Ce(),T=xe(),{isSearchFormActive:k,isSearchLoading:M,isSearchActive:h,startDate:N,endDate:P,searchedOrders:B,customerName:L,productName:$,addSearchQuery:K,resetSearch:z,searchOrders:H}=Fe(C,T,w.currentUser.id),O=Oe(()=>h.value?B.value:b.orders),{currentPage:o,paginatedElements:i,isInverseSort:A,elementsPerPageCount:d,totalPages:g,setSortField:be}=Ne({tableElements:O,pageName:"orders-page",sortField:f,route:C,router:T});return(ie,r)=>{const ye=Ae("TableActions");return c(),_e("div",null,[t(we,{modelValue:a(v).isMessageShown,"onUpdate:modelValue":r[0]||(r[0]=u=>a(v).isMessageShown=u),color:a(v).messageType,"location-strategy":"connected"},{default:e(()=>[Q("p",je,I(a(v).messageText),1)]),_:1},8,["modelValue","color"]),Qe,t(oe,{elevation:"3",color:"white",class:"pa-5 rounded-lg mx-sm-0 mx-n5"},{default:e(()=>[a(b).ordersErrorMessage?R("",!0):(c(),m(le,{key:0,class:"pa-0"},{default:e(()=>[t(ye,{count:a(d),"onUpdate:count":r[1]||(r[1]=u=>D(d)?d.value=u:null),onToggleAddDialog:r[2]||(r[2]=u=>S.value=!0),onToggleSearch:r[3]||(r[3]=u=>k.value=!a(k)),"is-badge-active":!!(ie.$route.query.startDate||ie.$route.query.endDate)},{default:e(()=>[p(" Все заказы ")]),_:1},8,["count","is-badge-active"]),t(Me,null,{default:e(()=>[a(k)?(c(),m(j,{key:0,class:"mb-5"},{default:e(()=>[t(s,{sm:"6",cols:"12"},{default:e(()=>[t(j,null,{default:e(()=>[t(s,{cols:"6"},{default:e(()=>[t(F,{modelValue:a(N),"onUpdate:modelValue":r[4]||(r[4]=u=>D(N)?N.value=u:null),type:"date",label:"Начальная дата",clearable:!1},null,8,["modelValue"])]),_:1}),t(s,{cols:"6"},{default:e(()=>[t(F,{modelValue:a(P),"onUpdate:modelValue":r[5]||(r[5]=u=>D(P)?P.value=u:null),type:"date",label:"Конечная дата",clearable:!1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(s,{cols:"6"},{default:e(()=>[t(F,{modelValue:a(L),"onUpdate:modelValue":r[6]||(r[6]=u=>D(L)?L.value=u:null),label:"Клиент"},null,8,["modelValue"])]),_:1}),t(s,{cols:"6"},{default:e(()=>[t(F,{modelValue:a($),"onUpdate:modelValue":r[7]||(r[7]=u=>D($)?$.value=u:null),label:"Товар"},null,8,["modelValue"])]),_:1}),t(s,{md:"6",cols:"12"},{default:e(()=>[t(j,null,{default:e(()=>[t(s,{sm:"auto",cols:"6"},{default:e(()=>[t(E,{onClick:a(K),variant:"flat",color:"green-darken-3",block:""},{default:e(()=>[p(" Искать ")]),_:1},8,["onClick"])]),_:1}),t(s,{sm:"auto",cols:"6"},{default:e(()=>[t(E,{onClick:a(z),variant:"flat",color:"red-darken-4",block:""},{default:e(()=>[ze]),_:1},8,["onClick"])]),_:1}),t(s,{sm:"auto",cols:"12"},{default:e(()=>[t(E,{variant:"flat",color:"blue-darken-4",onClick:r[8]||(r[8]=u=>k.value=!1),block:""},{default:e(()=>[p(" Закрыть ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):R("",!0)]),_:1})]),_:1})),a(b).ordersErrorMessage?(c(),m(G,{key:1},{default:e(()=>[t(W,{variant:"outlined",border:"end",type:"error"},{default:e(()=>[Q("p",null,I(a(b).ordersErrorMessage),1)]),_:1})]),_:1})):a(M)?R("",!0):(c(),m(Te,{key:2,items:a(i),fields:_.value,"current-sort-field":f.value,onUpdateSortField:r[9]||(r[9]=u=>a(be)(u)),"is-inverse-sort":a(A),onOpenDialog:r[10]||(r[10]=(u,Se)=>a(x)(u,Se)),"no-data-text":"Заказы не найдены"},null,8,["items","fields","current-sort-field","is-inverse-sort"])),a(M)?(c(),m(G,{key:3,class:"text-center mb-2"},{default:e(()=>[t($e,{indeterminate:"",size:"32",color:"green"})]),_:1})):R("",!0),a(O).length?(c(),m(Ue,{key:4,length:a(g),modelValue:a(o),"onUpdate:modelValue":r[11]||(r[11]=u=>D(o)?o.value=u:null),rounded:"circle","total-visible":7,color:"deep-purple-darken-4"},null,8,["length","modelValue"])):R("",!0)]),_:1}),a(y)?(c(),m(Re,{key:0,"is-search-active":a(h),"is-opened":a(V),onCloseDialog:r[12]||(r[12]=u=>V.value=!1),onUpdateSearchOrders:a(H),order:a(y)},null,8,["is-search-active","is-opened","onUpdateSearchOrders","order"])):R("",!0),a(y)?(c(),m(Le,{key:1,"is-search-active":a(h),onUpdateSearchOrders:a(H),onCloseDialog:r[13]||(r[13]=u=>n.value=!1),"is-opened":a(n),order:a(y)},null,8,["is-search-active","onUpdateSearchOrders","is-opened","order"])):R("",!0),t(Ie,{"is-opened":a(S),onCloseDialog:r[14]||(r[14]=u=>S.value=!1)},null,8,["is-opened"])])}}});export{Xe as default};
