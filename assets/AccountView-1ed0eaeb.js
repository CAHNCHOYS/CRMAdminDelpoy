import{d as T,u as R,x as Y,r as _,y as Z,z as L,A as O,o as j,c as F,b as e,e as t,l as n,t as z,f as l,j as $,m as q,i as a,B as ee,k as oe,h as te,p as ae,n as se,C as le,_ as ne,D as re,q as ue}from"./index-7839c28a.js";import{u as H,a as J,b as A}from"./useFormSchemas-f6529911.js";const de=n("div",{class:"text-h5 mb-4"},"Общая информация об аккаунте",-1),ce=n("div",{class:"text-h6"},"Данные были успешно обновлены!",-1),ie=n("p",{class:"text-h6"},"Ошибка:",-1),me={class:"d-flex flex-sm-row flex-column align-sm-center"},_e=n("span",{class:"text-h6"},"Обновить данные ",-1),pe=T({__name:"AccountInfo",setup(y){const d=R(),P=Y(()=>{var r,o,w;return{name:((r=d.currentUser)==null?void 0:r.name)||"user logged out",email:((o=d.currentUser)==null?void 0:o.email)||"user logged out",country:((w=d.currentUser)==null?void 0:w.country)||"user logged out",avatar:[]}}),{updateInfoShchema:V}=H(),{handleSubmit:u,isSubmitting:S}=J({validationSchema:V,initialValues:P}),{value:x,errorMessage:k}=A("name"),{value:m,errorMessage:E}=A("email"),{value:f,errorMessage:U}=A("country"),{value:g,errorMessage:h}=A("avatar"),p=_(!1),c=_(!1),I=_(""),D=u(async r=>{try{let o=new FormData;o.append("name",r.name),o.append("email",r.email),o.append("country",r.country),o.append("avatar",r.avatar[0],g.value[0].name),o.append("id",String(d.currentUser.id));const{data:w}=await Z(o);console.log(w),w.isInfoUpdated&&(await d.updateUserToken(),p.value=!0,setTimeout(()=>p.value=!1,3500))}catch(o){console.log(o),c.value=!0,setTimeout(()=>c.value=!1,3500),L(o)?I.value=O(o):I.value="Ошибка при обновлении информации"}}),s=_("");async function b(r){const o=r.target.files[0];s.value=URL.createObjectURL(o),console.log(URL.createObjectURL(o))}function C(){s.value=""}return(r,o)=>{const w=a("v-snackbar"),B=a("v-avatar"),i=a("v-file-input"),M=a("v-col"),G=a("v-text-field"),K=a("v-select"),Q=a("v-btn"),W=a("v-row"),X=a("v-form");return j(),F("div",null,[de,e(w,{location:"right bottom","max-width":400,color:"success",modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=v=>p.value=v)},{default:t(()=>[ce]),_:1},8,["modelValue"]),e(w,{location:"right bottom",color:"error","max-width":400,modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=v=>c.value=v)},{default:t(()=>[ie,n("p",null,z(I.value),1)]),_:1},8,["modelValue"]),e(X,{onSubmit:q(l(D),["prevent"]),enctype:"multipart/form-data"},{default:t(()=>[e(W,{align:"center"},{default:t(()=>[e(M,{md:"6",cols:"12"},{default:t(()=>[n("div",me,[e(B,{size:"80",class:"mr-sm-3 mb-sm-0 mb-4 border mx-auto",image:s.value||`http://localhost:3000/UserAvatars/${l(d).currentUser.avatar}`},null,8,["image"]),e(i,{modelValue:l(g),"onUpdate:modelValue":o[2]||(o[2]=v=>$(g)?g.value=v:null),"error-messages":l(h),"show-size":"","prepend-icon":"mdi-camera","hide-details":"auto",label:"Загрузите ваш аватар",accept:".jpg, .png, .jpeg, .svg , .webp",onChange:b,"onClick:clear":C},null,8,["modelValue","error-messages"])])]),_:1}),e(M,{sm:"6",cols:"12"},{default:t(()=>[e(G,{modelValue:l(x),"onUpdate:modelValue":o[3]||(o[3]=v=>$(x)?x.value=v:null),"error-messages":l(k),label:"Ваше имя"},null,8,["modelValue","error-messages"])]),_:1}),e(M,{sm:"6",cols:"12"},{default:t(()=>[e(G,{modelValue:l(m),"onUpdate:modelValue":o[4]||(o[4]=v=>$(m)?m.value=v:null),"error-messages":l(E),label:"Ваша почта"},null,8,["modelValue","error-messages"])]),_:1}),e(M,{sm:"6",cols:"12"},{default:t(()=>[e(K,{modelValue:l(f),"onUpdate:modelValue":o[5]||(o[5]=v=>$(f)?f.value=v:null),"error-messages":l(U),items:["Россия","Беларусь","Латвия","Украина","Казахстан","Узбекистан"],label:"Страна проживания"},null,8,["modelValue","error-messages"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(Q,{type:"submit",variant:"flat",loading:l(S),color:"green"},{default:t(()=>[_e]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}}}),ve=n("div",{class:"text-h5 mb-3"},"Безопасность",-1),fe=n("p",{class:"text-h6 mb-1"},"Ошибка:",-1),ge={class:"text-h6"},be=n("p",{class:"text-h6"},"Пароль был успешно обновлен !",-1),we=n("span",{class:"text-white text-h6"},"Обновить пароль",-1),xe=T({__name:"AccountSecurity",setup(y){const{updatePasswordSchema:d}=H(),{handleSubmit:P,isSubmitting:V}=J({validationSchema:d}),{value:u,errorMessage:S}=A("oldPassword"),{value:x,errorMessage:k}=A("newPassword"),{value:m,errorMessage:E}=A("newPasswordConfirm"),f=_(!1),U=_(!1),g=_(""),h=_(!1),p=_(!1),c=R(),I=P(async D=>{const s=c.currentUser.id;try{const{data:b}=await ee({...D,id:s});b.isInfoUpdated&&(await c.updateUserToken(),U.value=!0,setTimeout(()=>U.value=!1,3500))}catch(b){f.value=!0,setTimeout(()=>f.value=!1,3500),L(b)?g.value=O(b):g.value="Ошибка при обновлении пароля",console.log(b)}});return(D,s)=>{const b=a("v-snackbar"),C=a("v-text-field"),r=a("v-col"),o=a("v-btn"),w=a("v-row"),B=a("v-form");return j(),F("div",null,[ve,e(b,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=i=>f.value=i),color:"error",location:"bottom right"},{default:t(()=>[fe,n("p",ge,z(g.value),1)]),_:1},8,["modelValue"]),e(b,{modelValue:U.value,"onUpdate:modelValue":s[1]||(s[1]=i=>U.value=i),color:"success",location:"bottom right"},{default:t(()=>[be]),_:1},8,["modelValue"]),e(B,{onSubmit:q(l(I),["prevent"])},{default:t(()=>[e(w,null,{default:t(()=>[e(r,{cols:"12"},{default:t(()=>[e(C,{modelValue:l(u),"onUpdate:modelValue":s[2]||(s[2]=i=>$(u)?u.value=i:null),"error-messages":l(S),label:"Старый пароль",type:p.value?"text":"password","append-inner-icon":p.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":s[3]||(s[3]=i=>p.value=!p.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1}),e(r,{sm:"6",cols:"12"},{default:t(()=>[e(C,{label:"Новый пароль",modelValue:l(x),"onUpdate:modelValue":s[4]||(s[4]=i=>$(x)?x.value=i:null),"error-messages":l(k),type:h.value?"text":"password","append-inner-icon":h.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":s[5]||(s[5]=i=>h.value=!h.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1}),e(r,{sm:"6",cols:"12"},{default:t(()=>[e(C,{modelValue:l(m),"onUpdate:modelValue":s[6]||(s[6]=i=>$(m)?m.value=i:null),"error-messages":l(E),label:"Повторите новый пароль",type:h.value?"text":"password"},null,8,["modelValue","error-messages","type"])]),_:1}),e(r,{cols:"12"},{default:t(()=>[e(o,{type:"submit",loading:l(V),variant:"flat",color:"green"},{default:t(()=>[we]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}}}),N=y=>(ae("data-v-ecfbe209"),y=y(),se(),y),he=N(()=>n("div",{class:"text-h5 mb-4"},"Удаление аккаунта",-1)),Ve={class:"text-h6"},Ue=N(()=>n("p",{class:"text-h6"},"Отменить это действие будет невозможно",-1)),ye={class:"mb-2"},Se=N(()=>n("span",{class:"font-weight-bold"},"Я хочу удалить аккаунт ",-1)),ke=N(()=>n("span",{class:"text-h6"},"Удалить аккаунт",-1)),$e=T({__name:"AccountDeletion",setup(y){const d=R(),P=te(),V=_(!1),u=_(!1),S=_(""),x=async()=>{if(V.value&&window.confirm("Вы точно уверены?"))try{await le(d.currentUser.id),d.logOutUser(),P.push({name:"login-page"})}catch(k){u.value=!0,L(k)?S.value=O(k):S.value="Ошибка при удалении!",setTimeout(()=>u.value=!1,3500)}};return(k,m)=>{const E=a("v-snackbar"),f=a("v-alert-title"),U=a("v-alert"),g=a("v-checkbox"),h=a("v-btn"),p=a("v-form");return j(),F("div",null,[he,e(E,{modelValue:u.value,"onUpdate:modelValue":m[0]||(m[0]=c=>u.value=c),location:"bottom right",color:"error"},{default:t(()=>[n("p",Ve,z(S.value),1)]),_:1},8,["modelValue"]),e(p,{onSubmit:q(x,["prevent"])},{default:t(()=>[e(U,{border:"end",variant:"tonal",color:"red-darken-2"},{default:t(()=>[e(f,{class:"text-h6 mb-1"},{default:t(()=>[oe("Вы уверены что хотите удалить аккаунт?")]),_:1}),Ue]),_:1}),n("p",ye,[e(g,{modelValue:V.value,"onUpdate:modelValue":m[1]||(m[1]=c=>V.value=c),rules:[c=>!!c||"Подтвердите удаление аккаунта"],required:"",color:"red-darken-2",class:"text-red-darken-4"},{label:t(()=>[Se]),_:1},8,["modelValue","rules"])]),e(h,{type:"submit",color:"error"},{default:t(()=>[ke]),_:1})]),_:1},8,["onSubmit"])])}}});const Ae=ne($e,[["__scopeId","data-v-ecfbe209"]]),Pe={key:0},Ee=n("div",{class:"title text-h2 mb-5 anim"},"Аккаунт",-1),Me=T({__name:"AccountView",setup(y){const d=R();return re(()=>{}),(P,V)=>{const u=a("v-card");return l(d).currentUser?(j(),F("div",Pe,[Ee,e(u,{color:"white",elevation:"2",class:"anim pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:t(()=>[e(pe)]),_:1}),e(u,{color:"white",elevation:"2",class:"anim pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:t(()=>[e(xe)]),_:1}),e(u,{color:"white",elevation:"2",class:"anim pa-5 rounded-lg mx-sm-0 mx-n5"},{default:t(()=>[e(Ae)]),_:1})])):ue("",!0)}}});export{Me as default};
