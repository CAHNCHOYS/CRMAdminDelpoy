System.register(["./index-legacy-f3dd0dbc.js","./alert-legacy-6dc9dd53.js","./ElementsTable.vue_vue_type_script_setup_true_lang-legacy-9c4a2141.js","./useFormSchemas-legacy-ce8ffa27.js"],(function(e,a){"use strict";var l,t,r,o,s,d,u,i,c,n,m,v,p,g,f,h,b,y,_,P,x,S,k,M,V,w,U,A,C,q,T,E,D;return{setters:[e=>{l=e.r,t=e.D,r=e.P,o=e.i,s=e.h,d=e.d,u=e.z,i=e.E,c=e.v,n=e.y,m=e.e,v=e.j,p=e.k,g=e.o,f=e.b,h=e.n,b=e.f,y=e.p,_=e.l,P=e.t,x=e.m,S=e.u,k=e.B,M=e.c,V=e.x,w=e.g},e=>{U=e.u},e=>{A=e.u,C=e.a,q=e._},e=>{T=e.u,E=e.a,D=e.b}],execute:function(){const a=x("p",{class:"text-h6 font-weight-bold mb-4"},"Редактирование товара",-1),N=x("p",{class:"text-h6 mb-2"},"Загрузка категорий....",-1),F=d({__name:"ProductEditDialog",props:{isActive:{type:Boolean},product:null,isSearchActive:{type:Boolean}},emits:["closeModal","updateSearchProducts"],setup(e,{emit:l}){const t=e,d=u((()=>({name:t.product?.name||"Товар не был выбран",price:t.product?.price||0,count:t.product?.count||0,categoryId:t.product?.categoryId||0}))),{userProductSchema:x}=T(),{handleSubmit:S,isSubmitting:k,resetForm:M}=E({validationSchema:x,initialValues:d}),{value:V,errorMessage:w}=D("name"),{value:A,errorMessage:C}=D("price"),{value:q,errorMessage:F}=D("count"),{value:I,errorMessage:$}=D("categoryId"),j=i(),B=U(),{productsCategories:L,categoriesErrorMessage:z,isCategoriesLoading:Q}=c(j),O=v(),G=S((async e=>{try{await r.updateProduct(e,t.product.id);const a=L.value.find((a=>a.id===e.categoryId)).name;j.updateUserProduct({...e,category:a,id:t.product.id}),t.isSearchActive&&l("updateSearchProducts"),B.showMessage("success","Товар был изменен")}catch(a){if(o(a)){if(401===a.response?.status)return void O.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"products-page"}});B.showMessage("error",s(a))}else B.showMessage("error","Ошибка при обновлении товара!")}finally{M(),l("closeModal")}}));return(l,t)=>{const r=p("v-card-title"),o=p("v-text-field"),s=p("v-col"),d=p("v-progress-linear"),u=p("v-sheet"),i=p("v-autocomplete"),c=p("v-alert-title"),v=p("v-alert"),x=p("v-btn"),S=p("v-row"),M=p("v-form"),U=p("v-card-actions"),T=p("v-card"),E=p("v-dialog");return g(),n(E,{transition:"dialog-bottom-transition","max-width":"500","onUpdate:modelValue":t[5]||(t[5]=e=>l.$emit("closeModal")),"model-value":e.isActive},{default:m((()=>[f(T,{class:"pa-5",color:"white",elevation:"4"},{default:m((()=>[f(r,null,{default:m((()=>[a])),_:1}),f(U,null,{default:m((()=>[f(M,{onSubmit:h(b(G),["prevent"])},{default:m((()=>[f(S,null,{default:m((()=>[f(s,{cols:"12"},{default:m((()=>[f(o,{modelValue:b(V),"onUpdate:modelValue":t[0]||(t[0]=e=>y(V)?V.value=e:null),"error-messages":b(w),label:"Название товара"},null,8,["modelValue","error-messages"])])),_:1}),f(s,{cols:"12"},{default:m((()=>[b(Q)?(g(),n(u,{key:0},{default:m((()=>[N,f(d,{indeterminate:"",height:"6",color:"green"})])),_:1})):b(z)?(g(),n(u,{key:2},{default:m((()=>[f(v,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:m((()=>[f(c,{class:"text-h6"},{default:m((()=>[_(P(b(z)),1)])),_:1})])),_:1})])),_:1})):(g(),n(i,{key:1,modelValue:b(I),"onUpdate:modelValue":t[1]||(t[1]=e=>y(I)?I.value=e:null),label:"Категория товара","error-messages":b($),items:b(L),"item-title":"name",clearable:!1,"item-value":"id","no-data-text":"Нет категорий"},null,8,["modelValue","error-messages","items"]))])),_:1}),f(s,{sm:"6",cols:"12"},{default:m((()=>[f(o,{modelValue:b(q),"onUpdate:modelValue":t[2]||(t[2]=e=>y(q)?q.value=e:null),modelModifiers:{number:!0},"error-messages":b(F),label:"Количество",type:"number"},null,8,["modelValue","error-messages"])])),_:1}),f(s,{sm:"6",cols:"12"},{default:m((()=>[f(o,{modelValue:b(A),"onUpdate:modelValue":t[3]||(t[3]=e=>y(A)?A.value=e:null),modelModifiers:{number:!0},"error-messages":b(C),label:"Цена",type:"number",suffix:"руб"},null,8,["modelValue","error-messages"])])),_:1}),f(s,{cols:"12"},{default:m((()=>[f(x,{color:"green-darken-4",variant:"flat",loading:b(k),type:"submit"},{default:m((()=>[_(" Сохранить ")])),_:1},8,["loading"]),f(x,{color:"blue-darken-4",variant:"flat",onClick:t[4]||(t[4]=e=>l.$emit("closeModal"))},{default:m((()=>[_(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"])}}}),I=x("p",{class:"font-weight-bold text-h5"},"Подтверждение удаления",-1),$={class:"text-h6"},j={class:"text-red"},B=x("span",{class:"text-white"},"Нет",-1),L=d({__name:"ProductDeleteDialog",props:{product:null,isActive:{type:Boolean},isSearchActive:{type:Boolean}},emits:["closeModal","updateSearchProducts"],setup(e,{emit:a}){const t=e,d=l(!1),u=i(),c=U(),h=v(),b=async()=>{try{d.value=!0,await r.deleteProduct(t.product.id),u.deleteUserProduct(t.product.id),t.isSearchActive&&a("updateSearchProducts"),c.showMessage("success","Товар был успешно удален")}catch(e){if(o(e)){if(401===e.response?.status)return void h.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"products-page"}});c.showMessage("error",s(e))}else c.showMessage("error","Ошибка при удалении товара!")}finally{d.value=!1,a("closeModal")}};return(a,l)=>{const r=p("v-card-title"),o=p("v-card-text"),s=p("v-btn"),u=p("v-card-actions"),i=p("v-card"),c=p("v-dialog");return g(),n(c,{"model-value":e.isActive,"max-width":450,persistent:"",transition:"dialog-bottom-transition"},{default:m((()=>[f(i,{class:"pa-4"},{default:m((()=>[f(r,{class:"pa-0 mb-3"},{default:m((()=>[I])),_:1}),f(o,{class:"pa-0 mb-4"},{default:m((()=>[x("p",$,[_(" Вы уверены что хотите удалить товар "),x("span",j,P(t.product.name),1),_(" из списка? ")])])),_:1}),f(u,{class:"justify-center"},{default:m((()=>[f(s,{onClick:l[0]||(l[0]=e=>a.$emit("closeModal")),height:"40",color:"blue-darken-4",variant:"flat"},{default:m((()=>[B])),_:1}),f(s,{height:"40",loading:d.value,color:"error",variant:"flat",onClick:b},{default:m((()=>[_("Да")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["model-value"])}}}),z=x("p",{class:"text-h6 font-weight-bold mb-4"},"Добавление нового товара",-1),Q=x("p",{class:"text-h6 mb-2"},"Загрузка категорий....",-1),O=d({__name:"ProductAddDialog",props:{isActive:{type:Boolean}},emits:["closeModal"],setup(e,{emit:a}){const{userProductSchema:l}=T(),{handleSubmit:t,isSubmitting:d,resetForm:u}=E({validationSchema:l}),{value:x,errorMessage:S}=D("name"),{value:k,errorMessage:M}=D("categoryId"),{value:V,errorMessage:w}=D("count"),{value:A,errorMessage:C}=D("price"),q=i(),N=U(),{productsCategories:F,categoriesErrorMessage:I,isCategoriesLoading:$}=c(q),j=v(),B=t((async e=>{try{const{data:a}=await r.addProduct(e);console.log(e),q.addUserProduct({...e,...a}),N.showMessage("success",`Товар ${e.name} был успешно добавлен!`)}catch(l){if(o(l)){if(401===l.response?.status)return void j.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"products-page"}});N.showMessage("error",s(l))}else N.showMessage("error","Ошибка при добавлении товара !")}finally{u(),a("closeModal")}}));return(a,l)=>{const t=p("v-card-title"),r=p("v-text-field"),o=p("v-col"),s=p("v-progress-linear"),u=p("v-sheet"),i=p("v-autocomplete"),c=p("v-alert-title"),v=p("v-alert"),U=p("v-btn"),q=p("v-row"),T=p("v-form"),E=p("v-card-actions"),D=p("v-card"),N=p("v-dialog");return g(),n(N,{transition:"dialog-bottom-transition","max-width":"500","onUpdate:modelValue":l[5]||(l[5]=e=>a.$emit("closeModal")),scrollable:"","model-value":e.isActive},{default:m((()=>[f(D,{class:"pa-5",color:"white",elevation:"4"},{default:m((()=>[f(t,null,{default:m((()=>[z])),_:1}),f(E,null,{default:m((()=>[f(T,{onSubmit:h(b(B),["prevent"])},{default:m((()=>[f(q,null,{default:m((()=>[f(o,{cols:"12"},{default:m((()=>[f(r,{modelValue:b(x),"onUpdate:modelValue":l[0]||(l[0]=e=>y(x)?x.value=e:null),"error-messages":b(S),label:"Название товара"},null,8,["modelValue","error-messages"])])),_:1}),f(o,{cols:"12"},{default:m((()=>[b($)?(g(),n(u,{key:0},{default:m((()=>[Q,f(s,{indeterminate:"",height:"6",color:"green"})])),_:1})):b(I)?(g(),n(u,{key:2},{default:m((()=>[f(v,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:m((()=>[f(c,{class:"text-h6"},{default:m((()=>[_(P(b(I)),1)])),_:1})])),_:1})])),_:1})):(g(),n(i,{key:1,modelValue:b(k),"onUpdate:modelValue":l[1]||(l[1]=e=>y(k)?k.value=e:null),label:"Категория товара","error-messages":b(M),items:b(F),"item-title":"name",clearable:!1,"item-value":"id","no-data-text":"Нет категорий"},null,8,["modelValue","error-messages","items"]))])),_:1}),f(o,{sm:"6",cols:"12"},{default:m((()=>[f(r,{modelValue:b(V),"onUpdate:modelValue":l[2]||(l[2]=e=>y(V)?V.value=e:null),modelModifiers:{number:!0},"error-messages":b(w),label:"Количество",type:"number"},null,8,["modelValue","error-messages"])])),_:1}),f(o,{sm:"6",cols:"12"},{default:m((()=>[f(r,{modelValue:b(A),"onUpdate:modelValue":l[3]||(l[3]=e=>y(A)?A.value=e:null),modelModifiers:{number:!0},"error-messages":b(C),label:"Цена",suffix:"руб",type:"number"},null,8,["modelValue","error-messages"])])),_:1}),f(o,{cols:"12"},{default:m((()=>[f(U,{color:"green-darken-4",variant:"flat",loading:b(d),type:"submit"},{default:m((()=>[_(" Добавить ")])),_:1},8,["loading"]),f(U,{color:"blue-darken-4",variant:"flat",onClick:l[4]||(l[4]=e=>a.$emit("closeModal"))},{default:m((()=>[_(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"])}}}),G={key:0},H={class:"text-h6"},J=x("h2",{class:"title text-h2 mb-5"},"Товары",-1),K=x("span",{class:"text-wrap"}," Сбросить поиск",-1),R={class:"text-h6"};e("default",d({__name:"ProductsView",setup(e){const a=i(),d=U(),h=S(),T=l([{fieldText:"Имя",fieldName:"name"},{fieldText:"Цена(руб)",fieldName:"price"},{fieldText:"Кол-во",fieldName:"count"},{fieldText:"Категория",fieldName:"category"}]),E=l("name"),{userProducts:D,productsErrorMessage:N,productsCategories:I}=c(a);k((async()=>{I.value.length||a.getAllProductsCategories()}));const{itemToEdit:$,isAddDialogActive:j,isEditDialogActive:B,isDeleteDialogActive:z,openDialog:Q}=A(),W=w(),X=v(),{searchName:Y,searchPrices:Z,searchedProducts:ee,isSearchActive:ae,isSearchLoading:le,isSearchFormActive:te,resetSearch:re,addSearchQuery:oe,searchUserProducts:se}=((e,a,d)=>{const u=U(),i=l([+e.query.startPrice||1,+e.query.endPrice||99999]),c=l(e.query.productName||""),n=l([]),m=l(!1),v=l(!1),p=l(!1),g=async()=>{try{v.value=!0;const{data:a}=await r.getSearchedProducts({startPrice:e.query.startPrice,endPrice:e.query.endPrice,productName:e.query.productName,userId:d});n.value=a.products,console.log(n.value),m.value=!0}catch(a){o(a)?u.showMessage("error",s(a)):u.showMessage("error","Ошибка при поиске товара(")}finally{v.value=!1}};return t([()=>e.query.startPrice,()=>e.query.endPrice,()=>e.query.productName],(async()=>{(e.query.startPrice||e.query.endPrice)&&g()}),{immediate:!0}),{searchPrices:i,searchName:c,isSearchActive:m,searchedProducts:n,isSearchLoading:v,isSearchFormActive:p,searchUserProducts:g,addSearchQuery:()=>{a.push({name:"products-page",query:{...e.query,productName:c.value,startPrice:i.value[0],endPrice:i.value[1]}})},resetSearch:()=>{c.value="",i.value=[1,99999],m.value=!1,n.value=[],a.push({name:"products-page",query:{}})}}})(W,X,h.currentUser.id),de=u((()=>ae.value?ee.value:D.value)),{currentPage:ue,paginatedElements:ie,totalPages:ce,isInverseSort:ne,elementsPerPageCount:me,setSortField:ve}=C({tableElements:de,pageName:"products-page",sortField:E,route:W,router:X});return(e,a)=>{const l=p("v-snackbar"),t=p("TableActions"),r=p("v-text-field"),o=p("v-col"),s=p("v-range-slider"),u=p("v-btn"),i=p("v-row"),c=p("v-form"),v=p("v-expand-transition"),S=p("v-card-title"),k=p("v-alert-title"),w=p("v-alert"),U=p("v-progress-circular"),A=p("v-sheet"),C=p("v-pagination"),D=p("v-card");return b(h).currentUser?(g(),M("div",G,[f(l,{modelValue:b(d).isMessageShown,"onUpdate:modelValue":a[0]||(a[0]=e=>b(d).isMessageShown=e),color:b(d).messageType,position:"fixed"},{default:m((()=>[x("p",H,P(b(d).messageText),1)])),_:1},8,["modelValue","color"]),J,f(D,{color:"white",elevation:"3",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:m((()=>[b(N)?V("",!0):(g(),n(S,{key:0,class:"pa-0"},{default:m((()=>[f(t,{count:b(me),"onUpdate:count":a[1]||(a[1]=e=>y(me)?me.value=e:null),onToggleAddDialog:a[2]||(a[2]=e=>j.value=!0),onToggleSearch:a[3]||(a[3]=e=>te.value=!b(te)),"is-badge-active":!!e.$route.query.startPrice},{default:m((()=>[_(" Все товары ")])),_:1},8,["count","is-badge-active"]),f(v,null,{default:m((()=>[b(te)?(g(),n(c,{key:0,class:"mb-8"},{default:m((()=>[f(i,{align:"center"},{default:m((()=>[f(o,{sm:"6",cols:"12",class:"mb-sm-0 mb-2"},{default:m((()=>[f(r,{modelValue:b(Y),"onUpdate:modelValue":a[4]||(a[4]=e=>y(Y)?Y.value=e:null),variant:"outlined",label:"Название товара"},null,8,["modelValue"])])),_:1}),f(o,{sm:"6",cols:"12",class:"pr-7"},{default:m((()=>[f(s,{modelValue:b(Z),"onUpdate:modelValue":a[5]||(a[5]=e=>y(Z)?Z.value=e:null),min:"1",step:"10",max:"99999",color:"blue-grey-darken-2",label:"Цена:"},null,8,["modelValue"])])),_:1}),f(o,{sm:"auto",cols:"12"},{default:m((()=>[f(i,null,{default:m((()=>[f(o,{sm:"auto",cols:"6"},{default:m((()=>[f(u,{variant:"flat",color:"green-darken-3",onClick:b(oe),disabled:b(le),block:""},{default:m((()=>[_(" Искать ")])),_:1},8,["onClick","disabled"])])),_:1}),f(o,{sm:"auto",cols:"6"},{default:m((()=>[f(u,{variant:"flat",color:"red-darken-4",onClick:b(re),disabled:b(le),block:""},{default:m((()=>[K])),_:1},8,["onClick","disabled"])])),_:1}),f(o,{sm:"auto",cols:"12"},{default:m((()=>[f(u,{variant:"flat",color:"blue-darken-4",onClick:a[6]||(a[6]=e=>te.value=!1),disabled:b(le),block:""},{default:m((()=>[_(" Закрыть ")])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):V("",!0)])),_:1})])),_:1})),b(N)?(g(),n(w,{key:1,type:"error",border:"end",variant:"tonal"},{default:m((()=>[f(k,{class:"mb-2 text-h5"},{default:m((()=>[_(" Ошибка при загрузке товаров ")])),_:1}),x("p",R,P(b(N)),1)])),_:1})):b(le)?V("",!0):(g(),n(q,{key:2,items:b(ie),fields:T.value,"current-sort-field":E.value,onUpdateSortField:a[7]||(a[7]=e=>b(ve)(e)),"is-inverse-sort":b(ne),"no-data-text":"Товары не найдены",onOpenDialog:a[8]||(a[8]=(e,a)=>b(Q)(e,a))},null,8,["items","fields","current-sort-field","is-inverse-sort"])),b(le)?(g(),n(A,{key:3,class:"text-center mb-2"},{default:m((()=>[f(U,{indeterminate:"",size:"48",color:"green"})])),_:1})):V("",!0),b(de).length?(g(),n(C,{key:4,length:b(ce),modelValue:b(ue),"onUpdate:modelValue":a[9]||(a[9]=e=>y(ue)?ue.value=e:null),rounded:"circle","total-visible":7,color:"indigo-darken-4"},null,8,["length","modelValue"])):V("",!0)])),_:1}),b($)?(g(),n(F,{key:0,product:b($),onCloseModal:a[10]||(a[10]=e=>B.value=!1),"is-active":b(B),"is-search-active":b(ae),onUpdateSearchProducts:b(se)},null,8,["product","is-active","is-search-active","onUpdateSearchProducts"])):V("",!0),b($)?(g(),n(L,{key:1,"is-active":b(z),product:b($),onCloseModal:a[11]||(a[11]=e=>z.value=!1),"is-search-active":b(ae),onUpdateSearchProducts:b(se)},null,8,["is-active","product","is-search-active","onUpdateSearchProducts"])):V("",!0),f(O,{onCloseModal:a[12]||(a[12]=e=>j.value=!1),"is-active":b(j)},null,8,["is-active"])])):V("",!0)}}}))}}}));
