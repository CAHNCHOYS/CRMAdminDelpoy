System.register(["./index-legacy-f3dd0dbc.js","./useFormSchemas-legacy-ce8ffa27.js","./alert-legacy-6dc9dd53.js"],(function(e,a){"use strict";var s,l,t,r,o,n,u,d,m,c,i,p,v,g,f,h,w,b,x,y,_,V,U,M,S,k,j,C,A,I=document.createElement("style");return I.textContent=".text[data-v-80575f6d]{font-weight:600}\n",document.head.appendChild(I),{setters:[e=>{s=e.d,l=e.u,t=e.z,r=e.A,o=e.i,n=e.h,u=e.r,d=e.o,m=e.c,c=e.b,i=e.e,p=e.m,v=e.f,g=e.p,f=e.n,h=e.j,w=e.k,b=e.l,x=e.q,y=e.s,_=e._,V=e.B,U=e.C,M=e.x,S=e.t},e=>{k=e.u,j=e.a,C=e.b},e=>{A=e.u}],execute:function(){const a=p("div",{class:"text-h5 mb-4"},"Общая информация об аккаунте",-1),I={class:"d-flex flex-sm-row flex-column align-sm-center"},F=p("span",{class:"text-h6"},"Обновить данные ",-1),P=s({__name:"AccountInfo",emits:["showMessage"],setup(e,{emit:s}){const b=l(),x=t((()=>({name:b.currentUser?.name||"user logged out",email:b.currentUser?.email||"user logged out",country:b.currentUser?.country||"user logged out",avatar:[]}))),{updateInfoShchema:y}=k(),{handleSubmit:_,isSubmitting:V}=j({validationSchema:y,initialValues:x}),{value:U,errorMessage:M}=C("name"),{value:S,errorMessage:A}=C("email"),{value:P,errorMessage:T}=C("country"),{value:q,errorMessage:L}=C("avatar"),R=h(),z=_((async e=>{try{let a=new FormData;a.append("name",e.name),a.append("email",e.email),a.append("country",e.country),a.append("avatar",e.avatar[0],q.value[0].name),await r.updateInfo(a);const{data:l}=await r.getUser();b.setUser(l.user),s("showMessage","success","Данные были обновлены!")}catch(a){o(a)?(401===a.response?.status&&R.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"account-page"}}),s("showMessage","error",n(a))):s("showMessage","error","Ошибка при изменении данных!")}})),E=u("");function O(e){const a=e.target.files[0];E.value=URL.createObjectURL(a),console.log(URL.createObjectURL(a))}function D(){E.value=""}return(e,s)=>{const l=w("v-avatar"),t=w("v-file-input"),r=w("v-col"),o=w("v-text-field"),n=w("v-select"),u=w("v-btn"),h=w("v-row"),x=w("v-form");return d(),m("div",null,[a,c(x,{onSubmit:f(v(z),["prevent"]),enctype:"multipart/form-data"},{default:i((()=>[c(h,{align:"center"},{default:i((()=>[c(r,{md:"6",cols:"12"},{default:i((()=>[p("div",I,[c(l,{size:"80",class:"mr-sm-3 mb-sm-0 mb-4 border mx-auto",image:E.value||`https://crm-backend-mocha.vercel.app/UserAvatars/${v(b).currentUser.avatar}`},null,8,["image"]),c(t,{modelValue:v(q),"onUpdate:modelValue":s[0]||(s[0]=e=>g(q)?q.value=e:null),"error-messages":v(L),"show-size":"","prepend-icon":"mdi-camera","hide-details":"auto",label:"Загрузите ваш аватар",accept:".jpg, .png, .jpeg, .svg , .webp",onChange:O,"onClick:clear":D},null,8,["modelValue","error-messages"])])])),_:1}),c(r,{sm:"6",cols:"12"},{default:i((()=>[c(o,{modelValue:v(U),"onUpdate:modelValue":s[1]||(s[1]=e=>g(U)?U.value=e:null),"error-messages":v(M),label:"Ваше имя"},null,8,["modelValue","error-messages"])])),_:1}),c(r,{sm:"6",cols:"12"},{default:i((()=>[c(o,{modelValue:v(S),"onUpdate:modelValue":s[2]||(s[2]=e=>g(S)?S.value=e:null),"error-messages":v(A),label:"Ваша почта"},null,8,["modelValue","error-messages"])])),_:1}),c(r,{sm:"6",cols:"12"},{default:i((()=>[c(n,{modelValue:v(P),"onUpdate:modelValue":s[3]||(s[3]=e=>g(P)?P.value=e:null),"error-messages":v(T),items:["Россия","Беларусь","Латвия","Украина","Казахстан","Узбекистан"],label:"Страна проживания"},null,8,["modelValue","error-messages"])])),_:1}),c(r,{cols:"12"},{default:i((()=>[c(u,{type:"submit",variant:"flat",loading:v(V),color:"green"},{default:i((()=>[F])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["onSubmit"])])}}}),T=p("div",{class:"text-h5 mb-3"},"Безопасность",-1),q=p("span",{class:"text-white text-h6"},"Обновить пароль",-1),L=s({__name:"AccountSecurity",emits:["showMessage"],setup(e,{emit:a}){const{updatePasswordSchema:s}=k(),{handleSubmit:t,isSubmitting:p,resetForm:b}=j({validationSchema:s}),{value:x,errorMessage:y}=C("oldPassword"),{value:_,errorMessage:V}=C("newPassword"),{value:U,errorMessage:M}=C("newPasswordConfirm"),S=u(!1),A=u(!1),I=l(),F=h(),P=t((async e=>{try{await r.updatePassword(e);const{data:s}=await r.getUser();I.setUser(s.user),a("showMessage","success","Пароль был успешно имзенен"),b()}catch(s){if(o(s)){if(401===s.response?.status)return void F.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"account-page"}});a("showMessage","error",n(s))}else a("showMessage","error","Ошибка при изменении пароля!")}}));return(e,a)=>{const s=w("v-text-field"),l=w("v-col"),t=w("v-btn"),r=w("v-row"),o=w("v-form");return d(),m("div",null,[T,c(o,{onSubmit:f(v(P),["prevent"])},{default:i((()=>[c(r,null,{default:i((()=>[c(l,{cols:"12"},{default:i((()=>[c(s,{modelValue:v(x),"onUpdate:modelValue":a[0]||(a[0]=e=>g(x)?x.value=e:null),"error-messages":v(y),label:"Старый пароль",type:A.value?"text":"password","append-inner-icon":A.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":a[1]||(a[1]=e=>A.value=!A.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])])),_:1}),c(l,{sm:"6",cols:"12"},{default:i((()=>[c(s,{label:"Новый пароль",modelValue:v(_),"onUpdate:modelValue":a[2]||(a[2]=e=>g(_)?_.value=e:null),"error-messages":v(V),type:S.value?"text":"password","append-inner-icon":S.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":a[3]||(a[3]=e=>S.value=!S.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])])),_:1}),c(l,{sm:"6",cols:"12"},{default:i((()=>[c(s,{modelValue:v(U),"onUpdate:modelValue":a[4]||(a[4]=e=>g(U)?U.value=e:null),"error-messages":v(M),label:"Повторите новый пароль",type:S.value?"text":"password"},null,8,["modelValue","error-messages","type"])])),_:1}),c(l,{cols:"12"},{default:i((()=>[c(t,{type:"submit",loading:v(p),variant:"flat",color:"green"},{default:i((()=>[q])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["onSubmit"])])}}}),R=e=>(x("data-v-80575f6d"),e=e(),y(),e),z=R((()=>p("div",{class:"text-h5 mb-4"},"Удаление аккаунта",-1))),E=R((()=>p("p",{class:"text-h6"},"Отменить это действие будет невозможно",-1))),O={class:"mb-2"},D=R((()=>p("span",{class:"font-weight-bold"},"Я хочу удалить аккаунт ",-1))),B=R((()=>p("span",{class:"text-h6"},"Удалить аккаунт",-1))),$=_(s({__name:"AccountDeletion",emits:["showMessage"],setup(e,{emit:a}){const s=l(),t=h(),v=u(!1),g=u(!1),x=async()=>{if(v.value&&window.confirm("Вы точно уверены?"))try{await r.deleteAccount(s.currentUser.id),s.logOutUser(),t.push({name:"login-page"})}catch(e){g.value=!0,o(e)?a("showMessage","error",n(e)):a("showMessage","error","Ошибка при удалении профиля!"),setTimeout((()=>g.value=!1),3500)}};return(e,a)=>{const s=w("v-alert-title"),l=w("v-alert"),t=w("v-checkbox"),r=w("v-btn"),o=w("v-form");return d(),m("div",null,[z,c(o,{onSubmit:f(x,["prevent"])},{default:i((()=>[c(l,{border:"end",variant:"tonal",color:"red-darken-2"},{default:i((()=>[c(s,{class:"text-h6 mb-1"},{default:i((()=>[b("Вы уверены что хотите удалить аккаунт?")])),_:1}),E])),_:1}),p("p",O,[c(t,{modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=e=>v.value=e),rules:[e=>!!e||"Подтвердите удаление аккаунта"],required:"",color:"red-darken-2",class:"text-red-darken-4"},{label:i((()=>[D])),_:1},8,["modelValue","rules"])]),c(r,{type:"submit",color:"error"},{default:i((()=>[B])),_:1})])),_:1},8,["onSubmit"])])}}}),[["__scopeId","data-v-80575f6d"]]),G={key:0},H={class:"text-h6"},J=p("div",{class:"title text-h2 mb-5 anim"},"Аккаунт",-1),K={class:"account-items"};e("default",s({__name:"AccountView",setup(e){const a=l(),s=A(),t=(e,a)=>{s.showMessage(e,a)};return V((()=>{U.from(".account-items > *",{y:"-70%",opacity:0,duration:.8,stagger:.4,ease:"power3.out"})})),(e,l)=>{const r=w("v-snackbar"),o=w("v-card");return v(a).currentUser?(d(),m("div",G,[c(r,{modelValue:v(s).isMessageShown,"onUpdate:modelValue":l[0]||(l[0]=e=>v(s).isMessageShown=e),color:v(s).messageType,position:"fixed"},{default:i((()=>[p("p",H,S(v(s).messageText),1)])),_:1},8,["modelValue","color"]),J,p("div",K,[p("div",null,[c(o,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:i((()=>[c(P,{onShowMessage:t})])),_:1})]),p("div",null,[c(o,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:i((()=>[c(L,{onShowMessage:t})])),_:1})]),p("div",null,[c(o,{color:"white",elevation:"2",class:"pa-5 rounded-lg mx-sm-0 mx-n5"},{default:i((()=>[c($,{onShowMessage:t})])),_:1})])])])):M("",!0)}}}))}}}));
