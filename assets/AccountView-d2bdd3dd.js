import{d as F,u as R,z as Y,A as D,i as q,h as B,r as $,o as T,c as j,b as e,e as o,m as r,f as s,p as A,n as L,j as O,k as t,t as W,l as Z,q as ee,s as oe,_ as se,B as te,C as ae,x as re}from"./index-6bc77bae.js";import{u as G,a as H,b as k}from"./useFormSchemas-2bba9048.js";import{u as ne}from"./alert-ad4a9987.js";const le=r("div",{class:"text-h5 mb-4"},"Общая информация об аккаунте",-1),ue={class:"d-flex flex-sm-row flex-column align-sm-center"},ce=r("span",{class:"text-h6"},"Обновить данные ",-1),de=F({__name:"AccountInfo",emits:["showMessage"],setup(y,{emit:m}){const n=R(),h=Y(()=>{var c,a,l;return{name:((c=n.currentUser)==null?void 0:c.name)||"user logged out",email:((a=n.currentUser)==null?void 0:a.email)||"user logged out",country:((l=n.currentUser)==null?void 0:l.country)||"user logged out",avatar:[]}}),{updateInfoShchema:f}=G(),{handleSubmit:d,isSubmitting:b}=H({validationSchema:f,initialValues:h}),{value:_,errorMessage:p}=k("name"),{value:w,errorMessage:V}=k("email"),{value:M,errorMessage:x}=k("country"),{value:v,errorMessage:C}=k("avatar"),E=O(),S=d(async c=>{var a;try{let l=new FormData;l.append("name",c.name),l.append("email",c.email),l.append("country",c.country),l.append("avatar",c.avatar[0],v.value[0].name),await D.updateInfo(l);const{data:I}=await D.getUser();n.setUser(I.user),m("showMessage","success","Данные были обновлены!")}catch(l){q(l)?(((a=l.response)==null?void 0:a.status)===401&&E.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"account-page"}}),m("showMessage","error",B(l))):m("showMessage","error","Ошибка при изменении данных!")}}),P=$("");function u(c){const a=c.target.files[0];P.value=URL.createObjectURL(a),console.log(URL.createObjectURL(a))}function g(){P.value=""}return(c,a)=>{const l=t("v-avatar"),I=t("v-file-input"),i=t("v-col"),z=t("v-text-field"),J=t("v-select"),K=t("v-btn"),Q=t("v-row"),X=t("v-form");return T(),j("div",null,[le,e(X,{onSubmit:L(s(S),["prevent"]),enctype:"multipart/form-data"},{default:o(()=>[e(Q,{align:"center"},{default:o(()=>[e(i,{md:"6",cols:"12"},{default:o(()=>[r("div",ue,[e(l,{size:"80",class:"mr-sm-3 mb-sm-0 mb-4 border mx-auto",image:P.value||`http://localhost:3000/UserAvatars/${s(n).currentUser.avatar}`},null,8,["image"]),e(I,{modelValue:s(v),"onUpdate:modelValue":a[0]||(a[0]=U=>A(v)?v.value=U:null),"error-messages":s(C),"show-size":"","prepend-icon":"mdi-camera","hide-details":"auto",label:"Загрузите ваш аватар",accept:".jpg, .png, .jpeg, .svg , .webp",onChange:u,"onClick:clear":g},null,8,["modelValue","error-messages"])])]),_:1}),e(i,{sm:"6",cols:"12"},{default:o(()=>[e(z,{modelValue:s(_),"onUpdate:modelValue":a[1]||(a[1]=U=>A(_)?_.value=U:null),"error-messages":s(p),label:"Ваше имя"},null,8,["modelValue","error-messages"])]),_:1}),e(i,{sm:"6",cols:"12"},{default:o(()=>[e(z,{modelValue:s(w),"onUpdate:modelValue":a[2]||(a[2]=U=>A(w)?w.value=U:null),"error-messages":s(V),label:"Ваша почта"},null,8,["modelValue","error-messages"])]),_:1}),e(i,{sm:"6",cols:"12"},{default:o(()=>[e(J,{modelValue:s(M),"onUpdate:modelValue":a[3]||(a[3]=U=>A(M)?M.value=U:null),"error-messages":s(x),items:["Россия","Беларусь","Латвия","Украина","Казахстан","Узбекистан"],label:"Страна проживания"},null,8,["modelValue","error-messages"])]),_:1}),e(i,{cols:"12"},{default:o(()=>[e(K,{type:"submit",variant:"flat",loading:s(b),color:"green"},{default:o(()=>[ce]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}}}),ie=r("div",{class:"text-h5 mb-3"},"Безопасность",-1),me=r("span",{class:"text-white text-h6"},"Обновить пароль",-1),_e=F({__name:"AccountSecurity",emits:["showMessage"],setup(y,{emit:m}){const{updatePasswordSchema:n}=G(),{handleSubmit:h,isSubmitting:f,resetForm:d}=H({validationSchema:n}),{value:b,errorMessage:_}=k("oldPassword"),{value:p,errorMessage:w}=k("newPassword"),{value:V,errorMessage:M}=k("newPasswordConfirm"),x=$(!1),v=$(!1),C=R(),E=O(),S=h(async P=>{var u;try{await D.updatePassword(P);const{data:g}=await D.getUser();C.setUser(g.user),m("showMessage","success","Пароль был успешно имзенен"),d()}catch(g){if(q(g)){if(((u=g.response)==null?void 0:u.status)===401){E.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"account-page"}});return}m("showMessage","error",B(g))}else m("showMessage","error","Ошибка при изменении пароля!")}});return(P,u)=>{const g=t("v-text-field"),c=t("v-col"),a=t("v-btn"),l=t("v-row"),I=t("v-form");return T(),j("div",null,[ie,e(I,{onSubmit:L(s(S),["prevent"])},{default:o(()=>[e(l,null,{default:o(()=>[e(c,{cols:"12"},{default:o(()=>[e(g,{modelValue:s(b),"onUpdate:modelValue":u[0]||(u[0]=i=>A(b)?b.value=i:null),"error-messages":s(_),label:"Старый пароль",type:v.value?"text":"password","append-inner-icon":v.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":u[1]||(u[1]=i=>v.value=!v.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1}),e(c,{sm:"6",cols:"12"},{default:o(()=>[e(g,{label:"Новый пароль",modelValue:s(p),"onUpdate:modelValue":u[2]||(u[2]=i=>A(p)?p.value=i:null),"error-messages":s(w),type:x.value?"text":"password","append-inner-icon":x.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":u[3]||(u[3]=i=>x.value=!x.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1}),e(c,{sm:"6",cols:"12"},{default:o(()=>[e(g,{modelValue:s(V),"onUpdate:modelValue":u[4]||(u[4]=i=>A(V)?V.value=i:null),"error-messages":s(M),label:"Повторите новый пароль",type:x.value?"text":"password"},null,8,["modelValue","error-messages","type"])]),_:1}),e(c,{cols:"12"},{default:o(()=>[e(a,{type:"submit",loading:s(f),variant:"flat",color:"green"},{default:o(()=>[me]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}}}),N=y=>(ee("data-v-4164d402"),y=y(),oe(),y),pe=N(()=>r("div",{class:"text-h5 mb-4"},"Удаление аккаунта",-1)),ve={class:"text-h6"},ge=N(()=>r("p",{class:"text-h6"},"Отменить это действие будет невозможно",-1)),fe={class:"mb-2"},we=N(()=>r("span",{class:"font-weight-bold"},"Я хочу удалить аккаунт ",-1)),he=N(()=>r("span",{class:"text-h6"},"Удалить аккаунт",-1)),be=F({__name:"AccountDeletion",emits:["showMessage"],setup(y,{emit:m}){const n=R(),h=O(),f=$(!1),d=$(!1),b=$(""),_=async()=>{if(f.value&&window.confirm("Вы точно уверены?"))try{await D.deleteAccount(n.currentUser.id),n.logOutUser(),h.push({name:"login-page"})}catch(p){d.value=!0,q(p)?m("showMessage","error",B(p)):m("showMessage","error","Ошибка при удалении профиля!"),setTimeout(()=>d.value=!1,3500)}};return(p,w)=>{const V=t("v-snackbar"),M=t("v-alert-title"),x=t("v-alert"),v=t("v-checkbox"),C=t("v-btn"),E=t("v-form");return T(),j("div",null,[pe,e(V,{modelValue:d.value,"onUpdate:modelValue":w[0]||(w[0]=S=>d.value=S),location:"bottom right",color:"error"},{default:o(()=>[r("p",ve,W(b.value),1)]),_:1},8,["modelValue"]),e(E,{onSubmit:L(_,["prevent"])},{default:o(()=>[e(x,{border:"end",variant:"tonal",color:"red-darken-2"},{default:o(()=>[e(M,{class:"text-h6 mb-1"},{default:o(()=>[Z("Вы уверены что хотите удалить аккаунт?")]),_:1}),ge]),_:1}),r("p",fe,[e(v,{modelValue:f.value,"onUpdate:modelValue":w[1]||(w[1]=S=>f.value=S),rules:[S=>!!S||"Подтвердите удаление аккаунта"],required:"",color:"red-darken-2",class:"text-red-darken-4"},{label:o(()=>[we]),_:1},8,["modelValue","rules"])]),e(C,{type:"submit",color:"error"},{default:o(()=>[he]),_:1})]),_:1},8,["onSubmit"])])}}});const xe=se(be,[["__scopeId","data-v-4164d402"]]),Se={key:0},ye={class:"text-h6"},Ve=r("div",{class:"title text-h2 mb-5 anim"},"Аккаунт",-1),Me={class:"account-items"},Pe=F({__name:"AccountView",setup(y){const m=R(),n=ne(),h=(f,d)=>{n.showMessage(f,d)};return te(()=>{ae.from(".account-items > *",{y:"-70%",opacity:0,duration:.8,stagger:.4,ease:"power3.out"})}),(f,d)=>{const b=t("v-snackbar"),_=t("v-card");return s(m).currentUser?(T(),j("div",Se,[e(b,{modelValue:s(n).isMessageShown,"onUpdate:modelValue":d[0]||(d[0]=p=>s(n).isMessageShown=p),color:s(n).messageType,location:"bottom right"},{default:o(()=>[r("p",ye,W(s(n).messageText),1)]),_:1},8,["modelValue","color"]),Ve,r("div",Me,[r("div",null,[e(_,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:o(()=>[e(de,{onShowMessage:h})]),_:1})]),r("div",null,[e(_,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:o(()=>[e(_e,{onShowMessage:h})]),_:1})]),r("div",null,[e(_,{color:"white",elevation:"2",class:"pa-5 rounded-lg mx-sm-0 mx-n5"},{default:o(()=>[e(xe,{onShowMessage:h})]),_:1})])])])):re("",!0)}}});export{Pe as default};
