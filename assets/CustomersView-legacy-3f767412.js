System.register(["./index-legacy-2e63bdda.js","./useLogoutHandler-legacy-f4541d6f.js","./useFormSchemas-legacy-7f6262d4.js","./ElementsTable.vue_vue_type_script_setup_true_lang-legacy-f5cc59e9.js"],(function(e,a){"use strict";var l,s,o,t,r,u,d,i,n,m,c,g,h,p,f,v,_,b,y,V,S,N,C,w,k,D,U,x,M,q,A,T,P,E,F,O,W,j,B,L,$,I,Q,H,z,G,K,X,J,R,Y,Z,ee;return{setters:[e=>{l=e.d,s=e.a,o=e.ak,t=e.r,r=e.P,u=e.f,d=e.$,i=e.o,n=e.e,m=e.v,c=e.q,g=e.a3,h=e.s,p=e.t,f=e.x,v=e.G,_=e.g,b=e.at,y=e.i,V=e.h,S=e.y,N=e.j,C=e.B,w=e.C,k=e.D,D=e.E,U=e.au,x=e.ai,M=e.X,q=e.u,A=e.K,T=e.Q,P=e.c,E=e.W,F=e.N,O=e.l,W=e.m,j=e.a4,B=e.M,L=e.O,$=e.p,I=e.n,Q=e.a6,H=e.a0,z=e.a7,G=e.H},e=>{K=e.u},e=>{X=e.u,J=e.a,R=e.b},e=>{Y=e.u,Z=e.a,ee=e._}],execute:function(){const a={class:"text-error"},ae=l({__name:"CustomersDeleteDialog",props:{isOpened:{type:Boolean},customer:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchCustomers"],setup(e,{emit:l}){const S=e,N=s(),C=o(),{handleLogout:w}=K("customers-page"),k=t(!1),D=async()=>{try{k.value=!0,await b.deleteCustomer(S.customer.id),C.deleteCustomer(S.customer.id),S.isSearchActive&&l("updateSearchCustomers"),N.showMessage("success","Клиент был успешно удален!")}catch(e){if(y(e)){if(401===e.response?.status)return void(await w());N.showMessage("error",V(e))}else N.showMessage("error","Ошибка при удалении клиента!")}finally{k.value=!1,l("closeDialog")}};return(l,s)=>(i(),r(d,{width:"auto","model-value":e.isOpened,persistent:!0,transition:"dialog-bottom-transition"},{default:u((()=>[n(_,{color:"white",class:"pa-4","max-width":450},{default:u((()=>[n(m,{class:"text-h5 mb-4 pa-0 font-weight-bold"},{default:u((()=>[c("Подтвердите удаление клиента")])),_:1}),n(g,{class:"text-h6 mb-4 pa-0"},{default:u((()=>[c(" Вы уверены что хотиет удалить клиента "),h("span",a,p(e.customer.firstName+" "+e.customer.secondName),1),c(" ? ")])),_:1}),n(f,{class:"justify-center pa-0"},{default:u((()=>[n(v,{onClick:s[0]||(s[0]=e=>l.$emit("closeDialog")),height:"40",color:"blue-darken-4",variant:"flat"},{default:u((()=>[c(" Нет ")])),_:1}),n(v,{height:"40",color:"error",variant:"flat",loading:k.value,onClick:D},{default:u((()=>[c("Да")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),le=h("p",{class:"text-h6"},"Премиум клиент",-1),se=l({__name:"CustomersAddDialog",props:{isOpened:{type:Boolean}},emits:["closeDialog"],setup(e,{emit:a}){const{userCustomerSchema:l}=X(),{resetForm:t,handleSubmit:g,isSubmitting:h}=J({validationSchema:l}),{value:p,errorMessage:x}=R("firstName"),{value:M,errorMessage:q}=R("secondName"),{value:A,errorMessage:T}=R("thirdName"),{value:P,errorMessage:E}=R("phone"),{value:F,errorMessage:O}=R("premium");F.value="Нет";const W=s(),j=o(),{handleLogout:B}=K("customers-page"),L=g((async e=>{try{const{data:a}=await b.addCustomer(e);j.addCustomer({...e,id:a.customerId,fullName:e.secondName+" "+e.firstName+" "+e.thirdName}),W.showMessage("success","Клиент "+e.secondName+" был успешно добавлен!")}catch(l){if(y(l)){if(401===l.response?.status)return void(await B());W.showMessage("error",V(l))}else W.showMessage("error","Ошибка при добавлении клиента")}finally{a("closeDialog"),t()}}));return(l,s)=>(i(),r(d,{"model-value":e.isOpened,"onUpdate:modelValue":s[6]||(s[6]=e=>a("closeDialog")),width:"auto",scrollable:"",transition:"dialog-bottom-transition"},{default:u((()=>[n(_,{color:"white",class:"pa-4",width:"450"},{default:u((()=>[n(m,{class:"font-weight-bold text-h6 mb-3"},{default:u((()=>[c(" Добавление нового клиента ")])),_:1}),n(f,null,{default:u((()=>[n(S,{onSubmit:N(L)},{default:u((()=>[n(C,null,{default:u((()=>[n(w,{cols:"12"},{default:u((()=>[n(k,{modelValue:N(p),"onUpdate:modelValue":s[0]||(s[0]=e=>D(p)?p.value=e:null),"error-messages":N(x),label:"Имя"},null,8,["modelValue","error-messages"])])),_:1}),n(w,{cols:"12"},{default:u((()=>[n(k,{modelValue:N(M),"onUpdate:modelValue":s[1]||(s[1]=e=>D(M)?M.value=e:null),"error-messages":N(q),label:"Фамилия"},null,8,["modelValue","error-messages"])])),_:1}),n(w,{cols:"12"},{default:u((()=>[n(k,{modelValue:N(A),"onUpdate:modelValue":s[2]||(s[2]=e=>D(A)?A.value=e:null),"error-messages":N(T),label:"Отчество"},null,8,["modelValue","error-messages"])])),_:1}),n(w,{cols:"12"},{default:u((()=>[n(k,{label:"Номер телефона",modelValue:N(P),"onUpdate:modelValue":s[3]||(s[3]=e=>D(P)?P.value=e:null),"error-messages":N(E)},null,8,["modelValue","error-messages"])])),_:1}),n(w,{cols:"12"},{default:u((()=>[le,n(U,{modelValue:N(F),"onUpdate:modelValue":s[4]||(s[4]=e=>D(F)?F.value=e:null),"true-value":"Да","false-value":"Нет","hide-details":"",label:N(F),color:"indigo","error-messages":N(O)},null,8,["modelValue","label","error-messages"])])),_:1}),n(w,{cols:"12"},{default:u((()=>[n(v,{color:"green-darken-4",variant:"flat",type:"submit",loading:N(h)},{default:u((()=>[c(" Добавить ")])),_:1},8,["loading"]),n(v,{color:"blue-darken-4",variant:"flat",onClick:s[5]||(s[5]=e=>l.$emit("closeDialog"))},{default:u((()=>[c(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),oe=h("p",{class:"text-h6"},"Премиум клиент ?",-1),te=l({__name:"CustomersEditDialog",props:{isOpened:{type:Boolean},customer:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchCustomers"],setup(e,{emit:a}){const l=e,t=x((()=>({firstName:l.customer.firstName,secondName:l.customer.secondName,thirdName:l.customer.thirdName,phone:l.customer.phone,premium:l.customer.premium}))),{userCustomerSchema:g}=X(),{resetForm:h,handleSubmit:p,isSubmitting:M}=J({validationSchema:g,initialValues:t}),{value:q,errorMessage:A}=R("firstName"),{value:T,errorMessage:P}=R("secondName"),{value:E,errorMessage:F}=R("thirdName"),{value:O,errorMessage:W}=R("phone"),{value:j}=R("premium"),B=s(),L=o(),{handleLogout:$}=K("customers-page"),I=p((async e=>{try{await b.updateCustomer(e,l.customer.id),L.updateCustomer({...e,id:l.customer.id,fullName:e.secondName+" "+e.firstName+" "+e.thirdName}),l.isSearchActive&&a("updateSearchCustomers"),B.showMessage("success","Клиент был успешно изменен")}catch(s){if(y(s)){if(401===s.response?.status)return void(await $());B.showMessage("error",V(s))}else B.showMessage("error","Ошибка при изменении клиента")}finally{h(),a("closeDialog")}}));return(a,l)=>(i(),r(d,{"model-value":e.isOpened,"onUpdate:modelValue":l[6]||(l[6]=e=>a.$emit("closeDialog")),scrollable:"",width:"auto"},{default:u((()=>[n(_,{width:"450",color:"white",class:"pa-4"},{default:u((()=>[n(m,{class:"text-h6 font-weight-bold"},{default:u((()=>[c(" Редактирование клиента ")])),_:1}),n(f,null,{default:u((()=>[n(S,{onSubmit:N(I)},{default:u((()=>[n(C,null,{default:u((()=>[n(w,{cols:"12"},{default:u((()=>[n(k,{modelValue:N(q),"onUpdate:modelValue":l[0]||(l[0]=e=>D(q)?q.value=e:null),"error-messages":N(A),label:"Имя"},null,8,["modelValue","error-messages"])])),_:1}),n(w,{cols:"12"},{default:u((()=>[n(k,{modelValue:N(T),"onUpdate:modelValue":l[1]||(l[1]=e=>D(T)?T.value=e:null),"error-messages":N(P),label:"Фамилия"},null,8,["modelValue","error-messages"])])),_:1}),n(w,{cols:"12"},{default:u((()=>[n(k,{modelValue:N(E),"onUpdate:modelValue":l[2]||(l[2]=e=>D(E)?E.value=e:null),"error-messages":N(F),label:"Отчество"},null,8,["modelValue","error-messages"])])),_:1}),n(w,{cols:"12"},{default:u((()=>[n(k,{label:"Номер телефона",modelValue:N(O),"onUpdate:modelValue":l[3]||(l[3]=e=>D(O)?O.value=e:null),"error-messages":N(W)},null,8,["modelValue","error-messages"])])),_:1}),n(w,{cols:"12"},{default:u((()=>[oe,n(U,{modelValue:N(j),"onUpdate:modelValue":l[4]||(l[4]=e=>D(j)?j.value=e:null),"true-value":"Да","false-value":"Нет","hide-details":"",label:N(j),color:"indigo"},null,8,["modelValue","label"])])),_:1}),n(w,{cols:"12"},{default:u((()=>[n(v,{color:"green-darken-4",variant:"flat",type:"submit",loading:N(M)},{default:u((()=>[c(" Обновить ")])),_:1},8,["loading"]),n(v,{color:"blue-darken-4",variant:"flat",onClick:l[5]||(l[5]=e=>a.$emit("closeDialog"))},{default:u((()=>[c(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),re={class:"text-h6"},ue=h("h2",{class:"title text-h2 mb-5"},"Клиенты",-1),de=h("span",{class:"text-wrap"}," Сбросить поиск",-1),ie=h("span",{class:"text-wrap"}," Закрыть поиск",-1);e("default",l({__name:"CustomersView",setup(e){const a=o(),l=s(),d=q(),m=t([{fieldText:"Имя",fieldName:"firstName"},{fieldText:"Фамилия",fieldName:"secondName"},{fieldText:"Отчество",fieldName:"thirdName"},{fieldText:"Телефон",fieldName:"phone"},{fieldText:"Есть премиум",fieldName:"premium"}]),g=t("firstName"),{customers:f,customersErrorMessage:S}=A(a),{isAddDialogActive:x,isEditDialogActive:K,isDeleteDialogActive:X,itemToEdit:J,openDialog:R}=Y(),le=O(),oe=W(),{isSearchFormActive:ne,isSearchLoading:me,searchWithPremium:ce,premium:ge,isSearchActive:he,secondName:pe,searchedCustomers:fe,addSearchQuery:ve,resetSearch:_e,searchUserCustomers:be}=((e,a,l)=>{const o=s(),r=t(e.query.secondName||""),u=t(+e.query.premium||0),d=t(!1),i=t([]),n=t(!1),m=t(!1),c=t(!1),g=async()=>{try{m.value=!0;const{data:a}=await b.getSearchedCustomers({userId:l,premium:+e.query.premium,secondName:e.query.secondName,searchWithPremium:e.query.searchWithPremium});i.value=a.customers,n.value=!0}catch(a){y(a)?o.showMessage("error",V(a)):o.showMessage("error","Ошибка при поиске товаров!")}finally{m.value=!1}};return M([()=>e.query.secondName,()=>e.query.premium,()=>e.query.searchWithPremium],(async()=>{(void 0!==e.query.secondName||e.query.premium)&&g()}),{immediate:!0}),{premium:u,searchWithPremium:d,isSearchFormActive:c,isSearchActive:n,isSearchLoading:m,secondName:r,searchedCustomers:i,searchUserCustomers:g,addSearchQuery:()=>{a.push({name:"customers-page",query:{...e.query,secondName:r.value,searchWithPremium:String(d.value),premium:u.value}})},resetSearch:()=>{r.value="",d.value=!1,u.value=0,n.value=!1,i.value=[],a.push({name:"customers-page",query:{}})}}})(le,oe,d.currentUser.id),ye=T((()=>he.value?fe.value:f.value)),{currentPage:Ve,paginatedElements:Se,isInverseSort:Ne,elementsPerPageCount:Ce,totalPages:we,setSortField:ke}=Z({tableElements:ye,pageName:"customers-page",sortField:g,route:le,router:oe});return(e,a)=>{const s=G("TableActions");return i(),P("div",null,[n(E,{modelValue:N(l).isMessageShown,"onUpdate:modelValue":a[0]||(a[0]=e=>N(l).isMessageShown=e),color:N(l).messageType,"location-strategy":"connected"},{default:u((()=>[h("p",re,p(N(l).messageText),1)])),_:1},8,["modelValue","color"]),ue,n(_,{color:"white",elevation:"3",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:u((()=>[n(s,{count:N(Ce),"onUpdate:count":a[1]||(a[1]=e=>D(Ce)?Ce.value=e:null),onToggleAddDialog:a[2]||(a[2]=e=>x.value=!0),onToggleSearch:a[3]||(a[3]=e=>ne.value=!N(ne)),"is-badge-active":void 0!==e.$route.query.secondName},{default:u((()=>[c(" Все клиенты ")])),_:1},8,["count","is-badge-active"]),n(j,null,{default:u((()=>[N(ne)?(i(),r(C,{key:0,class:"mb-5",align:"center"},{default:u((()=>[n(w,{sm:"8",cols:"12"},{default:u((()=>[n(k,{label:"Имя клиента",modelValue:N(pe),"onUpdate:modelValue":a[4]||(a[4]=e=>D(pe)?pe.value=e:null),"onClick:clear":a[5]||(a[5]=e=>pe.value="")},null,8,["modelValue"])])),_:1}),n(w,{sm:"auto",cols:"6"},{default:u((()=>[n(B,{modelValue:N(ce),"onUpdate:modelValue":a[6]||(a[6]=e=>D(ce)?ce.value=e:null),color:"indigo-darken-4",label:"Искать с премиумом"},null,8,["modelValue"])])),_:1}),n(L,{"leave-absolute":!0},{default:u((()=>[N(ce)?(i(),r(w,{key:0,sm:"auto",cols:"6"},{default:u((()=>[n(U,{modelValue:N(ge),"onUpdate:modelValue":a[7]||(a[7]=e=>D(ge)?ge.value=e:null),"true-value":1,"false-value":0,color:"indigo-darken-4",label:"Есть премиум?"},null,8,["modelValue"])])),_:1})):F("",!0)])),_:1}),n(w,{cols:"12"},{default:u((()=>[n(C,null,{default:u((()=>[n(w,{sm:"auto",cols:"6"},{default:u((()=>[n(v,{variant:"flat",disabled:N(me),color:"green-darken-3",onClick:N(ve),block:""},{default:u((()=>[c(" Искать ")])),_:1},8,["disabled","onClick"])])),_:1}),n(w,{sm:"auto",cols:"6"},{default:u((()=>[n(v,{variant:"flat",disabled:N(me),color:"error",onClick:N(_e),block:""},{default:u((()=>[de])),_:1},8,["disabled","onClick"])])),_:1}),n(w,{sm:"auto",cols:"12"},{default:u((()=>[n(v,{variant:"flat",disabled:N(me),color:"blue-darken-4",onClick:a[8]||(a[8]=e=>ne.value=!1),block:""},{default:u((()=>[ie])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1})):F("",!0)])),_:1}),N(S)?(i(),r(I,{key:0,type:"error",border:"end",variant:"tonal"},{default:u((()=>[n($,{class:"mb-2"},{default:u((()=>[c(" Ошибка при загрузке клиентов")])),_:1}),h("p",null,p(N(S)),1)])),_:1})):N(me)?F("",!0):(i(),r(ee,{key:1,items:N(Se),fields:m.value,"current-sort-field":g.value,onUpdateSortField:a[9]||(a[9]=e=>N(ke)(e)),"is-inverse-sort":N(Ne),onOpenDialog:a[10]||(a[10]=(e,a)=>N(R)(e,a)),"no-data-text":"Клиенты не найдены"},null,8,["items","fields","current-sort-field","is-inverse-sort"])),N(me)?(i(),r(H,{key:2,class:"text-center mb-2"},{default:u((()=>[n(Q,{indeterminate:"",size:"32",color:"green"})])),_:1})):F("",!0),N(ye).length?(i(),r(z,{key:3,length:N(we),modelValue:N(Ve),"onUpdate:modelValue":a[11]||(a[11]=e=>D(Ve)?Ve.value=e:null),rounded:"circle","total-visible":7,color:"deep-purple-darken-4"},null,8,["length","modelValue"])):F("",!0)])),_:1}),N(J)?(i(),r(ae,{key:0,"is-opened":N(X),onCloseDialog:a[12]||(a[12]=e=>X.value=!1),"is-search-active":N(he),onUpdateSearchCustomers:N(be),customer:N(J)},null,8,["is-opened","is-search-active","onUpdateSearchCustomers","customer"])):F("",!0),N(J)?(i(),r(te,{key:1,"is-opened":N(K),onCloseDialog:a[13]||(a[13]=e=>K.value=!1),"is-search-active":N(he),onUpdateSearchCustomers:N(be),customer:N(J)},null,8,["is-opened","is-search-active","onUpdateSearchCustomers","customer"])):F("",!0),n(se,{"is-opened":N(x),onCloseDialog:a[14]||(a[14]=e=>x.value=!1)},null,8,["is-opened"])])}}}))}}}));
