import{r as E,W as Ve,X as J,i as W,h as X,d as Y,P as ne,Y as Z,J as ae,O as p,e as a,Z as se,l as H,o as m,b as t,y as K,s as re,v as oe,x as de,g as e,z as G,B as f,C as L,D as w,$ as O,a0 as ie,a1 as ce,m as le,n as ue,p as k,t as Q,F as T,f as ee,q as A,a2 as Pe,u as _e,S as ke,c as xe,U as we,M as B,k as Ae,a3 as Me,a4 as Ue,a5 as $e,a6 as Ce,G as De}from"./index-42528f6a.js";import{u as j}from"./alert-45d0e397.js";import{u as Ee,a as Te,_ as qe}from"./ElementsTable.vue_vue_type_script_setup_true_lang-0278024e.js";import{u as me,a as ge,b as R}from"./useFormSchemas-05520230.js";const Fe=(u,S,n)=>{const V=j(),x=E([+u.query.startPrice||1,+u.query.endPrice||99999]),v=E(u.query.productName||""),y=E([]),P=E(!1),c=E(!1),g=E(!1),b=()=>{v.value="",x.value=[1,99999],P.value=!1,y.value=[],S.push({name:"products-page",query:{}})},q=()=>{S.push({name:"products-page",query:{...u.query,productName:v.value,startPrice:x.value[0],endPrice:x.value[1]}})},_=async()=>{try{c.value=!0;const{data:M}=await J.getSearchedProducts({startPrice:u.query.startPrice,endPrice:u.query.endPrice,productName:u.query.productName,userId:n});y.value=M.products,console.log(y.value),P.value=!0}catch(M){W(M)?V.showMessage("error",X(M)):V.showMessage("error","Ошибка при поиске товара(")}finally{c.value=!1}};return Ve([()=>u.query.startPrice,()=>u.query.endPrice,()=>u.query.productName],async()=>{!u.query.startPrice&&!u.query.endPrice||_()},{immediate:!0}),{searchPrices:x,searchName:v,isSearchActive:P,searchedProducts:y,isSearchLoading:c,isSearchFormActive:g,searchUserProducts:_,addSearchQuery:q,resetSearch:b}},Ne=A("p",{class:"text-h6 font-weight-bold mb-4"},"Редактирование товара",-1),Ie=A("p",{class:"text-h6 mb-2"},"Загрузка категорий....",-1),Be=Y({__name:"ProductEditDialog",props:{isActive:{type:Boolean},product:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchProducts"],setup(u,{emit:S}){const n=u,V=ne(()=>{var s,o,l,I;return{name:((s=n.product)==null?void 0:s.name)||"Товар не был выбран",price:((o=n.product)==null?void 0:o.price)||0,count:((l=n.product)==null?void 0:l.count)||0,categoryId:((I=n.product)==null?void 0:I.categoryId)||0}}),{userProductSchema:x}=me(),{handleSubmit:v,isSubmitting:y,resetForm:P}=ge({validationSchema:x,initialValues:V}),{value:c,errorMessage:g}=R("name"),{value:b,errorMessage:q}=R("price"),{value:_,errorMessage:M}=R("count"),{value:$,errorMessage:F}=R("categoryId"),C=Z(),U=j(),{productsCategories:z,categoriesErrorMessage:N,isCategoriesLoading:D}=ae(C),h=H(),d=v(async s=>{var o;try{await J.updateProduct(s,n.product.id);const l=z.value.find(I=>I.id===s.categoryId).name;C.updateUserProduct({...s,category:l,id:n.product.id}),n.isSearchActive&&S("updateSearchProducts"),U.showMessage("success","Товар был изменен")}catch(l){if(W(l)){if(((o=l.response)==null?void 0:o.status)===401){h.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"products-page"}});return}U.showMessage("error",X(l))}else U.showMessage("error","Ошибка при обновлении товара!")}finally{P(),S("closeDialog")}});return(s,o)=>(m(),p(se,{transition:"dialog-bottom-transition","max-width":"500","onUpdate:modelValue":o[5]||(o[5]=l=>s.$emit("closeDialog")),"model-value":u.isActive},{default:a(()=>[t(ee,{class:"pa-5",color:"white",elevation:"4"},{default:a(()=>[t(K,null,{default:a(()=>[Ne]),_:1}),t(re,null,{default:a(()=>[t(oe,{onSubmit:de(e(d),["prevent"])},{default:a(()=>[t(G,null,{default:a(()=>[t(f,{cols:"12"},{default:a(()=>[t(L,{modelValue:e(c),"onUpdate:modelValue":o[0]||(o[0]=l=>w(c)?c.value=l:null),"error-messages":e(g),label:"Название товара"},null,8,["modelValue","error-messages"])]),_:1}),t(f,{cols:"12"},{default:a(()=>[e(D)?(m(),p(O,{key:0},{default:a(()=>[Ie,t(ie,{indeterminate:"",height:"6",color:"green"})]),_:1})):e(N)?(m(),p(O,{key:2},{default:a(()=>[t(le,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:a(()=>[t(ue,{class:"text-h6"},{default:a(()=>[k(Q(e(N)),1)]),_:1})]),_:1})]),_:1})):(m(),p(ce,{key:1,modelValue:e($),"onUpdate:modelValue":o[1]||(o[1]=l=>w($)?$.value=l:null),label:"Категория товара","error-messages":e(F),items:e(z),"item-title":"name",clearable:!1,"item-value":"id","no-data-text":"Нет категорий"},null,8,["modelValue","error-messages","items"]))]),_:1}),t(f,{sm:"6",cols:"12"},{default:a(()=>[t(L,{modelValue:e(_),"onUpdate:modelValue":o[2]||(o[2]=l=>w(_)?_.value=l:null),modelModifiers:{number:!0},"error-messages":e(M),label:"Количество",type:"number"},null,8,["modelValue","error-messages"])]),_:1}),t(f,{sm:"6",cols:"12"},{default:a(()=>[t(L,{modelValue:e(b),"onUpdate:modelValue":o[3]||(o[3]=l=>w(b)?b.value=l:null),modelModifiers:{number:!0},"error-messages":e(q),label:"Цена",type:"number",suffix:"руб"},null,8,["modelValue","error-messages"])]),_:1}),t(f,{cols:"12"},{default:a(()=>[t(T,{color:"green-darken-4",variant:"flat",loading:e(y),type:"submit"},{default:a(()=>[k(" Сохранить ")]),_:1},8,["loading"]),t(T,{color:"blue-darken-4",variant:"flat",onClick:o[4]||(o[4]=l=>s.$emit("closeDialog"))},{default:a(()=>[k(" Отмена ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),Re=A("p",{class:"font-weight-bold text-h5"},"Подтверждение удаления",-1),Le={class:"text-h6"},ze={class:"text-red"},Oe=A("span",{class:"text-white"},"Нет",-1),Qe=Y({__name:"ProductDeleteDialog",props:{product:null,isActive:{type:Boolean},isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchProducts"],setup(u,{emit:S}){const n=u,V=E(!1),x=Z(),v=j(),y=H(),P=async()=>{var c;try{V.value=!0,await J.deleteProduct(n.product.id),x.deleteUserProduct(n.product.id),n.isSearchActive&&S("updateSearchProducts"),v.showMessage("success","Товар был успешно удален")}catch(g){if(W(g)){if(((c=g.response)==null?void 0:c.status)===401){y.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"products-page"}});return}v.showMessage("error",X(g))}else v.showMessage("error","Ошибка при удалении товара!")}finally{V.value=!1,S("closeDialog")}};return(c,g)=>(m(),p(se,{"model-value":u.isActive,"max-width":450,persistent:"",transition:"dialog-bottom-transition"},{default:a(()=>[t(ee,{class:"pa-4"},{default:a(()=>[t(K,{class:"pa-0 mb-3"},{default:a(()=>[Re]),_:1}),t(Pe,{class:"pa-0 mb-4"},{default:a(()=>[A("p",Le,[k(" Вы уверены что хотите удалить товар "),A("span",ze,Q(n.product.name),1),k(" из списка? ")])]),_:1}),t(re,{class:"justify-center"},{default:a(()=>[t(T,{onClick:g[0]||(g[0]=b=>c.$emit("closeDialog")),height:"40",color:"blue-darken-4",variant:"flat"},{default:a(()=>[Oe]),_:1}),t(T,{height:"40",loading:V.value,color:"error",variant:"flat",onClick:P},{default:a(()=>[k("Да")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),je=A("p",{class:"text-h6 font-weight-bold mb-4"},"Добавление нового товара",-1),Ge=A("p",{class:"text-h6 mb-2"},"Загрузка категорий....",-1),Je=Y({__name:"ProductAddDialog",props:{isActive:{type:Boolean}},emits:["closeDialog"],setup(u,{emit:S}){const{userProductSchema:n}=me(),{handleSubmit:V,isSubmitting:x,resetForm:v}=ge({validationSchema:n}),{value:y,errorMessage:P}=R("name"),{value:c,errorMessage:g}=R("categoryId"),{value:b,errorMessage:q}=R("count"),{value:_,errorMessage:M}=R("price"),$=Z(),F=j(),{productsCategories:C,categoriesErrorMessage:U,isCategoriesLoading:z}=ae($),N=H(),D=V(async h=>{var d;try{const{data:s}=await J.addProduct(h),o=C.value.find(l=>l.id===h.categoryId).name;$.addUserProduct({...h,id:s.productId,category:o}),F.showMessage("success",`Товар ${h.name} был успешно добавлен!`)}catch(s){if(W(s)){if(((d=s.response)==null?void 0:d.status)===401){N.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"products-page"}});return}F.showMessage("error",X(s))}else F.showMessage("error","Ошибка при добавлении товара !")}finally{v(),S("closeDialog")}});return(h,d)=>(m(),p(se,{transition:"dialog-bottom-transition","max-width":"500","onUpdate:modelValue":d[5]||(d[5]=s=>h.$emit("closeDialog")),scrollable:"","model-value":u.isActive},{default:a(()=>[t(ee,{class:"pa-5",color:"white",elevation:"4"},{default:a(()=>[t(K,null,{default:a(()=>[je]),_:1}),t(re,null,{default:a(()=>[t(oe,{onSubmit:de(e(D),["prevent"])},{default:a(()=>[t(G,null,{default:a(()=>[t(f,{cols:"12"},{default:a(()=>[t(L,{modelValue:e(y),"onUpdate:modelValue":d[0]||(d[0]=s=>w(y)?y.value=s:null),"error-messages":e(P),label:"Название товара"},null,8,["modelValue","error-messages"])]),_:1}),t(f,{cols:"12"},{default:a(()=>[e(z)?(m(),p(O,{key:0},{default:a(()=>[Ge,t(ie,{indeterminate:"",height:"6",color:"green"})]),_:1})):e(U)?(m(),p(O,{key:2},{default:a(()=>[t(le,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:a(()=>[t(ue,{class:"text-h6"},{default:a(()=>[k(Q(e(U)),1)]),_:1})]),_:1})]),_:1})):(m(),p(ce,{key:1,modelValue:e(c),"onUpdate:modelValue":d[1]||(d[1]=s=>w(c)?c.value=s:null),label:"Категория товара","error-messages":e(g),items:e(C),"item-title":"name",clearable:!1,"item-value":"id","no-data-text":"Нет категорий"},null,8,["modelValue","error-messages","items"]))]),_:1}),t(f,{sm:"6",cols:"12"},{default:a(()=>[t(L,{modelValue:e(b),"onUpdate:modelValue":d[2]||(d[2]=s=>w(b)?b.value=s:null),modelModifiers:{number:!0},"error-messages":e(q),label:"Количество",type:"number"},null,8,["modelValue","error-messages"])]),_:1}),t(f,{sm:"6",cols:"12"},{default:a(()=>[t(L,{modelValue:e(_),"onUpdate:modelValue":d[3]||(d[3]=s=>w(_)?_.value=s:null),modelModifiers:{number:!0},"error-messages":e(M),label:"Цена",suffix:"руб",type:"number"},null,8,["modelValue","error-messages"])]),_:1}),t(f,{cols:"12"},{default:a(()=>[t(T,{color:"green-darken-4",variant:"flat",loading:e(x),type:"submit"},{default:a(()=>[k(" Добавить ")]),_:1},8,["loading"]),t(T,{color:"blue-darken-4",variant:"flat",onClick:d[4]||(d[4]=s=>h.$emit("closeDialog"))},{default:a(()=>[k(" Отмена ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),We={key:0},Xe={class:"text-h6"},Ye=A("h2",{class:"title text-h2 mb-5"},"Товары",-1),Ze=A("span",{class:"text-wrap"}," Сбросить поиск",-1),He={class:"text-h6"},st=Y({__name:"ProductsView",setup(u){const S=Z(),n=j(),V=_e(),x=E([{fieldText:"Имя",fieldName:"name"},{fieldText:"Цена(руб)",fieldName:"price"},{fieldText:"Кол-во",fieldName:"count"},{fieldText:"Категория",fieldName:"category"}]),v=E("name"),{userProducts:y,productsErrorMessage:P,productsCategories:c}=ae(S);ke(async()=>{c.value.length||S.getAllProductsCategories()});const{itemToEdit:g,isAddDialogActive:b,isEditDialogActive:q,isDeleteDialogActive:_,openDialog:M}=Ee(),$=Ae(),F=H(),{searchName:C,searchPrices:U,searchedProducts:z,isSearchActive:N,isSearchLoading:D,isSearchFormActive:h,resetSearch:d,addSearchQuery:s,searchUserProducts:o}=Fe($,F,V.currentUser.id),l=ne(()=>N.value?z.value:y.value),{currentPage:I,paginatedElements:pe,totalPages:fe,isInverseSort:ve,elementsPerPageCount:te,setSortField:ye}=Te({tableElements:l,pageName:"products-page",sortField:v,route:$,router:F});return(be,r)=>{const he=De("TableActions");return e(V).currentUser?(m(),xe("div",We,[t(we,{modelValue:e(n).isMessageShown,"onUpdate:modelValue":r[0]||(r[0]=i=>e(n).isMessageShown=i),color:e(n).messageType,"location-strategy":"connected"},{default:a(()=>[A("p",Xe,Q(e(n).messageText),1)]),_:1},8,["modelValue","color"]),Ye,t(ee,{color:"white",elevation:"3",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:a(()=>[e(P)?B("",!0):(m(),p(K,{key:0,class:"pa-0"},{default:a(()=>[t(he,{count:e(te),"onUpdate:count":r[1]||(r[1]=i=>w(te)?te.value=i:null),onToggleAddDialog:r[2]||(r[2]=i=>b.value=!0),onToggleSearch:r[3]||(r[3]=i=>h.value=!e(h)),"is-badge-active":!!be.$route.query.startPrice},{default:a(()=>[k(" Все товары ")]),_:1},8,["count","is-badge-active"]),t(Me,null,{default:a(()=>[e(h)?(m(),p(oe,{key:0,class:"mb-8"},{default:a(()=>[t(G,{align:"center"},{default:a(()=>[t(f,{sm:"6",cols:"12",class:"mb-sm-0 mb-2"},{default:a(()=>[t(L,{modelValue:e(C),"onUpdate:modelValue":r[4]||(r[4]=i=>w(C)?C.value=i:null),variant:"outlined",label:"Название товара"},null,8,["modelValue"])]),_:1}),t(f,{sm:"6",cols:"12",class:"pr-7"},{default:a(()=>[t(Ue,{modelValue:e(U),"onUpdate:modelValue":r[5]||(r[5]=i=>w(U)?U.value=i:null),min:"1",step:"10",max:"99999",color:"blue-grey-darken-2",label:"Цена:"},null,8,["modelValue"])]),_:1}),t(f,{sm:"auto",cols:"12"},{default:a(()=>[t(G,null,{default:a(()=>[t(f,{sm:"auto",cols:"6"},{default:a(()=>[t(T,{variant:"flat",color:"green-darken-3",onClick:e(s),disabled:e(D),block:""},{default:a(()=>[k(" Искать ")]),_:1},8,["onClick","disabled"])]),_:1}),t(f,{sm:"auto",cols:"6"},{default:a(()=>[t(T,{variant:"flat",color:"red-darken-4",onClick:e(d),disabled:e(D),block:""},{default:a(()=>[Ze]),_:1},8,["onClick","disabled"])]),_:1}),t(f,{sm:"auto",cols:"12"},{default:a(()=>[t(T,{variant:"flat",color:"blue-darken-4",onClick:r[6]||(r[6]=i=>h.value=!1),disabled:e(D),block:""},{default:a(()=>[k(" Закрыть ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):B("",!0)]),_:1})]),_:1})),e(P)?(m(),p(le,{key:1,type:"error",border:"end",variant:"tonal"},{default:a(()=>[t(ue,{class:"mb-2 text-h5"},{default:a(()=>[k(" Ошибка при загрузке товаров ")]),_:1}),A("p",He,Q(e(P)),1)]),_:1})):e(D)?B("",!0):(m(),p(qe,{key:2,items:e(pe),fields:x.value,"current-sort-field":v.value,onUpdateSortField:r[7]||(r[7]=i=>e(ye)(i)),"is-inverse-sort":e(ve),"no-data-text":"Товары не найдены",onOpenDialog:r[8]||(r[8]=(i,Se)=>e(M)(i,Se))},null,8,["items","fields","current-sort-field","is-inverse-sort"])),e(D)?(m(),p(O,{key:3,class:"text-center mb-2"},{default:a(()=>[t($e,{indeterminate:"",size:"48",color:"green"})]),_:1})):B("",!0),e(l).length?(m(),p(Ce,{key:4,length:e(fe),modelValue:e(I),"onUpdate:modelValue":r[9]||(r[9]=i=>w(I)?I.value=i:null),rounded:"circle","total-visible":7,color:"indigo-darken-4"},null,8,["length","modelValue"])):B("",!0)]),_:1}),e(g)?(m(),p(Be,{key:0,"is-active":e(q),onCloseDialog:r[10]||(r[10]=i=>q.value=!1),product:e(g),"is-search-active":e(N),onUpdateSearchProducts:e(o)},null,8,["is-active","product","is-search-active","onUpdateSearchProducts"])):B("",!0),e(g)?(m(),p(Qe,{key:1,"is-active":e(_),onCloseDialog:r[11]||(r[11]=i=>_.value=!1),product:e(g),"is-search-active":e(N),onUpdateSearchProducts:e(o)},null,8,["is-active","product","is-search-active","onUpdateSearchProducts"])):B("",!0),t(Je,{onCloseDialog:r[12]||(r[12]=i=>b.value=!1),"is-active":e(b)},null,8,["is-active"])])):B("",!0)}}});export{st as default};
