System.register(["./index-legacy-0d6d964e.js","./ElementsTable.vue_vue_type_script_setup_true_lang-legacy-1247e002.js","./alert-legacy-c9f97587.js","./useFormSchemas-legacy-425f91b7.js"],(function(e,a){"use strict";var l,t,r,o,s,d,u,n,i,c,m,p,g,f,v,h,_,y,b,k,V,D,S,x,O,w,M,U,N,q,C,E,A,F,T,I,$,j,P,B,z,L,Q,G,J,W,Y,Z,H,K,R,X,ee;return{setters:[e=>{l=e.r,t=e.W,r=e.au,o=e.i,s=e.h,d=e.d,u=e.Y,n=e.aj,i=e.ak,c=e.J,m=e.O,p=e.e,g=e.Z,f=e.l,v=e.o,h=e.b,_=e.y,y=e.p,b=e.s,k=e.v,V=e.x,D=e.g,S=e.z,x=e.B,O=e.a1,w=e.D,M=e.$,U=e.m,N=e.n,q=e.t,C=e.C,E=e.F,A=e.f,F=e.q,T=e.a2,I=e.ah,$=e.u,j=e.P,P=e.c,B=e.U,z=e.M,L=e.k,Q=e.a3,G=e.a5,J=e.a6,W=e.G},e=>{Y=e.u,Z=e.a,H=e._},e=>{K=e.u},e=>{R=e.u,X=e.a,ee=e.b}],execute:function(){const a=F("span",{class:"px-5 text-wrap"},"Очистить ",-1),ae=d({__name:"OrdersAddDialog",props:{isOpened:{type:Boolean}},emits:["closeDialog"],setup(e,{emit:l}){const t=u(),d=n(),F=i(),T=K(),{userProducts:I,productsErrorMessage:$}=c(t),{customers:j,customersErrorMessage:P}=c(d),{userOrderSchema:B}=R(),{handleSubmit:z,isSubmitting:L,resetForm:Q}=X({validationSchema:B}),{value:G,errorMessage:J}=ee("customerId"),{value:W,errorMessage:Y}=ee("productId"),{value:Z,errorMessage:H}=ee("productCount"),{value:ae,errorMessage:le}=ee("date"),te=f(),re=z((async e=>{try{const{data:a}=await r.addOrder(e);e.date=e.date.split("-").reverse().join("-"),F.addOrder({...e,...a}),T.showMessage("success","Заказ был успешно добавлен!"),Q()}catch(a){if(o(a)){if(401===a.response?.status)return void te.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"orders-page"}});T.showMessage("error",s(a))}else T.showMessage("error","Ошибка при добавлении заказа")}finally{l("closeDialog")}}));return(l,t)=>(v(),m(g,{"model-value":e.isOpened,"onUpdate:modelValue":t[6]||(t[6]=e=>l.$emit("closeDialog")),width:"auto",scrollable:"",transition:"dialog-bottom-transition"},{default:p((()=>[h(A,{width:"450",color:"white",class:"pa-4"},{default:p((()=>[h(_,{class:"font-weight-bold text-h6 mb-3"},{default:p((()=>[y(" Добавление заказа ")])),_:1}),h(b,null,{default:p((()=>[h(k,{onSubmit:V(D(re),["prevent"])},{default:p((()=>[h(S,null,{default:p((()=>[h(x,{cols:"12"},{default:p((()=>[D(P)?(v(),m(M,{key:1},{default:p((()=>[h(U,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:p((()=>[h(N,{class:"text-h6"},{default:p((()=>[y(q(D(P)),1)])),_:1})])),_:1})])),_:1})):(v(),m(O,{key:0,modelValue:D(G),"onUpdate:modelValue":t[0]||(t[0]=e=>w(G)?G.value=e:null),"error-messages":D(J),label:"Клиент",items:D(j),"item-title":"fullName","item-value":"id","no-data-text":"Клиенты не найдены"},null,8,["modelValue","error-messages","items"]))])),_:1}),h(x,{cols:"12"},{default:p((()=>[D($)?(v(),m(M,{key:1},{default:p((()=>[h(U,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:p((()=>[h(N,{class:"text-h6"},{default:p((()=>[y(q(D($)),1)])),_:1})])),_:1})])),_:1})):(v(),m(O,{key:0,modelValue:D(W),"onUpdate:modelValue":t[1]||(t[1]=e=>w(W)?W.value=e:null),"error-messages":D(Y),label:"Товар",items:D(I),"item-title":"name","item-value":"id","no-data-text":"Товары не найдены"},null,8,["modelValue","error-messages","items"]))])),_:1}),h(x,{cols:"12"},{default:p((()=>[h(C,{type:"number",modelValue:D(Z),"onUpdate:modelValue":t[2]||(t[2]=e=>w(Z)?Z.value=e:null),modelModifiers:{number:!0},label:"Количество товара","error-messages":D(H)},null,8,["modelValue","error-messages"])])),_:1}),h(x,{cols:"12"},{default:p((()=>[h(C,{modelValue:D(ae),"onUpdate:modelValue":t[3]||(t[3]=e=>w(ae)?ae.value=e:null),"error-messages":D(le),type:"date"},null,8,["modelValue","error-messages"])])),_:1}),h(x,{cols:"12"},{default:p((()=>[h(S,null,{default:p((()=>[h(x,{sm:"auto",cols:"12"},{default:p((()=>[h(E,{color:"green-darken-4",variant:"flat",type:"submit",block:"",loading:D(L)},{default:p((()=>[y(" Добавить ")])),_:1},8,["loading"])])),_:1}),h(x,{sm:"5",cols:"6"},{default:p((()=>[h(E,{color:"error",variant:"flat",onClick:t[4]||(t[4]=e=>D(Q)()),block:""},{default:p((()=>[a])),_:1})])),_:1}),h(x,{sm:"auto",cols:"6"},{default:p((()=>[h(E,{color:"blue-darken-4",block:"",variant:"flat",onClick:t[5]||(t[5]=e=>l.$emit("closeDialog"))},{default:p((()=>[y(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),le={class:"text-h6"},te={class:"text-error"},re=d({__name:"OrdersDeleteDialog",props:{isOpened:{type:Boolean},order:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchOrders"],setup(e,{emit:a}){const t=e,d=l(!1),u=K(),n=i(),c=f(),k=async()=>{try{d.value=!0,await r.deleteOrder(t.order.id),n.deleteOrder(t.order.id),t.isSearchActive&&a("updateSearchOrders"),u.showMessage("success","Заказ был успешно удален!")}catch(e){if(o(e)){if(401===e.response?.status)return void c.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"orders-page"}});u.showMessage("error",s(e))}else u.showMessage("error","Ошибка при удалении заказа")}finally{d.value=!1,a("closeDialog")}};return(a,l)=>(v(),m(g,{scrollable:"",width:"auto","model-value":e.isOpened,"onUpdate:modelValue":l[1]||(l[1]=e=>a.$emit("closeDialog")),persistent:""},{default:p((()=>[h(A,{width:"450",elevation:"3",class:"pa-4"},{default:p((()=>[h(_,{class:"font-weight-bold text-h6 mb-4 pa-0"},{default:p((()=>[y("Удаление заказа")])),_:1}),h(T,{class:"mb-4 pa-0"},{default:p((()=>[F("p",le,[y(" Вы уверены что хотите удалить заказ за "+q(e.order.date)+" клиента ",1),F("span",te,q(e.order.customerFullName),1),y(" ? ")])])),_:1}),h(b,{class:"pa-0"},{default:p((()=>[h(E,{onClick:l[0]||(l[0]=e=>a.$emit("closeDialog")),height:"40",color:"blue-darken-4",variant:"flat"},{default:p((()=>[y(" Нет ")])),_:1}),h(E,{height:"40",color:"error",variant:"flat",loading:d.value,onClick:k},{default:p((()=>[y("Да")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),oe=d({__name:"OrdersEditDialog",props:{isOpened:{type:Boolean},order:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchOrders"],setup(e,{emit:a}){const l=e,t=I((()=>{const e=l.order.date.split("-");return e[2]+"-"+e[1]+"-"+e[0]})),d=I((()=>({productCount:l.order.productCount,productId:l.order.productId,customerId:l.order.customerId,date:t.value}))),{userOrderSchema:F}=R(),{isSubmitting:T,resetForm:$,handleSubmit:j}=X({validationSchema:F,initialValues:d}),{value:P,errorMessage:B}=ee("customerId"),{value:z,errorMessage:L}=ee("productId"),{value:Q,errorMessage:G}=ee("productCount"),{value:J,errorMessage:W}=ee("date"),Y=n(),Z=u(),H=i(),ae=K(),le=f(),{customers:te,customersErrorMessage:re}=c(Y),{userProducts:oe,productsErrorMessage:se}=c(Z),de=j((async e=>{try{const{data:t}=await r.updateOrder(e,l.order.id);e.date=e.date.split("-").reverse().join("-"),H.updateOrder({...e,...t}),l.isSearchActive&&a("updateSearchOrders"),ae.showMessage("success","Заказ был успешно обновлен")}catch(t){if(o(t)){if(401===t.response?.status)return void le.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"orders-page"}});ae.showMessage("error",s(t))}else ae.showMessage("error","Ошибка при добавлении заказа")}finally{a("closeDialog"),$()}}));return(a,l)=>(v(),m(g,{"model-value":e.isOpened,"onUpdate:modelValue":l[5]||(l[5]=e=>a.$emit("closeDialog")),width:"auto",scrollable:"",transition:"dialog-bottom-transition"},{default:p((()=>[h(A,{width:"450",color:"white",class:"pa-4"},{default:p((()=>[h(_,{class:"font-weight-bold text-h6 mb-3"},{default:p((()=>[y(" Редактирование заказа ")])),_:1}),h(b,null,{default:p((()=>[h(k,{onSubmit:V(D(de),["prevent"])},{default:p((()=>[h(S,null,{default:p((()=>[h(x,{cols:"12"},{default:p((()=>[D(re)?(v(),m(M,{key:1},{default:p((()=>[h(U,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:p((()=>[h(N,{class:"text-h6"},{default:p((()=>[y(q(D(re)),1)])),_:1})])),_:1})])),_:1})):(v(),m(O,{key:0,modelValue:D(P),"onUpdate:modelValue":l[0]||(l[0]=e=>w(P)?P.value=e:null),"error-messages":D(B),label:"Клиент",items:D(te),"item-title":"fullName","item-value":"id","no-data-text":"Клиенты не найдены"},null,8,["modelValue","error-messages","items"]))])),_:1}),h(x,{cols:"12"},{default:p((()=>[D(se)?(v(),m(M,{key:1},{default:p((()=>[h(U,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:p((()=>[h(N,{class:"text-h6"},{default:p((()=>[y(q(D(se)),1)])),_:1})])),_:1})])),_:1})):(v(),m(O,{key:0,modelValue:D(z),"onUpdate:modelValue":l[1]||(l[1]=e=>w(z)?z.value=e:null),"error-messages":D(L),label:"Товар",items:D(oe),"item-title":"name","item-value":"id","no-data-text":"Товары не найдены"},null,8,["modelValue","error-messages","items"]))])),_:1}),h(x,{cols:"12"},{default:p((()=>[h(C,{modelValue:D(Q),"onUpdate:modelValue":l[2]||(l[2]=e=>w(Q)?Q.value=e:null),modelModifiers:{number:!0},label:"Количество товара","error-messages":D(G),type:"number"},null,8,["modelValue","error-messages"])])),_:1}),h(x,{cols:"12"},{default:p((()=>[h(C,{modelValue:D(J),"onUpdate:modelValue":l[3]||(l[3]=e=>w(J)?J.value=e:null),"error-messages":D(W),type:"date"},null,8,["modelValue","error-messages"])])),_:1}),h(x,{cols:"12"},{default:p((()=>[h(S,null,{default:p((()=>[h(x,{sm:"auto",cols:"12"},{default:p((()=>[h(E,{color:"green-darken-4",variant:"flat",type:"submit",block:"",loading:D(T)},{default:p((()=>[y(" Добавить ")])),_:1},8,["loading"])])),_:1}),h(x,{sm:"auto",cols:"12"},{default:p((()=>[h(E,{color:"blue-darken-4",block:"",variant:"flat",onClick:l[4]||(l[4]=e=>a.$emit("closeDialog"))},{default:p((()=>[y(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),se={class:"text-h6"},de=F("h2",{class:"title text-h2 mb-5"},"Заказы",-1),ue=F("span",{class:"text-wrap"}," Сбросить поиск",-1);e("default",d({__name:"OrdersView",setup(e){const a=l([{fieldText:"Клиент",fieldName:"customerFullName"},{fieldText:"Товар",fieldName:"productName"},{fieldText:"Количество товара",fieldName:"productCount"},{fieldText:"Дата",fieldName:"date"}]),d=l("customerFullName"),u=$(),n=i(),c=K(),{itemToEdit:g,isAddDialogActive:b,isEditDialogActive:k,isDeleteDialogActive:V,openDialog:O}=Y(),N=L(),T=f(),{isSearchFormActive:I,isSearchLoading:R,isSearchActive:X,startDate:ee,endDate:le,searchedOrders:te,customerName:ne,productName:ie,addSearchQuery:ce,resetSearch:me,searchOrders:pe}=((e,a,d)=>{const u=K(),n=l(!1),i=l(!1),c=l(!1),m=l([]),p=l("2023-01-01"),g=l("2024-01-01"),f=l(""),v=l(""),h=async()=>{try{if(!e.query.startDate&&!e.query.endDate)return;c.value=!0;const{data:a}=await r.getSerachedOrders({userId:d,product:e.query.productName,customer:e.query.customerName,startDate:e.query.startDate,endDate:e.query.endDate});m.value=a.orders,i.value=!0}catch(a){o(a)?u.showMessage("error",s(a)):u.showMessage("error","Ошибка при поиске заказов")}finally{c.value=!1}};return t([()=>e.query.startDate,()=>e.query.endDate,()=>e.query.customerName,()=>e.query.productName],(async()=>{(e.query.startDate||e.query.endDate)&&h()}),{immediate:!0}),{isSearchLoading:c,isSearchFormActive:n,isSearchActive:i,startDate:p,endDate:g,customerName:f,productName:v,searchedOrders:m,resetSearch:()=>{p.value="2023-01-01",g.value="2024-01-01",f.value="",v.value="",i.value=!1,m.value=[],a.push({name:"orders-page",query:{}})},addSearchQuery:()=>{a.push({name:"orders-page",query:{startDate:p.value,endDate:g.value,customerName:f.value,productName:v.value}})},searchOrders:h}})(N,T,u.currentUser.id),ge=j((()=>X.value?te.value:n.orders)),{currentPage:fe,paginatedElements:ve,isInverseSort:he,elementsPerPageCount:_e,totalPages:ye,setSortField:be}=Z({tableElements:ge,pageName:"orders-page",sortField:d,route:N,router:T});return(e,l)=>{const t=W("TableActions");return v(),P("div",null,[h(B,{modelValue:D(c).isMessageShown,"onUpdate:modelValue":l[0]||(l[0]=e=>D(c).isMessageShown=e),color:D(c).messageType,"location-strategy":"connected"},{default:p((()=>[F("p",se,q(D(c).messageText),1)])),_:1},8,["modelValue","color"]),de,h(A,{elevation:"3",color:"white",class:"pa-5 rounded-lg mx-sm-0 mx-n5"},{default:p((()=>[D(n).ordersErrorMessage?z("",!0):(v(),m(_,{key:0,class:"pa-0"},{default:p((()=>[h(t,{count:D(_e),"onUpdate:count":l[1]||(l[1]=e=>w(_e)?_e.value=e:null),onToggleAddDialog:l[2]||(l[2]=e=>b.value=!0),onToggleSearch:l[3]||(l[3]=e=>I.value=!D(I)),"is-badge-active":!(!e.$route.query.startDate&&!e.$route.query.endDate)},{default:p((()=>[y(" Все заказы ")])),_:1},8,["count","is-badge-active"]),h(Q,null,{default:p((()=>[D(I)?(v(),m(S,{key:0,class:"mb-5"},{default:p((()=>[h(x,{sm:"6",cols:"12"},{default:p((()=>[h(S,null,{default:p((()=>[h(x,{cols:"6"},{default:p((()=>[h(C,{modelValue:D(ee),"onUpdate:modelValue":l[4]||(l[4]=e=>w(ee)?ee.value=e:null),type:"date",label:"Начальная дата",clearable:!1},null,8,["modelValue"])])),_:1}),h(x,{cols:"6"},{default:p((()=>[h(C,{modelValue:D(le),"onUpdate:modelValue":l[5]||(l[5]=e=>w(le)?le.value=e:null),type:"date",label:"Конечная дата",clearable:!1},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),h(x,{cols:"6"},{default:p((()=>[h(C,{modelValue:D(ne),"onUpdate:modelValue":l[6]||(l[6]=e=>w(ne)?ne.value=e:null),label:"Клиент"},null,8,["modelValue"])])),_:1}),h(x,{cols:"6"},{default:p((()=>[h(C,{modelValue:D(ie),"onUpdate:modelValue":l[7]||(l[7]=e=>w(ie)?ie.value=e:null),label:"Товар"},null,8,["modelValue"])])),_:1}),h(x,{md:"6",cols:"12"},{default:p((()=>[h(S,null,{default:p((()=>[h(x,{sm:"auto",cols:"6"},{default:p((()=>[h(E,{onClick:D(ce),variant:"flat",color:"green-darken-3",block:""},{default:p((()=>[y(" Искать ")])),_:1},8,["onClick"])])),_:1}),h(x,{sm:"auto",cols:"6"},{default:p((()=>[h(E,{onClick:D(me),variant:"flat",color:"red-darken-4",block:""},{default:p((()=>[ue])),_:1},8,["onClick"])])),_:1}),h(x,{sm:"auto",cols:"12"},{default:p((()=>[h(E,{variant:"flat",color:"blue-darken-4",onClick:l[8]||(l[8]=e=>I.value=!1),block:""},{default:p((()=>[y(" Закрыть ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):z("",!0)])),_:1})])),_:1})),D(n).ordersErrorMessage?(v(),m(M,{key:1},{default:p((()=>[h(U,{variant:"outlined",border:"end",type:"error"},{default:p((()=>[F("p",null,q(D(n).ordersErrorMessage),1)])),_:1})])),_:1})):D(R)?z("",!0):(v(),m(H,{key:2,items:D(ve),fields:a.value,"current-sort-field":d.value,onUpdateSortField:l[9]||(l[9]=e=>D(be)(e)),"is-inverse-sort":D(he),onOpenDialog:l[10]||(l[10]=(e,a)=>D(O)(e,a)),"no-data-text":"Заказы не найдены"},null,8,["items","fields","current-sort-field","is-inverse-sort"])),D(R)?(v(),m(M,{key:3,class:"text-center mb-2"},{default:p((()=>[h(G,{indeterminate:"",size:"32",color:"green"})])),_:1})):z("",!0),D(ge).length?(v(),m(J,{key:4,length:D(ye),modelValue:D(fe),"onUpdate:modelValue":l[11]||(l[11]=e=>w(fe)?fe.value=e:null),rounded:"circle","total-visible":7,color:"deep-purple-darken-4"},null,8,["length","modelValue"])):z("",!0)])),_:1}),D(g)?(v(),m(oe,{key:0,"is-search-active":D(X),"is-opened":D(k),onCloseDialog:l[12]||(l[12]=e=>k.value=!1),onUpdateSearchOrders:D(pe),order:D(g)},null,8,["is-search-active","is-opened","onUpdateSearchOrders","order"])):z("",!0),D(g)?(v(),m(re,{key:1,"is-search-active":D(X),onUpdateSearchOrders:D(pe),onCloseDialog:l[13]||(l[13]=e=>V.value=!1),"is-opened":D(V),order:D(g)},null,8,["is-search-active","onUpdateSearchOrders","is-opened","order"])):z("",!0),h(ae,{"is-opened":D(b),onCloseDialog:l[14]||(l[14]=e=>b.value=!1)},null,8,["is-opened"])])}}}))}}}));
