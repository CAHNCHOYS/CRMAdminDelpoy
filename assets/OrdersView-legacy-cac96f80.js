System.register(["./index-legacy-1913095e.js","./ElementsTable.vue_vue_type_script_setup_true_lang-legacy-c4071cfe.js","./alert-legacy-54ef0e32.js","./useFormSchemas-legacy-0b14383d.js"],(function(e,a){"use strict";var l,t,r,o,s,d,u,n,i,c,m,v,p,g,f,h,_,y,b,V,k,D,S,x,w,O,M,U,N,q,C,E,A,T,F;return{setters:[e=>{l=e.r,t=e.D,r=e.a0,o=e.i,s=e.h,d=e.d,u=e.E,n=e.S,i=e.T,c=e.v,m=e.y,v=e.e,p=e.j,g=e.k,f=e.o,h=e.b,_=e.l,y=e.n,b=e.f,V=e.p,k=e.t,D=e.m,S=e.Q,x=e.u,w=e.z,O=e.c,M=e.x,U=e.g},e=>{N=e.u,q=e.a,C=e._},e=>{E=e.u},e=>{A=e.u,T=e.a,F=e.b}],execute:function(){const a=D("span",{class:"px-5 text-wrap"},"Очистить ",-1),I=d({__name:"OrdersAddDialog",props:{isOpened:{type:Boolean}},emits:["closeDialog"],setup(e,{emit:l}){const t=u(),d=n(),D=i(),S=E(),{userProducts:x,productsErrorMessage:w}=c(t),{customers:O,customersErrorMessage:M}=c(d),{userOrderSchema:U}=A(),{handleSubmit:N,isSubmitting:q,resetForm:C}=T({validationSchema:U}),{value:I,errorMessage:$}=F("customerId"),{value:j,errorMessage:P}=F("productId"),{value:B,errorMessage:Q}=F("productCount"),{value:z,errorMessage:L}=F("date"),G=p(),H=N((async e=>{try{const{data:a}=await r.addOrder(e);e.date=e.date.split("-").reverse().join("-"),D.addOrder({...e,...a}),S.showMessage("success","Заказ был успешно добавлен!"),C()}catch(a){if(o(a)){if(401===a.response?.status)return void G.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"orders-page"}});S.showMessage("error",s(a))}else S.showMessage("error","Ошибка при добавлении заказа")}finally{l("closeDialog")}}));return(l,t)=>{const r=g("v-card-title"),o=g("v-autocomplete"),s=g("v-alert-title"),d=g("v-alert"),u=g("v-sheet"),n=g("v-col"),i=g("v-text-field"),c=g("v-btn"),p=g("v-row"),D=g("v-form"),S=g("v-card-actions"),U=g("v-card"),N=g("v-dialog");return f(),m(N,{"model-value":e.isOpened,"onUpdate:modelValue":t[6]||(t[6]=e=>l.$emit("closeDialog")),width:"auto",scrollable:"",transition:"dialog-bottom-transition"},{default:v((()=>[h(U,{width:"450",color:"white",class:"pa-4"},{default:v((()=>[h(r,{class:"font-weight-bold text-h6 mb-3"},{default:v((()=>[_(" Добавление заказа ")])),_:1}),h(S,null,{default:v((()=>[h(D,{onSubmit:y(b(H),["prevent"])},{default:v((()=>[h(p,null,{default:v((()=>[h(n,{cols:"12"},{default:v((()=>[b(M)?(f(),m(u,{key:1},{default:v((()=>[h(d,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:v((()=>[h(s,{class:"text-h6"},{default:v((()=>[_(k(b(M)),1)])),_:1})])),_:1})])),_:1})):(f(),m(o,{key:0,modelValue:b(I),"onUpdate:modelValue":t[0]||(t[0]=e=>V(I)?I.value=e:null),"error-messages":b($),label:"Клиент",items:b(O),"item-title":"fullName","item-value":"id","no-data-text":"Клиенты не найдены"},null,8,["modelValue","error-messages","items"]))])),_:1}),h(n,{cols:"12"},{default:v((()=>[b(w)?(f(),m(u,{key:1},{default:v((()=>[h(d,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:v((()=>[h(s,{class:"text-h6"},{default:v((()=>[_(k(b(w)),1)])),_:1})])),_:1})])),_:1})):(f(),m(o,{key:0,modelValue:b(j),"onUpdate:modelValue":t[1]||(t[1]=e=>V(j)?j.value=e:null),"error-messages":b(P),label:"Товар",items:b(x),"item-title":"name","item-value":"id","no-data-text":"Товары не найдены"},null,8,["modelValue","error-messages","items"]))])),_:1}),h(n,{cols:"12"},{default:v((()=>[h(i,{type:"number",modelValue:b(B),"onUpdate:modelValue":t[2]||(t[2]=e=>V(B)?B.value=e:null),modelModifiers:{number:!0},label:"Количество товара","error-messages":b(Q)},null,8,["modelValue","error-messages"])])),_:1}),h(n,{cols:"12"},{default:v((()=>[h(i,{modelValue:b(z),"onUpdate:modelValue":t[3]||(t[3]=e=>V(z)?z.value=e:null),"error-messages":b(L),type:"date"},null,8,["modelValue","error-messages"])])),_:1}),h(n,{cols:"12"},{default:v((()=>[h(p,null,{default:v((()=>[h(n,{sm:"auto",cols:"12"},{default:v((()=>[h(c,{color:"green-darken-4",variant:"flat",type:"submit",block:"",loading:b(q)},{default:v((()=>[_(" Добавить ")])),_:1},8,["loading"])])),_:1}),h(n,{sm:"5",cols:"6"},{default:v((()=>[h(c,{color:"error",variant:"flat",onClick:t[4]||(t[4]=e=>b(C)()),block:""},{default:v((()=>[a])),_:1})])),_:1}),h(n,{sm:"auto",cols:"6"},{default:v((()=>[h(c,{color:"blue-darken-4",block:"",variant:"flat",onClick:t[5]||(t[5]=e=>l.$emit("closeDialog"))},{default:v((()=>[_(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"])}}}),$={class:"text-h6"},j={class:"text-error"},P=d({__name:"OrdersDeleteDialog",props:{isOpened:{type:Boolean},order:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchOrders"],setup(e,{emit:a}){const t=e,d=l(!1),u=E(),n=i(),c=p(),y=async()=>{try{d.value=!0,await r.deleteOrder(t.order.id),n.deleteOrder(t.order.id),t.isSearchActive&&a("updateSearchOrders"),u.showMessage("success","Заказ был успешно удален!")}catch(e){if(o(e)){if(401===e.response?.status)return void c.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"orders-page"}});u.showMessage("error",s(e))}else u.showMessage("error","Ошибка при удалении заказа")}finally{d.value=!1,a("closeDialog")}};return(a,l)=>{const t=g("v-card-title"),r=g("v-card-text"),o=g("v-btn"),s=g("v-card-actions"),u=g("v-card"),n=g("v-dialog");return f(),m(n,{scrollable:"",width:"auto","model-value":e.isOpened,"onUpdate:modelValue":l[1]||(l[1]=e=>a.$emit("closeDialog")),persistent:""},{default:v((()=>[h(u,{width:"450",elevation:"3",class:"pa-4"},{default:v((()=>[h(t,{class:"font-weight-bold text-h6 mb-4 pa-0"},{default:v((()=>[_("Удаление заказа")])),_:1}),h(r,{class:"mb-4 pa-0"},{default:v((()=>[D("p",$,[_(" Вы уверены что хотите удалить заказ за "+k(e.order.date)+" клиента ",1),D("span",j,k(e.order.customerFullName),1),_(" ? ")])])),_:1}),h(s,{class:"pa-0"},{default:v((()=>[h(o,{onClick:l[0]||(l[0]=e=>a.$emit("closeDialog")),height:"40",color:"blue-darken-4",variant:"flat"},{default:v((()=>[_(" Нет ")])),_:1}),h(o,{height:"40",color:"error",variant:"flat",loading:d.value,onClick:y},{default:v((()=>[_("Да")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["model-value"])}}}),B=d({__name:"OrdersEditDialog",props:{isOpened:{type:Boolean},order:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchOrders"],setup(e,{emit:a}){const l=e,t=S((()=>{const e=l.order.date.split("-");return e[2]+"-"+e[1]+"-"+e[0]})),d=S((()=>({productCount:l.order.productCount,productId:l.order.productId,customerId:l.order.customerId,date:t.value}))),{userOrderSchema:D}=A(),{isSubmitting:x,resetForm:w,handleSubmit:O}=T({validationSchema:D,initialValues:d}),{value:M,errorMessage:U}=F("customerId"),{value:N,errorMessage:q}=F("productId"),{value:C,errorMessage:I}=F("productCount"),{value:$,errorMessage:j}=F("date"),P=n(),B=u(),Q=i(),z=E(),L=p(),{customers:G,customersErrorMessage:H}=c(P),{userProducts:J,productsErrorMessage:K}=c(B),R=O((async e=>{try{const{data:t}=await r.updateOrder(e,l.order.id);e.date=e.date.split("-").reverse().join("-"),Q.updateOrder({...e,...t}),l.isSearchActive&&a("updateSearchOrders"),z.showMessage("success","Заказ был успешно обновлен")}catch(t){if(o(t)){if(401===t.response?.status)return void L.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"orders-page"}});z.showMessage("error",s(t))}else z.showMessage("error","Ошибка при добавлении заказа")}finally{a("closeDialog"),w()}}));return(a,l)=>{const t=g("v-card-title"),r=g("v-autocomplete"),o=g("v-alert-title"),s=g("v-alert"),d=g("v-sheet"),u=g("v-col"),n=g("v-text-field"),i=g("v-btn"),c=g("v-row"),p=g("v-form"),D=g("v-card-actions"),S=g("v-card"),w=g("v-dialog");return f(),m(w,{"model-value":e.isOpened,"onUpdate:modelValue":l[5]||(l[5]=e=>a.$emit("closeDialog")),width:"auto",scrollable:"",transition:"dialog-bottom-transition"},{default:v((()=>[h(S,{width:"450",color:"white",class:"pa-4"},{default:v((()=>[h(t,{class:"font-weight-bold text-h6 mb-3"},{default:v((()=>[_(" Редактирование заказа ")])),_:1}),h(D,null,{default:v((()=>[h(p,{onSubmit:y(b(R),["prevent"])},{default:v((()=>[h(c,null,{default:v((()=>[h(u,{cols:"12"},{default:v((()=>[b(H)?(f(),m(d,{key:1},{default:v((()=>[h(s,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:v((()=>[h(o,{class:"text-h6"},{default:v((()=>[_(k(b(H)),1)])),_:1})])),_:1})])),_:1})):(f(),m(r,{key:0,modelValue:b(M),"onUpdate:modelValue":l[0]||(l[0]=e=>V(M)?M.value=e:null),"error-messages":b(U),label:"Клиент",items:b(G),"item-title":"fullName","item-value":"id","no-data-text":"Клиенты не найдены"},null,8,["modelValue","error-messages","items"]))])),_:1}),h(u,{cols:"12"},{default:v((()=>[b(K)?(f(),m(d,{key:1},{default:v((()=>[h(s,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:v((()=>[h(o,{class:"text-h6"},{default:v((()=>[_(k(b(K)),1)])),_:1})])),_:1})])),_:1})):(f(),m(r,{key:0,modelValue:b(N),"onUpdate:modelValue":l[1]||(l[1]=e=>V(N)?N.value=e:null),"error-messages":b(q),label:"Товар",items:b(J),"item-title":"name","item-value":"id","no-data-text":"Товары не найдены"},null,8,["modelValue","error-messages","items"]))])),_:1}),h(u,{cols:"12"},{default:v((()=>[h(n,{modelValue:b(C),"onUpdate:modelValue":l[2]||(l[2]=e=>V(C)?C.value=e:null),modelModifiers:{number:!0},label:"Количество товара","error-messages":b(I),type:"number"},null,8,["modelValue","error-messages"])])),_:1}),h(u,{cols:"12"},{default:v((()=>[h(n,{modelValue:b($),"onUpdate:modelValue":l[3]||(l[3]=e=>V($)?$.value=e:null),"error-messages":b(j),type:"date"},null,8,["modelValue","error-messages"])])),_:1}),h(u,{cols:"12"},{default:v((()=>[h(c,null,{default:v((()=>[h(u,{sm:"auto",cols:"12"},{default:v((()=>[h(i,{color:"green-darken-4",variant:"flat",type:"submit",block:"",loading:b(x)},{default:v((()=>[_(" Добавить ")])),_:1},8,["loading"])])),_:1}),h(u,{sm:"auto",cols:"12"},{default:v((()=>[h(i,{color:"blue-darken-4",block:"",variant:"flat",onClick:l[4]||(l[4]=e=>a.$emit("closeDialog"))},{default:v((()=>[_(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"])}}}),Q={class:"text-h6"},z=D("h2",{class:"title text-h2 mb-5"},"Заказы",-1);e("default",d({__name:"OrdersView",setup(e){const a=l([{fieldText:"Клиент",fieldName:"customerFullName"},{fieldText:"Товар",fieldName:"productName"},{fieldText:"Количество товара",fieldName:"productCount"},{fieldText:"Дата",fieldName:"date"}]),d=l("customerFullName"),u=x(),n=i(),c=E(),{itemToEdit:y,isAddDialogActive:S,isEditDialogActive:A,isDeleteDialogActive:T,openDialog:F}=N(),$=U(),j=p(),{isSearchFormActive:L,isSearchLoading:G,isSearchActive:H,startDate:J,endDate:K,searchedOrders:R,customerName:W,productName:X,addSearchQuery:Y,resetSearch:Z,searchOrders:ee}=((e,a,d)=>{const u=E(),n=l(!1),i=l(!1),c=l(!1),m=l([]),v=l("2023-01-01"),p=l("2024-01-01"),g=l(""),f=l(""),h=async()=>{try{if(!e.query.startDate&&!e.query.endDate)return;c.value=!0;const{data:a}=await r.getSerachedOrders({userId:d,product:e.query.productName,customer:e.query.customerName,startDate:e.query.startDate,endDate:e.query.endDate});m.value=a.orders,i.value=!0}catch(a){o(a)?u.showMessage("error",s(a)):u.showMessage("error","Ошибка при поиске заказов")}finally{c.value=!1}};return t([()=>e.query.startDate,()=>e.query.endDate,()=>e.query.customerName,()=>e.query.productName],(async()=>{(e.query.startDate||e.query.endDate)&&h()}),{immediate:!0}),{isSearchLoading:c,isSearchFormActive:n,isSearchActive:i,startDate:v,endDate:p,customerName:g,productName:f,searchedOrders:m,resetSearch:()=>{v.value="2023-01-01",p.value="2024-01-01",g.value="",f.value="",i.value=!1,m.value=[],a.push({name:"orders-page",query:{}})},addSearchQuery:()=>{a.push({name:"orders-page",query:{startDate:v.value,endDate:p.value,customerName:g.value,productName:f.value}})},searchOrders:h}})($,j,u.currentUser.id),ae=w((()=>H.value?R.value:n.orders)),{currentPage:le,paginatedElements:te,isInverseSort:re,elemetsPerPage:oe,totalPages:se,setSortField:de}=q({tableElements:ae,pageName:"orders-page",sortField:d,route:$,router:j});return(e,l)=>{const t=g("v-snackbar"),r=g("TableActions"),o=g("v-text-field"),s=g("v-col"),u=g("v-row"),i=g("v-btn"),p=g("v-expand-transition"),x=g("v-card-title"),w=g("v-alert"),U=g("v-sheet"),N=g("v-progress-circular"),q=g("v-pagination"),E=g("v-card");return f(),O("div",null,[h(t,{modelValue:b(c).isMessageShown,"onUpdate:modelValue":l[0]||(l[0]=e=>b(c).isMessageShown=e),"max-width":500,color:b(c).messageType},{default:v((()=>[D("p",Q,k(b(c).messageText),1)])),_:1},8,["modelValue","color"]),z,h(E,{elevation:"3",color:"white",class:"pa-5 rounded-lg mx-sm-0 mx-n5"},{default:v((()=>[b(n).ordersErrorMessage?M("",!0):(f(),m(x,{key:0,class:"pa-0"},{default:v((()=>[h(r,{count:b(oe),"onUpdate:count":[l[1]||(l[1]=e=>V(oe)?oe.value=e:null),l[2]||(l[2]=e=>oe.value=e)],onToggleAddDialog:l[3]||(l[3]=e=>S.value=!0),onToggleSearch:l[4]||(l[4]=e=>L.value=!b(L)),"is-badge-active":!(!e.$route.query.startDate&&!e.$route.query.endDate)},{default:v((()=>[_(" Все заказы ")])),_:1},8,["count","is-badge-active"]),h(p,null,{default:v((()=>[b(L)?(f(),m(u,{key:0,class:"mb-5"},{default:v((()=>[h(s,{cols:"6"},{default:v((()=>[h(u,null,{default:v((()=>[h(s,{cols:"6"},{default:v((()=>[h(o,{modelValue:b(J),"onUpdate:modelValue":l[5]||(l[5]=e=>V(J)?J.value=e:null),type:"date",label:"Начальная дата",clearable:!1},null,8,["modelValue"])])),_:1}),h(s,{cols:"6"},{default:v((()=>[h(o,{modelValue:b(K),"onUpdate:modelValue":l[6]||(l[6]=e=>V(K)?K.value=e:null),type:"date",label:"Конечная дата",clearable:!1},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),h(s,{cols:"6"},{default:v((()=>[h(o,{modelValue:b(W),"onUpdate:modelValue":l[7]||(l[7]=e=>V(W)?W.value=e:null),label:"Клиент"},null,8,["modelValue"])])),_:1}),h(s,{cols:"6"},{default:v((()=>[h(o,{modelValue:b(X),"onUpdate:modelValue":l[8]||(l[8]=e=>V(X)?X.value=e:null),label:"Товар"},null,8,["modelValue"])])),_:1}),h(s,{cols:"6"},{default:v((()=>[h(u,null,{default:v((()=>[h(s,{cols:"auto"},{default:v((()=>[h(i,{onClick:b(Y),variant:"flat",color:"green-darken-3"},{default:v((()=>[_(" Искать ")])),_:1},8,["onClick"])])),_:1}),h(s,{cols:"auto"},{default:v((()=>[h(i,{onClick:b(Z),variant:"flat",color:"red-darken-4"},{default:v((()=>[_(" Сбросить поиск ")])),_:1},8,["onClick"])])),_:1}),h(s,{cols:"auto"},{default:v((()=>[h(i,{variant:"flat",color:"blue-darken-4",onClick:l[9]||(l[9]=e=>L.value=!1)},{default:v((()=>[_(" Закрыть ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):M("",!0)])),_:1})])),_:1})),b(n).ordersErrorMessage?(f(),m(U,{key:1},{default:v((()=>[h(w,{variant:"outlined",border:"end",type:"error"},{default:v((()=>[D("p",null,k(b(n).ordersErrorMessage),1)])),_:1})])),_:1})):b(G)?M("",!0):(f(),m(C,{key:2,items:b(te),fields:a.value,"is-inverse-sort":b(re),"no-data-text":"Заказы не найдены","current-sort-field":d.value,"onUpdate:currentSortField":[l[10]||(l[10]=e=>d.value=e),l[11]||(l[11]=e=>b(de)(e))],onOpenDialog:l[12]||(l[12]=(e,a)=>b(F)(e,a))},null,8,["items","fields","is-inverse-sort","current-sort-field"])),b(G)?(f(),m(U,{key:3,class:"text-center mb-2"},{default:v((()=>[h(N,{indeterminate:"",size:"32",color:"green"})])),_:1})):M("",!0),b(ae).length?(f(),m(q,{key:4,length:b(se),modelValue:b(le),"onUpdate:modelValue":l[13]||(l[13]=e=>V(le)?le.value=e:null),rounded:"circle","total-visible":7,color:"deep-purple-darken-4"},null,8,["length","modelValue"])):M("",!0)])),_:1}),h(I,{"is-opened":b(S),onCloseDialog:l[14]||(l[14]=e=>S.value=!1)},null,8,["is-opened"]),b(y)?(f(),m(B,{key:0,"is-search-active":b(H),onUpdateSearchOrders:b(ee),order:b(y),"is-opened":b(A),onCloseDialog:l[15]||(l[15]=e=>A.value=!1)},null,8,["is-search-active","onUpdateSearchOrders","order","is-opened"])):M("",!0),b(y)?(f(),m(P,{key:1,"is-search-active":b(H),onUpdateSearchOrders:b(ee),"is-opened":b(T),order:b(y),onCloseDialog:l[16]||(l[16]=e=>T.value=!1)},null,8,["is-search-active","onUpdateSearchOrders","is-opened","order"])):M("",!0)])}}}))}}}));
