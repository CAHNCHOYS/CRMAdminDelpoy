import{d as H,R as J,r as T,y as M,e as t,k as a,o as D,b as o,l as p,m as z,t as te,j as K,Z as X,i as Y,h as ee,f as e,p as b,Q as Se,D as Ne,u as Ve,v as Ce,z as ye,c as we,x as Q,g as xe}from"./index-6bc77bae.js";import{u as G}from"./alert-ad4a9987.js";import{u as ae,a as le,b as q}from"./useFormSchemas-2bba9048.js";import{u as ke,a as De,_ as Ue}from"./ElementsTable.vue_vue_type_script_setup_true_lang-f962e500.js";const $e={class:"text-error"},Me=H({__name:"CustomersDeleteDialog",props:{isOpened:{type:Boolean},customer:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchCustomers"],setup(u,{emit:V}){const i=u,y=G(),F=J(),C=K(),_=T(!1),w=async()=>{var d;try{_.value=!0,await X.deleteCustomer(i.customer.id),F.deleteCustomer(i.customer.id),i.isSearchActive&&V("updateSearchCustomers"),y.showMessage("success","Клиент был успешно удален!")}catch(c){if(Y(c)){if(((d=c.response)==null?void 0:d.status)===401){C.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"customers-page"}});return}y.showMessage("error",ee(c))}else y.showMessage("error","Ошибка при удалении клиента!")}finally{V("closeDialog"),_.value=!1}};return(d,c)=>{const v=a("v-card-title"),x=a("v-card-text"),S=a("v-btn"),U=a("v-card-actions"),m=a("v-card"),A=a("v-dialog");return D(),M(A,{width:"auto","model-value":u.isOpened,persistent:!0,transition:"dialog-bottom-transition"},{default:t(()=>[o(m,{color:"white",class:"pa-4","max-width":450},{default:t(()=>[o(v,{class:"text-h5 mb-4 pa-0 font-weight-bold"},{default:t(()=>[p("Подтвердите удаление клиента")]),_:1}),o(x,{class:"text-h6 mb-4 pa-0"},{default:t(()=>[p(" Вы уверены что хотиет удалить клиента "),z("span",$e,te(u.customer.firstName+" "+u.customer.secondName),1),p(" ? ")]),_:1}),o(U,{class:"justify-center pa-0"},{default:t(()=>[o(S,{onClick:c[0]||(c[0]=f=>d.$emit("closeDialog")),height:"40",color:"blue-darken-4",variant:"flat"},{default:t(()=>[p(" Нет ")]),_:1}),o(S,{height:"40",color:"error",variant:"flat",loading:_.value,onClick:w},{default:t(()=>[p("Да")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),Ae=z("p",{class:"text-h6"},"Премиум клиент",-1),Ee=H({__name:"CustomersAddDialog",props:{isOpened:{type:Boolean}},emits:["closeDialog"],setup(u,{emit:V}){const{userCustomerSchema:i}=ae(),{resetForm:y,handleSubmit:F,isSubmitting:C}=le({validationSchema:i}),{value:_,errorMessage:w}=q("firstName"),{value:d,errorMessage:c}=q("secondName"),{value:v,errorMessage:x}=q("thirdName"),{value:S,errorMessage:U}=q("phone"),{value:m,errorMessage:A}=q("premium");m.value="Нет";const f=G(),E=J(),O=K(),W=F(async g=>{var l;try{const{data:r}=await X.addCustomer(g);E.addCustomer({...g,id:r.customerId,fullName:g.secondName+" "+g.firstName+" "+g.thirdName}),f.showMessage("success","Клиент "+g.secondName+" был успешно добавлен!")}catch(r){if(Y(r)){if(((l=r.response)==null?void 0:l.status)===401){O.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"customers-page"}});return}f.showMessage("error",ee(r))}else f.showMessage("error","Ошибка при добавлении клиента")}finally{V("closeDialog"),y()}});return(g,l)=>{const r=a("v-card-title"),k=a("v-text-field"),N=a("v-col"),$=a("v-switch"),P=a("v-btn"),j=a("v-row"),I=a("v-form"),B=a("v-card-actions"),L=a("v-card"),Z=a("v-dialog");return D(),M(Z,{"model-value":u.isOpened,"onUpdate:modelValue":l[6]||(l[6]=h=>V("closeDialog")),width:"auto",scrollable:"",transition:"dialog-bottom-transition"},{default:t(()=>[o(L,{color:"white",class:"pa-4",width:"450"},{default:t(()=>[o(r,{class:"font-weight-bold text-h6 mb-3"},{default:t(()=>[p(" Добавление нового клиента ")]),_:1}),o(B,null,{default:t(()=>[o(I,{onSubmit:e(W)},{default:t(()=>[o(j,null,{default:t(()=>[o(N,{cols:"12"},{default:t(()=>[o(k,{modelValue:e(_),"onUpdate:modelValue":l[0]||(l[0]=h=>b(_)?_.value=h:null),"error-messages":e(w),label:"Имя"},null,8,["modelValue","error-messages"])]),_:1}),o(N,{cols:"12"},{default:t(()=>[o(k,{modelValue:e(d),"onUpdate:modelValue":l[1]||(l[1]=h=>b(d)?d.value=h:null),"error-messages":e(c),label:"Фамилия"},null,8,["modelValue","error-messages"])]),_:1}),o(N,{cols:"12"},{default:t(()=>[o(k,{modelValue:e(v),"onUpdate:modelValue":l[2]||(l[2]=h=>b(v)?v.value=h:null),"error-messages":e(x),label:"Отчество"},null,8,["modelValue","error-messages"])]),_:1}),o(N,{cols:"12"},{default:t(()=>[o(k,{label:"Номер телефона",modelValue:e(S),"onUpdate:modelValue":l[3]||(l[3]=h=>b(S)?S.value=h:null),"error-messages":e(U)},null,8,["modelValue","error-messages"])]),_:1}),o(N,{cols:"12"},{default:t(()=>[Ae,o($,{modelValue:e(m),"onUpdate:modelValue":l[4]||(l[4]=h=>b(m)?m.value=h:null),"true-value":"Да","false-value":"Нет","hide-details":"",label:e(m),color:"indigo","error-messages":e(A)},null,8,["modelValue","label","error-messages"])]),_:1}),o(N,{cols:"12"},{default:t(()=>[o(P,{color:"green-darken-4",variant:"flat",type:"submit",loading:e(C)},{default:t(()=>[p(" Добавить ")]),_:1},8,["loading"]),o(P,{color:"blue-darken-4",variant:"flat",onClick:l[5]||(l[5]=h=>g.$emit("closeDialog"))},{default:t(()=>[p(" Отмена ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),Te=z("p",{class:"text-h6"},"Премиум клиент ?",-1),qe=H({__name:"CustomersEditDialog",props:{isOpened:{type:Boolean},customer:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchCustomers"],setup(u,{emit:V}){const i=u,y=Se(()=>({firstName:i.customer.firstName,secondName:i.customer.secondName,thirdName:i.customer.thirdName,phone:i.customer.phone,premium:i.customer.premium})),{userCustomerSchema:F}=ae(),{resetForm:C,handleSubmit:_,isSubmitting:w}=le({validationSchema:F,initialValues:y}),{value:d,errorMessage:c}=q("firstName"),{value:v,errorMessage:x}=q("secondName"),{value:S,errorMessage:U}=q("thirdName"),{value:m,errorMessage:A}=q("phone"),{value:f}=q("premium"),E=G(),O=J(),W=K(),g=_(async l=>{var r;console.log(l);try{await X.updateCustomer(l,i.customer.id),O.updateCustomer({...l,id:i.customer.id,fullName:l.secondName+" "+l.firstName+" "+l.thirdName}),i.isSearchActive&&V("updateSearchCustomers"),E.showMessage("success","Клиент был успешно изменен")}catch(k){if(Y(k)){if(((r=k.response)==null?void 0:r.status)===401){W.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"customers-page"}});return}E.showMessage("error",ee(k))}else E.showMessage("error","Ошибка при изменении клиента")}finally{C(),V("closeDialog")}});return(l,r)=>{const k=a("v-card-title"),N=a("v-text-field"),$=a("v-col"),P=a("v-switch"),j=a("v-btn"),I=a("v-row"),B=a("v-form"),L=a("v-card-actions"),Z=a("v-card"),h=a("v-dialog");return D(),M(h,{"model-value":u.isOpened,"onUpdate:modelValue":r[6]||(r[6]=s=>l.$emit("closeDialog")),scrollable:"",width:"auto"},{default:t(()=>[o(Z,{width:"450",color:"white",class:"pa-4"},{default:t(()=>[o(k,{class:"text-h6 font-weight-bold"},{default:t(()=>[p(" Редактирование клиента ")]),_:1}),o(L,null,{default:t(()=>[o(B,{onSubmit:e(g)},{default:t(()=>[o(I,null,{default:t(()=>[o($,{cols:"12"},{default:t(()=>[o(N,{modelValue:e(d),"onUpdate:modelValue":r[0]||(r[0]=s=>b(d)?d.value=s:null),"error-messages":e(c),label:"Имя"},null,8,["modelValue","error-messages"])]),_:1}),o($,{cols:"12"},{default:t(()=>[o(N,{modelValue:e(v),"onUpdate:modelValue":r[1]||(r[1]=s=>b(v)?v.value=s:null),"error-messages":e(x),label:"Фамилия"},null,8,["modelValue","error-messages"])]),_:1}),o($,{cols:"12"},{default:t(()=>[o(N,{modelValue:e(S),"onUpdate:modelValue":r[2]||(r[2]=s=>b(S)?S.value=s:null),"error-messages":e(U),label:"Отчество"},null,8,["modelValue","error-messages"])]),_:1}),o($,{cols:"12"},{default:t(()=>[o(N,{label:"Номер телефона",modelValue:e(m),"onUpdate:modelValue":r[3]||(r[3]=s=>b(m)?m.value=s:null),"error-messages":e(A)},null,8,["modelValue","error-messages"])]),_:1}),o($,{cols:"12"},{default:t(()=>[Te,o(P,{modelValue:e(f),"onUpdate:modelValue":r[4]||(r[4]=s=>b(f)?f.value=s:null),"true-value":"Да","false-value":"Нет","hide-details":"",label:e(f),color:"indigo"},null,8,["modelValue","label"])]),_:1}),o($,{cols:"12"},{default:t(()=>[o(j,{color:"green-darken-4",variant:"flat",type:"submit",loading:e(w)},{default:t(()=>[p(" Обновить ")]),_:1},8,["loading"]),o(j,{color:"blue-darken-4",variant:"flat",onClick:r[5]||(r[5]=s=>l.$emit("closeDialog"))},{default:t(()=>[p(" Отмена ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),Fe=(u,V,i)=>{const y=G(),F=T(!1),C=T(u.query.secondName||""),_=T(+u.query.premium||0),w=T(!1),d=T([]),c=T(!1),v=T(!1),x=()=>{C.value="",w.value=!1,_.value=0,c.value=!1,d.value=[],V.push({name:"clients-page",query:{}})},S=()=>{V.push({name:"clients-page",query:{...u.query,secondName:C.value,searchWithPremium:String(w.value),premium:_.value}})},U=async()=>{try{v.value=!0;const{data:m}=await X.getSearchedCustomers({userId:i,premium:+u.query.premium,secondName:u.query.secondName,searchWithPremium:u.query.searchWithPremium});console.log(m),d.value=m.customers,c.value=!0}catch(m){Y(m)?y.showMessage("error",ee(m)):y.showMessage("error","Ошибка при поиске товаров!")}finally{v.value=!1}};return Ne([()=>u.query.secondName,()=>u.query.premium,()=>u.query.searchWithPremium],async()=>{u.query.secondName===void 0&&!u.query.premium||U()},{immediate:!0}),{premium:_,searchWithPremium:w,isSearchFormActive:F,isSearchActive:c,isSearchLoading:v,secondName:C,searchedCustomers:d,searchUserCustomers:U,addSearchQuery:S,resetSearch:x}},Pe={class:"text-h6"},Be=z("h2",{class:"title text-h2 mb-5"},"Клиенты",-1),je=H({__name:"CustomersView",setup(u){const V=J(),i=G(),y=Ve(),F=T([{fieldText:"Имя",fieldName:"firstName"},{fieldText:"Фамилия",fieldName:"secondName"},{fieldText:"Отчество",fieldName:"thirdName"},{fieldText:"Телефон",fieldName:"phone"},{fieldText:"Есть премиум",fieldName:"premium"}]),C=T("firstName"),{customers:_,customersErrorMessage:w}=Ce(V),{isAddDialogActive:d,isEditDialogActive:c,isDeleteDialogActive:v,itemToEdit:x,openDialog:S}=ke(),U=xe(),m=K(),{isSearchFormActive:A,isSearchLoading:f,searchWithPremium:E,premium:O,isSearchActive:W,secondName:g,searchedCustomers:l,addSearchQuery:r,resetSearch:k,searchUserCustomers:N}=Fe(U,m,y.currentUser.id),$=ye(()=>W.value?l.value:_.value),{currentPage:P,paginatedElements:j,isInverseSort:I,elemetsPerPage:B,totalPages:L,setSortField:Z}=De({tableElements:$,pageName:"clients-page",sortField:C,route:U,router:m});return(h,s)=>{const re=a("v-snackbar"),ne=a("TableActions"),ue=a("v-text-field"),R=a("v-col"),ie=a("v-checkbox"),de=a("v-switch"),me=a("v-scale-transition"),oe=a("v-btn"),se=a("v-row"),ce=a("v-expand-transition"),ve=a("v-alert-title"),pe=a("v-alert"),_e=a("v-progress-circular"),fe=a("v-sheet"),ge=a("v-pagination"),he=a("v-card");return D(),we("div",null,[o(re,{modelValue:e(i).isMessageShown,"onUpdate:modelValue":s[0]||(s[0]=n=>e(i).isMessageShown=n),"max-width":500,color:e(i).messageType},{default:t(()=>[z("p",Pe,te(e(i).messageText),1)]),_:1},8,["modelValue","color"]),Be,o(he,{color:"white",elevation:"3",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:t(()=>[o(ne,{count:e(B),"onUpdate:count":[s[1]||(s[1]=n=>b(B)?B.value=n:null),s[2]||(s[2]=n=>B.value=n)],onToggleAddDialog:s[3]||(s[3]=n=>d.value=!0),onToggleSearch:s[4]||(s[4]=n=>A.value=!e(A)),"is-badge-active":!!h.$route.query.secondName},{default:t(()=>[p(" Все клиенты ")]),_:1},8,["count","is-badge-active"]),o(ce,null,{default:t(()=>[e(A)?(D(),M(se,{key:0,class:"mb-5",align:"center"},{default:t(()=>[o(R,{cols:"8"},{default:t(()=>[o(ue,{label:"Имя клиента",modelValue:e(g),"onUpdate:modelValue":s[5]||(s[5]=n=>b(g)?g.value=n:null),"onClick:clear":s[6]||(s[6]=n=>g.value="")},null,8,["modelValue"])]),_:1}),o(R,{cols:"auto"},{default:t(()=>[o(ie,{modelValue:e(E),"onUpdate:modelValue":s[7]||(s[7]=n=>b(E)?E.value=n:null),color:"indigo-darken-4",label:"Искать с премиумом"},null,8,["modelValue"])]),_:1}),o(me,{"leave-absolute":!0},{default:t(()=>[e(E)?(D(),M(R,{key:0,cols:"auto"},{default:t(()=>[o(de,{modelValue:e(O),"onUpdate:modelValue":s[8]||(s[8]=n=>b(O)?O.value=n:null),"true-value":1,"false-value":0,color:"indigo-darken-4",label:"Есть премиум?"},null,8,["modelValue"])]),_:1})):Q("",!0)]),_:1}),o(R,{cols:"12"},{default:t(()=>[o(se,null,{default:t(()=>[o(R,{cols:"auto"},{default:t(()=>[o(oe,{variant:"flat",disabled:e(f),color:"green-darken-3",onClick:e(r)},{default:t(()=>[p(" Искать ")]),_:1},8,["disabled","onClick"])]),_:1}),o(R,{cols:"auto"},{default:t(()=>[o(oe,{variant:"flat",disabled:e(f),color:"error",onClick:e(k)},{default:t(()=>[p(" Сбросить поиск ")]),_:1},8,["disabled","onClick"])]),_:1}),o(R,{cols:"auto"},{default:t(()=>[o(oe,{variant:"flat",disabled:e(f),color:"blue-darken-4",onClick:s[9]||(s[9]=n=>A.value=!1)},{default:t(()=>[p(" Закрыть поиск ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})):Q("",!0)]),_:1}),e(w)?(D(),M(pe,{key:0,type:"error",border:"end",variant:"tonal"},{default:t(()=>[o(ve,{class:"mb-2"},{default:t(()=>[p(" Ошибка при загрузке клиентов")]),_:1}),z("p",null,te(e(w)),1)]),_:1})):e(f)?Q("",!0):(D(),M(Ue,{key:1,items:e(j),fields:F.value,"no-data-text":"Клиенты не найдены","current-sort-field":C.value,"onUpdate:currentSortField":[s[10]||(s[10]=n=>C.value=n),s[11]||(s[11]=n=>e(Z)(n))],"is-inverse-sort":e(I),onOpenDialog:s[12]||(s[12]=(n,be)=>e(S)(n,be))},null,8,["items","fields","current-sort-field","is-inverse-sort"])),e(f)?(D(),M(fe,{key:2,class:"text-center mb-2"},{default:t(()=>[o(_e,{indeterminate:"",size:"32",color:"green"})]),_:1})):Q("",!0),e($).length?(D(),M(ge,{key:3,length:e(L),modelValue:e(P),"onUpdate:modelValue":s[13]||(s[13]=n=>b(P)?P.value=n:null),rounded:"circle","total-visible":7,color:"deep-purple-darken-4"},null,8,["length","modelValue"])):Q("",!0)]),_:1}),e(x)?(D(),M(Me,{key:0,"is-opened":e(v),onCloseDialog:s[14]||(s[14]=n=>v.value=!1),"is-search-active":e(W),onUpdateSearchCustomers:e(N),customer:e(x)},null,8,["is-opened","is-search-active","onUpdateSearchCustomers","customer"])):Q("",!0),e(x)?(D(),M(qe,{key:1,"is-opened":e(c),onCloseDialog:s[15]||(s[15]=n=>c.value=!1),"is-search-active":e(W),onUpdateSearchCustomers:e(N),customer:e(x)},null,8,["is-opened","is-search-active","onUpdateSearchCustomers","customer"])):Q("",!0),o(Ee,{"is-opened":e(d),onCloseDialog:s[16]||(s[16]=n=>d.value=!1)},null,8,["is-opened"])])}}});export{je as default};
