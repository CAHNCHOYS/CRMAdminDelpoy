import{d as I,u as D,z as X,A as C,i as q,h as B,r as E,o as F,c as R,b as e,e as o,m as l,f as s,p as A,n as L,j as O,k as t,l as Y,q as Z,s as ee,_ as se,B as oe,C as te,x as ae,t as re}from"./index-895edbee.js";import{u as W,a as G,b as k}from"./useFormSchemas-8d352281.js";import{u as ne}from"./alert-139ef2ed.js";const le=l("div",{class:"text-h5 mb-4"},"Общая информация об аккаунте",-1),ue={class:"d-flex flex-sm-row flex-column align-sm-center"},ce=l("span",{class:"text-h6"},"Обновить данные ",-1),de=I({__name:"AccountInfo",emits:["showMessage"],setup(x,{emit:m}){const r=D(),w=X(()=>{var c,a,n;return{name:((c=r.currentUser)==null?void 0:c.name)||"user logged out",email:((a=r.currentUser)==null?void 0:a.email)||"user logged out",country:((n=r.currentUser)==null?void 0:n.country)||"user logged out",avatar:[]}}),{updateInfoShchema:f}=W(),{handleSubmit:p,isSubmitting:h}=G({validationSchema:f,initialValues:w}),{value:d,errorMessage:g}=k("name"),{value:S,errorMessage:y}=k("email"),{value:V,errorMessage:b}=k("country"),{value:_,errorMessage:M}=k("avatar"),j=O(),N=p(async c=>{var a;try{let n=new FormData;n.append("name",c.name),n.append("email",c.email),n.append("country",c.country),n.append("avatar",c.avatar[0],_.value[0].name),await C.updateInfo(n);const{data:$}=await C.getUser();r.setUser($.user),m("showMessage","success","Данные были обновлены!")}catch(n){q(n)?(((a=n.response)==null?void 0:a.status)===401&&j.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"account-page"}}),m("showMessage","error",B(n))):m("showMessage","error","Ошибка при изменении данных!")}}),P=E("");function u(c){const a=c.target.files[0];P.value=URL.createObjectURL(a),console.log(URL.createObjectURL(a))}function v(){P.value=""}return(c,a)=>{const n=t("v-avatar"),$=t("v-file-input"),i=t("v-col"),z=t("v-text-field"),H=t("v-select"),J=t("v-btn"),K=t("v-row"),Q=t("v-form");return F(),R("div",null,[le,e(Q,{onSubmit:L(s(N),["prevent"]),enctype:"multipart/form-data"},{default:o(()=>[e(K,{align:"center"},{default:o(()=>[e(i,{md:"6",cols:"12"},{default:o(()=>[l("div",ue,[e(n,{size:"80",class:"mr-sm-3 mb-sm-0 mb-4 border mx-auto",image:P.value||`https://crm-backend-mocha.vercel.app/UserAvatars/${s(r).currentUser.avatar}`},null,8,["image"]),e($,{modelValue:s(_),"onUpdate:modelValue":a[0]||(a[0]=U=>A(_)?_.value=U:null),"error-messages":s(M),"show-size":"","prepend-icon":"mdi-camera","hide-details":"auto",label:"Загрузите ваш аватар",accept:".jpg, .png, .jpeg, .svg , .webp",onChange:u,"onClick:clear":v},null,8,["modelValue","error-messages"])])]),_:1}),e(i,{sm:"6",cols:"12"},{default:o(()=>[e(z,{modelValue:s(d),"onUpdate:modelValue":a[1]||(a[1]=U=>A(d)?d.value=U:null),"error-messages":s(g),label:"Ваше имя"},null,8,["modelValue","error-messages"])]),_:1}),e(i,{sm:"6",cols:"12"},{default:o(()=>[e(z,{modelValue:s(S),"onUpdate:modelValue":a[2]||(a[2]=U=>A(S)?S.value=U:null),"error-messages":s(y),label:"Ваша почта"},null,8,["modelValue","error-messages"])]),_:1}),e(i,{sm:"6",cols:"12"},{default:o(()=>[e(H,{modelValue:s(V),"onUpdate:modelValue":a[3]||(a[3]=U=>A(V)?V.value=U:null),"error-messages":s(b),items:["Россия","Беларусь","Латвия","Украина","Казахстан","Узбекистан"],label:"Страна проживания"},null,8,["modelValue","error-messages"])]),_:1}),e(i,{cols:"12"},{default:o(()=>[e(J,{type:"submit",variant:"flat",loading:s(h),color:"green"},{default:o(()=>[ce]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}}}),ie=l("div",{class:"text-h5 mb-3"},"Безопасность",-1),me=l("span",{class:"text-white text-h6"},"Обновить пароль",-1),pe=I({__name:"AccountSecurity",emits:["showMessage"],setup(x,{emit:m}){const{updatePasswordSchema:r}=W(),{handleSubmit:w,isSubmitting:f,resetForm:p}=G({validationSchema:r}),{value:h,errorMessage:d}=k("oldPassword"),{value:g,errorMessage:S}=k("newPassword"),{value:y,errorMessage:V}=k("newPasswordConfirm"),b=E(!1),_=E(!1),M=D(),j=O(),N=w(async P=>{var u;try{await C.updatePassword(P);const{data:v}=await C.getUser();M.setUser(v.user),m("showMessage","success","Пароль был успешно имзенен"),p()}catch(v){if(q(v)){if(((u=v.response)==null?void 0:u.status)===401){j.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"account-page"}});return}m("showMessage","error",B(v))}else m("showMessage","error","Ошибка при изменении пароля!")}});return(P,u)=>{const v=t("v-text-field"),c=t("v-col"),a=t("v-btn"),n=t("v-row"),$=t("v-form");return F(),R("div",null,[ie,e($,{onSubmit:L(s(N),["prevent"])},{default:o(()=>[e(n,null,{default:o(()=>[e(c,{cols:"12"},{default:o(()=>[e(v,{modelValue:s(h),"onUpdate:modelValue":u[0]||(u[0]=i=>A(h)?h.value=i:null),"error-messages":s(d),label:"Старый пароль",type:_.value?"text":"password","append-inner-icon":_.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":u[1]||(u[1]=i=>_.value=!_.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1}),e(c,{sm:"6",cols:"12"},{default:o(()=>[e(v,{label:"Новый пароль",modelValue:s(g),"onUpdate:modelValue":u[2]||(u[2]=i=>A(g)?g.value=i:null),"error-messages":s(S),type:b.value?"text":"password","append-inner-icon":b.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":u[3]||(u[3]=i=>b.value=!b.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1}),e(c,{sm:"6",cols:"12"},{default:o(()=>[e(v,{modelValue:s(y),"onUpdate:modelValue":u[4]||(u[4]=i=>A(y)?y.value=i:null),"error-messages":s(V),label:"Повторите новый пароль",type:b.value?"text":"password"},null,8,["modelValue","error-messages","type"])]),_:1}),e(c,{cols:"12"},{default:o(()=>[e(a,{type:"submit",loading:s(f),variant:"flat",color:"green"},{default:o(()=>[me]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}}}),T=x=>(Z("data-v-80575f6d"),x=x(),ee(),x),_e=T(()=>l("div",{class:"text-h5 mb-4"},"Удаление аккаунта",-1)),ve=T(()=>l("p",{class:"text-h6"},"Отменить это действие будет невозможно",-1)),fe={class:"mb-2"},ge=T(()=>l("span",{class:"font-weight-bold"},"Я хочу удалить аккаунт ",-1)),we=T(()=>l("span",{class:"text-h6"},"Удалить аккаунт",-1)),he=I({__name:"AccountDeletion",emits:["showMessage"],setup(x,{emit:m}){const r=D(),w=O(),f=E(!1),p=E(!1),h=async()=>{if(f.value&&window.confirm("Вы точно уверены?"))try{await C.deleteAccount(r.currentUser.id),r.logOutUser(),w.push({name:"login-page"})}catch(d){p.value=!0,q(d)?m("showMessage","error",B(d)):m("showMessage","error","Ошибка при удалении профиля!"),setTimeout(()=>p.value=!1,3500)}};return(d,g)=>{const S=t("v-alert-title"),y=t("v-alert"),V=t("v-checkbox"),b=t("v-btn"),_=t("v-form");return F(),R("div",null,[_e,e(_,{onSubmit:L(h,["prevent"])},{default:o(()=>[e(y,{border:"end",variant:"tonal",color:"red-darken-2"},{default:o(()=>[e(S,{class:"text-h6 mb-1"},{default:o(()=>[Y("Вы уверены что хотите удалить аккаунт?")]),_:1}),ve]),_:1}),l("p",fe,[e(V,{modelValue:f.value,"onUpdate:modelValue":g[0]||(g[0]=M=>f.value=M),rules:[M=>!!M||"Подтвердите удаление аккаунта"],required:"",color:"red-darken-2",class:"text-red-darken-4"},{label:o(()=>[ge]),_:1},8,["modelValue","rules"])]),e(b,{type:"submit",color:"error"},{default:o(()=>[we]),_:1})]),_:1},8,["onSubmit"])])}}});const be=se(he,[["__scopeId","data-v-80575f6d"]]),xe={key:0},Se={class:"text-h6"},ye=l("div",{class:"title text-h2 mb-5 anim"},"Аккаунт",-1),Ve={class:"account-items"},ke=I({__name:"AccountView",setup(x){const m=D(),r=ne(),w=(f,p)=>{r.showMessage(f,p)};return oe(()=>{te.from(".account-items > *",{y:"-70%",opacity:0,duration:.8,stagger:.4,ease:"power3.out"})}),(f,p)=>{const h=t("v-snackbar"),d=t("v-card");return s(m).currentUser?(F(),R("div",xe,[e(h,{modelValue:s(r).isMessageShown,"onUpdate:modelValue":p[0]||(p[0]=g=>s(r).isMessageShown=g),color:s(r).messageType,position:"fixed"},{default:o(()=>[l("p",Se,re(s(r).messageText),1)]),_:1},8,["modelValue","color"]),ye,l("div",Ve,[l("div",null,[e(d,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:o(()=>[e(de,{onShowMessage:w})]),_:1})]),l("div",null,[e(d,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:o(()=>[e(pe,{onShowMessage:w})]),_:1})]),l("div",null,[e(d,{color:"white",elevation:"2",class:"pa-5 rounded-lg mx-sm-0 mx-n5"},{default:o(()=>[e(be,{onShowMessage:w})]),_:1})])])])):ae("",!0)}}});export{ke as default};
