import{r as V,x as X,E as Ve,g as ce,h as ue,w as Se,d as O,i as s,o as f,c as D,l as i,t as T,k as U,b as e,e as t,F as ae,p as de,n as ie,_ as ve,G as Z,a as ee,s as Y,H as ke,z as se,A as le,v as I,m as me,f as o,j as A,q as B,I as Me,u as Ue,J as Ce,D as Ae,K as ne,L as re,T as Ee,M as Ie,N as De,O as Te,P as Be,Q as Ne}from"./index-7839c28a.js";import{u as _e,a as pe,b as j}from"./useFormSchemas-f6529911.js";const Fe=(u=V([]),_)=>{const m=ce(),c=ue(),v=V(+m.query.currentPage||1),p=V(10),g=X(()=>Math.ceil(u.value.length/p.value)),n=V(!1),h=d=>{_.value===d?n.value=!n.value:n.value=!1,_.value=d},w=d=>{v.value=d},$=X(()=>{const d=u.value.length;let x=(v.value-1)*p.value;x>d&&(w(Math.ceil(d/p.value)),x=(v.value-1)*p.value);let S=x+p.value;const y=u.value.slice(x,S);return n.value?[...y].sort((P,k)=>P[_.value]>k[_.value]?-1:1):[...y].sort((P,k)=>P[_.value]>k[_.value]?1:-1)});return Ve(v,()=>{c.push({name:"products-page",query:{...m.query,currentPage:v.value}})}),{currentPage:v,paginatedProducts:$,totalPages:g,isInverseSort:n,productsByPage:p,setSortField:h}},Re=u=>{const _=ce(),m=ue(),c=V([+_.query.startPrice||1,+_.query.endPrice||999999]),v=V(_.query.name||""),p=X(()=>u.value.filter(h=>h.price>c.value[0]&&h.price<c.value[1]).filter(h=>h.name.toLowerCase().includes(v.value.toLowerCase()))),g=()=>{v.value="",c.value=[1,999999]};return Se(n=>{console.log("watchEffect called");const h=v.value,w=c.value[0],$=c.value[1],d=setTimeout(()=>{m.push({name:"products-page",query:{..._.query,name:h,startPrice:w,endPrice:$}})},800);n(()=>{clearInterval(d)})}),{searchName:v,searchPrices:c,filteredProducts:p,resetSearch:g}},te=u=>(de("data-v-0c1d4abb"),u=u(),ie(),u),qe={class:"d-sm-table-row d-block"},je={class:"d-sm-table-cell d-flex justify-space-between h-auto pa-0 py-2"},Le=te(()=>i("div",{class:"d-sm-none d-block font-weight-bold pr-1"},"Название:",-1)),ze={class:"text-sm-left text-right"},Ge={class:"d-sm-table-cell d-flex justify-space-between h-auto pa-0 py-2"},Oe=te(()=>i("div",{class:"d-sm-none d-block font-weight-bold pr-1"},"Цена:",-1)),Je={class:"d-sm-table-cell d-flex justify-space-between h-auto pa-0 py-2"},Ke=te(()=>i("div",{class:"d-sm-none d-block font-weight-bold pr-1"},"Кол-во:",-1)),Qe={class:"d-sm-table-cell d-flex justify-space-between h-auto pa-0 py-2"},He=te(()=>i("div",{class:"d-sm-none d-block font-weight-bold pr-1"},"Категория:",-1)),We={class:"d-sm-table-cell d-flex justify-end h-auto pa-0 py-2"},Xe={class:"d-flex flex-wrap"},Ye=O({__name:"UserProductRow",props:{product:null},emits:["openDialog"],setup(u,{emit:_}){return(m,c)=>{const v=s("v-btn"),p=s("v-tooltip");return f(),D("tr",qe,[i("td",je,[Le,i("div",ze,T(u.product.name),1)]),i("td",Ge,[Oe,U(" "+T(u.product.price)+"₽ ",1)]),i("td",Je,[Ke,U(" "+T(u.product.count),1)]),i("td",Qe,[He,U(" "+T(u.product.category),1)]),i("td",We,[i("div",Xe,[e(p,{text:"Удалить",location:"left","no-click-animation":""},{activator:t(({props:g})=>[e(v,ae(g,{variant:"flat",icon:"mdi-trash-can",onClick:c[0]||(c[0]=n=>m.$emit("openDialog",u.product,"delete")),color:"error",class:"mr-2"}),null,16)]),_:1}),e(p,{text:"Редактировать",location:"right","no-click-animation":""},{activator:t(({props:g})=>[e(v,ae(g,{variant:"flat",icon:"mdi-pencil",color:"info",onClick:c[1]||(c[1]=n=>m.$emit("openDialog",u.product,"edit"))}),null,16)]),_:1})])])])}}});const Ze=ve(Ye,[["__scopeId","data-v-0c1d4abb"]]),et=i("p",{class:"text-h6 font-weight-bold mb-4"},"Редактирование товара",-1),tt={key:1,class:"text-h6 text-red"},ot=O({__name:"ProductEditDialog",props:{isActive:{type:Boolean},product:null},emits:["closeModal"],setup(u,{emit:_}){const m=u,c=X(()=>{var M,l,N,E;return{name:((M=m.product)==null?void 0:M.name)||"Товар не был выбран",price:((l=m.product)==null?void 0:l.price)||0,count:((N=m.product)==null?void 0:N.count)||0,categoryId:((E=m.product)==null?void 0:E.categoryId)||0}}),{userProductSchema:v}=_e(),{handleSubmit:p,isSubmitting:g}=pe({validationSchema:v,initialValues:c}),{value:n,errorMessage:h}=j("name"),{value:w,errorMessage:$}=j("price"),{value:d,errorMessage:x}=j("count"),{value:S,errorMessage:y}=j("categoryId"),P=Z(),k=ee(),{productsCategories:L,isCategoriesFetchError:J,categoriesLoadErrorMessage:F}=Y(P),R=p(async M=>{try{const{data:l}=await ke(M,m.product.id,m.product.userId);P.updateUserProduct(l.product),k.showMessage("success","Товар был изменен")}catch(l){se(l)?k.showMessage("error",le(l)):k.showMessage("error","Ошибка при обновлении товара!")}finally{_("closeModal")}});return(M,l)=>{const N=s("v-card-title"),E=s("v-text-field"),C=s("v-col"),q=s("v-select"),z=s("v-btn"),G=s("v-row"),a=s("v-form"),K=s("v-card-actions"),Q=s("v-card"),H=s("v-dialog");return f(),I(H,{transition:"dialog-bottom-transition","max-width":"500","onUpdate:modelValue":l[5]||(l[5]=b=>M.$emit("closeModal")),"model-value":u.isActive},{default:t(()=>[e(Q,{class:"pa-5",color:"white",elevation:"4"},{default:t(()=>[e(N,null,{default:t(()=>[et]),_:1}),e(K,null,{default:t(()=>[e(a,{onSubmit:me(o(R),["prevent"])},{default:t(()=>[e(G,null,{default:t(()=>[e(C,{cols:"12"},{default:t(()=>[e(E,{modelValue:o(n),"onUpdate:modelValue":l[0]||(l[0]=b=>A(n)?n.value=b:null),"error-messages":o(h),label:"Название товара"},null,8,["modelValue","error-messages"])]),_:1}),e(C,{cols:"12"},{default:t(()=>[o(L).length?(f(),I(q,{key:0,modelValue:o(S),"onUpdate:modelValue":l[1]||(l[1]=b=>A(S)?S.value=b:null),label:"Категория товара","error-messages":o(y),items:o(L),"item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])):B("",!0),o(J)?(f(),D("p",tt,T(o(F)),1)):B("",!0)]),_:1}),e(C,{sm:"6",cols:"12"},{default:t(()=>[e(E,{modelValue:o(d),"onUpdate:modelValue":l[2]||(l[2]=b=>A(d)?d.value=b:null),"error-messages":o(x),label:"Количество",type:"number"},null,8,["modelValue","error-messages"])]),_:1}),e(C,{sm:"6",cols:"12"},{default:t(()=>[e(E,{modelValue:o(w),"onUpdate:modelValue":l[3]||(l[3]=b=>A(w)?w.value=b:null),"error-messages":o($),label:"Цена",type:"number",suffix:"руб"},null,8,["modelValue","error-messages"])]),_:1}),e(C,{cols:"12"},{default:t(()=>[e(z,{color:"green-darken-4",variant:"flat",loading:o(g),type:"submit"},{default:t(()=>[U(" Сохранить ")]),_:1},8,["loading"]),e(z,{color:"blue-darken-4",variant:"flat",onClick:l[4]||(l[4]=b=>M.$emit("closeModal"))},{default:t(()=>[U(" Отмена ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),st=i("p",{class:"font-weight-bold text-h5"},"Подтверждение удаления",-1),lt={class:"text-h6"},at={class:"text-red"},nt=i("span",{class:"text-white"},"Нет",-1),rt=O({__name:"ProductDeleteDialog",props:{product:null,isActive:{type:Boolean}},emits:["closeModal"],setup(u,{emit:_}){const m=u,c=V(!1),v=Z(),p=ee(),g=async()=>{try{c.value=!0,await Me(m.product.id),v.deleteUserProduct(m.product.id),p.showMessage("success","Товар был успешно удален")}catch(n){se(n)?p.showMessage("error",le(n)):p.showMessage("error","Ошибка при удалении товара!")}finally{c.value=!1,_("closeModal")}};return(n,h)=>{const w=s("v-card-title"),$=s("v-card-text"),d=s("v-btn"),x=s("v-card-actions"),S=s("v-card"),y=s("v-dialog");return f(),I(y,{"model-value":u.isActive,"max-width":450,persistent:""},{default:t(()=>[e(S,{class:"pa-4"},{default:t(()=>[e(w,{class:"pa-0 mb-3"},{default:t(()=>[st]),_:1}),e($,{class:"pa-0"},{default:t(()=>{var P;return[i("p",lt,[U(" Вы уверены что хотите удалить товар "),i("span",at,T((P=m.product)==null?void 0:P.name),1),U(" с базы данных ? ")])]}),_:1}),e(x,{class:"justify-center"},{default:t(()=>[e(d,{onClick:h[0]||(h[0]=P=>n.$emit("closeModal")),height:"40",color:"blue-darken-4",variant:"flat"},{default:t(()=>[nt]),_:1}),e(d,{height:"40",loading:c.value,color:"error",variant:"flat",onClick:g},{default:t(()=>[U("Да")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),ct=i("p",{class:"text-h6 font-weight-bold mb-4"},"Добавление нового товара",-1),ut={key:1,class:"text-h6 text-red"},dt=O({__name:"ProductAddDialog",props:{isActive:{type:Boolean}},emits:["closeModal"],setup(u,{emit:_}){const{userProductSchema:m}=_e(),{handleSubmit:c,isSubmitting:v,resetForm:p}=pe({validationSchema:m}),{value:g,errorMessage:n}=j("name"),{value:h,errorMessage:w}=j("categoryId"),{value:$,errorMessage:d}=j("count"),{value:x,errorMessage:S}=j("price"),y=Z(),P=ee(),k=Ue(),{productsCategories:L,isCategoriesFetchError:J,categoriesLoadErrorMessage:F}=Y(y),R=c(async M=>{try{const{data:l}=await Ce(M,k.currentUser.id);y.addUserProduct(l.product),P.showMessage("success",`Товар ${M.name} был успешно добавлен!`)}catch(l){se(l)?P.showMessage("error",le(l)):P.showMessage("error","Ошибка при добавлении товара !")}finally{p(),_("closeModal")}});return(M,l)=>{const N=s("v-card-title"),E=s("v-text-field"),C=s("v-col"),q=s("v-select"),z=s("v-btn"),G=s("v-row"),a=s("v-form"),K=s("v-card-actions"),Q=s("v-card"),H=s("v-dialog");return f(),I(H,{transition:"dialog-bottom-transition","max-width":"500","onUpdate:modelValue":l[5]||(l[5]=b=>M.$emit("closeModal")),"model-value":u.isActive},{default:t(()=>[e(Q,{class:"pa-5",color:"white",elevation:"4"},{default:t(()=>[e(N,null,{default:t(()=>[ct]),_:1}),e(K,null,{default:t(()=>[e(a,{onSubmit:me(o(R),["prevent"])},{default:t(()=>[e(G,null,{default:t(()=>[e(C,{cols:"12"},{default:t(()=>[e(E,{modelValue:o(g),"onUpdate:modelValue":l[0]||(l[0]=b=>A(g)?g.value=b:null),"error-messages":o(n),label:"Название товара"},null,8,["modelValue","error-messages"])]),_:1}),e(C,{cols:"12"},{default:t(()=>[o(L).length?(f(),I(q,{key:0,modelValue:o(h),"onUpdate:modelValue":l[1]||(l[1]=b=>A(h)?h.value=b:null),label:"Категория товара","error-messages":o(w),items:o(L),"item-title":"name",clearable:!1,"item-value":"id"},null,8,["modelValue","error-messages","items"])):B("",!0),o(J)?(f(),D("p",ut,T(o(F)),1)):B("",!0)]),_:1}),e(C,{sm:"6",cols:"12"},{default:t(()=>[e(E,{modelValue:o($),"onUpdate:modelValue":l[2]||(l[2]=b=>A($)?$.value=b:null),"error-messages":o(d),label:"Количество",type:"number"},null,8,["modelValue","error-messages"])]),_:1}),e(C,{sm:"6",cols:"12"},{default:t(()=>[e(E,{modelValue:o(x),"onUpdate:modelValue":l[3]||(l[3]=b=>A(x)?x.value=b:null),"error-messages":o(S),label:"Цена",suffix:"руб",type:"number"},null,8,["modelValue","error-messages"])]),_:1}),e(C,{cols:"12"},{default:t(()=>[e(z,{color:"green-darken-4",variant:"flat",loading:o(v),type:"submit"},{default:t(()=>[U(" Добавить ")]),_:1},8,["loading"]),e(z,{color:"blue-darken-4",variant:"flat",onClick:l[4]||(l[4]=b=>M.$emit("close"))},{default:t(()=>[U(" Отмена ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),it=O({__name:"ProductsSearchForm",props:{searchName:null,searchPrices:null},emits:["update:searchName","update:searchPrices","resetSearch","close"],setup(u,{emit:_}){const m=u,c=V(m.searchName),v=V(m.searchPrices),p=()=>{c.value="",v.value=[1,999999],_("resetSearch")};return(g,n)=>{const h=s("v-text-field"),w=s("v-col"),$=s("v-range-slider"),d=s("v-btn"),x=s("v-row"),S=s("v-form");return f(),I(S,null,{default:t(()=>[e(x,{align:"center"},{default:t(()=>[e(w,{sm:"6",cols:"12"},{default:t(()=>[e(h,{modelValue:c.value,"onUpdate:modelValue":[n[0]||(n[0]=y=>c.value=y),n[1]||(n[1]=y=>g.$emit("update:searchName",c.value))],variant:"outlined",label:"Название товара"},null,8,["modelValue"])]),_:1}),e(w,{sm:"6",cols:"12"},{default:t(()=>[e($,{modelValue:v.value,"onUpdate:modelValue":[n[2]||(n[2]=y=>v.value=y),n[3]||(n[3]=y=>g.$emit("update:searchPrices",v.value))],"thumb-label":"always",min:"1",step:"10",max:"999999",strict:"",color:"blue-grey-darken-2",label:"Цена:","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(w,{cols:"auto"},{default:t(()=>[e(x,null,{default:t(()=>[e(w,null,{default:t(()=>[e(d,{variant:"flat",color:"red-darken-4",onClick:p},{default:t(()=>[U(" Сбросить поиск ")]),_:1})]),_:1}),e(w,null,{default:t(()=>[e(d,{variant:"flat",color:"blue-darken-4",onClick:n[4]||(n[4]=y=>g.$emit("close"))},{default:t(()=>[U(" Закрыть поиск ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),oe=u=>(de("data-v-013a1e31"),u=u(),ie(),u),vt={class:"text-h6"},mt=oe(()=>i("div",{class:"title text-h2 mb-5"},"Товары",-1)),_t={key:0},pt=oe(()=>i("div",{class:"text-center mb-3 text-h6"},"Идет загрузка...",-1)),ft={class:"h-auto"},gt={class:"d-none d-sm-table-row"},ht=["onClick"],bt=oe(()=>i("th",{class:"text-left text-h6"},"Действия",-1)),yt={class:"d-sm-none d-block mb-2"},wt={key:0},xt={key:1},Pt=oe(()=>i("tr",null,[i("td",{class:"py-2 text-h6 text-center font-weight-bold",colspan:"12"}," Не удалось найти ни одного товара по заданным фильтрам( ")],-1)),$t=[Pt],Vt={key:3,class:"text-h6"},St=O({__name:"ProductsView",setup(u){const _=Z(),m=ee(),{userProducts:c,loadErrorMessage:v,isProductsLoading:p,isProductsError:g}=Y(_),{isMessageShown:n,messageText:h,messageType:w}=Y(m);Ae(async()=>{c.value.length||await _.fetchUserProducts(),await _.fetchProductsCategories()});const $=V([{text:"Имя",field:"name"},{text:"Цена(руб)",field:"price"},{text:"Кол-во",field:"count"},{text:"Категория",field:"category"}]),d=V($.value[0].field),x=V(!1),S=V(!1),y=V(!1),P=V(!1),k=V(null),L=(G,a)=>{console.log(a),k.value=G,a==="delete"?x.value=!0:a==="edit"&&(y.value=!0)},{filteredProducts:J,searchName:F,searchPrices:R,resetSearch:M}=Re(c),{currentPage:l,paginatedProducts:N,totalPages:E,isInverseSort:C,productsByPage:q,setSortField:z}=Fe(J,d);return(G,a)=>{const K=s("v-snackbar"),Q=s("TableActions"),H=s("v-progress-linear"),b=s("v-expand-transition"),fe=s("v-icon"),ge=s("v-hover"),he=s("v-select"),be=s("v-table"),ye=s("v-alert-title"),we=s("v-alert"),xe=s("v-pagination"),Pe=s("v-card");return f(),D("div",null,[e(K,{modelValue:o(n),"onUpdate:modelValue":a[0]||(a[0]=r=>A(n)?n.value=r:null),location:"right bottom","max-width":500,color:o(w)},{default:t(()=>[i("p",vt,T(o(h)),1)]),_:1},8,["modelValue","color"]),mt,e(Pe,{color:"white",elevation:"3",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:t(()=>[e(Q,{count:o(q),"onUpdate:count":[a[1]||(a[1]=r=>A(q)?q.value=r:null),a[2]||(a[2]=r=>q.value=r)],onToggleAddDialog:a[3]||(a[3]=r=>S.value=!0),onToggleSearch:a[4]||(a[4]=r=>P.value=!P.value)},{default:t(()=>[U(" Все товары("+T(o(c).length)+") ",1)]),_:1},8,["count"]),o(p)?(f(),D("div",_t,[pt,e(H,{color:"green",height:"4",indeterminate:""})])):B("",!0),e(b,null,{default:t(()=>[P.value?(f(),I(it,{key:0,"search-name":o(F),"onUpdate:searchName":[a[5]||(a[5]=r=>A(F)?F.value=r:null),a[7]||(a[7]=r=>F.value=r)],"search-prices":o(R),"onUpdate:searchPrices":[a[6]||(a[6]=r=>A(R)?R.value=r:null),a[8]||(a[8]=r=>R.value=r)],onClose:a[9]||(a[9]=r=>P.value=!1),onResetSearch:o(M),class:"mb-8"},null,8,["search-name","search-prices","onResetSearch"])):B("",!0)]),_:1}),o(c).length?(f(),I(be,{key:1,density:"comfortable"},{default:t(()=>[i("thead",ft,[i("tr",gt,[(f(!0),D(ne,null,re($.value,r=>(f(),D("th",{key:r.text,class:"text-left text-h6",onClick:W=>o(z)(r.field)},[e(ge,null,{default:t(({isHovering:W,props:$e})=>[i("p",Ie(De($e)),[U(T(r.text)+" ",1),Te(e(fe,{style:Be([{position:"absolute"},{opacity:W&&d.value!=r.field?.6:1}]),icon:o(C)&&d.value==r.field?"mdi-arrow-up-thin":"mdi-arrow-down-thin"},null,8,["icon","style"]),[[Ne,d.value===r.field||W]])],16)]),_:2},1024)],8,ht))),128)),bt]),i("div",yt,[e(he,{modelValue:d.value,"onUpdate:modelValue":a[10]||(a[10]=r=>d.value=r),variant:"underlined",label:"Сортировать по",items:$.value,"item-title":"text","item-value":"field"},null,8,["modelValue","items"])])]),o(N).length?(f(),D("tbody",wt,[e(Ee,{appear:"",name:"list"},{default:t(()=>[(f(!0),D(ne,null,re(o(N),(r,W)=>(f(),I(Ze,{product:r,key:r.id,onOpenDialog:L,"data-index":W},null,8,["product","data-index"]))),128))]),_:1})])):(f(),D("tbody",xt,$t))]),_:1})):B("",!0),o(g)?(f(),I(we,{key:2,type:"error",border:"end",variant:"tonal"},{default:t(()=>[e(ye,{class:"mb-2"},{default:t(()=>[U(" Ошибка при загрузке товаров ")]),_:1}),i("p",null,T(o(v)),1)]),_:1})):o(c).length===0&&!o(p)?(f(),D("p",Vt," Пока в таблице нет товаров, добавьте хоть один ")):B("",!0),e(xe,{length:o(E),modelValue:o(l),"onUpdate:modelValue":a[11]||(a[11]=r=>A(l)?l.value=r:null),rounded:"circle","total-visible":7,color:"primary"},null,8,["length","modelValue"])]),_:1}),k.value?(f(),I(ot,{key:0,product:k.value,onCloseModal:a[12]||(a[12]=r=>y.value=!1),"is-active":y.value},null,8,["product","is-active"])):B("",!0),k.value?(f(),I(rt,{key:1,"is-active":x.value,product:k.value,onCloseModal:a[13]||(a[13]=r=>x.value=!1)},null,8,["is-active","product"])):B("",!0),e(dt,{onCloseModal:a[14]||(a[14]=r=>S.value=!1),"is-active":S.value},null,8,["is-active"])])}}});const Ut=ve(St,[["__scopeId","data-v-013a1e31"]]);export{Ut as default};
