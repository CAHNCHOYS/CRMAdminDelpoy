System.register(["./index-legacy-9bb8cf7f.js","./alert-legacy-1f2322f2.js","./useLogoutHandler-legacy-692f2d2e.js","./useFormSchemas-legacy-1f7ae4a9.js"],(function(e,a){"use strict";var l,s,o,t,r,u,d,i,m,n,c,g,h,p,f,v,_,b,y,V,S,N,C,w,k,U,D,x,M,q,A,P,T,F,O,L,W,j,B,E,$,I,z,Q,G,H,J,Z,K,R,X,Y,ee;return{setters:[e=>{l=e.d,s=e.aj,o=e.r,t=e.O,r=e.e,u=e.Z,d=e.o,i=e.b,m=e.s,n=e.p,c=e.a2,g=e.q,h=e.t,p=e.v,f=e.F,v=e.f,_=e.as,b=e.i,y=e.h,V=e.x,S=e.g,N=e.z,C=e.B,w=e.C,k=e.D,U=e.at,D=e.ah,x=e.W,M=e.u,q=e.J,A=e.P,P=e.c,T=e.U,F=e.M,O=e.k,L=e.l,W=e.a3,j=e.L,B=e.N,E=e.n,$=e.m,I=e.a5,z=e.$,Q=e.a6,G=e.G},e=>{H=e.u},e=>{J=e.u,Z=e.a,K=e.b,R=e._},e=>{X=e.u,Y=e.a,ee=e.b}],execute:function(){const a={class:"text-error"},ae=l({__name:"CustomersDeleteDialog",props:{isOpened:{type:Boolean},customer:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchCustomers"],setup(e,{emit:l}){const V=e,S=H(),N=s(),{handleLogout:C}=J("customers-page"),w=o(!1),k=async()=>{try{w.value=!0,await _.deleteCustomer(V.customer.id),N.deleteCustomer(V.customer.id),V.isSearchActive&&l("updateSearchCustomers"),S.showMessage("success","Клиент был успешно удален!")}catch(e){if(b(e)){if(401===e.response?.status)return void(await C());S.showMessage("error",y(e))}else S.showMessage("error","Ошибка при удалении клиента!")}finally{w.value=!1,l("closeDialog")}};return(l,s)=>(d(),t(u,{width:"auto","model-value":e.isOpened,persistent:!0,transition:"dialog-bottom-transition"},{default:r((()=>[i(v,{color:"white",class:"pa-4","max-width":450},{default:r((()=>[i(m,{class:"text-h5 mb-4 pa-0 font-weight-bold"},{default:r((()=>[n("Подтвердите удаление клиента")])),_:1}),i(c,{class:"text-h6 mb-4 pa-0"},{default:r((()=>[n(" Вы уверены что хотиет удалить клиента "),g("span",a,h(e.customer.firstName+" "+e.customer.secondName),1),n(" ? ")])),_:1}),i(p,{class:"justify-center pa-0"},{default:r((()=>[i(f,{onClick:s[0]||(s[0]=e=>l.$emit("closeDialog")),height:"40",color:"blue-darken-4",variant:"flat"},{default:r((()=>[n(" Нет ")])),_:1}),i(f,{height:"40",color:"error",variant:"flat",loading:w.value,onClick:k},{default:r((()=>[n("Да")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),le=g("p",{class:"text-h6"},"Премиум клиент",-1),se=l({__name:"CustomersAddDialog",props:{isOpened:{type:Boolean}},emits:["closeDialog"],setup(e,{emit:a}){const{userCustomerSchema:l}=X(),{resetForm:o,handleSubmit:c,isSubmitting:g}=Y({validationSchema:l}),{value:h,errorMessage:D}=ee("firstName"),{value:x,errorMessage:M}=ee("secondName"),{value:q,errorMessage:A}=ee("thirdName"),{value:P,errorMessage:T}=ee("phone"),{value:F,errorMessage:O}=ee("premium");F.value="Нет";const L=H(),W=s(),{handleLogout:j}=J("customers-page"),B=c((async e=>{try{const{data:a}=await _.addCustomer(e);W.addCustomer({...e,id:a.customerId,fullName:e.secondName+" "+e.firstName+" "+e.thirdName}),L.showMessage("success","Клиент "+e.secondName+" был успешно добавлен!")}catch(l){if(b(l)){if(401===l.response?.status)return void(await j());L.showMessage("error",y(l))}else L.showMessage("error","Ошибка при добавлении клиента")}finally{a("closeDialog"),o()}}));return(l,s)=>(d(),t(u,{"model-value":e.isOpened,"onUpdate:modelValue":s[6]||(s[6]=e=>a("closeDialog")),width:"auto",scrollable:"",transition:"dialog-bottom-transition"},{default:r((()=>[i(v,{color:"white",class:"pa-4",width:"450"},{default:r((()=>[i(m,{class:"font-weight-bold text-h6 mb-3"},{default:r((()=>[n(" Добавление нового клиента ")])),_:1}),i(p,null,{default:r((()=>[i(V,{onSubmit:S(B)},{default:r((()=>[i(N,null,{default:r((()=>[i(C,{cols:"12"},{default:r((()=>[i(w,{modelValue:S(h),"onUpdate:modelValue":s[0]||(s[0]=e=>k(h)?h.value=e:null),"error-messages":S(D),label:"Имя"},null,8,["modelValue","error-messages"])])),_:1}),i(C,{cols:"12"},{default:r((()=>[i(w,{modelValue:S(x),"onUpdate:modelValue":s[1]||(s[1]=e=>k(x)?x.value=e:null),"error-messages":S(M),label:"Фамилия"},null,8,["modelValue","error-messages"])])),_:1}),i(C,{cols:"12"},{default:r((()=>[i(w,{modelValue:S(q),"onUpdate:modelValue":s[2]||(s[2]=e=>k(q)?q.value=e:null),"error-messages":S(A),label:"Отчество"},null,8,["modelValue","error-messages"])])),_:1}),i(C,{cols:"12"},{default:r((()=>[i(w,{label:"Номер телефона",modelValue:S(P),"onUpdate:modelValue":s[3]||(s[3]=e=>k(P)?P.value=e:null),"error-messages":S(T)},null,8,["modelValue","error-messages"])])),_:1}),i(C,{cols:"12"},{default:r((()=>[le,i(U,{modelValue:S(F),"onUpdate:modelValue":s[4]||(s[4]=e=>k(F)?F.value=e:null),"true-value":"Да","false-value":"Нет","hide-details":"",label:S(F),color:"indigo","error-messages":S(O)},null,8,["modelValue","label","error-messages"])])),_:1}),i(C,{cols:"12"},{default:r((()=>[i(f,{color:"green-darken-4",variant:"flat",type:"submit",loading:S(g)},{default:r((()=>[n(" Добавить ")])),_:1},8,["loading"]),i(f,{color:"blue-darken-4",variant:"flat",onClick:s[5]||(s[5]=e=>l.$emit("closeDialog"))},{default:r((()=>[n(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),oe=g("p",{class:"text-h6"},"Премиум клиент ?",-1),te=l({__name:"CustomersEditDialog",props:{isOpened:{type:Boolean},customer:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchCustomers"],setup(e,{emit:a}){const l=e,o=D((()=>({firstName:l.customer.firstName,secondName:l.customer.secondName,thirdName:l.customer.thirdName,phone:l.customer.phone,premium:l.customer.premium}))),{userCustomerSchema:c}=X(),{resetForm:g,handleSubmit:h,isSubmitting:x}=Y({validationSchema:c,initialValues:o}),{value:M,errorMessage:q}=ee("firstName"),{value:A,errorMessage:P}=ee("secondName"),{value:T,errorMessage:F}=ee("thirdName"),{value:O,errorMessage:L}=ee("phone"),{value:W}=ee("premium"),j=H(),B=s(),{handleLogout:E}=J("customers-page"),$=h((async e=>{try{await _.updateCustomer(e,l.customer.id),B.updateCustomer({...e,id:l.customer.id,fullName:e.secondName+" "+e.firstName+" "+e.thirdName}),l.isSearchActive&&a("updateSearchCustomers"),j.showMessage("success","Клиент был успешно изменен")}catch(s){if(b(s)){if(401===s.response?.status)return void(await E());j.showMessage("error",y(s))}else j.showMessage("error","Ошибка при изменении клиента")}finally{g(),a("closeDialog")}}));return(a,l)=>(d(),t(u,{"model-value":e.isOpened,"onUpdate:modelValue":l[6]||(l[6]=e=>a.$emit("closeDialog")),scrollable:"",width:"auto"},{default:r((()=>[i(v,{width:"450",color:"white",class:"pa-4"},{default:r((()=>[i(m,{class:"text-h6 font-weight-bold"},{default:r((()=>[n(" Редактирование клиента ")])),_:1}),i(p,null,{default:r((()=>[i(V,{onSubmit:S($)},{default:r((()=>[i(N,null,{default:r((()=>[i(C,{cols:"12"},{default:r((()=>[i(w,{modelValue:S(M),"onUpdate:modelValue":l[0]||(l[0]=e=>k(M)?M.value=e:null),"error-messages":S(q),label:"Имя"},null,8,["modelValue","error-messages"])])),_:1}),i(C,{cols:"12"},{default:r((()=>[i(w,{modelValue:S(A),"onUpdate:modelValue":l[1]||(l[1]=e=>k(A)?A.value=e:null),"error-messages":S(P),label:"Фамилия"},null,8,["modelValue","error-messages"])])),_:1}),i(C,{cols:"12"},{default:r((()=>[i(w,{modelValue:S(T),"onUpdate:modelValue":l[2]||(l[2]=e=>k(T)?T.value=e:null),"error-messages":S(F),label:"Отчество"},null,8,["modelValue","error-messages"])])),_:1}),i(C,{cols:"12"},{default:r((()=>[i(w,{label:"Номер телефона",modelValue:S(O),"onUpdate:modelValue":l[3]||(l[3]=e=>k(O)?O.value=e:null),"error-messages":S(L)},null,8,["modelValue","error-messages"])])),_:1}),i(C,{cols:"12"},{default:r((()=>[oe,i(U,{modelValue:S(W),"onUpdate:modelValue":l[4]||(l[4]=e=>k(W)?W.value=e:null),"true-value":"Да","false-value":"Нет","hide-details":"",label:S(W),color:"indigo"},null,8,["modelValue","label"])])),_:1}),i(C,{cols:"12"},{default:r((()=>[i(f,{color:"green-darken-4",variant:"flat",type:"submit",loading:S(x)},{default:r((()=>[n(" Обновить ")])),_:1},8,["loading"]),i(f,{color:"blue-darken-4",variant:"flat",onClick:l[5]||(l[5]=e=>a.$emit("closeDialog"))},{default:r((()=>[n(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),re={class:"text-h6"},ue=g("h2",{class:"title text-h2 mb-5"},"Клиенты",-1),de=g("span",{class:"text-wrap"}," Сбросить поиск",-1),ie=g("span",{class:"text-wrap"}," Закрыть поиск",-1);e("default",l({__name:"CustomersView",setup(e){const a=s(),l=H(),u=M(),m=o([{fieldText:"Имя",fieldName:"firstName"},{fieldText:"Фамилия",fieldName:"secondName"},{fieldText:"Отчество",fieldName:"thirdName"},{fieldText:"Телефон",fieldName:"phone"},{fieldText:"Есть премиум",fieldName:"premium"}]),c=o("firstName"),{customers:p,customersErrorMessage:V}=q(a),{isAddDialogActive:D,isEditDialogActive:J,isDeleteDialogActive:X,itemToEdit:Y,openDialog:ee}=Z(),le=O(),oe=L(),{isSearchFormActive:me,isSearchLoading:ne,searchWithPremium:ce,premium:ge,isSearchActive:he,secondName:pe,searchedCustomers:fe,addSearchQuery:ve,resetSearch:_e,searchUserCustomers:be}=((e,a,l)=>{const s=H(),t=o(e.query.secondName||""),r=o(+e.query.premium||0),u=o(!1),d=o([]),i=o(!1),m=o(!1),n=o(!1),c=async()=>{try{m.value=!0;const{data:a}=await _.getSearchedCustomers({userId:l,premium:+e.query.premium,secondName:e.query.secondName,searchWithPremium:e.query.searchWithPremium});d.value=a.customers,i.value=!0}catch(a){b(a)?s.showMessage("error",y(a)):s.showMessage("error","Ошибка при поиске товаров!")}finally{m.value=!1}};return x([()=>e.query.secondName,()=>e.query.premium,()=>e.query.searchWithPremium],(async()=>{(void 0!==e.query.secondName||e.query.premium)&&c()}),{immediate:!0}),{premium:r,searchWithPremium:u,isSearchFormActive:n,isSearchActive:i,isSearchLoading:m,secondName:t,searchedCustomers:d,searchUserCustomers:c,addSearchQuery:()=>{a.push({name:"customers-page",query:{...e.query,secondName:t.value,searchWithPremium:String(u.value),premium:r.value}})},resetSearch:()=>{t.value="",u.value=!1,r.value=0,i.value=!1,d.value=[],a.push({name:"customers-page",query:{}})}}})(le,oe,u.currentUser.id),ye=A((()=>he.value?fe.value:p.value)),{currentPage:Ve,paginatedElements:Se,isInverseSort:Ne,elementsPerPageCount:Ce,totalPages:we,setSortField:ke}=K({tableElements:ye,pageName:"customers-page",sortField:c,route:le,router:oe});return(e,a)=>{const s=G("TableActions");return d(),P("div",null,[i(T,{modelValue:S(l).isMessageShown,"onUpdate:modelValue":a[0]||(a[0]=e=>S(l).isMessageShown=e),color:S(l).messageType,"location-strategy":"connected"},{default:r((()=>[g("p",re,h(S(l).messageText),1)])),_:1},8,["modelValue","color"]),ue,i(v,{color:"white",elevation:"3",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:r((()=>[i(s,{count:S(Ce),"onUpdate:count":a[1]||(a[1]=e=>k(Ce)?Ce.value=e:null),onToggleAddDialog:a[2]||(a[2]=e=>D.value=!0),onToggleSearch:a[3]||(a[3]=e=>me.value=!S(me)),"is-badge-active":void 0!==e.$route.query.secondName},{default:r((()=>[n(" Все клиенты ")])),_:1},8,["count","is-badge-active"]),i(W,null,{default:r((()=>[S(me)?(d(),t(N,{key:0,class:"mb-5",align:"center"},{default:r((()=>[i(C,{sm:"8",cols:"12"},{default:r((()=>[i(w,{label:"Имя клиента",modelValue:S(pe),"onUpdate:modelValue":a[4]||(a[4]=e=>k(pe)?pe.value=e:null),"onClick:clear":a[5]||(a[5]=e=>pe.value="")},null,8,["modelValue"])])),_:1}),i(C,{sm:"auto",cols:"6"},{default:r((()=>[i(j,{modelValue:S(ce),"onUpdate:modelValue":a[6]||(a[6]=e=>k(ce)?ce.value=e:null),color:"indigo-darken-4",label:"Искать с премиумом"},null,8,["modelValue"])])),_:1}),i(B,{"leave-absolute":!0},{default:r((()=>[S(ce)?(d(),t(C,{key:0,sm:"auto",cols:"6"},{default:r((()=>[i(U,{modelValue:S(ge),"onUpdate:modelValue":a[7]||(a[7]=e=>k(ge)?ge.value=e:null),"true-value":1,"false-value":0,color:"indigo-darken-4",label:"Есть премиум?"},null,8,["modelValue"])])),_:1})):F("",!0)])),_:1}),i(C,{cols:"12"},{default:r((()=>[i(N,null,{default:r((()=>[i(C,{sm:"auto",cols:"6"},{default:r((()=>[i(f,{variant:"flat",disabled:S(ne),color:"green-darken-3",onClick:S(ve),block:""},{default:r((()=>[n(" Искать ")])),_:1},8,["disabled","onClick"])])),_:1}),i(C,{sm:"auto",cols:"6"},{default:r((()=>[i(f,{variant:"flat",disabled:S(ne),color:"error",onClick:S(_e),block:""},{default:r((()=>[de])),_:1},8,["disabled","onClick"])])),_:1}),i(C,{sm:"auto",cols:"12"},{default:r((()=>[i(f,{variant:"flat",disabled:S(ne),color:"blue-darken-4",onClick:a[8]||(a[8]=e=>me.value=!1),block:""},{default:r((()=>[ie])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1})):F("",!0)])),_:1}),S(V)?(d(),t($,{key:0,type:"error",border:"end",variant:"tonal"},{default:r((()=>[i(E,{class:"mb-2"},{default:r((()=>[n(" Ошибка при загрузке клиентов")])),_:1}),g("p",null,h(S(V)),1)])),_:1})):S(ne)?F("",!0):(d(),t(R,{key:1,items:S(Se),fields:m.value,"current-sort-field":c.value,onUpdateSortField:a[9]||(a[9]=e=>S(ke)(e)),"is-inverse-sort":S(Ne),onOpenDialog:a[10]||(a[10]=(e,a)=>S(ee)(e,a)),"no-data-text":"Клиенты не найдены"},null,8,["items","fields","current-sort-field","is-inverse-sort"])),S(ne)?(d(),t(z,{key:2,class:"text-center mb-2"},{default:r((()=>[i(I,{indeterminate:"",size:"32",color:"green"})])),_:1})):F("",!0),S(ye).length?(d(),t(Q,{key:3,length:S(we),modelValue:S(Ve),"onUpdate:modelValue":a[11]||(a[11]=e=>k(Ve)?Ve.value=e:null),rounded:"circle","total-visible":7,color:"deep-purple-darken-4"},null,8,["length","modelValue"])):F("",!0)])),_:1}),S(Y)?(d(),t(ae,{key:0,"is-opened":S(X),onCloseDialog:a[12]||(a[12]=e=>X.value=!1),"is-search-active":S(he),onUpdateSearchCustomers:S(be),customer:S(Y)},null,8,["is-opened","is-search-active","onUpdateSearchCustomers","customer"])):F("",!0),S(Y)?(d(),t(te,{key:1,"is-opened":S(J),onCloseDialog:a[13]||(a[13]=e=>J.value=!1),"is-search-active":S(he),onUpdateSearchCustomers:S(be),customer:S(Y)},null,8,["is-opened","is-search-active","onUpdateSearchCustomers","customer"])):F("",!0),i(se,{"is-opened":S(D),onCloseDialog:a[14]||(a[14]=e=>D.value=!1)},null,8,["is-opened"])])}}}))}}}));
