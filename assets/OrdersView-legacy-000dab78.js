System.register(["./index-legacy-ed03e264.js","./ElementsTable.vue_vue_type_script_setup_true_lang-legacy-2e079f7f.js","./useLogoutHandler-legacy-2bf866cd.js","./useFormSchemas-legacy-11707a64.js"],(function(e,a){"use strict";var l,t,r,o,s,d,u,n,i,c,m,p,g,f,v,h,_,y,b,V,D,k,S,w,O,x,M,U,N,C,q,A,E,F,T,I,$,j,P,B,L,Q,z,H,G,K,W,X,Z,J,R,Y,ee,ae;return{setters:[e=>{l=e.a,t=e.r,r=e.X,o=e.av,s=e.i,d=e.h,u=e.d,n=e.Z,i=e.ak,c=e.al,m=e.K,p=e.P,g=e.f,f=e.$,v=e.o,h=e.e,_=e.v,y=e.q,b=e.x,V=e.y,D=e.z,k=e.j,S=e.B,w=e.C,O=e.a2,x=e.E,M=e.a0,U=e.n,N=e.p,C=e.t,q=e.D,A=e.G,E=e.g,F=e.s,T=e.a3,I=e.ai,$=e.u,j=e.Q,P=e.c,B=e.W,L=e.N,Q=e.l,z=e.m,H=e.a4,G=e.a6,K=e.a7,W=e.H},e=>{X=e.u,Z=e.a,J=e._},e=>{R=e.u},e=>{Y=e.u,ee=e.a,ae=e.b}],execute:function(){const a=F("span",{class:"px-5 text-wrap"},"Очистить ",-1),le=u({__name:"OrdersAddDialog",props:{isOpened:{type:Boolean}},emits:["closeDialog"],setup(e,{emit:t}){const r=n(),u=i(),F=c(),T=l(),{userProducts:I,productsErrorMessage:$}=m(r),{customers:j,customersErrorMessage:P}=m(u),{userOrderSchema:B}=Y(),{handleSubmit:L,isSubmitting:Q,resetForm:z}=ee({validationSchema:B}),{value:H,errorMessage:G}=ae("customerId"),{value:K,errorMessage:W}=ae("productId"),{value:X,errorMessage:Z}=ae("productCount"),{value:J,errorMessage:le}=ae("date"),{handleLogout:te}=R("orders-page"),re=L((async e=>{try{const{data:a}=await o.addOrder(e);e.date=e.date.split("-").reverse().join("-"),F.addOrder({...e,...a}),T.showMessage("success","Заказ был успешно добавлен!"),z()}catch(a){if(s(a)){if(401===a.response?.status)return void(await te());T.showMessage("error",d(a))}else T.showMessage("error","Ошибка при добавлении заказа")}finally{t("closeDialog")}}));return(l,t)=>(v(),p(f,{"model-value":e.isOpened,"onUpdate:modelValue":t[6]||(t[6]=e=>l.$emit("closeDialog")),width:"auto",scrollable:"",transition:"dialog-bottom-transition"},{default:g((()=>[h(E,{width:"450",color:"white",class:"pa-4"},{default:g((()=>[h(_,{class:"font-weight-bold text-h6 mb-3"},{default:g((()=>[y(" Добавление заказа ")])),_:1}),h(b,null,{default:g((()=>[h(V,{onSubmit:D(k(re),["prevent"])},{default:g((()=>[h(S,null,{default:g((()=>[h(w,{cols:"12"},{default:g((()=>[k(P)?(v(),p(M,{key:1},{default:g((()=>[h(U,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:g((()=>[h(N,{class:"text-h6"},{default:g((()=>[y(C(k(P)),1)])),_:1})])),_:1})])),_:1})):(v(),p(O,{key:0,modelValue:k(H),"onUpdate:modelValue":t[0]||(t[0]=e=>x(H)?H.value=e:null),"error-messages":k(G),label:"Клиент",items:k(j),"item-title":"fullName","item-value":"id","no-data-text":"Клиенты не найдены"},null,8,["modelValue","error-messages","items"]))])),_:1}),h(w,{cols:"12"},{default:g((()=>[k($)?(v(),p(M,{key:1},{default:g((()=>[h(U,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:g((()=>[h(N,{class:"text-h6"},{default:g((()=>[y(C(k($)),1)])),_:1})])),_:1})])),_:1})):(v(),p(O,{key:0,modelValue:k(K),"onUpdate:modelValue":t[1]||(t[1]=e=>x(K)?K.value=e:null),"error-messages":k(W),label:"Товар",items:k(I),"item-title":"name","item-value":"id","no-data-text":"Товары не найдены"},null,8,["modelValue","error-messages","items"]))])),_:1}),h(w,{cols:"12"},{default:g((()=>[h(q,{type:"number",modelValue:k(X),"onUpdate:modelValue":t[2]||(t[2]=e=>x(X)?X.value=e:null),modelModifiers:{number:!0},label:"Количество товара","error-messages":k(Z)},null,8,["modelValue","error-messages"])])),_:1}),h(w,{cols:"12"},{default:g((()=>[h(q,{modelValue:k(J),"onUpdate:modelValue":t[3]||(t[3]=e=>x(J)?J.value=e:null),"error-messages":k(le),type:"date"},null,8,["modelValue","error-messages"])])),_:1}),h(w,{cols:"12"},{default:g((()=>[h(S,null,{default:g((()=>[h(w,{sm:"auto",cols:"12"},{default:g((()=>[h(A,{color:"green-darken-4",variant:"flat",type:"submit",block:"",loading:k(Q)},{default:g((()=>[y(" Добавить ")])),_:1},8,["loading"])])),_:1}),h(w,{sm:"5",cols:"6"},{default:g((()=>[h(A,{color:"error",variant:"flat",onClick:t[4]||(t[4]=e=>k(z)()),block:""},{default:g((()=>[a])),_:1})])),_:1}),h(w,{sm:"auto",cols:"6"},{default:g((()=>[h(A,{color:"blue-darken-4",block:"",variant:"flat",onClick:t[5]||(t[5]=e=>l.$emit("closeDialog"))},{default:g((()=>[y(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),te={class:"text-h6"},re={class:"text-error"},oe=u({__name:"OrdersDeleteDialog",props:{isOpened:{type:Boolean},order:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchOrders"],setup(e,{emit:a}){const r=e,u=t(!1),n=l(),i=c(),{handleLogout:m}=R("orders-page"),V=async()=>{try{u.value=!0,await o.deleteOrder(r.order.id),i.deleteOrder(r.order.id),r.isSearchActive&&a("updateSearchOrders"),n.showMessage("success","Заказ был успешно удален!")}catch(e){s(e)?(401===e.response?.status&&await m(),n.showMessage("error",d(e))):n.showMessage("error","Ошибка при удалении заказа")}finally{u.value=!1,a("closeDialog")}};return(a,l)=>(v(),p(f,{scrollable:"",width:"auto","model-value":e.isOpened,"onUpdate:modelValue":l[1]||(l[1]=e=>a.$emit("closeDialog")),persistent:""},{default:g((()=>[h(E,{width:"450",elevation:"3",class:"pa-4"},{default:g((()=>[h(_,{class:"font-weight-bold text-h6 mb-4 pa-0"},{default:g((()=>[y("Удаление заказа")])),_:1}),h(T,{class:"mb-4 pa-0"},{default:g((()=>[F("p",te,[y(" Вы уверены что хотите удалить заказ за "+C(e.order.date)+" клиента ",1),F("span",re,C(e.order.customerFullName),1),y(" ? ")])])),_:1}),h(b,{class:"pa-0"},{default:g((()=>[h(A,{onClick:l[0]||(l[0]=e=>a.$emit("closeDialog")),height:"40",color:"blue-darken-4",variant:"flat"},{default:g((()=>[y(" Нет ")])),_:1}),h(A,{height:"40",color:"error",variant:"flat",loading:u.value,onClick:V},{default:g((()=>[y("Да")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),se=u({__name:"OrdersEditDialog",props:{isOpened:{type:Boolean},order:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchOrders"],setup(e,{emit:a}){const t=e,r=I((()=>{const e=t.order.date.split("-");return e[2]+"-"+e[1]+"-"+e[0]})),u=I((()=>({productCount:t.order.productCount,productId:t.order.productId,customerId:t.order.customerId,date:r.value}))),{userOrderSchema:F}=Y(),{isSubmitting:T,resetForm:$,handleSubmit:j}=ee({validationSchema:F,initialValues:u}),{value:P,errorMessage:B}=ae("customerId"),{value:L,errorMessage:Q}=ae("productId"),{value:z,errorMessage:H}=ae("productCount"),{value:G,errorMessage:K}=ae("date"),W=i(),X=n(),Z=c(),J=l(),{customers:le,customersErrorMessage:te}=m(W),{userProducts:re,productsErrorMessage:oe}=m(X),{handleLogout:se}=R("orders-page"),de=j((async e=>{try{const{data:l}=await o.updateOrder(e,t.order.id);e.date=e.date.split("-").reverse().join("-"),Z.updateOrder({...e,...l}),t.isSearchActive&&a("updateSearchOrders"),J.showMessage("success","Заказ был успешно обновлен")}catch(l){if(s(l)){if(401===l.response?.status)return void(await se());J.showMessage("error",d(l))}else J.showMessage("error","Ошибка при добавлении заказа")}finally{a("closeDialog"),$()}}));return(a,l)=>(v(),p(f,{"model-value":e.isOpened,"onUpdate:modelValue":l[5]||(l[5]=e=>a.$emit("closeDialog")),width:"auto",scrollable:"",transition:"dialog-bottom-transition"},{default:g((()=>[h(E,{width:"450",color:"white",class:"pa-4"},{default:g((()=>[h(_,{class:"font-weight-bold text-h6 mb-3"},{default:g((()=>[y(" Редактирование заказа ")])),_:1}),h(b,null,{default:g((()=>[h(V,{onSubmit:D(k(de),["prevent"])},{default:g((()=>[h(S,null,{default:g((()=>[h(w,{cols:"12"},{default:g((()=>[k(te)?(v(),p(M,{key:1},{default:g((()=>[h(U,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:g((()=>[h(N,{class:"text-h6"},{default:g((()=>[y(C(k(te)),1)])),_:1})])),_:1})])),_:1})):(v(),p(O,{key:0,modelValue:k(P),"onUpdate:modelValue":l[0]||(l[0]=e=>x(P)?P.value=e:null),"error-messages":k(B),label:"Клиент",items:k(le),"item-title":"fullName","item-value":"id","no-data-text":"Клиенты не найдены"},null,8,["modelValue","error-messages","items"]))])),_:1}),h(w,{cols:"12"},{default:g((()=>[k(oe)?(v(),p(M,{key:1},{default:g((()=>[h(U,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:g((()=>[h(N,{class:"text-h6"},{default:g((()=>[y(C(k(oe)),1)])),_:1})])),_:1})])),_:1})):(v(),p(O,{key:0,modelValue:k(L),"onUpdate:modelValue":l[1]||(l[1]=e=>x(L)?L.value=e:null),"error-messages":k(Q),label:"Товар",items:k(re),"item-title":"name","item-value":"id","no-data-text":"Товары не найдены"},null,8,["modelValue","error-messages","items"]))])),_:1}),h(w,{cols:"12"},{default:g((()=>[h(q,{modelValue:k(z),"onUpdate:modelValue":l[2]||(l[2]=e=>x(z)?z.value=e:null),modelModifiers:{number:!0},label:"Количество товара","error-messages":k(H),type:"number"},null,8,["modelValue","error-messages"])])),_:1}),h(w,{cols:"12"},{default:g((()=>[h(q,{modelValue:k(G),"onUpdate:modelValue":l[3]||(l[3]=e=>x(G)?G.value=e:null),"error-messages":k(K),type:"date"},null,8,["modelValue","error-messages"])])),_:1}),h(w,{cols:"12"},{default:g((()=>[h(S,null,{default:g((()=>[h(w,{sm:"auto",cols:"12"},{default:g((()=>[h(A,{color:"green-darken-4",variant:"flat",type:"submit",block:"",loading:k(T)},{default:g((()=>[y(" Сохранить ")])),_:1},8,["loading"])])),_:1}),h(w,{sm:"auto",cols:"12"},{default:g((()=>[h(A,{color:"blue-darken-4",block:"",variant:"flat",onClick:l[4]||(l[4]=e=>a.$emit("closeDialog"))},{default:g((()=>[y(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),de={class:"text-h6"},ue=F("h2",{class:"title text-h2 mb-5"},"Заказы",-1),ne=F("span",{class:"text-wrap"}," Сбросить поиск",-1);e("default",u({__name:"OrdersView",setup(e){const a=t([{fieldText:"Клиент",fieldName:"customerFullName"},{fieldText:"Товар",fieldName:"productName"},{fieldText:"Количество товара",fieldName:"productCount"},{fieldText:"Дата",fieldName:"date"}]),u=t("customerFullName"),n=$(),i=c(),m=l(),{itemToEdit:f,isAddDialogActive:b,isEditDialogActive:V,isDeleteDialogActive:D,openDialog:O}=X(),N=Q(),T=z(),{isSearchFormActive:I,isSearchLoading:R,isSearchActive:Y,startDate:ee,endDate:ae,searchedOrders:te,customerName:re,productName:ie,addSearchQuery:ce,resetSearch:me,searchOrders:pe}=((e,a,u)=>{const n=l(),i=t(!1),c=t(!1),m=t(!1),p=t([]),g=t("2023-01-01"),f=t("2024-01-01"),v=t(""),h=t(""),_=async()=>{try{if(!e.query.startDate&&!e.query.endDate)return;m.value=!0;const{data:a}=await o.getSerachedOrders({userId:u,product:e.query.productName,customer:e.query.customerName,startDate:e.query.startDate,endDate:e.query.endDate});p.value=a.orders,c.value=!0}catch(a){s(a)?n.showMessage("error",d(a)):n.showMessage("error","Ошибка при поиске заказов")}finally{m.value=!1}};return r([()=>e.query.startDate,()=>e.query.endDate,()=>e.query.customerName,()=>e.query.productName],(async()=>{(e.query.startDate||e.query.endDate)&&_()}),{immediate:!0}),{isSearchLoading:m,isSearchFormActive:i,isSearchActive:c,startDate:g,endDate:f,customerName:v,productName:h,searchedOrders:p,resetSearch:()=>{g.value="2023-01-01",f.value="2024-01-01",v.value="",h.value="",c.value=!1,p.value=[],a.push({name:"orders-page",query:{}})},addSearchQuery:()=>{a.push({name:"orders-page",query:{startDate:g.value,endDate:f.value,customerName:v.value,productName:h.value}})},searchOrders:_}})(N,T,n.currentUser.id),ge=j((()=>Y.value?te.value:i.orders)),{currentPage:fe,paginatedElements:ve,isInverseSort:he,elementsPerPageCount:_e,totalPages:ye,setSortField:be}=Z({tableElements:ge,pageName:"orders-page",sortField:u,route:N,router:T});return(e,l)=>{const t=W("TableActions");return v(),P("div",null,[h(B,{modelValue:k(m).isMessageShown,"onUpdate:modelValue":l[0]||(l[0]=e=>k(m).isMessageShown=e),color:k(m).messageType,"location-strategy":"connected"},{default:g((()=>[F("p",de,C(k(m).messageText),1)])),_:1},8,["modelValue","color"]),ue,h(E,{elevation:"3",color:"white",class:"pa-5 rounded-lg mx-sm-0 mx-n5"},{default:g((()=>[k(i).ordersErrorMessage?L("",!0):(v(),p(_,{key:0,class:"pa-0"},{default:g((()=>[h(t,{count:k(_e),"onUpdate:count":l[1]||(l[1]=e=>x(_e)?_e.value=e:null),onToggleAddDialog:l[2]||(l[2]=e=>b.value=!0),onToggleSearch:l[3]||(l[3]=e=>I.value=!k(I)),"is-badge-active":!(!e.$route.query.startDate&&!e.$route.query.endDate)},{default:g((()=>[y(" Все заказы ")])),_:1},8,["count","is-badge-active"]),h(H,null,{default:g((()=>[k(I)?(v(),p(S,{key:0,class:"mb-5"},{default:g((()=>[h(w,{sm:"6",cols:"12"},{default:g((()=>[h(S,null,{default:g((()=>[h(w,{cols:"6"},{default:g((()=>[h(q,{modelValue:k(ee),"onUpdate:modelValue":l[4]||(l[4]=e=>x(ee)?ee.value=e:null),type:"date",label:"Начальная дата",clearable:!1},null,8,["modelValue"])])),_:1}),h(w,{cols:"6"},{default:g((()=>[h(q,{modelValue:k(ae),"onUpdate:modelValue":l[5]||(l[5]=e=>x(ae)?ae.value=e:null),type:"date",label:"Конечная дата",clearable:!1},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),h(w,{cols:"6"},{default:g((()=>[h(q,{modelValue:k(re),"onUpdate:modelValue":l[6]||(l[6]=e=>x(re)?re.value=e:null),label:"Клиент"},null,8,["modelValue"])])),_:1}),h(w,{cols:"6"},{default:g((()=>[h(q,{modelValue:k(ie),"onUpdate:modelValue":l[7]||(l[7]=e=>x(ie)?ie.value=e:null),label:"Товар"},null,8,["modelValue"])])),_:1}),h(w,{md:"6",cols:"12"},{default:g((()=>[h(S,null,{default:g((()=>[h(w,{sm:"auto",cols:"6"},{default:g((()=>[h(A,{onClick:k(ce),variant:"flat",color:"green-darken-3",block:""},{default:g((()=>[y(" Искать ")])),_:1},8,["onClick"])])),_:1}),h(w,{sm:"auto",cols:"6"},{default:g((()=>[h(A,{onClick:k(me),variant:"flat",color:"red-darken-4",block:""},{default:g((()=>[ne])),_:1},8,["onClick"])])),_:1}),h(w,{sm:"auto",cols:"12"},{default:g((()=>[h(A,{variant:"flat",color:"blue-darken-4",onClick:l[8]||(l[8]=e=>I.value=!1),block:""},{default:g((()=>[y(" Закрыть ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):L("",!0)])),_:1})])),_:1})),k(i).ordersErrorMessage?(v(),p(M,{key:1},{default:g((()=>[h(U,{variant:"outlined",border:"end",type:"error"},{default:g((()=>[F("p",null,C(k(i).ordersErrorMessage),1)])),_:1})])),_:1})):k(R)?L("",!0):(v(),p(J,{key:2,items:k(ve),fields:a.value,"current-sort-field":u.value,onUpdateSortField:l[9]||(l[9]=e=>k(be)(e)),"is-inverse-sort":k(he),onOpenDialog:l[10]||(l[10]=(e,a)=>k(O)(e,a)),"no-data-text":"Заказы не найдены"},null,8,["items","fields","current-sort-field","is-inverse-sort"])),k(R)?(v(),p(M,{key:3,class:"text-center mb-2"},{default:g((()=>[h(G,{indeterminate:"",size:"32",color:"green"})])),_:1})):L("",!0),k(ge).length?(v(),p(K,{key:4,length:k(ye),modelValue:k(fe),"onUpdate:modelValue":l[11]||(l[11]=e=>x(fe)?fe.value=e:null),rounded:"circle","total-visible":7,color:"deep-purple-darken-4"},null,8,["length","modelValue"])):L("",!0)])),_:1}),k(f)?(v(),p(se,{key:0,"is-search-active":k(Y),"is-opened":k(V),onCloseDialog:l[12]||(l[12]=e=>V.value=!1),onUpdateSearchOrders:k(pe),order:k(f)},null,8,["is-search-active","is-opened","onUpdateSearchOrders","order"])):L("",!0),k(f)?(v(),p(oe,{key:1,"is-search-active":k(Y),onUpdateSearchOrders:k(pe),onCloseDialog:l[13]||(l[13]=e=>D.value=!1),"is-opened":k(D),order:k(f)},null,8,["is-search-active","onUpdateSearchOrders","is-opened","order"])):L("",!0),h(le,{"is-opened":k(b),onCloseDialog:l[14]||(l[14]=e=>b.value=!1)},null,8,["is-opened"])])}}}))}}}));
