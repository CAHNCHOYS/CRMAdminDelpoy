import{d as I,u as $,P as G,A as P,i as L,h as N,r as C,o as k,c as E,b as e,e as a,z as H,B as w,q as l,Q as J,g as s,R as X,D as S,C as A,K as Y,F as j,x as q,v as O,l as z,m as Z,n as ee,p as se,L as ae,H as oe,I as te,_ as re,S as le,T as ne,U as ue,f as B,M as de,t as ie}from"./index-1cb64e4a.js";import{u as K,a as Q,b as x}from"./useFormSchemas-bbdef749.js";import{u as ce}from"./alert-18323748.js";const me=l("div",{class:"text-h5 mb-4"},"Общая информация об аккаунте",-1),pe={class:"d-flex flex-sm-row flex-column align-sm-center"},ge=l("span",{class:"text-h6"},"Обновить данные ",-1),fe=I({__name:"AccountInfo",emits:["showMessage"],setup(V,{emit:d}){const r=$(),p=G(()=>{var m,t,o;return{name:((m=r.currentUser)==null?void 0:m.name)||"user logged out",email:((t=r.currentUser)==null?void 0:t.email)||"user logged out",country:((o=r.currentUser)==null?void 0:o.country)||"user logged out",avatar:[]}}),{updateInfoShchema:c}=K(),{handleSubmit:i,isSubmitting:g}=Q({validationSchema:c,initialValues:p}),{value:f,errorMessage:h}=x("name"),{value:_,errorMessage:M}=x("email"),{value:U,errorMessage:b}=x("country"),{value:v,errorMessage:D}=x("avatar"),R=z(),T=i(async m=>{var t;try{let o=new FormData;o.append("name",m.name),o.append("email",m.email),o.append("country",m.country),o.append("avatar",m.avatar[0],v.value[0].name),await P.updateInfo(o);const{data:W}=await P.getUser();r.setUser(W.user),d("showMessage","success","Данные были обновлены!")}catch(o){L(o)?(((t=o.response)==null?void 0:t.status)===401&&R.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"account-page"}}),d("showMessage","error",N(o))):d("showMessage","error","Ошибка при изменении данных!")}}),y=C("");function n(m){const t=m.target.files[0];y.value=URL.createObjectURL(t),console.log(URL.createObjectURL(t))}function u(){y.value=""}return(m,t)=>(k(),E("div",null,[me,e(O,{onSubmit:q(s(T),["prevent"]),enctype:"multipart/form-data"},{default:a(()=>[e(H,{align:"center"},{default:a(()=>[e(w,{md:"6",cols:"12"},{default:a(()=>[l("div",pe,[e(J,{size:"80",class:"mr-sm-3 mb-sm-0 mb-4 border mx-auto",image:y.value||`https://crm-backend-mocha.vercel.app/UserAvatars/${s(r).currentUser.avatar}`},null,8,["image"]),e(X,{modelValue:s(v),"onUpdate:modelValue":t[0]||(t[0]=o=>S(v)?v.value=o:null),"error-messages":s(D),"show-size":"","prepend-icon":"mdi-camera","hide-details":"auto",label:"Загрузите ваш аватар",accept:".jpg, .png, .jpeg, .svg , .webp",onChange:n,"onClick:clear":u},null,8,["modelValue","error-messages"])])]),_:1}),e(w,{sm:"6",cols:"12"},{default:a(()=>[e(A,{modelValue:s(f),"onUpdate:modelValue":t[1]||(t[1]=o=>S(f)?f.value=o:null),"error-messages":s(h),label:"Ваше имя"},null,8,["modelValue","error-messages"])]),_:1}),e(w,{sm:"6",cols:"12"},{default:a(()=>[e(A,{modelValue:s(_),"onUpdate:modelValue":t[2]||(t[2]=o=>S(_)?_.value=o:null),"error-messages":s(M),label:"Ваша почта"},null,8,["modelValue","error-messages"])]),_:1}),e(w,{sm:"6",cols:"12"},{default:a(()=>[e(Y,{modelValue:s(U),"onUpdate:modelValue":t[3]||(t[3]=o=>S(U)?U.value=o:null),"error-messages":s(b),items:["Россия","Беларусь","Латвия","Украина","Казахстан","Узбекистан"],label:"Страна проживания"},null,8,["modelValue","error-messages"])]),_:1}),e(w,{cols:"12"},{default:a(()=>[e(j,{type:"submit",variant:"flat",loading:s(g),color:"green"},{default:a(()=>[ge]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]))}}),_e=l("div",{class:"text-h5 mb-3"},"Безопасность",-1),ve=l("span",{class:"text-white text-h6"},"Обновить пароль",-1),we=I({__name:"AccountSecurity",emits:["showMessage"],setup(V,{emit:d}){const{updatePasswordSchema:r}=K(),{handleSubmit:p,isSubmitting:c,resetForm:i}=Q({validationSchema:r}),{value:g,errorMessage:f}=x("oldPassword"),{value:h,errorMessage:_}=x("newPassword"),{value:M,errorMessage:U}=x("newPasswordConfirm"),b=C(!1),v=C(!1),D=$(),R=z(),T=p(async y=>{var n;try{await P.updatePassword(y);const{data:u}=await P.getUser();D.setUser(u.user),d("showMessage","success","Пароль был успешно имзенен"),i()}catch(u){if(L(u)){if(((n=u.response)==null?void 0:n.status)===401){R.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"account-page"}});return}d("showMessage","error",N(u))}else d("showMessage","error","Ошибка при изменении пароля!")}});return(y,n)=>(k(),E("div",null,[_e,e(O,{onSubmit:q(s(T),["prevent"])},{default:a(()=>[e(H,null,{default:a(()=>[e(w,{cols:"12"},{default:a(()=>[e(A,{modelValue:s(g),"onUpdate:modelValue":n[0]||(n[0]=u=>S(g)?g.value=u:null),"error-messages":s(f),label:"Старый пароль",type:v.value?"text":"password","append-inner-icon":v.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":n[1]||(n[1]=u=>v.value=!v.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1}),e(w,{sm:"6",cols:"12"},{default:a(()=>[e(A,{label:"Новый пароль",modelValue:s(h),"onUpdate:modelValue":n[2]||(n[2]=u=>S(h)?h.value=u:null),"error-messages":s(_),type:b.value?"text":"password","append-inner-icon":b.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":n[3]||(n[3]=u=>b.value=!b.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1}),e(w,{sm:"6",cols:"12"},{default:a(()=>[e(A,{modelValue:s(M),"onUpdate:modelValue":n[4]||(n[4]=u=>S(M)?M.value=u:null),"error-messages":s(U),label:"Повторите новый пароль",type:b.value?"text":"password"},null,8,["modelValue","error-messages","type"])]),_:1}),e(w,{cols:"12"},{default:a(()=>[e(j,{type:"submit",loading:s(c),variant:"flat",color:"green"},{default:a(()=>[ve]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]))}}),F=V=>(oe("data-v-80575f6d"),V=V(),te(),V),he=F(()=>l("div",{class:"text-h5 mb-4"},"Удаление аккаунта",-1)),Ve=F(()=>l("p",{class:"text-h6"},"Отменить это действие будет невозможно",-1)),be={class:"mb-2"},Se=F(()=>l("span",{class:"font-weight-bold"},"Я хочу удалить аккаунт ",-1)),xe=F(()=>l("span",{class:"text-h6"},"Удалить аккаунт",-1)),ye=I({__name:"AccountDeletion",emits:["showMessage"],setup(V,{emit:d}){const r=$(),p=z(),c=C(!1),i=C(!1),g=async()=>{if(c.value&&window.confirm("Вы точно уверены?"))try{await P.deleteAccount(r.currentUser.id),r.logOutUser(),p.push({name:"login-page"})}catch(f){i.value=!0,L(f)?d("showMessage","error",N(f)):d("showMessage","error","Ошибка при удалении профиля!"),setTimeout(()=>i.value=!1,3500)}};return(f,h)=>(k(),E("div",null,[he,e(O,{onSubmit:q(g,["prevent"])},{default:a(()=>[e(Z,{border:"end",variant:"tonal",color:"red-darken-2"},{default:a(()=>[e(ee,{class:"text-h6 mb-1"},{default:a(()=>[se("Вы уверены что хотите удалить аккаунт?")]),_:1}),Ve]),_:1}),l("p",be,[e(ae,{modelValue:c.value,"onUpdate:modelValue":h[0]||(h[0]=_=>c.value=_),rules:[_=>!!_||"Подтвердите удаление аккаунта"],required:"",color:"red-darken-2",class:"text-red-darken-4"},{label:a(()=>[Se]),_:1},8,["modelValue","rules"])]),e(j,{type:"submit",color:"error"},{default:a(()=>[xe]),_:1})]),_:1},8,["onSubmit"])]))}});const Me=re(ye,[["__scopeId","data-v-80575f6d"]]),Ue={key:0},Ae={class:"text-h6"},Pe=l("div",{class:"title text-h2 mb-5 anim"},"Аккаунт",-1),Ce={class:"account-items"},Ee=I({__name:"AccountView",setup(V){const d=$(),r=ce(),p=(c,i)=>{r.showMessage(c,i)};return le(()=>{ne.from(".account-items > *",{y:"-70%",opacity:0,duration:.8,stagger:.4,ease:"power3.out"})}),(c,i)=>s(d).currentUser?(k(),E("div",Ue,[e(ue,{modelValue:s(r).isMessageShown,"onUpdate:modelValue":i[0]||(i[0]=g=>s(r).isMessageShown=g),color:s(r).messageType,"location-strategy":"connected"},{default:a(()=>[l("p",Ae,ie(s(r).messageText),1)]),_:1},8,["modelValue","color"]),Pe,l("div",Ce,[l("div",null,[e(B,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:a(()=>[e(fe,{onShowMessage:p})]),_:1})]),l("div",null,[e(B,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:a(()=>[e(we,{onShowMessage:p})]),_:1})]),l("div",null,[e(B,{color:"white",elevation:"2",class:"pa-5 rounded-lg mx-sm-0 mx-n5"},{default:a(()=>[e(Me,{onShowMessage:p})]),_:1})])])])):de("",!0)}});export{Ee as default};
