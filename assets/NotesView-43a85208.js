import{d as W,r as h,o as c,c as y,q as p,al as V,am as x,t as T,b as s,C as Z,e as o,E as C,an as F,ao as U,_ as Y,a as b,u as ee,P as te,S as ae,i as k,h as A,g as m,U as se,O as w,z as oe,M as L,m as I,Z as re,a0 as z,ap as P,aq as q,B as le,y as G,s as ne,p as N,ar as ie,n as H,v as de,a3 as ue,x as ce,F as pe,f as O,a2 as ve,T as R}from"./index-619baa70.js";import{u as ge}from"./alert-163d7f92.js";const fe={class:"d-flex align-center"},me={class:"flex-grow-1"},he=W({__name:"Note",props:{note:null},emits:["deleteNote","dragstart","dragend","updateNote"],setup(g,{emit:u}){const D=g,v=h(!1),$=()=>{u("updateNote",D.note),v.value=!1};return(l,i)=>(c(),y("div",{class:"note py-3 px-4 bg-white mb-3",onDragstart:i[3]||(i[3]=r=>l.$emit("dragstart",r,g.note.id)),onDragend:i[4]||(i[4]=r=>l.$emit("dragend",r))},[p("div",fe,[V(p("div",{class:"text-h6 flex-grow-1 pr-1"},T(g.note.title),513),[[x,!v.value]]),V(p("div",me,[s(Z,{modelValue:g.note.title,"onUpdate:modelValue":i[0]||(i[0]=r=>g.note.title=r),density:"comfortable",variant:"underlined",clearable:!1,"bg-color":"white"},null,8,["modelValue"])],512),[[x,v.value]]),p("div",null,[s(U,null,{default:o(({props:r,isHovering:n})=>[s(C,F({icon:"mdi-trash-can",size:"large",color:n?"red-darken-3":"grey",onClick:i[1]||(i[1]=f=>l.$emit("deleteNote",g.note.id))},r),null,16,["color"])]),_:1}),s(U,null,{default:o(({props:r,isHovering:n})=>[V(s(C,F({onClick:i[2]||(i[2]=f=>v.value=!v.value),icon:"mdi-pencil",size:"large",color:n?"blue":"grey"},r),null,16,["color"]),[[x,!v.value]])]),_:1}),s(U,null,{default:o(({props:r,isHovering:n})=>[V(s(C,F({onClick:$,style:{cursor:"pointer"},icon:"mdi-content-save-all",size:"large",color:n?"green":"grey"},r),null,16,["color"]),[[x,v.value]])]),_:1})])])],32))}});const ye=Y(he,[["__scopeId","data-v-44834e74"]]);class _e{async getNotes(u){return b.get(`/Notes/${u}`)}async updateNote(u){return await b.patch("/Notes",u)}async deleteNote(u){return await b.delete(`/Notes/${u}`)}async addNote(u){return await b.post("/Notes",u)}}const S=new _e,we={class:"text-h6"},Ne=p("div",{class:"text-h2 mb-8 title"},"Ваши заметки",-1),Ve={key:0,class:""},xe=p("p",{class:"mb-3 text-h6"},"Загрузка заметок ...",-1),be={key:0,color:"transparent","max-height":700,style:{overflow:"auto","max-height":"700px"}},ke=["onClick"],Ae=p("p",{class:"mb-2"},"Загрузка...",-1),Ce=W({__name:"NotesView",setup(g){const u=h([{title:"В процессе",isFormActive:!1,addText:""},{title:"Сделать потом",isFormActive:!1,addText:""},{title:"Сделано",isFormActive:!1,addText:""}]),D=(e,t)=>{e.target.classList.add("dragging"),e.dataTransfer.setData("id",t.toString())},v=e=>{e.target.classList.remove("dragging")},$=async(e,t)=>{var d;const a=(d=e.dataTransfer)==null?void 0:d.getData("id");if(a){const B=r.value.find(X=>X.id===+a);B.type=t,await E(B)}},l=ge(),i=ee(),r=h([]),n=h(!1),f=h(!1),_=h(null),M=te(()=>function(e){return r.value.filter(t=>t.type===e)});ae(async()=>{f.value=!0;try{const{data:e}=await S.getNotes(i.currentUser.id);r.value=e.notes}catch(e){k(e)?_.value=A(e):_.value="Ошибка при загрузке заметок!"}f.value=!1});const E=async e=>{n.value=!0;try{await S.updateNote(e)}catch(t){k(t)?l.showMessage("error",A(t)):l.showMessage("error","Ошибка при добавлении заметки!")}n.value=!1},j=async(e,t)=>{if(!(e.length<1)){n.value=!0;try{const{data:a}=await S.addNote({title:e,type:t,userId:i.currentUser.id});r.value.push({id:a.noteId,title:e,type:t})}catch(a){k(a)?l.showMessage("error",A(a)):l.showMessage("error","Ошибка при добавлении заметки!")}n.value=!1}},J=async e=>{n.value=!0;try{await S.deleteNote(e),r.value=r.value.filter(t=>t.id!=e)}catch(t){k(t)?l.showMessage("error",A(t)):l.showMessage("error","Ошибка при добавлении заметки!")}n.value=!1},K=(e,t)=>{R.from(e,{opacity:0,scale:0,ease:"sine.out",duration:.6,onComplete:t})},Q=(e,t)=>{R.to(e,{duration:.6,ease:"sine.out",opacity:0,scale:0,onComplete:t})};return(e,t)=>(c(),y("div",null,[s(se,{modelValue:m(l).isMessageShown,"onUpdate:modelValue":t[0]||(t[0]=a=>m(l).isMessageShown=a),color:m(l).messageType},{default:o(()=>[p("p",we,T(m(l).messageText),1)]),_:1},8,["modelValue","color"]),Ne,f.value?(c(),y("div",Ve,[xe,s(z,{color:"green",height:"4",indeterminate:""})])):_.value?L("",!0):(c(),w(oe,{key:1,class:"row"},{default:o(()=>[(c(!0),y(P,null,q(u.value,a=>(c(),w(le,{key:a.title,onDragover:t[1]||(t[1]=G(()=>{},["prevent"])),onDrop:d=>$(d,a.title)},{default:o(()=>[s(O,{color:"blue-grey-darken-1 pa-4"},{default:o(()=>[s(ne,{class:"text-h4 text-white mb-5 pa-0"},{default:o(()=>[N(T(a.title),1)]),_:2},1024),m(M)(a.title).length?(c(),y("div",be,[s(ie,{onEnter:K,onLeave:Q,css:!1,appear:""},{default:o(()=>[(c(!0),y(P,null,q(m(M)(a.title),d=>(c(),w(ye,{key:d.id,note:d,onDeleteNote:J,onUpdateNote:E,draggable:"true",onDragstart:D,onDragend:v},null,8,["note"]))),128))]),_:2},1024)])):(c(),w(I,{key:1,color:"white",class:"mb-2","border-color":"white"},{default:o(()=>[s(H,null,{default:o(()=>[N("Пока нет заметок, добавьте хоть одну !")]),_:1})]),_:1})),s(de,{class:"d-flex flex-column pa-0 align-stretch",style:{"min-height":"auto"}},{default:o(()=>[p("div",{onClick:d=>a.isFormActive=!a.isFormActive,style:{cursor:"pointer"}},[s(C,{icon:a.isFormActive?"mdi-minus":"mdi-plus"},null,8,["icon"]),N(" Добавить заметку ")],8,ke),s(ue,null,{default:o(()=>[V(s(ce,{onSubmit:G(d=>{j(a.addText,a.title),a.addText=""},["prevent"])},{default:o(()=>[s(Z,{"bg-color":"white",color:"black",placeholder:"Задача...",modelValue:a.addText,"onUpdate:modelValue":d=>a.addText=d,class:"my-2 white-input",rules:[d=>!!d||"Поле обязательное для ввода"]},null,8,["modelValue","onUpdate:modelValue","rules"]),s(pe,{type:"submit",variant:"flat",color:"green"},{default:o(()=>[N("Добавить")]),_:1})]),_:2},1032,["onSubmit"]),[[x,a.isFormActive]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onDrop"]))),128))]),_:1})),!f.value&&_.value?(c(),w(I,{key:2,type:"error",border:"end",variant:"tonal"},{default:o(()=>[s(H,{class:"mb-2"},{default:o(()=>[N(" Ошибка при загрузке товаров ")]),_:1}),p("p",null,T(_.value),1)]),_:1})):L("",!0),s(re,{modelValue:n.value,"onUpdate:modelValue":t[2]||(t[2]=a=>n.value=a),scrim:!1,persistent:"",width:"auto"},{default:o(()=>[s(O,{color:"indigo-darken-4"},{default:o(()=>[s(ve,null,{default:o(()=>[Ae,s(z,{indeterminate:"",color:"white",class:"mb-0"})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{Ce as default};
