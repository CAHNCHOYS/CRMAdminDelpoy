System.register(["./index-legacy-8b0be313.js","./alert-legacy-299e871f.js","./useFormSchemas-legacy-4c013c40.js","./ElementsTable.vue_vue_type_script_setup_true_lang-legacy-44e4698f.js"],(function(e,a){"use strict";var l,s,t,o,r,u,i,d,n,c,m,v,g,p,h,f,_,b,y,V,S,N,w,C,k,x,D,U,M,q,A,T;return{setters:[e=>{l=e.d,s=e.R,t=e.r,o=e.y,r=e.e,u=e.k,i=e.o,d=e.b,n=e.l,c=e.m,m=e.t,v=e.j,g=e.Z,p=e.i,h=e.h,f=e.f,_=e.p,b=e.Q,y=e.D,V=e.u,S=e.v,N=e.z,w=e.c,C=e.x,k=e.g},e=>{x=e.u},e=>{D=e.u,U=e.a,M=e.b},e=>{q=e.u,A=e.a,T=e._}],execute:function(){const a={class:"text-error"},F=l({__name:"CustomersDeleteDialog",props:{isOpened:{type:Boolean},customer:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchCustomers"],setup(e,{emit:l}){const f=e,_=x(),b=s(),y=v(),V=t(!1),S=async()=>{try{V.value=!0,await g.deleteCustomer(f.customer.id),b.deleteCustomer(f.customer.id),f.isSearchActive&&l("updateSearchCustomers"),_.showMessage("success","Клиент был успешно удален!")}catch(e){if(p(e)){if(401===e.response?.status)return void y.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"customers-page"}});_.showMessage("error",h(e))}else _.showMessage("error","Ошибка при удалении клиента!")}finally{l("closeDialog"),V.value=!1}};return(l,s)=>{const t=u("v-card-title"),v=u("v-card-text"),g=u("v-btn"),p=u("v-card-actions"),h=u("v-card"),f=u("v-dialog");return i(),o(f,{width:"auto","model-value":e.isOpened,persistent:!0,transition:"dialog-bottom-transition"},{default:r((()=>[d(h,{color:"white",class:"pa-4","max-width":450},{default:r((()=>[d(t,{class:"text-h5 mb-4 pa-0 font-weight-bold"},{default:r((()=>[n("Подтвердите удаление клиента")])),_:1}),d(v,{class:"text-h6 mb-4 pa-0"},{default:r((()=>[n(" Вы уверены что хотиет удалить клиента "),c("span",a,m(e.customer.firstName+" "+e.customer.secondName),1),n(" ? ")])),_:1}),d(p,{class:"justify-center pa-0"},{default:r((()=>[d(g,{onClick:s[0]||(s[0]=e=>l.$emit("closeDialog")),height:"40",color:"blue-darken-4",variant:"flat"},{default:r((()=>[n(" Нет ")])),_:1}),d(g,{height:"40",color:"error",variant:"flat",loading:V.value,onClick:S},{default:r((()=>[n("Да")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["model-value"])}}}),E=c("p",{class:"text-h6"},"Премиум клиент",-1),P=l({__name:"CustomersAddDialog",props:{isOpened:{type:Boolean}},emits:["closeDialog"],setup(e,{emit:a}){const{userCustomerSchema:l}=D(),{resetForm:t,handleSubmit:c,isSubmitting:m}=U({validationSchema:l}),{value:b,errorMessage:y}=M("firstName"),{value:V,errorMessage:S}=M("secondName"),{value:N,errorMessage:w}=M("thirdName"),{value:C,errorMessage:k}=M("phone"),{value:q,errorMessage:A}=M("premium");q.value="Нет";const T=x(),F=s(),P=v(),O=c((async e=>{try{const{data:a}=await g.addCustomer(e);F.addCustomer({...e,id:a.customerId,fullName:e.secondName+" "+e.firstName+" "+e.thirdName}),T.showMessage("success","Клиент "+e.secondName+" был успешно добавлен!")}catch(l){if(p(l)){if(401===l.response?.status)return void P.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"customers-page"}});T.showMessage("error",h(l))}else T.showMessage("error","Ошибка при добавлении клиента")}finally{a("closeDialog"),t()}}));return(l,s)=>{const t=u("v-card-title"),c=u("v-text-field"),v=u("v-col"),g=u("v-switch"),p=u("v-btn"),h=u("v-row"),x=u("v-form"),D=u("v-card-actions"),U=u("v-card"),M=u("v-dialog");return i(),o(M,{"model-value":e.isOpened,"onUpdate:modelValue":s[6]||(s[6]=e=>a("closeDialog")),width:"auto",scrollable:"",transition:"dialog-bottom-transition"},{default:r((()=>[d(U,{color:"white",class:"pa-4",width:"450"},{default:r((()=>[d(t,{class:"font-weight-bold text-h6 mb-3"},{default:r((()=>[n(" Добавление нового клиента ")])),_:1}),d(D,null,{default:r((()=>[d(x,{onSubmit:f(O)},{default:r((()=>[d(h,null,{default:r((()=>[d(v,{cols:"12"},{default:r((()=>[d(c,{modelValue:f(b),"onUpdate:modelValue":s[0]||(s[0]=e=>_(b)?b.value=e:null),"error-messages":f(y),label:"Имя"},null,8,["modelValue","error-messages"])])),_:1}),d(v,{cols:"12"},{default:r((()=>[d(c,{modelValue:f(V),"onUpdate:modelValue":s[1]||(s[1]=e=>_(V)?V.value=e:null),"error-messages":f(S),label:"Фамилия"},null,8,["modelValue","error-messages"])])),_:1}),d(v,{cols:"12"},{default:r((()=>[d(c,{modelValue:f(N),"onUpdate:modelValue":s[2]||(s[2]=e=>_(N)?N.value=e:null),"error-messages":f(w),label:"Отчество"},null,8,["modelValue","error-messages"])])),_:1}),d(v,{cols:"12"},{default:r((()=>[d(c,{label:"Номер телефона",modelValue:f(C),"onUpdate:modelValue":s[3]||(s[3]=e=>_(C)?C.value=e:null),"error-messages":f(k)},null,8,["modelValue","error-messages"])])),_:1}),d(v,{cols:"12"},{default:r((()=>[E,d(g,{modelValue:f(q),"onUpdate:modelValue":s[4]||(s[4]=e=>_(q)?q.value=e:null),"true-value":"Да","false-value":"Нет","hide-details":"",label:f(q),color:"indigo","error-messages":f(A)},null,8,["modelValue","label","error-messages"])])),_:1}),d(v,{cols:"12"},{default:r((()=>[d(p,{color:"green-darken-4",variant:"flat",type:"submit",loading:f(m)},{default:r((()=>[n(" Добавить ")])),_:1},8,["loading"]),d(p,{color:"blue-darken-4",variant:"flat",onClick:s[5]||(s[5]=e=>l.$emit("closeDialog"))},{default:r((()=>[n(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"])}}}),O=c("p",{class:"text-h6"},"Премиум клиент ?",-1),j=l({__name:"CustomersEditDialog",props:{isOpened:{type:Boolean},customer:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchCustomers"],setup(e,{emit:a}){const l=e,t=b((()=>({firstName:l.customer.firstName,secondName:l.customer.secondName,thirdName:l.customer.thirdName,phone:l.customer.phone,premium:l.customer.premium}))),{userCustomerSchema:c}=D(),{resetForm:m,handleSubmit:y,isSubmitting:V}=U({validationSchema:c,initialValues:t}),{value:S,errorMessage:N}=M("firstName"),{value:w,errorMessage:C}=M("secondName"),{value:k,errorMessage:q}=M("thirdName"),{value:A,errorMessage:T}=M("phone"),{value:F}=M("premium"),E=x(),P=s(),j=v(),W=y((async e=>{console.log(e);try{await g.updateCustomer(e,l.customer.id),P.updateCustomer({...e,id:l.customer.id,fullName:e.secondName+" "+e.firstName+" "+e.thirdName}),l.isSearchActive&&a("updateSearchCustomers"),E.showMessage("success","Клиент был успешно изменен")}catch(s){if(p(s)){if(401===s.response?.status)return void j.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"customers-page"}});E.showMessage("error",h(s))}else E.showMessage("error","Ошибка при изменении клиента")}finally{m(),a("closeDialog")}}));return(a,l)=>{const s=u("v-card-title"),t=u("v-text-field"),c=u("v-col"),m=u("v-switch"),v=u("v-btn"),g=u("v-row"),p=u("v-form"),h=u("v-card-actions"),b=u("v-card"),y=u("v-dialog");return i(),o(y,{"model-value":e.isOpened,"onUpdate:modelValue":l[6]||(l[6]=e=>a.$emit("closeDialog")),scrollable:"",width:"auto"},{default:r((()=>[d(b,{width:"450",color:"white",class:"pa-4"},{default:r((()=>[d(s,{class:"text-h6 font-weight-bold"},{default:r((()=>[n(" Редактирование клиента ")])),_:1}),d(h,null,{default:r((()=>[d(p,{onSubmit:f(W)},{default:r((()=>[d(g,null,{default:r((()=>[d(c,{cols:"12"},{default:r((()=>[d(t,{modelValue:f(S),"onUpdate:modelValue":l[0]||(l[0]=e=>_(S)?S.value=e:null),"error-messages":f(N),label:"Имя"},null,8,["modelValue","error-messages"])])),_:1}),d(c,{cols:"12"},{default:r((()=>[d(t,{modelValue:f(w),"onUpdate:modelValue":l[1]||(l[1]=e=>_(w)?w.value=e:null),"error-messages":f(C),label:"Фамилия"},null,8,["modelValue","error-messages"])])),_:1}),d(c,{cols:"12"},{default:r((()=>[d(t,{modelValue:f(k),"onUpdate:modelValue":l[2]||(l[2]=e=>_(k)?k.value=e:null),"error-messages":f(q),label:"Отчество"},null,8,["modelValue","error-messages"])])),_:1}),d(c,{cols:"12"},{default:r((()=>[d(t,{label:"Номер телефона",modelValue:f(A),"onUpdate:modelValue":l[3]||(l[3]=e=>_(A)?A.value=e:null),"error-messages":f(T)},null,8,["modelValue","error-messages"])])),_:1}),d(c,{cols:"12"},{default:r((()=>[O,d(m,{modelValue:f(F),"onUpdate:modelValue":l[4]||(l[4]=e=>_(F)?F.value=e:null),"true-value":"Да","false-value":"Нет","hide-details":"",label:f(F),color:"indigo"},null,8,["modelValue","label"])])),_:1}),d(c,{cols:"12"},{default:r((()=>[d(v,{color:"green-darken-4",variant:"flat",type:"submit",loading:f(V)},{default:r((()=>[n(" Обновить ")])),_:1},8,["loading"]),d(v,{color:"blue-darken-4",variant:"flat",onClick:l[5]||(l[5]=e=>a.$emit("closeDialog"))},{default:r((()=>[n(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"])}}}),W={class:"text-h6"},B=c("h2",{class:"title text-h2 mb-5"},"Клиенты",-1);e("default",l({__name:"CustomersView",setup(e){const a=s(),l=x(),b=V(),D=t([{fieldText:"Имя",fieldName:"firstName"},{fieldText:"Фамилия",fieldName:"secondName"},{fieldText:"Отчество",fieldName:"thirdName"},{fieldText:"Телефон",fieldName:"phone"},{fieldText:"Есть премиум",fieldName:"premium"}]),U=t("firstName"),{customers:M,customersErrorMessage:E}=S(a),{isAddDialogActive:O,isEditDialogActive:$,isDeleteDialogActive:I,itemToEdit:Q,openDialog:z}=q(),L=k(),R=v(),{isSearchFormActive:Z,isSearchLoading:G,searchWithPremium:H,premium:J,isSearchActive:K,secondName:X,searchedCustomers:Y,addSearchQuery:ee,resetSearch:ae,searchUserCustomers:le}=((e,a,l)=>{const s=x(),o=t(!1),r=t(e.query.secondName||""),u=t(+e.query.premium||0),i=t(!1),d=t([]),n=t(!1),c=t(!1),m=async()=>{try{c.value=!0;const{data:a}=await g.getSearchedCustomers({userId:l,premium:+e.query.premium,secondName:e.query.secondName,searchWithPremium:e.query.searchWithPremium});console.log(a),d.value=a.customers,n.value=!0}catch(a){p(a)?s.showMessage("error",h(a)):s.showMessage("error","Ошибка при поиске товаров!")}finally{c.value=!1}};return y([()=>e.query.secondName,()=>e.query.premium,()=>e.query.searchWithPremium],(async()=>{(void 0!==e.query.secondName||e.query.premium)&&m()}),{immediate:!0}),{premium:u,searchWithPremium:i,isSearchFormActive:o,isSearchActive:n,isSearchLoading:c,secondName:r,searchedCustomers:d,searchUserCustomers:m,addSearchQuery:()=>{a.push({name:"clients-page",query:{...e.query,secondName:r.value,searchWithPremium:String(i.value),premium:u.value}})},resetSearch:()=>{r.value="",i.value=!1,u.value=0,n.value=!1,d.value=[],a.push({name:"clients-page",query:{}})}}})(L,R,b.currentUser.id),se=N((()=>K.value?Y.value:M.value)),{currentPage:te,paginatedElements:oe,isInverseSort:re,elemetsPerPage:ue,totalPages:ie,setSortField:de}=A({tableElements:se,pageName:"clients-page",sortField:U,route:L,router:R});return(e,a)=>{const s=u("v-snackbar"),t=u("TableActions"),v=u("v-text-field"),g=u("v-col"),p=u("v-checkbox"),h=u("v-switch"),b=u("v-scale-transition"),y=u("v-btn"),V=u("v-row"),S=u("v-expand-transition"),N=u("v-alert-title"),k=u("v-alert"),x=u("v-progress-circular"),M=u("v-sheet"),q=u("v-pagination"),A=u("v-card");return i(),w("div",null,[d(s,{modelValue:f(l).isMessageShown,"onUpdate:modelValue":a[0]||(a[0]=e=>f(l).isMessageShown=e),"max-width":500,color:f(l).messageType},{default:r((()=>[c("p",W,m(f(l).messageText),1)])),_:1},8,["modelValue","color"]),B,d(A,{color:"white",elevation:"3",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:r((()=>[d(t,{count:f(ue),"onUpdate:count":[a[1]||(a[1]=e=>_(ue)?ue.value=e:null),a[2]||(a[2]=e=>ue.value=e)],onToggleAddDialog:a[3]||(a[3]=e=>O.value=!0),onToggleSearch:a[4]||(a[4]=e=>Z.value=!f(Z)),"is-badge-active":!!e.$route.query.secondName},{default:r((()=>[n(" Все клиенты ")])),_:1},8,["count","is-badge-active"]),d(S,null,{default:r((()=>[f(Z)?(i(),o(V,{key:0,class:"mb-5",align:"center"},{default:r((()=>[d(g,{cols:"8"},{default:r((()=>[d(v,{label:"Имя клиента",modelValue:f(X),"onUpdate:modelValue":a[5]||(a[5]=e=>_(X)?X.value=e:null),"onClick:clear":a[6]||(a[6]=e=>X.value="")},null,8,["modelValue"])])),_:1}),d(g,{cols:"auto"},{default:r((()=>[d(p,{modelValue:f(H),"onUpdate:modelValue":a[7]||(a[7]=e=>_(H)?H.value=e:null),color:"indigo-darken-4",label:"Искать с премиумом"},null,8,["modelValue"])])),_:1}),d(b,{"leave-absolute":!0},{default:r((()=>[f(H)?(i(),o(g,{key:0,cols:"auto"},{default:r((()=>[d(h,{modelValue:f(J),"onUpdate:modelValue":a[8]||(a[8]=e=>_(J)?J.value=e:null),"true-value":1,"false-value":0,color:"indigo-darken-4",label:"Есть премиум?"},null,8,["modelValue"])])),_:1})):C("",!0)])),_:1}),d(g,{cols:"12"},{default:r((()=>[d(V,null,{default:r((()=>[d(g,{cols:"auto"},{default:r((()=>[d(y,{variant:"flat",disabled:f(G),color:"green-darken-3",onClick:f(ee)},{default:r((()=>[n(" Искать ")])),_:1},8,["disabled","onClick"])])),_:1}),d(g,{cols:"auto"},{default:r((()=>[d(y,{variant:"flat",disabled:f(G),color:"error",onClick:f(ae)},{default:r((()=>[n(" Сбросить поиск ")])),_:1},8,["disabled","onClick"])])),_:1}),d(g,{cols:"auto"},{default:r((()=>[d(y,{variant:"flat",disabled:f(G),color:"blue-darken-4",onClick:a[9]||(a[9]=e=>Z.value=!1)},{default:r((()=>[n(" Закрыть поиск ")])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1})):C("",!0)])),_:1}),f(E)?(i(),o(k,{key:0,type:"error",border:"end",variant:"tonal"},{default:r((()=>[d(N,{class:"mb-2"},{default:r((()=>[n(" Ошибка при загрузке клиентов")])),_:1}),c("p",null,m(f(E)),1)])),_:1})):f(G)?C("",!0):(i(),o(T,{key:1,items:f(oe),fields:D.value,"no-data-text":"Клиенты не найдены","current-sort-field":U.value,"onUpdate:currentSortField":[a[10]||(a[10]=e=>U.value=e),a[11]||(a[11]=e=>f(de)(e))],"is-inverse-sort":f(re),onOpenDialog:a[12]||(a[12]=(e,a)=>f(z)(e,a))},null,8,["items","fields","current-sort-field","is-inverse-sort"])),f(G)?(i(),o(M,{key:2,class:"text-center mb-2"},{default:r((()=>[d(x,{indeterminate:"",size:"32",color:"green"})])),_:1})):C("",!0),f(se).length?(i(),o(q,{key:3,length:f(ie),modelValue:f(te),"onUpdate:modelValue":a[13]||(a[13]=e=>_(te)?te.value=e:null),rounded:"circle","total-visible":7,color:"deep-purple-darken-4"},null,8,["length","modelValue"])):C("",!0)])),_:1}),f(Q)?(i(),o(F,{key:0,"is-opened":f(I),onCloseDialog:a[14]||(a[14]=e=>I.value=!1),"is-search-active":f(K),onUpdateSearchCustomers:f(le),customer:f(Q)},null,8,["is-opened","is-search-active","onUpdateSearchCustomers","customer"])):C("",!0),f(Q)?(i(),o(j,{key:1,"is-opened":f($),onCloseDialog:a[15]||(a[15]=e=>$.value=!1),"is-search-active":f(K),onUpdateSearchCustomers:f(le),customer:f(Q)},null,8,["is-opened","is-search-active","onUpdateSearchCustomers","customer"])):C("",!0),d(P,{"is-opened":f(O),onCloseDialog:a[16]||(a[16]=e=>O.value=!1)},null,8,["is-opened"])])}}}))}}}));
