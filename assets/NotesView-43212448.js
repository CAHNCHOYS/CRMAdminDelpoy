import{d as Q,r as h,o as c,c as y,s as p,am as V,an as x,t as C,e as s,D as R,f as o,F as D,ao as F,ap as U,_ as Z,b,a as ee,u as te,Q as ae,T as se,i as k,h as A,j as m,W as oe,P as w,B as le,N as L,n as I,$ as re,a1 as z,aq as P,ar as q,C as ne,z as G,v as ie,q as N,as as de,p as W,x as ue,a4 as ce,y as pe,G as ve,g as j,a3 as ge,U as H}from"./index-b08fb9b5.js";const fe={class:"d-flex align-center"},me={class:"flex-grow-1"},he=Q({__name:"Note",props:{note:null},emits:["deleteNote","dragstart","dragend","updateNote"],setup(g,{emit:u}){const S=g,v=h(!1),$=()=>{u("updateNote",S.note),v.value=!1};return(r,i)=>(c(),y("div",{class:"note py-3 px-4 bg-white mb-3",onDragstart:i[3]||(i[3]=l=>r.$emit("dragstart",l,g.note.id)),onDragend:i[4]||(i[4]=l=>r.$emit("dragend",l))},[p("div",fe,[V(p("div",{class:"text-h6 flex-grow-1 pr-1"},C(g.note.title),513),[[x,!v.value]]),V(p("div",me,[s(R,{modelValue:g.note.title,"onUpdate:modelValue":i[0]||(i[0]=l=>g.note.title=l),density:"comfortable",variant:"underlined",clearable:!1,"bg-color":"white"},null,8,["modelValue"])],512),[[x,v.value]]),p("div",null,[s(U,null,{default:o(({props:l,isHovering:n})=>[s(D,F({icon:"mdi-trash-can",size:"large",color:n?"red-darken-3":"grey",onClick:i[1]||(i[1]=f=>r.$emit("deleteNote",g.note.id))},l),null,16,["color"])]),_:1}),s(U,null,{default:o(({props:l,isHovering:n})=>[V(s(D,F({onClick:i[2]||(i[2]=f=>v.value=!v.value),icon:"mdi-pencil",size:"large",color:n?"blue":"grey"},l),null,16,["color"]),[[x,!v.value]])]),_:1}),s(U,null,{default:o(({props:l,isHovering:n})=>[V(s(D,F({onClick:$,style:{cursor:"pointer"},icon:"mdi-content-save-all",size:"large",color:n?"green":"grey"},l),null,16,["color"]),[[x,v.value]])]),_:1})])])],32))}});const ye=Z(he,[["__scopeId","data-v-44834e74"]]);class _e{async getNotes(u){return b.get(`/Notes/${u}`)}async updateNote(u){return await b.patch("/Notes",u)}async deleteNote(u){return await b.delete(`/Notes/${u}`)}async addNote(u){return await b.post("/Notes",u)}}const T=new _e,we={class:"text-h6"},Ne=p("div",{class:"text-h2 mb-8 title"},"Ваши заметки",-1),Ve={key:0,class:""},xe=p("p",{class:"mb-3 text-h6"},"Загрузка заметок ...",-1),be={key:0,color:"transparent","max-height":700,style:{overflow:"auto","max-height":"700px"}},ke=["onClick"],Ae=p("p",{class:"mb-2"},"Загрузка...",-1),Ce=Q({__name:"NotesView",setup(g){const u=h([{title:"В процессе",isFormActive:!1,addText:""},{title:"Сделать потом",isFormActive:!1,addText:""},{title:"Сделано",isFormActive:!1,addText:""}]),S=(e,t)=>{e.target.classList.add("dragging"),e.dataTransfer.setData("id",t.toString())},v=e=>{e.target.classList.remove("dragging")},$=async(e,t)=>{var d;const a=(d=e.dataTransfer)==null?void 0:d.getData("id");if(a){const B=l.value.find(Y=>Y.id===+a);B.type=t,await E(B)}},r=ee(),i=te(),l=h([]),n=h(!1),f=h(!1),_=h(null),M=ae(()=>function(e){return l.value.filter(t=>t.type===e)});se(async()=>{f.value=!0;try{const{data:e}=await T.getNotes(i.currentUser.id);l.value=e.notes}catch(e){k(e)?_.value=A(e):_.value="Ошибка при загрузке заметок!"}f.value=!1});const E=async e=>{n.value=!0;try{await T.updateNote(e)}catch(t){k(t)?r.showMessage("error",A(t)):r.showMessage("error","Ошибка при добавлении заметки!")}n.value=!1},J=async(e,t)=>{if(!(e.length<1)){n.value=!0;try{const{data:a}=await T.addNote({title:e,type:t,userId:i.currentUser.id});l.value.push({id:a.noteId,title:e,type:t})}catch(a){k(a)?r.showMessage("error",A(a)):r.showMessage("error","Ошибка при добавлении заметки!")}n.value=!1}},K=async e=>{n.value=!0;try{await T.deleteNote(e),l.value=l.value.filter(t=>t.id!=e)}catch(t){k(t)?r.showMessage("error",A(t)):r.showMessage("error","Ошибка при добавлении заметки!")}n.value=!1},O=(e,t)=>{H.from(e,{opacity:0,scale:0,ease:"sine.out",duration:.6,onComplete:t})},X=(e,t)=>{H.to(e,{duration:.6,ease:"sine.out",opacity:0,scale:0,onComplete:t})};return(e,t)=>(c(),y("div",null,[s(oe,{modelValue:m(r).isMessageShown,"onUpdate:modelValue":t[0]||(t[0]=a=>m(r).isMessageShown=a),color:m(r).messageType},{default:o(()=>[p("p",we,C(m(r).messageText),1)]),_:1},8,["modelValue","color"]),Ne,f.value?(c(),y("div",Ve,[xe,s(z,{color:"green",height:"4",indeterminate:""})])):_.value?L("",!0):(c(),w(le,{key:1,class:"row"},{default:o(()=>[(c(!0),y(P,null,q(u.value,a=>(c(),w(ne,{key:a.title,onDragover:t[1]||(t[1]=G(()=>{},["prevent"])),onDrop:d=>$(d,a.title)},{default:o(()=>[s(j,{color:"blue-grey-darken-1 pa-4"},{default:o(()=>[s(ie,{class:"text-h4 text-white mb-5 pa-0"},{default:o(()=>[N(C(a.title),1)]),_:2},1024),m(M)(a.title).length?(c(),y("div",be,[s(de,{onEnter:O,onLeave:X,css:!1,appear:""},{default:o(()=>[(c(!0),y(P,null,q(m(M)(a.title),d=>(c(),w(ye,{key:d.id,note:d,onDeleteNote:K,onUpdateNote:E,draggable:"true",onDragstart:S,onDragend:v},null,8,["note"]))),128))]),_:2},1024)])):(c(),w(I,{key:1,color:"white",class:"mb-2","border-color":"white"},{default:o(()=>[s(W,null,{default:o(()=>[N("Пока нет заметок, добавьте хоть одну !")]),_:1})]),_:1})),s(ue,{class:"d-flex flex-column pa-0 align-stretch",style:{"min-height":"auto"}},{default:o(()=>[p("div",{onClick:d=>a.isFormActive=!a.isFormActive,style:{cursor:"pointer"}},[s(D,{icon:a.isFormActive?"mdi-minus":"mdi-plus"},null,8,["icon"]),N(" Добавить заметку ")],8,ke),s(ce,null,{default:o(()=>[V(s(pe,{onSubmit:G(d=>{J(a.addText,a.title),a.addText=""},["prevent"])},{default:o(()=>[s(R,{"bg-color":"white",color:"black",placeholder:"Задача...",modelValue:a.addText,"onUpdate:modelValue":d=>a.addText=d,class:"my-2 white-input",rules:[d=>!!d||"Поле обязательное для ввода"]},null,8,["modelValue","onUpdate:modelValue","rules"]),s(ve,{type:"submit",variant:"flat",color:"green"},{default:o(()=>[N("Добавить")]),_:1})]),_:2},1032,["onSubmit"]),[[x,a.isFormActive]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onDrop"]))),128))]),_:1})),!f.value&&_.value?(c(),w(I,{key:2,type:"error",border:"end",variant:"tonal"},{default:o(()=>[s(W,{class:"mb-2"},{default:o(()=>[N(" Ошибка при загрузке товаров ")]),_:1}),p("p",null,C(_.value),1)]),_:1})):L("",!0),s(re,{modelValue:n.value,"onUpdate:modelValue":t[2]||(t[2]=a=>n.value=a),scrim:!1,persistent:"",width:"auto"},{default:o(()=>[s(j,{color:"indigo-darken-4"},{default:o(()=>[s(ge,null,{default:o(()=>[Ae,s(z,{indeterminate:"",color:"white",class:"mb-0"})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{Ce as default};
