System.register(["./index-legacy-bdf57a8f.js","./useFormSchemas-legacy-4726c74c.js","./alert-legacy-4db1546e.js"],(function(e,a){"use strict";var s,l,t,r,o,n,u,d,m,c,i,p,g,v,h,f,w,b,y,_,x,V,U,M,S,k,C,j,A,I,F,P,T,L,R,q,z,D,E,O,B,H=document.createElement("style");return H.textContent=".text[data-v-80575f6d]{font-weight:600}\n",document.head.appendChild(H),{setters:[e=>{s=e.d,l=e.u,t=e.P,r=e.A,o=e.i,n=e.h,u=e.r,d=e.o,m=e.c,c=e.b,i=e.e,p=e.z,g=e.B,v=e.q,h=e.Q,f=e.g,w=e.R,b=e.D,y=e.C,_=e.K,x=e.F,V=e.x,U=e.v,M=e.l,S=e.m,k=e.n,C=e.p,j=e.L,A=e.H,I=e.I,F=e._,P=e.S,T=e.T,L=e.U,R=e.f,q=e.M,z=e.t},e=>{D=e.u,E=e.a,O=e.b},e=>{B=e.u}],execute:function(){const a=v("div",{class:"text-h5 mb-4"},"Общая информация об аккаунте",-1),H={class:"d-flex flex-sm-row flex-column align-sm-center"},K=v("span",{class:"text-h6"},"Обновить данные ",-1),Q=s({__name:"AccountInfo",emits:["showMessage"],setup(e,{emit:s}){const S=l(),k=t((()=>({name:S.currentUser?.name||"user logged out",email:S.currentUser?.email||"user logged out",country:S.currentUser?.country||"user logged out",avatar:[]}))),{updateInfoShchema:C}=D(),{handleSubmit:j,isSubmitting:A}=E({validationSchema:C,initialValues:k}),{value:I,errorMessage:F}=O("name"),{value:P,errorMessage:T}=O("email"),{value:L,errorMessage:R}=O("country"),{value:q,errorMessage:z}=O("avatar"),B=M(),Q=j((async e=>{try{let a=new FormData;a.append("name",e.name),a.append("email",e.email),a.append("country",e.country),a.append("avatar",e.avatar[0],q.value[0].name),await r.updateInfo(a);const{data:l}=await r.getUser();S.setUser(l.user),s("showMessage","success","Данные были обновлены!")}catch(a){o(a)?(401===a.response?.status&&B.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"account-page"}}),s("showMessage","error",n(a))):s("showMessage","error","Ошибка при изменении данных!")}})),$=u("");function G(e){const a=e.target.files[0];$.value=URL.createObjectURL(a),console.log(URL.createObjectURL(a))}function J(){$.value=""}return(e,s)=>(d(),m("div",null,[a,c(U,{onSubmit:V(f(Q),["prevent"]),enctype:"multipart/form-data"},{default:i((()=>[c(p,{align:"center"},{default:i((()=>[c(g,{md:"6",cols:"12"},{default:i((()=>[v("div",H,[c(h,{size:"80",class:"mr-sm-3 mb-sm-0 mb-4 border mx-auto",image:$.value||`https://crm-backend-mocha.vercel.app/UserAvatars/${f(S).currentUser.avatar}`},null,8,["image"]),c(w,{modelValue:f(q),"onUpdate:modelValue":s[0]||(s[0]=e=>b(q)?q.value=e:null),"error-messages":f(z),"show-size":"","prepend-icon":"mdi-camera","hide-details":"auto",label:"Загрузите ваш аватар",accept:".jpg, .png, .jpeg, .svg , .webp",onChange:G,"onClick:clear":J},null,8,["modelValue","error-messages"])])])),_:1}),c(g,{sm:"6",cols:"12"},{default:i((()=>[c(y,{modelValue:f(I),"onUpdate:modelValue":s[1]||(s[1]=e=>b(I)?I.value=e:null),"error-messages":f(F),label:"Ваше имя"},null,8,["modelValue","error-messages"])])),_:1}),c(g,{sm:"6",cols:"12"},{default:i((()=>[c(y,{modelValue:f(P),"onUpdate:modelValue":s[2]||(s[2]=e=>b(P)?P.value=e:null),"error-messages":f(T),label:"Ваша почта"},null,8,["modelValue","error-messages"])])),_:1}),c(g,{sm:"6",cols:"12"},{default:i((()=>[c(_,{modelValue:f(L),"onUpdate:modelValue":s[3]||(s[3]=e=>b(L)?L.value=e:null),"error-messages":f(R),items:["Россия","Беларусь","Латвия","Украина","Казахстан","Узбекистан"],label:"Страна проживания"},null,8,["modelValue","error-messages"])])),_:1}),c(g,{cols:"12"},{default:i((()=>[c(x,{type:"submit",variant:"flat",loading:f(A),color:"green"},{default:i((()=>[K])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["onSubmit"])]))}}),$=v("div",{class:"text-h5 mb-3"},"Безопасность",-1),G=v("span",{class:"text-white text-h6"},"Обновить пароль",-1),J=s({__name:"AccountSecurity",emits:["showMessage"],setup(e,{emit:a}){const{updatePasswordSchema:s}=D(),{handleSubmit:t,isSubmitting:v,resetForm:h}=E({validationSchema:s}),{value:w,errorMessage:_}=O("oldPassword"),{value:S,errorMessage:k}=O("newPassword"),{value:C,errorMessage:j}=O("newPasswordConfirm"),A=u(!1),I=u(!1),F=l(),P=M(),T=t((async e=>{try{await r.updatePassword(e);const{data:s}=await r.getUser();F.setUser(s.user),a("showMessage","success","Пароль был успешно имзенен"),h()}catch(s){if(o(s)){if(401===s.response?.status)return void P.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"account-page"}});a("showMessage","error",n(s))}else a("showMessage","error","Ошибка при изменении пароля!")}}));return(e,a)=>(d(),m("div",null,[$,c(U,{onSubmit:V(f(T),["prevent"])},{default:i((()=>[c(p,null,{default:i((()=>[c(g,{cols:"12"},{default:i((()=>[c(y,{modelValue:f(w),"onUpdate:modelValue":a[0]||(a[0]=e=>b(w)?w.value=e:null),"error-messages":f(_),label:"Старый пароль",type:I.value?"text":"password","append-inner-icon":I.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":a[1]||(a[1]=e=>I.value=!I.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])])),_:1}),c(g,{sm:"6",cols:"12"},{default:i((()=>[c(y,{label:"Новый пароль",modelValue:f(S),"onUpdate:modelValue":a[2]||(a[2]=e=>b(S)?S.value=e:null),"error-messages":f(k),type:A.value?"text":"password","append-inner-icon":A.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":a[3]||(a[3]=e=>A.value=!A.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])])),_:1}),c(g,{sm:"6",cols:"12"},{default:i((()=>[c(y,{modelValue:f(C),"onUpdate:modelValue":a[4]||(a[4]=e=>b(C)?C.value=e:null),"error-messages":f(j),label:"Повторите новый пароль",type:A.value?"text":"password"},null,8,["modelValue","error-messages","type"])])),_:1}),c(g,{cols:"12"},{default:i((()=>[c(x,{type:"submit",loading:f(v),variant:"flat",color:"green"},{default:i((()=>[G])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["onSubmit"])]))}}),N=e=>(A("data-v-80575f6d"),e=e(),I(),e),W=N((()=>v("div",{class:"text-h5 mb-4"},"Удаление аккаунта",-1))),X=N((()=>v("p",{class:"text-h6"},"Отменить это действие будет невозможно",-1))),Y={class:"mb-2"},Z=N((()=>v("span",{class:"font-weight-bold"},"Я хочу удалить аккаунт ",-1))),ee=N((()=>v("span",{class:"text-h6"},"Удалить аккаунт",-1))),ae=F(s({__name:"AccountDeletion",emits:["showMessage"],setup(e,{emit:a}){const s=l(),t=M(),p=u(!1),g=u(!1),h=async()=>{if(p.value&&window.confirm("Вы точно уверены?"))try{await r.deleteAccount(s.currentUser.id),s.logOutUser(),t.push({name:"login-page"})}catch(e){g.value=!0,o(e)?a("showMessage","error",n(e)):a("showMessage","error","Ошибка при удалении профиля!"),setTimeout((()=>g.value=!1),3500)}};return(e,a)=>(d(),m("div",null,[W,c(U,{onSubmit:V(h,["prevent"])},{default:i((()=>[c(S,{border:"end",variant:"tonal",color:"red-darken-2"},{default:i((()=>[c(k,{class:"text-h6 mb-1"},{default:i((()=>[C("Вы уверены что хотите удалить аккаунт?")])),_:1}),X])),_:1}),v("p",Y,[c(j,{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e),rules:[e=>!!e||"Подтвердите удаление аккаунта"],required:"",color:"red-darken-2",class:"text-red-darken-4"},{label:i((()=>[Z])),_:1},8,["modelValue","rules"])]),c(x,{type:"submit",color:"error"},{default:i((()=>[ee])),_:1})])),_:1},8,["onSubmit"])]))}}),[["__scopeId","data-v-80575f6d"]]),se={key:0},le={class:"text-h6"},te=v("div",{class:"title text-h2 mb-5 anim"},"Аккаунт",-1),re={class:"account-items"};e("default",s({__name:"AccountView",setup(e){const a=l(),s=B(),t=(e,a)=>{s.showMessage(e,a)};return P((()=>{T.from(".account-items > *",{y:"-70%",opacity:0,duration:.8,stagger:.4,ease:"power3.out"})})),(e,l)=>f(a).currentUser?(d(),m("div",se,[c(L,{modelValue:f(s).isMessageShown,"onUpdate:modelValue":l[0]||(l[0]=e=>f(s).isMessageShown=e),color:f(s).messageType,"location-strategy":"connected"},{default:i((()=>[v("p",le,z(f(s).messageText),1)])),_:1},8,["modelValue","color"]),te,v("div",re,[v("div",null,[c(R,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:i((()=>[c(Q,{onShowMessage:t})])),_:1})]),v("div",null,[c(R,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:i((()=>[c(J,{onShowMessage:t})])),_:1})]),v("div",null,[c(R,{color:"white",elevation:"2",class:"pa-5 rounded-lg mx-sm-0 mx-n5"},{default:i((()=>[c(ae,{onShowMessage:t})])),_:1})])])])):q("",!0)}}))}}}));
