import{d as $,u as k,P as G,A as P,i as B,h as L,r as C,o as E,c as F,b as e,e as a,z as H,B as w,q as l,Q as J,g as s,R as X,D as S,C as A,K as Y,F as N,y as j,x as q,l as z,m as Z,n as ee,p as se,L as ae,H as oe,I as te,_ as re,S as le,T as ne,U as ue,f as O,M as de,t as ie}from"./index-619baa70.js";import{u as K,a as Q,b as x}from"./useFormSchemas-8a5fa9a3.js";import{u as ce}from"./alert-163d7f92.js";const me=l("div",{class:"text-h5 mb-4"},"Общая информация об аккаунте",-1),pe={class:"d-flex flex-sm-row flex-column align-sm-center"},ge=l("span",{class:"text-h6"},"Обновить данные ",-1),fe=$({__name:"AccountInfo",emits:["showMessage"],setup(V,{emit:d}){const t=k(),p=G(()=>{var m,r,o;return{name:((m=t.currentUser)==null?void 0:m.name)||"user logged out",email:((r=t.currentUser)==null?void 0:r.email)||"user logged out",country:((o=t.currentUser)==null?void 0:o.country)||"user logged out",avatar:[]}}),{updateInfoShchema:c}=K(),{handleSubmit:i,isSubmitting:g}=Q({validationSchema:c,initialValues:p}),{value:f,errorMessage:h}=x("name"),{value:_,errorMessage:U}=x("email"),{value:M,errorMessage:b}=x("country"),{value:v,errorMessage:I}=x("avatar"),R=z(),T=i(async m=>{var r;try{let o=new FormData;o.append("name",m.name),o.append("email",m.email),o.append("country",m.country),o.append("avatar",m.avatar[0],v.value[0].name),await P.updateInfo(o);const{data:W}=await P.getUser();t.setUser(W.user),d("showMessage","success","Данные были обновлены!")}catch(o){B(o)?(((r=o.response)==null?void 0:r.status)===401&&(t.logOutUser(),R.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"account-page"}})),d("showMessage","error",L(o))):d("showMessage","error","Ошибка при изменении данных!")}}),y=C("");function n(m){const r=m.target.files[0];y.value=URL.createObjectURL(r),console.log(URL.createObjectURL(r))}function u(){y.value=""}return(m,r)=>(E(),F("div",null,[me,e(q,{onSubmit:j(s(T),["prevent"]),enctype:"multipart/form-data"},{default:a(()=>[e(H,{align:"center"},{default:a(()=>[e(w,{md:"6",cols:"12"},{default:a(()=>[l("div",pe,[e(J,{size:"80",class:"mr-sm-3 mb-sm-0 mb-4 border mx-auto",image:y.value||`https://crm-backend-mocha.vercel.app/UserAvatars/${s(t).currentUser.avatar}`},null,8,["image"]),e(X,{modelValue:s(v),"onUpdate:modelValue":r[0]||(r[0]=o=>S(v)?v.value=o:null),"error-messages":s(I),"show-size":"","prepend-icon":"mdi-camera","hide-details":"auto",label:"Загрузите ваш аватар",accept:".jpg, .png, .jpeg, .svg , .webp",onChange:n,"onClick:clear":u},null,8,["modelValue","error-messages"])])]),_:1}),e(w,{sm:"6",cols:"12"},{default:a(()=>[e(A,{modelValue:s(f),"onUpdate:modelValue":r[1]||(r[1]=o=>S(f)?f.value=o:null),"error-messages":s(h),label:"Ваше имя"},null,8,["modelValue","error-messages"])]),_:1}),e(w,{sm:"6",cols:"12"},{default:a(()=>[e(A,{modelValue:s(_),"onUpdate:modelValue":r[2]||(r[2]=o=>S(_)?_.value=o:null),"error-messages":s(U),label:"Ваша почта"},null,8,["modelValue","error-messages"])]),_:1}),e(w,{sm:"6",cols:"12"},{default:a(()=>[e(Y,{modelValue:s(M),"onUpdate:modelValue":r[3]||(r[3]=o=>S(M)?M.value=o:null),"error-messages":s(b),items:["Россия","Беларусь","Латвия","Украина","Казахстан","Узбекистан"],label:"Страна проживания"},null,8,["modelValue","error-messages"])]),_:1}),e(w,{cols:"12"},{default:a(()=>[e(N,{type:"submit",variant:"flat",loading:s(g),color:"green"},{default:a(()=>[ge]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]))}}),_e=l("div",{class:"text-h5 mb-3"},"Безопасность",-1),ve=l("span",{class:"text-white text-h6"},"Обновить пароль",-1),we=$({__name:"AccountSecurity",emits:["showMessage"],setup(V,{emit:d}){const{updatePasswordSchema:t}=K(),{handleSubmit:p,isSubmitting:c,resetForm:i}=Q({validationSchema:t}),{value:g,errorMessage:f}=x("oldPassword"),{value:h,errorMessage:_}=x("newPassword"),{value:U,errorMessage:M}=x("newPasswordConfirm"),b=C(!1),v=C(!1),I=k(),R=z(),T=p(async y=>{var n;try{await P.updatePassword(y);const{data:u}=await P.getUser();I.setUser(u.user),d("showMessage","success","Пароль был успешно имзенен"),i()}catch(u){if(B(u)){if(((n=u.response)==null?void 0:n.status)===401){I.logOutUser(),R.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"account-page"}});return}d("showMessage","error",L(u))}else d("showMessage","error","Ошибка при изменении пароля!")}});return(y,n)=>(E(),F("div",null,[_e,e(q,{onSubmit:j(s(T),["prevent"])},{default:a(()=>[e(H,null,{default:a(()=>[e(w,{cols:"12"},{default:a(()=>[e(A,{modelValue:s(g),"onUpdate:modelValue":n[0]||(n[0]=u=>S(g)?g.value=u:null),"error-messages":s(f),label:"Старый пароль",type:v.value?"text":"password","append-inner-icon":v.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":n[1]||(n[1]=u=>v.value=!v.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1}),e(w,{sm:"6",cols:"12"},{default:a(()=>[e(A,{label:"Новый пароль",modelValue:s(h),"onUpdate:modelValue":n[2]||(n[2]=u=>S(h)?h.value=u:null),"error-messages":s(_),type:b.value?"text":"password","append-inner-icon":b.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":n[3]||(n[3]=u=>b.value=!b.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1}),e(w,{sm:"6",cols:"12"},{default:a(()=>[e(A,{modelValue:s(U),"onUpdate:modelValue":n[4]||(n[4]=u=>S(U)?U.value=u:null),"error-messages":s(M),label:"Повторите новый пароль",type:b.value?"text":"password"},null,8,["modelValue","error-messages","type"])]),_:1}),e(w,{cols:"12"},{default:a(()=>[e(N,{type:"submit",loading:s(c),variant:"flat",color:"green"},{default:a(()=>[ve]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]))}}),D=V=>(oe("data-v-80575f6d"),V=V(),te(),V),he=D(()=>l("div",{class:"text-h5 mb-4"},"Удаление аккаунта",-1)),Ve=D(()=>l("p",{class:"text-h6"},"Отменить это действие будет невозможно",-1)),be={class:"mb-2"},Se=D(()=>l("span",{class:"font-weight-bold"},"Я хочу удалить аккаунт ",-1)),xe=D(()=>l("span",{class:"text-h6"},"Удалить аккаунт",-1)),ye=$({__name:"AccountDeletion",emits:["showMessage"],setup(V,{emit:d}){const t=k(),p=z(),c=C(!1),i=C(!1),g=async()=>{if(c.value&&window.confirm("Вы точно уверены?"))try{await P.deleteAccount(t.currentUser.id),t.logOutUser(),p.push({name:"login-page"})}catch(f){i.value=!0,B(f)?d("showMessage","error",L(f)):d("showMessage","error","Ошибка при удалении профиля!"),setTimeout(()=>i.value=!1,3500)}};return(f,h)=>(E(),F("div",null,[he,e(q,{onSubmit:j(g,["prevent"])},{default:a(()=>[e(Z,{border:"end",variant:"tonal",color:"red-darken-2"},{default:a(()=>[e(ee,{class:"text-h6 mb-1"},{default:a(()=>[se("Вы уверены что хотите удалить аккаунт?")]),_:1}),Ve]),_:1}),l("p",be,[e(ae,{modelValue:c.value,"onUpdate:modelValue":h[0]||(h[0]=_=>c.value=_),rules:[_=>!!_||"Подтвердите удаление аккаунта"],required:"",color:"red-darken-2",class:"text-red-darken-4"},{label:a(()=>[Se]),_:1},8,["modelValue","rules"])]),e(N,{type:"submit",color:"error"},{default:a(()=>[xe]),_:1})]),_:1},8,["onSubmit"])]))}});const Ue=re(ye,[["__scopeId","data-v-80575f6d"]]),Me={key:0},Ae={class:"text-h6"},Pe=l("div",{class:"title text-h2 mb-5 anim"},"Аккаунт",-1),Ce={class:"account-items"},Ee=$({__name:"AccountView",setup(V){const d=k(),t=ce(),p=(c,i)=>{t.showMessage(c,i)};return le(()=>{ne.from(".account-items > *",{y:"-70%",opacity:0,duration:.8,stagger:.4,ease:"power3.out"})}),(c,i)=>s(d).currentUser?(E(),F("div",Me,[e(ue,{modelValue:s(t).isMessageShown,"onUpdate:modelValue":i[0]||(i[0]=g=>s(t).isMessageShown=g),color:s(t).messageType,"location-strategy":"connected"},{default:a(()=>[l("p",Ae,ie(s(t).messageText),1)]),_:1},8,["modelValue","color"]),Pe,l("div",Ce,[l("div",null,[e(O,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:a(()=>[e(fe,{onShowMessage:p})]),_:1})]),l("div",null,[e(O,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:a(()=>[e(we,{onShowMessage:p})]),_:1})]),l("div",null,[e(O,{color:"white",elevation:"2",class:"pa-5 rounded-lg mx-sm-0 mx-n5"},{default:a(()=>[e(Ue,{onShowMessage:p})]),_:1})])])])):de("",!0)}});export{Ee as default};
