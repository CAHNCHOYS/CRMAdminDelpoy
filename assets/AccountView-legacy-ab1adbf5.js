System.register(["./index-legacy-ea2b4db0.js","./useFormSchemas-legacy-a2a6c0b7.js","./useLogoutHandler-legacy-60a74881.js"],(function(e,a){"use strict";var s,l,t,o,r,n,u,d,m,c,i,g,p,v,h,f,w,b,y,_,x,V,U,M,S,L,j,k,C,A,I,P,R,z,D,F,O,T,q,E,B,G,H=document.createElement("style");return H.textContent=".text[data-v-19a76008]{font-weight:600}\n",document.head.appendChild(H),{setters:[e=>{s=e.d,l=e.u,t=e.Q,o=e.A,r=e.i,n=e.h,u=e.r,d=e.o,m=e.c,c=e.e,i=e.f,g=e.B,p=e.C,v=e.s,h=e.R,f=e.j,w=e.S,b=e.E,y=e.D,_=e.L,x=e.G,V=e.z,U=e.y,M=e.n,S=e.p,L=e.q,j=e.M,k=e.m,C=e.I,A=e.J,I=e._,P=e.a,R=e.T,z=e.U,D=e.W,F=e.g,O=e.N,T=e.t},e=>{q=e.u,E=e.a,B=e.b},e=>{G=e.u}],execute:function(){const a=v("div",{class:"text-h5 mb-4"},"Общая информация об аккаунте",-1),H={class:"d-flex flex-sm-row flex-column align-sm-center"},J=v("span",{class:"text-h6"},"Обновить данные ",-1),N=s({__name:"AccountInfo",emits:["showMessage"],setup(e,{emit:s}){const M=l(),S=t((()=>({name:M.currentUser?.name||"user logged out",email:M.currentUser?.email||"user logged out",country:M.currentUser?.country||"user logged out",avatar:[]}))),{updateInfoShchema:L}=q(),{handleSubmit:j,isSubmitting:k}=E({validationSchema:L,initialValues:S}),{value:C,errorMessage:A}=B("name"),{value:I,errorMessage:P}=B("email"),{value:R,errorMessage:z}=B("country"),{value:D,errorMessage:F}=B("avatar"),{handleLogout:O}=G("account-page"),T=j((async e=>{try{let a=new FormData;a.append("name",e.name),a.append("email",e.email),a.append("country",e.country),a.append("avatar",e.avatar[0],D.value[0].name),await o.updateInfo(a);const{data:l}=await o.getUser();M.setUser(l.user),s("showMessage","success","Данные были обновлены!")}catch(a){if(r(a)){if(401===a.response?.status)return void(await O());s("showMessage","error",n(a))}else s("showMessage","error","Ошибка при изменении данных!")}})),N=u("");function Q(e){const a=e.target.files[0];N.value=URL.createObjectURL(a),console.log(URL.createObjectURL(a))}function W(){N.value=""}return(e,s)=>(d(),m("div",null,[a,c(U,{onSubmit:V(f(T),["prevent"]),enctype:"multipart/form-data"},{default:i((()=>[c(g,{align:"center"},{default:i((()=>[c(p,{md:"6",cols:"12"},{default:i((()=>[v("div",H,[c(h,{size:"80",class:"mr-sm-3 mb-sm-0 mb-4 border mx-auto",image:N.value||`https://crm-backend-mocha.vercel.app/UserAvatars/${f(M).currentUser.avatar}`},null,8,["image"]),c(w,{modelValue:f(D),"onUpdate:modelValue":s[0]||(s[0]=e=>b(D)?D.value=e:null),"error-messages":f(F),"show-size":"","prepend-icon":"mdi-camera","hide-details":"auto",label:"Загрузите ваш аватар",accept:".jpg, .png, .jpeg, .svg , .webp",onChange:Q,"onClick:clear":W},null,8,["modelValue","error-messages"])])])),_:1}),c(p,{sm:"6",cols:"12"},{default:i((()=>[c(y,{modelValue:f(C),"onUpdate:modelValue":s[1]||(s[1]=e=>b(C)?C.value=e:null),"error-messages":f(A),label:"Ваше имя"},null,8,["modelValue","error-messages"])])),_:1}),c(p,{sm:"6",cols:"12"},{default:i((()=>[c(y,{modelValue:f(I),"onUpdate:modelValue":s[2]||(s[2]=e=>b(I)?I.value=e:null),"error-messages":f(P),label:"Ваша почта"},null,8,["modelValue","error-messages"])])),_:1}),c(p,{sm:"6",cols:"12"},{default:i((()=>[c(_,{modelValue:f(R),"onUpdate:modelValue":s[3]||(s[3]=e=>b(R)?R.value=e:null),"error-messages":f(z),items:["Россия","Беларусь","Латвия","Украина","Казахстан","Узбекистан"],label:"Страна проживания"},null,8,["modelValue","error-messages"])])),_:1}),c(p,{cols:"12"},{default:i((()=>[c(x,{type:"submit",variant:"flat",loading:f(k),color:"green"},{default:i((()=>[J])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["onSubmit"])]))}}),Q=v("div",{class:"text-h5 mb-3"},"Безопасность",-1),W=v("span",{class:"text-white text-h6"},"Обновить пароль",-1),$=s({__name:"AccountSecurity",emits:["showMessage"],setup(e,{emit:a}){const{updatePasswordSchema:s}=q(),{handleSubmit:t,isSubmitting:v,resetForm:h}=E({validationSchema:s}),{value:w,errorMessage:_}=B("oldPassword"),{value:M,errorMessage:S}=B("newPassword"),{value:L,errorMessage:j}=B("newPasswordConfirm"),k=u(!1),C=u(!1),A=l(),{handleLogout:I}=G("account-page"),P=t((async e=>{try{await o.updatePassword(e);const{data:s}=await o.getUser();A.setUser(s.user),a("showMessage","success","Пароль был успешно имзенен"),h()}catch(s){if(r(s)){if(401===s.response?.status)return void(await I());a("showMessage","error",n(s))}else a("showMessage","error","Ошибка при изменении пароля!")}}));return(e,a)=>(d(),m("div",null,[Q,c(U,{onSubmit:V(f(P),["prevent"])},{default:i((()=>[c(g,null,{default:i((()=>[c(p,{cols:"12"},{default:i((()=>[c(y,{modelValue:f(w),"onUpdate:modelValue":a[0]||(a[0]=e=>b(w)?w.value=e:null),"error-messages":f(_),label:"Старый пароль",type:C.value?"text":"password","append-inner-icon":C.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":a[1]||(a[1]=e=>C.value=!C.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])])),_:1}),c(p,{sm:"6",cols:"12"},{default:i((()=>[c(y,{label:"Новый пароль",modelValue:f(M),"onUpdate:modelValue":a[2]||(a[2]=e=>b(M)?M.value=e:null),"error-messages":f(S),type:k.value?"text":"password","append-inner-icon":k.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":a[3]||(a[3]=e=>k.value=!k.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])])),_:1}),c(p,{sm:"6",cols:"12"},{default:i((()=>[c(y,{modelValue:f(L),"onUpdate:modelValue":a[4]||(a[4]=e=>b(L)?L.value=e:null),"error-messages":f(j),label:"Повторите новый пароль",type:k.value?"text":"password"},null,8,["modelValue","error-messages","type"])])),_:1}),c(p,{cols:"12"},{default:i((()=>[c(x,{type:"submit",loading:f(v),variant:"flat",color:"green"},{default:i((()=>[W])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["onSubmit"])]))}}),K=e=>(C("data-v-19a76008"),e=e(),A(),e),X=K((()=>v("div",{class:"text-h5 mb-4"},"Удаление аккаунта",-1))),Y=K((()=>v("p",{class:"text-h6"},"Отменить это действие будет невозможно",-1))),Z={class:"mb-2"},ee=K((()=>v("span",{class:"font-weight-bold"},"Я хочу удалить аккаунт ",-1))),ae=K((()=>v("span",{class:"text-h6"},"Удалить аккаунт",-1))),se=I(s({__name:"AccountDeletion",emits:["showMessage"],setup(e,{emit:a}){const s=l(),t=k(),g=u(!1),{handleLogout:p}=G("account-page"),h=async()=>{if(g.value&&window.confirm("Вы точно уверены?"))try{await o.deleteAccount(s.currentUser.id),await s.logOutUser(),t.push({name:"login-page"})}catch(e){if(r(e)){if(401===e.response?.status)return void(await p());a("showMessage","error",n(e))}else a("showMessage","error","Ошибка при удалении профиля!")}};return(e,a)=>(d(),m("div",null,[X,c(U,{onSubmit:V(h,["prevent"])},{default:i((()=>[c(M,{border:"end",variant:"tonal",color:"red-darken-2"},{default:i((()=>[c(S,{class:"text-h6 mb-1"},{default:i((()=>[L("Вы уверены что хотите удалить аккаунт?")])),_:1}),Y])),_:1}),v("p",Z,[c(j,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value=e),rules:[e=>!!e||"Подтвердите удаление аккаунта"],required:"",color:"red-darken-2",class:"text-red-darken-4"},{label:i((()=>[ee])),_:1},8,["modelValue","rules"])]),c(x,{type:"submit",color:"error"},{default:i((()=>[ae])),_:1})])),_:1},8,["onSubmit"])]))}}),[["__scopeId","data-v-19a76008"]]),le={key:0},te={class:"text-h6"},oe=v("div",{class:"title text-h2 mb-5 anim"},"Аккаунт",-1),re={class:"account-items"};e("default",s({__name:"AccountView",setup(e){const a=l(),s=P(),t=(e,a)=>{s.showMessage(e,a)};return R((()=>{z.from(".account-items > *",{y:"-70%",opacity:0,duration:.8,stagger:.4,ease:"power3.out"})})),(e,l)=>f(a).currentUser?(d(),m("div",le,[c(D,{modelValue:f(s).isMessageShown,"onUpdate:modelValue":l[0]||(l[0]=e=>f(s).isMessageShown=e),color:f(s).messageType,"location-strategy":"connected"},{default:i((()=>[v("p",te,T(f(s).messageText),1)])),_:1},8,["modelValue","color"]),oe,v("div",re,[v("div",null,[c(F,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:i((()=>[c(N,{onShowMessage:t})])),_:1})]),v("div",null,[c(F,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:i((()=>[c($,{onShowMessage:t})])),_:1})]),v("div",null,[c(F,{color:"white",elevation:"2",class:"pa-5 rounded-lg mx-sm-0 mx-n5"},{default:i((()=>[c(se,{onShowMessage:t})])),_:1})])])])):O("",!0)}}))}}}));
