System.register(["./index-legacy-67bac1ad.js","./ElementsTable.vue_vue_type_script_setup_true_lang-legacy-dde799c3.js","./useFormSchemas-legacy-5da05849.js","./useLogoutHandler-legacy-1053b484.js"],(function(e,a){"use strict";var l,t,r,s,o,u,d,i,c,n,m,g,p,v,f,h,y,_,b,P,S,V,k,x,w,M,U,D,A,C,q,N,T,E,I,F,L,$,j,B,Q,z,H,G,K,O,W,X,Y,Z,J,R,ee,ae;return{setters:[e=>{l=e.a,t=e.r,r=e.X,s=e.Y,o=e.i,u=e.h,d=e.d,i=e.Q,c=e.Z,n=e.K,m=e.P,g=e.f,p=e.$,v=e.o,f=e.e,h=e.v,y=e.x,_=e.y,b=e.z,P=e.j,S=e.B,V=e.C,k=e.D,x=e.E,w=e.a0,M=e.a1,U=e.a2,D=e.n,A=e.p,C=e.q,q=e.t,N=e.G,T=e.g,E=e.s,I=e.a3,F=e.u,L=e.T,$=e.c,j=e.W,B=e.N,Q=e.l,z=e.m,H=e.a4,G=e.a5,K=e.a6,O=e.a7,W=e.H},e=>{X=e.u,Y=e.a,Z=e._},e=>{J=e.u,R=e.a,ee=e.b},e=>{ae=e.u}],execute:function(){const a=E("p",{class:"text-h6 font-weight-bold mb-4"},"Редактирование товара",-1),le=E("p",{class:"text-h6 mb-2"},"Загрузка категорий....",-1),te=d({__name:"ProductEditDialog",props:{isActive:{type:Boolean},product:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchProducts"],setup(e,{emit:t}){const r=e,d=i((()=>({name:r.product?.name||"Товар не был выбран",price:r.product?.price||0,count:r.product?.count||0,categoryId:r.product?.categoryId||0}))),{userProductSchema:E}=J(),{handleSubmit:I,isSubmitting:F,resetForm:L}=R({validationSchema:E,initialValues:d}),{value:$,errorMessage:j}=ee("name"),{value:B,errorMessage:Q}=ee("price"),{value:z,errorMessage:H}=ee("count"),{value:G,errorMessage:K}=ee("categoryId"),O=c(),W=l(),{handleLogout:X}=ae("products-page"),{productsCategories:Y,categoriesErrorMessage:Z,isCategoriesLoading:te}=n(O),re=I((async e=>{try{await s.updateProduct(e,r.product.id);const a=Y.value.find((a=>a.id===e.categoryId)).name;O.updateUserProduct({...e,category:a,id:r.product.id}),r.isSearchActive&&t("updateSearchProducts"),W.showMessage("success","Товар был изменен")}catch(a){if(o(a)){if(401===a.response?.status)return void(await X());W.showMessage("error",u(a))}else W.showMessage("error","Ошибка при обновлении товара!")}finally{L(),t("closeDialog")}}));return(l,t)=>(v(),m(p,{transition:"dialog-bottom-transition","max-width":"500","onUpdate:modelValue":t[5]||(t[5]=e=>l.$emit("closeDialog")),"model-value":e.isActive},{default:g((()=>[f(T,{class:"pa-5",color:"white",elevation:"4"},{default:g((()=>[f(h,null,{default:g((()=>[a])),_:1}),f(y,null,{default:g((()=>[f(_,{onSubmit:b(P(re),["prevent"])},{default:g((()=>[f(S,null,{default:g((()=>[f(V,{cols:"12"},{default:g((()=>[f(k,{modelValue:P($),"onUpdate:modelValue":t[0]||(t[0]=e=>x($)?$.value=e:null),"error-messages":P(j),label:"Название товара"},null,8,["modelValue","error-messages"])])),_:1}),f(V,{cols:"12"},{default:g((()=>[P(te)?(v(),m(w,{key:0},{default:g((()=>[le,f(M,{indeterminate:"",height:"6",color:"green"})])),_:1})):P(Z)?(v(),m(w,{key:2},{default:g((()=>[f(D,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:g((()=>[f(A,{class:"text-h6"},{default:g((()=>[C(q(P(Z)),1)])),_:1})])),_:1})])),_:1})):(v(),m(U,{key:1,modelValue:P(G),"onUpdate:modelValue":t[1]||(t[1]=e=>x(G)?G.value=e:null),label:"Категория товара","error-messages":P(K),items:P(Y),"item-title":"name",clearable:!1,"item-value":"id","no-data-text":"Нет категорий"},null,8,["modelValue","error-messages","items"]))])),_:1}),f(V,{sm:"6",cols:"12"},{default:g((()=>[f(k,{modelValue:P(z),"onUpdate:modelValue":t[2]||(t[2]=e=>x(z)?z.value=e:null),modelModifiers:{number:!0},"error-messages":P(H),label:"Количество",type:"number"},null,8,["modelValue","error-messages"])])),_:1}),f(V,{sm:"6",cols:"12"},{default:g((()=>[f(k,{modelValue:P(B),"onUpdate:modelValue":t[3]||(t[3]=e=>x(B)?B.value=e:null),modelModifiers:{number:!0},"error-messages":P(Q),label:"Цена",type:"number",suffix:"руб"},null,8,["modelValue","error-messages"])])),_:1}),f(V,{cols:"12"},{default:g((()=>[f(N,{color:"green-darken-4",variant:"flat",loading:P(F),type:"submit"},{default:g((()=>[C(" Сохранить ")])),_:1},8,["loading"]),f(N,{color:"blue-darken-4",variant:"flat",onClick:t[4]||(t[4]=e=>l.$emit("closeDialog"))},{default:g((()=>[C(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),re=E("p",{class:"font-weight-bold text-h5"},"Подтверждение удаления",-1),se={class:"text-h6"},oe={class:"text-red"},ue=E("span",{class:"text-white"},"Нет",-1),de=d({__name:"ProductDeleteDialog",props:{product:null,isActive:{type:Boolean},isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchProducts"],setup(e,{emit:a}){const r=e,d=t(!1),i=c(),n=l(),{handleLogout:_}=ae("products-page"),b=async()=>{try{d.value=!0,await s.deleteProduct(r.product.id),i.deleteUserProduct(r.product.id),r.isSearchActive&&a("updateSearchProducts"),n.showMessage("success","Товар был успешно удален")}catch(e){if(o(e)){if(401===e.response?.status)return void(await _());n.showMessage("error",u(e))}else n.showMessage("error","Ошибка при удалении товара!")}finally{d.value=!1,a("closeDialog")}};return(a,l)=>(v(),m(p,{"model-value":e.isActive,"max-width":450,persistent:"",transition:"dialog-bottom-transition"},{default:g((()=>[f(T,{class:"pa-4"},{default:g((()=>[f(h,{class:"pa-0 mb-3"},{default:g((()=>[re])),_:1}),f(I,{class:"pa-0 mb-4"},{default:g((()=>[E("p",se,[C(" Вы уверены что хотите удалить товар "),E("span",oe,q(r.product.name),1),C(" из списка? ")])])),_:1}),f(y,{class:"justify-center"},{default:g((()=>[f(N,{onClick:l[0]||(l[0]=e=>a.$emit("closeDialog")),height:"40",color:"blue-darken-4",variant:"flat"},{default:g((()=>[ue])),_:1}),f(N,{height:"40",loading:d.value,color:"error",variant:"flat",onClick:b},{default:g((()=>[C("Да")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),ie=E("p",{class:"text-h6 font-weight-bold mb-4"},"Добавление нового товара",-1),ce=E("p",{class:"text-h6 mb-2"},"Загрузка категорий....",-1),ne=d({__name:"ProductAddDialog",props:{isActive:{type:Boolean}},emits:["closeDialog"],setup(e,{emit:a}){const{userProductSchema:t}=J(),{handleSubmit:r,isSubmitting:d,resetForm:i}=R({validationSchema:t}),{value:E,errorMessage:I}=ee("name"),{value:F,errorMessage:L}=ee("categoryId"),{value:$,errorMessage:j}=ee("count"),{value:B,errorMessage:Q}=ee("price"),z=c(),H=l(),{handleLogout:G}=ae("products-page"),{productsCategories:K,categoriesErrorMessage:O,isCategoriesLoading:W}=n(z),X=r((async e=>{try{const{data:a}=await s.addProduct(e),l=K.value.find((a=>a.id===e.categoryId)).name;z.addUserProduct({...e,id:a.productId,category:l}),H.showMessage("success",`Товар ${e.name} был успешно добавлен!`)}catch(l){if(o(l)){if(401===l.response?.status)return void(await G());H.showMessage("error",u(l))}else H.showMessage("error","Ошибка при добавлении товара !")}finally{i(),a("closeDialog")}}));return(a,l)=>(v(),m(p,{transition:"dialog-bottom-transition","max-width":"500","onUpdate:modelValue":l[5]||(l[5]=e=>a.$emit("closeDialog")),scrollable:"","model-value":e.isActive},{default:g((()=>[f(T,{class:"pa-5",color:"white",elevation:"4"},{default:g((()=>[f(h,null,{default:g((()=>[ie])),_:1}),f(y,null,{default:g((()=>[f(_,{onSubmit:b(P(X),["prevent"])},{default:g((()=>[f(S,null,{default:g((()=>[f(V,{cols:"12"},{default:g((()=>[f(k,{modelValue:P(E),"onUpdate:modelValue":l[0]||(l[0]=e=>x(E)?E.value=e:null),"error-messages":P(I),label:"Название товара"},null,8,["modelValue","error-messages"])])),_:1}),f(V,{cols:"12"},{default:g((()=>[P(W)?(v(),m(w,{key:0},{default:g((()=>[ce,f(M,{indeterminate:"",height:"6",color:"green"})])),_:1})):P(O)?(v(),m(w,{key:2},{default:g((()=>[f(D,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:g((()=>[f(A,{class:"text-h6"},{default:g((()=>[C(q(P(O)),1)])),_:1})])),_:1})])),_:1})):(v(),m(U,{key:1,modelValue:P(F),"onUpdate:modelValue":l[1]||(l[1]=e=>x(F)?F.value=e:null),label:"Категория товара","error-messages":P(L),items:P(K),"item-title":"name",clearable:!1,"item-value":"id","no-data-text":"Нет категорий"},null,8,["modelValue","error-messages","items"]))])),_:1}),f(V,{sm:"6",cols:"12"},{default:g((()=>[f(k,{modelValue:P($),"onUpdate:modelValue":l[2]||(l[2]=e=>x($)?$.value=e:null),modelModifiers:{number:!0},"error-messages":P(j),label:"Количество",type:"number"},null,8,["modelValue","error-messages"])])),_:1}),f(V,{sm:"6",cols:"12"},{default:g((()=>[f(k,{modelValue:P(B),"onUpdate:modelValue":l[3]||(l[3]=e=>x(B)?B.value=e:null),modelModifiers:{number:!0},"error-messages":P(Q),label:"Цена",suffix:"руб",type:"number"},null,8,["modelValue","error-messages"])])),_:1}),f(V,{cols:"12"},{default:g((()=>[f(N,{color:"green-darken-4",variant:"flat",loading:P(d),type:"submit"},{default:g((()=>[C(" Добавить ")])),_:1},8,["loading"]),f(N,{color:"blue-darken-4",variant:"flat",onClick:l[4]||(l[4]=e=>a.$emit("closeDialog"))},{default:g((()=>[C(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),me={key:0},ge={class:"text-h6"},pe=E("h2",{class:"title text-h2 mb-5"},"Товары",-1),ve=E("span",{class:"text-wrap"}," Сбросить поиск",-1),fe={class:"text-h6"};e("default",d({__name:"ProductsView",setup(e){const a=c(),d=l(),p=F(),y=t([{fieldText:"Имя",fieldName:"name"},{fieldText:"Цена(руб)",fieldName:"price"},{fieldText:"Кол-во",fieldName:"count"},{fieldText:"Категория",fieldName:"category"}]),b=t("name"),{userProducts:M,productsErrorMessage:U,productsCategories:I}=n(a);L((async()=>{I.value.length||a.getAllProductsCategories()}));const{itemToEdit:J,isAddDialogActive:R,isEditDialogActive:ee,isDeleteDialogActive:ae,openDialog:le}=X(),re=Q(),se=z(),{searchName:oe,searchPrices:ue,searchedProducts:ie,isSearchActive:ce,isSearchLoading:he,isSearchFormActive:ye,resetSearch:_e,addSearchQuery:be,searchUserProducts:Pe}=((e,a,d)=>{const i=l(),c=t([+e.query.startPrice||1,+e.query.endPrice||99999]),n=t(e.query.productName||""),m=t([]),g=t(!1),p=t(!1),v=t(!1),f=async()=>{try{p.value=!0;const{data:a}=await s.getSearchedProducts({startPrice:e.query.startPrice,endPrice:e.query.endPrice,productName:e.query.productName,userId:d});m.value=a.products,console.log(m.value),g.value=!0}catch(a){o(a)?i.showMessage("error",u(a)):i.showMessage("error","Ошибка при поиске товара(")}finally{p.value=!1}};return r([()=>e.query.startPrice,()=>e.query.endPrice,()=>e.query.productName],(async()=>{(e.query.startPrice||e.query.endPrice)&&f()}),{immediate:!0}),{searchPrices:c,searchName:n,isSearchActive:g,searchedProducts:m,isSearchLoading:p,isSearchFormActive:v,searchUserProducts:f,addSearchQuery:()=>{a.push({name:"products-page",query:{...e.query,productName:n.value,startPrice:c.value[0],endPrice:c.value[1]}})},resetSearch:()=>{n.value="",c.value=[1,99999],g.value=!1,m.value=[],a.push({name:"products-page",query:{}})}}})(re,se,p.currentUser.id),Se=i((()=>ce.value?ie.value:M.value)),{currentPage:Ve,paginatedElements:ke,totalPages:xe,isInverseSort:we,elementsPerPageCount:Me,setSortField:Ue}=Y({tableElements:Se,pageName:"products-page",sortField:b,route:re,router:se});return(e,a)=>{const l=W("TableActions");return P(p).currentUser?(v(),$("div",me,[f(j,{modelValue:P(d).isMessageShown,"onUpdate:modelValue":a[0]||(a[0]=e=>P(d).isMessageShown=e),color:P(d).messageType,"location-strategy":"connected"},{default:g((()=>[E("p",ge,q(P(d).messageText),1)])),_:1},8,["modelValue","color"]),pe,f(T,{color:"white",elevation:"3",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:g((()=>[P(U)?B("",!0):(v(),m(h,{key:0,class:"pa-0"},{default:g((()=>[f(l,{count:P(Me),"onUpdate:count":a[1]||(a[1]=e=>x(Me)?Me.value=e:null),onToggleAddDialog:a[2]||(a[2]=e=>R.value=!0),onToggleSearch:a[3]||(a[3]=e=>ye.value=!P(ye)),"is-badge-active":!!e.$route.query.startPrice},{default:g((()=>[C(" Все товары ")])),_:1},8,["count","is-badge-active"]),f(H,null,{default:g((()=>[P(ye)?(v(),m(_,{key:0,class:"mb-8"},{default:g((()=>[f(S,{align:"center"},{default:g((()=>[f(V,{sm:"6",cols:"12",class:"mb-sm-0 mb-2"},{default:g((()=>[f(k,{modelValue:P(oe),"onUpdate:modelValue":a[4]||(a[4]=e=>x(oe)?oe.value=e:null),variant:"outlined",label:"Название товара"},null,8,["modelValue"])])),_:1}),f(V,{sm:"6",cols:"12",class:"pr-7"},{default:g((()=>[f(G,{modelValue:P(ue),"onUpdate:modelValue":a[5]||(a[5]=e=>x(ue)?ue.value=e:null),min:"1",step:"10",max:"99999",color:"blue-grey-darken-2",label:"Цена:"},null,8,["modelValue"])])),_:1}),f(V,{sm:"auto",cols:"12"},{default:g((()=>[f(S,null,{default:g((()=>[f(V,{sm:"auto",cols:"6"},{default:g((()=>[f(N,{variant:"flat",color:"green-darken-3",onClick:P(be),disabled:P(he),block:""},{default:g((()=>[C(" Искать ")])),_:1},8,["onClick","disabled"])])),_:1}),f(V,{sm:"auto",cols:"6"},{default:g((()=>[f(N,{variant:"flat",color:"red-darken-4",onClick:P(_e),disabled:P(he),block:""},{default:g((()=>[ve])),_:1},8,["onClick","disabled"])])),_:1}),f(V,{sm:"auto",cols:"12"},{default:g((()=>[f(N,{variant:"flat",color:"blue-darken-4",onClick:a[6]||(a[6]=e=>ye.value=!1),disabled:P(he),block:""},{default:g((()=>[C(" Закрыть ")])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):B("",!0)])),_:1})])),_:1})),P(U)?(v(),m(D,{key:1,type:"error",border:"end",variant:"tonal"},{default:g((()=>[f(A,{class:"mb-2 text-h5"},{default:g((()=>[C(" Ошибка при загрузке товаров ")])),_:1}),E("p",fe,q(P(U)),1)])),_:1})):P(he)?B("",!0):(v(),m(Z,{key:2,items:P(ke),fields:y.value,"current-sort-field":b.value,onUpdateSortField:a[7]||(a[7]=e=>P(Ue)(e)),"is-inverse-sort":P(we),"no-data-text":"Товары не найдены",onOpenDialog:a[8]||(a[8]=(e,a)=>P(le)(e,a))},null,8,["items","fields","current-sort-field","is-inverse-sort"])),P(he)?(v(),m(w,{key:3,class:"text-center mb-2"},{default:g((()=>[f(K,{indeterminate:"",size:"48",color:"green"})])),_:1})):B("",!0),P(Se).length?(v(),m(O,{key:4,length:P(xe),modelValue:P(Ve),"onUpdate:modelValue":a[9]||(a[9]=e=>x(Ve)?Ve.value=e:null),rounded:"circle","total-visible":7,color:"indigo-darken-4"},null,8,["length","modelValue"])):B("",!0)])),_:1}),P(J)?(v(),m(te,{key:0,"is-active":P(ee),onCloseDialog:a[10]||(a[10]=e=>ee.value=!1),product:P(J),"is-search-active":P(ce),onUpdateSearchProducts:P(Pe)},null,8,["is-active","product","is-search-active","onUpdateSearchProducts"])):B("",!0),P(J)?(v(),m(de,{key:1,"is-active":P(ae),onCloseDialog:a[11]||(a[11]=e=>ae.value=!1),product:P(J),"is-search-active":P(ce),onUpdateSearchProducts:P(Pe)},null,8,["is-active","product","is-search-active","onUpdateSearchProducts"])):B("",!0),f(ne,{onCloseDialog:a[12]||(a[12]=e=>R.value=!1),"is-active":P(R)},null,8,["is-active"])])):B("",!0)}}}))}}}));
