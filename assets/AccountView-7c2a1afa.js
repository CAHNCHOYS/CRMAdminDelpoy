import{d as I,u as $,Q,A as C,i as T,h as j,r as P,o as k,c as E,e,f as a,B as W,C as h,s as l,R as K,j as s,S as X,E as S,D as A,L as Y,G as B,z as O,y as z,n as Z,p as ee,q as se,M as ae,m as te,I as oe,J as re,_ as le,a as ne,T as ue,U as de,W as ie,g as N,N as ce,t as me}from"./index-0479616c.js";import{u as G,a as H,b as x}from"./useFormSchemas-2643e2d8.js";import{u as q}from"./useLogoutHandler-4400691d.js";const pe=l("div",{class:"text-h5 mb-4"},"Общая информация об аккаунте",-1),ge={class:"d-flex flex-sm-row flex-column align-sm-center"},_e=l("span",{class:"text-h6"},"Обновить данные ",-1),fe=I({__name:"AccountInfo",emits:["showMessage"],setup(V,{emit:d}){const r=$(),g=Q(()=>{var p,o,t;return{name:((p=r.currentUser)==null?void 0:p.name)||"user logged out",email:((o=r.currentUser)==null?void 0:o.email)||"user logged out",country:((t=r.currentUser)==null?void 0:t.country)||"user logged out",avatar:[]}}),{updateInfoShchema:c}=G(),{handleSubmit:m,isSubmitting:_}=H({validationSchema:c,initialValues:g}),{value:f,errorMessage:i}=x("name"),{value:v,errorMessage:M}=x("email"),{value:U,errorMessage:b}=x("country"),{value:w,errorMessage:L}=x("avatar"),{handleLogout:R}=q("account-page"),D=m(async p=>{var o;try{let t=new FormData;t.append("name",p.name),t.append("email",p.email),t.append("country",p.country),t.append("avatar",p.avatar[0],w.value[0].name),await C.updateInfo(t);const{data:J}=await C.getUser();r.setUser(J.user),d("showMessage","success","Данные были обновлены!")}catch(t){if(T(t)){if(((o=t.response)==null?void 0:o.status)===401){await R();return}d("showMessage","error",j(t))}else d("showMessage","error","Ошибка при изменении данных!")}}),y=P("");function n(p){const o=p.target.files[0];y.value=URL.createObjectURL(o),console.log(URL.createObjectURL(o))}function u(){y.value=""}return(p,o)=>(k(),E("div",null,[pe,e(z,{onSubmit:O(s(D),["prevent"]),enctype:"multipart/form-data"},{default:a(()=>[e(W,{align:"center"},{default:a(()=>[e(h,{md:"6",cols:"12"},{default:a(()=>[l("div",ge,[e(K,{size:"80",class:"mr-sm-3 mb-sm-0 mb-4 border mx-auto",image:y.value||`https://crm-backend-mocha.vercel.app/UserAvatars/${s(r).currentUser.avatar}`},null,8,["image"]),e(X,{modelValue:s(w),"onUpdate:modelValue":o[0]||(o[0]=t=>S(w)?w.value=t:null),"error-messages":s(L),"show-size":"","prepend-icon":"mdi-camera","hide-details":"auto",label:"Загрузите ваш аватар",accept:".jpg, .png, .jpeg, .svg , .webp",onChange:n,"onClick:clear":u},null,8,["modelValue","error-messages"])])]),_:1}),e(h,{sm:"6",cols:"12"},{default:a(()=>[e(A,{modelValue:s(f),"onUpdate:modelValue":o[1]||(o[1]=t=>S(f)?f.value=t:null),"error-messages":s(i),label:"Ваше имя"},null,8,["modelValue","error-messages"])]),_:1}),e(h,{sm:"6",cols:"12"},{default:a(()=>[e(A,{modelValue:s(v),"onUpdate:modelValue":o[2]||(o[2]=t=>S(v)?v.value=t:null),"error-messages":s(M),label:"Ваша почта"},null,8,["modelValue","error-messages"])]),_:1}),e(h,{sm:"6",cols:"12"},{default:a(()=>[e(Y,{modelValue:s(U),"onUpdate:modelValue":o[3]||(o[3]=t=>S(U)?U.value=t:null),"error-messages":s(b),items:["Россия","Беларусь","Латвия","Украина","Казахстан","Узбекистан"],label:"Страна проживания"},null,8,["modelValue","error-messages"])]),_:1}),e(h,{cols:"12"},{default:a(()=>[e(B,{type:"submit",variant:"flat",loading:s(_),color:"green"},{default:a(()=>[_e]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]))}}),ve=l("div",{class:"text-h5 mb-3"},"Безопасность",-1),we=l("span",{class:"text-white text-h6"},"Обновить пароль",-1),he=I({__name:"AccountSecurity",emits:["showMessage"],setup(V,{emit:d}){const{updatePasswordSchema:r}=G(),{handleSubmit:g,isSubmitting:c,resetForm:m}=H({validationSchema:r}),{value:_,errorMessage:f}=x("oldPassword"),{value:i,errorMessage:v}=x("newPassword"),{value:M,errorMessage:U}=x("newPasswordConfirm"),b=P(!1),w=P(!1),L=$(),{handleLogout:R}=q("account-page"),D=g(async y=>{var n;try{await C.updatePassword(y);const{data:u}=await C.getUser();L.setUser(u.user),d("showMessage","success","Пароль был успешно имзенен"),m()}catch(u){if(T(u)){if(((n=u.response)==null?void 0:n.status)===401){await R();return}d("showMessage","error",j(u))}else d("showMessage","error","Ошибка при изменении пароля!")}});return(y,n)=>(k(),E("div",null,[ve,e(z,{onSubmit:O(s(D),["prevent"])},{default:a(()=>[e(W,null,{default:a(()=>[e(h,{cols:"12"},{default:a(()=>[e(A,{modelValue:s(_),"onUpdate:modelValue":n[0]||(n[0]=u=>S(_)?_.value=u:null),"error-messages":s(f),label:"Старый пароль",type:w.value?"text":"password","append-inner-icon":w.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":n[1]||(n[1]=u=>w.value=!w.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1}),e(h,{sm:"6",cols:"12"},{default:a(()=>[e(A,{label:"Новый пароль",modelValue:s(i),"onUpdate:modelValue":n[2]||(n[2]=u=>S(i)?i.value=u:null),"error-messages":s(v),type:b.value?"text":"password","append-inner-icon":b.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":n[3]||(n[3]=u=>b.value=!b.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1}),e(h,{sm:"6",cols:"12"},{default:a(()=>[e(A,{modelValue:s(M),"onUpdate:modelValue":n[4]||(n[4]=u=>S(M)?M.value=u:null),"error-messages":s(U),label:"Повторите новый пароль",type:b.value?"text":"password"},null,8,["modelValue","error-messages","type"])]),_:1}),e(h,{cols:"12"},{default:a(()=>[e(B,{type:"submit",loading:s(c),variant:"flat",color:"green"},{default:a(()=>[we]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]))}}),F=V=>(oe("data-v-19a76008"),V=V(),re(),V),Ve=F(()=>l("div",{class:"text-h5 mb-4"},"Удаление аккаунта",-1)),be=F(()=>l("p",{class:"text-h6"},"Отменить это действие будет невозможно",-1)),Se={class:"mb-2"},xe=F(()=>l("span",{class:"font-weight-bold"},"Я хочу удалить аккаунт ",-1)),ye=F(()=>l("span",{class:"text-h6"},"Удалить аккаунт",-1)),Me=I({__name:"AccountDeletion",emits:["showMessage"],setup(V,{emit:d}){const r=$(),g=te(),c=P(!1),{handleLogout:m}=q("account-page"),_=async()=>{var f;if(c.value&&window.confirm("Вы точно уверены?"))try{await C.deleteAccount(r.currentUser.id),await r.logOutUser(),g.push({name:"login-page"})}catch(i){if(T(i)){if(((f=i.response)==null?void 0:f.status)===401){await m();return}d("showMessage","error",j(i))}else d("showMessage","error","Ошибка при удалении профиля!")}};return(f,i)=>(k(),E("div",null,[Ve,e(z,{onSubmit:O(_,["prevent"])},{default:a(()=>[e(Z,{border:"end",variant:"tonal",color:"red-darken-2"},{default:a(()=>[e(ee,{class:"text-h6 mb-1"},{default:a(()=>[se("Вы уверены что хотите удалить аккаунт?")]),_:1}),be]),_:1}),l("p",Se,[e(ae,{modelValue:c.value,"onUpdate:modelValue":i[0]||(i[0]=v=>c.value=v),rules:[v=>!!v||"Подтвердите удаление аккаунта"],required:"",color:"red-darken-2",class:"text-red-darken-4"},{label:a(()=>[xe]),_:1},8,["modelValue","rules"])]),e(B,{type:"submit",color:"error"},{default:a(()=>[ye]),_:1})]),_:1},8,["onSubmit"])]))}});const Ue=le(Me,[["__scopeId","data-v-19a76008"]]),Ae={key:0},Ce={class:"text-h6"},Pe=l("div",{class:"title text-h2 mb-5 anim"},"Аккаунт",-1),Ie={class:"account-items"},Fe=I({__name:"AccountView",setup(V){const d=$(),r=ne(),g=(c,m)=>{r.showMessage(c,m)};return ue(()=>{de.from(".account-items > *",{y:"-70%",opacity:0,duration:.8,stagger:.4,ease:"power3.out"})}),(c,m)=>s(d).currentUser?(k(),E("div",Ae,[e(ie,{modelValue:s(r).isMessageShown,"onUpdate:modelValue":m[0]||(m[0]=_=>s(r).isMessageShown=_),color:s(r).messageType,"location-strategy":"connected"},{default:a(()=>[l("p",Ce,me(s(r).messageText),1)]),_:1},8,["modelValue","color"]),Pe,l("div",Ie,[l("div",null,[e(N,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:a(()=>[e(fe,{onShowMessage:g})]),_:1})]),l("div",null,[e(N,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:a(()=>[e(he,{onShowMessage:g})]),_:1})]),l("div",null,[e(N,{color:"white",elevation:"2",class:"pa-5 rounded-lg mx-sm-0 mx-n5"},{default:a(()=>[e(Ue,{onShowMessage:g})]),_:1})])])])):ce("",!0)}});export{Fe as default};
