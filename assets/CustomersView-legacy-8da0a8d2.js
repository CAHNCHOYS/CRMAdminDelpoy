System.register(["./index-legacy-0d6d964e.js","./alert-legacy-c9f97587.js","./useFormSchemas-legacy-425f91b7.js","./ElementsTable.vue_vue_type_script_setup_true_lang-legacy-1247e002.js"],(function(e,a){"use strict";var l,s,o,t,r,u,d,i,n,m,c,g,p,h,f,v,_,b,y,V,S,N,C,k,w,x,U,D,M,q,A,T,F,P,E,O,W,j,B,$,I,L,z,Q,G,J,Z,H,K,R,X,Y;return{setters:[e=>{l=e.d,s=e.aj,o=e.r,t=e.O,r=e.e,u=e.Z,d=e.o,i=e.b,n=e.y,m=e.p,c=e.a2,g=e.q,p=e.t,h=e.s,f=e.F,v=e.f,_=e.l,b=e.as,y=e.i,V=e.h,S=e.v,N=e.g,C=e.z,k=e.B,w=e.C,x=e.D,U=e.at,D=e.ah,M=e.W,q=e.u,A=e.J,T=e.P,F=e.c,P=e.U,E=e.M,O=e.k,W=e.a3,j=e.L,B=e.N,$=e.n,I=e.m,L=e.a5,z=e.$,Q=e.a6,G=e.G},e=>{J=e.u},e=>{Z=e.u,H=e.a,K=e.b},e=>{R=e.u,X=e.a,Y=e._}],execute:function(){const a={class:"text-error"},ee=l({__name:"CustomersDeleteDialog",props:{isOpened:{type:Boolean},customer:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchCustomers"],setup(e,{emit:l}){const S=e,N=J(),C=s(),k=_(),w=o(!1),x=async()=>{try{w.value=!0,await b.deleteCustomer(S.customer.id),C.deleteCustomer(S.customer.id),S.isSearchActive&&l("updateSearchCustomers"),N.showMessage("success","Клиент был успешно удален!")}catch(e){if(y(e)){if(401===e.response?.status)return void k.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"customers-page"}});N.showMessage("error",V(e))}else N.showMessage("error","Ошибка при удалении клиента!")}finally{l("closeDialog"),w.value=!1}};return(l,s)=>(d(),t(u,{width:"auto","model-value":e.isOpened,persistent:!0,transition:"dialog-bottom-transition"},{default:r((()=>[i(v,{color:"white",class:"pa-4","max-width":450},{default:r((()=>[i(n,{class:"text-h5 mb-4 pa-0 font-weight-bold"},{default:r((()=>[m("Подтвердите удаление клиента")])),_:1}),i(c,{class:"text-h6 mb-4 pa-0"},{default:r((()=>[m(" Вы уверены что хотиет удалить клиента "),g("span",a,p(e.customer.firstName+" "+e.customer.secondName),1),m(" ? ")])),_:1}),i(h,{class:"justify-center pa-0"},{default:r((()=>[i(f,{onClick:s[0]||(s[0]=e=>l.$emit("closeDialog")),height:"40",color:"blue-darken-4",variant:"flat"},{default:r((()=>[m(" Нет ")])),_:1}),i(f,{height:"40",color:"error",variant:"flat",loading:w.value,onClick:x},{default:r((()=>[m("Да")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),ae=g("p",{class:"text-h6"},"Премиум клиент",-1),le=l({__name:"CustomersAddDialog",props:{isOpened:{type:Boolean}},emits:["closeDialog"],setup(e,{emit:a}){const{userCustomerSchema:l}=Z(),{resetForm:o,handleSubmit:c,isSubmitting:g}=H({validationSchema:l}),{value:p,errorMessage:D}=K("firstName"),{value:M,errorMessage:q}=K("secondName"),{value:A,errorMessage:T}=K("thirdName"),{value:F,errorMessage:P}=K("phone"),{value:E,errorMessage:O}=K("premium");E.value="Нет";const W=J(),j=s(),B=_(),$=c((async e=>{try{const{data:a}=await b.addCustomer(e);j.addCustomer({...e,id:a.customerId,fullName:e.secondName+" "+e.firstName+" "+e.thirdName}),W.showMessage("success","Клиент "+e.secondName+" был успешно добавлен!")}catch(l){if(y(l)){if(401===l.response?.status)return void B.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"customers-page"}});W.showMessage("error",V(l))}else W.showMessage("error","Ошибка при добавлении клиента")}finally{a("closeDialog"),o()}}));return(l,s)=>(d(),t(u,{"model-value":e.isOpened,"onUpdate:modelValue":s[6]||(s[6]=e=>a("closeDialog")),width:"auto",scrollable:"",transition:"dialog-bottom-transition"},{default:r((()=>[i(v,{color:"white",class:"pa-4",width:"450"},{default:r((()=>[i(n,{class:"font-weight-bold text-h6 mb-3"},{default:r((()=>[m(" Добавление нового клиента ")])),_:1}),i(h,null,{default:r((()=>[i(S,{onSubmit:N($)},{default:r((()=>[i(C,null,{default:r((()=>[i(k,{cols:"12"},{default:r((()=>[i(w,{modelValue:N(p),"onUpdate:modelValue":s[0]||(s[0]=e=>x(p)?p.value=e:null),"error-messages":N(D),label:"Имя"},null,8,["modelValue","error-messages"])])),_:1}),i(k,{cols:"12"},{default:r((()=>[i(w,{modelValue:N(M),"onUpdate:modelValue":s[1]||(s[1]=e=>x(M)?M.value=e:null),"error-messages":N(q),label:"Фамилия"},null,8,["modelValue","error-messages"])])),_:1}),i(k,{cols:"12"},{default:r((()=>[i(w,{modelValue:N(A),"onUpdate:modelValue":s[2]||(s[2]=e=>x(A)?A.value=e:null),"error-messages":N(T),label:"Отчество"},null,8,["modelValue","error-messages"])])),_:1}),i(k,{cols:"12"},{default:r((()=>[i(w,{label:"Номер телефона",modelValue:N(F),"onUpdate:modelValue":s[3]||(s[3]=e=>x(F)?F.value=e:null),"error-messages":N(P)},null,8,["modelValue","error-messages"])])),_:1}),i(k,{cols:"12"},{default:r((()=>[ae,i(U,{modelValue:N(E),"onUpdate:modelValue":s[4]||(s[4]=e=>x(E)?E.value=e:null),"true-value":"Да","false-value":"Нет","hide-details":"",label:N(E),color:"indigo","error-messages":N(O)},null,8,["modelValue","label","error-messages"])])),_:1}),i(k,{cols:"12"},{default:r((()=>[i(f,{color:"green-darken-4",variant:"flat",type:"submit",loading:N(g)},{default:r((()=>[m(" Добавить ")])),_:1},8,["loading"]),i(f,{color:"blue-darken-4",variant:"flat",onClick:s[5]||(s[5]=e=>l.$emit("closeDialog"))},{default:r((()=>[m(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),se=g("p",{class:"text-h6"},"Премиум клиент ?",-1),oe=l({__name:"CustomersEditDialog",props:{isOpened:{type:Boolean},customer:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchCustomers"],setup(e,{emit:a}){const l=e,o=D((()=>({firstName:l.customer.firstName,secondName:l.customer.secondName,thirdName:l.customer.thirdName,phone:l.customer.phone,premium:l.customer.premium}))),{userCustomerSchema:c}=Z(),{resetForm:g,handleSubmit:p,isSubmitting:M}=H({validationSchema:c,initialValues:o}),{value:q,errorMessage:A}=K("firstName"),{value:T,errorMessage:F}=K("secondName"),{value:P,errorMessage:E}=K("thirdName"),{value:O,errorMessage:W}=K("phone"),{value:j}=K("premium"),B=J(),$=s(),I=_(),L=p((async e=>{console.log(e);try{await b.updateCustomer(e,l.customer.id),$.updateCustomer({...e,id:l.customer.id,fullName:e.secondName+" "+e.firstName+" "+e.thirdName}),l.isSearchActive&&a("updateSearchCustomers"),B.showMessage("success","Клиент был успешно изменен")}catch(s){if(y(s)){if(401===s.response?.status)return void I.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"customers-page"}});B.showMessage("error",V(s))}else B.showMessage("error","Ошибка при изменении клиента")}finally{g(),a("closeDialog")}}));return(a,l)=>(d(),t(u,{"model-value":e.isOpened,"onUpdate:modelValue":l[6]||(l[6]=e=>a.$emit("closeDialog")),scrollable:"",width:"auto"},{default:r((()=>[i(v,{width:"450",color:"white",class:"pa-4"},{default:r((()=>[i(n,{class:"text-h6 font-weight-bold"},{default:r((()=>[m(" Редактирование клиента ")])),_:1}),i(h,null,{default:r((()=>[i(S,{onSubmit:N(L)},{default:r((()=>[i(C,null,{default:r((()=>[i(k,{cols:"12"},{default:r((()=>[i(w,{modelValue:N(q),"onUpdate:modelValue":l[0]||(l[0]=e=>x(q)?q.value=e:null),"error-messages":N(A),label:"Имя"},null,8,["modelValue","error-messages"])])),_:1}),i(k,{cols:"12"},{default:r((()=>[i(w,{modelValue:N(T),"onUpdate:modelValue":l[1]||(l[1]=e=>x(T)?T.value=e:null),"error-messages":N(F),label:"Фамилия"},null,8,["modelValue","error-messages"])])),_:1}),i(k,{cols:"12"},{default:r((()=>[i(w,{modelValue:N(P),"onUpdate:modelValue":l[2]||(l[2]=e=>x(P)?P.value=e:null),"error-messages":N(E),label:"Отчество"},null,8,["modelValue","error-messages"])])),_:1}),i(k,{cols:"12"},{default:r((()=>[i(w,{label:"Номер телефона",modelValue:N(O),"onUpdate:modelValue":l[3]||(l[3]=e=>x(O)?O.value=e:null),"error-messages":N(W)},null,8,["modelValue","error-messages"])])),_:1}),i(k,{cols:"12"},{default:r((()=>[se,i(U,{modelValue:N(j),"onUpdate:modelValue":l[4]||(l[4]=e=>x(j)?j.value=e:null),"true-value":"Да","false-value":"Нет","hide-details":"",label:N(j),color:"indigo"},null,8,["modelValue","label"])])),_:1}),i(k,{cols:"12"},{default:r((()=>[i(f,{color:"green-darken-4",variant:"flat",type:"submit",loading:N(M)},{default:r((()=>[m(" Обновить ")])),_:1},8,["loading"]),i(f,{color:"blue-darken-4",variant:"flat",onClick:l[5]||(l[5]=e=>a.$emit("closeDialog"))},{default:r((()=>[m(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),te={class:"text-h6"},re=g("h2",{class:"title text-h2 mb-5"},"Клиенты",-1),ue=g("span",{class:"text-wrap"}," Сбросить поиск",-1),de=g("span",{class:"text-wrap"}," Закрыть поиск",-1);e("default",l({__name:"CustomersView",setup(e){const a=s(),l=J(),u=q(),n=o([{fieldText:"Имя",fieldName:"firstName"},{fieldText:"Фамилия",fieldName:"secondName"},{fieldText:"Отчество",fieldName:"thirdName"},{fieldText:"Телефон",fieldName:"phone"},{fieldText:"Есть премиум",fieldName:"premium"}]),c=o("firstName"),{customers:h,customersErrorMessage:S}=A(a),{isAddDialogActive:D,isEditDialogActive:Z,isDeleteDialogActive:H,itemToEdit:K,openDialog:ae}=R(),se=O(),ie=_(),{isSearchFormActive:ne,isSearchLoading:me,searchWithPremium:ce,premium:ge,isSearchActive:pe,secondName:he,searchedCustomers:fe,addSearchQuery:ve,resetSearch:_e,searchUserCustomers:be}=((e,a,l)=>{const s=J(),t=o(e.query.secondName||""),r=o(+e.query.premium||0),u=o(!1),d=o([]),i=o(!1),n=o(!1),m=o(!1),c=async()=>{try{n.value=!0;const{data:a}=await b.getSearchedCustomers({userId:l,premium:+e.query.premium,secondName:e.query.secondName,searchWithPremium:e.query.searchWithPremium});d.value=a.customers,i.value=!0}catch(a){y(a)?s.showMessage("error",V(a)):s.showMessage("error","Ошибка при поиске товаров!")}finally{n.value=!1}};return M([()=>e.query.secondName,()=>e.query.premium,()=>e.query.searchWithPremium],(async()=>{(void 0!==e.query.secondName||e.query.premium)&&c()}),{immediate:!0}),{premium:r,searchWithPremium:u,isSearchFormActive:m,isSearchActive:i,isSearchLoading:n,secondName:t,searchedCustomers:d,searchUserCustomers:c,addSearchQuery:()=>{a.push({name:"customers-page",query:{...e.query,secondName:t.value,searchWithPremium:String(u.value),premium:r.value}})},resetSearch:()=>{t.value="",u.value=!1,r.value=0,i.value=!1,d.value=[],a.push({name:"customers-page",query:{}})}}})(se,ie,u.currentUser.id),ye=T((()=>pe.value?fe.value:h.value)),{currentPage:Ve,paginatedElements:Se,isInverseSort:Ne,elementsPerPageCount:Ce,totalPages:ke,setSortField:we}=X({tableElements:ye,pageName:"customers-page",sortField:c,route:se,router:ie});return(e,a)=>{const s=G("TableActions");return d(),F("div",null,[i(P,{modelValue:N(l).isMessageShown,"onUpdate:modelValue":a[0]||(a[0]=e=>N(l).isMessageShown=e),color:N(l).messageType,"location-strategy":"connected"},{default:r((()=>[g("p",te,p(N(l).messageText),1)])),_:1},8,["modelValue","color"]),re,i(v,{color:"white",elevation:"3",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:r((()=>[i(s,{count:N(Ce),"onUpdate:count":a[1]||(a[1]=e=>x(Ce)?Ce.value=e:null),onToggleAddDialog:a[2]||(a[2]=e=>D.value=!0),onToggleSearch:a[3]||(a[3]=e=>ne.value=!N(ne)),"is-badge-active":void 0!==e.$route.query.secondName},{default:r((()=>[m(" Все клиенты ")])),_:1},8,["count","is-badge-active"]),i(W,null,{default:r((()=>[N(ne)?(d(),t(C,{key:0,class:"mb-5",align:"center"},{default:r((()=>[i(k,{sm:"8",cols:"12"},{default:r((()=>[i(w,{label:"Имя клиента",modelValue:N(he),"onUpdate:modelValue":a[4]||(a[4]=e=>x(he)?he.value=e:null),"onClick:clear":a[5]||(a[5]=e=>he.value="")},null,8,["modelValue"])])),_:1}),i(k,{sm:"auto",cols:"6"},{default:r((()=>[i(j,{modelValue:N(ce),"onUpdate:modelValue":a[6]||(a[6]=e=>x(ce)?ce.value=e:null),color:"indigo-darken-4",label:"Искать с премиумом"},null,8,["modelValue"])])),_:1}),i(B,{"leave-absolute":!0},{default:r((()=>[N(ce)?(d(),t(k,{key:0,sm:"auto",cols:"6"},{default:r((()=>[i(U,{modelValue:N(ge),"onUpdate:modelValue":a[7]||(a[7]=e=>x(ge)?ge.value=e:null),"true-value":1,"false-value":0,color:"indigo-darken-4",label:"Есть премиум?"},null,8,["modelValue"])])),_:1})):E("",!0)])),_:1}),i(k,{cols:"12"},{default:r((()=>[i(C,null,{default:r((()=>[i(k,{sm:"auto",cols:"6"},{default:r((()=>[i(f,{variant:"flat",disabled:N(me),color:"green-darken-3",onClick:N(ve),block:""},{default:r((()=>[m(" Искать ")])),_:1},8,["disabled","onClick"])])),_:1}),i(k,{sm:"auto",cols:"6"},{default:r((()=>[i(f,{variant:"flat",disabled:N(me),color:"error",onClick:N(_e),block:""},{default:r((()=>[ue])),_:1},8,["disabled","onClick"])])),_:1}),i(k,{sm:"auto",cols:"12"},{default:r((()=>[i(f,{variant:"flat",disabled:N(me),color:"blue-darken-4",onClick:a[8]||(a[8]=e=>ne.value=!1),block:""},{default:r((()=>[de])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1})):E("",!0)])),_:1}),N(S)?(d(),t(I,{key:0,type:"error",border:"end",variant:"tonal"},{default:r((()=>[i($,{class:"mb-2"},{default:r((()=>[m(" Ошибка при загрузке клиентов")])),_:1}),g("p",null,p(N(S)),1)])),_:1})):N(me)?E("",!0):(d(),t(Y,{key:1,items:N(Se),fields:n.value,"current-sort-field":c.value,onUpdateSortField:a[9]||(a[9]=e=>N(we)(e)),"is-inverse-sort":N(Ne),onOpenDialog:a[10]||(a[10]=(e,a)=>N(ae)(e,a)),"no-data-text":"Клиенты не найдены"},null,8,["items","fields","current-sort-field","is-inverse-sort"])),N(me)?(d(),t(z,{key:2,class:"text-center mb-2"},{default:r((()=>[i(L,{indeterminate:"",size:"32",color:"green"})])),_:1})):E("",!0),N(ye).length?(d(),t(Q,{key:3,length:N(ke),modelValue:N(Ve),"onUpdate:modelValue":a[11]||(a[11]=e=>x(Ve)?Ve.value=e:null),rounded:"circle","total-visible":7,color:"deep-purple-darken-4"},null,8,["length","modelValue"])):E("",!0)])),_:1}),N(K)?(d(),t(ee,{key:0,"is-opened":N(H),onCloseDialog:a[12]||(a[12]=e=>H.value=!1),"is-search-active":N(pe),onUpdateSearchCustomers:N(be),customer:N(K)},null,8,["is-opened","is-search-active","onUpdateSearchCustomers","customer"])):E("",!0),N(K)?(d(),t(oe,{key:1,"is-opened":N(Z),onCloseDialog:a[13]||(a[13]=e=>Z.value=!1),"is-search-active":N(pe),onUpdateSearchCustomers:N(be),customer:N(K)},null,8,["is-opened","is-search-active","onUpdateSearchCustomers","customer"])):E("",!0),i(le,{"is-opened":N(D),onCloseDialog:a[14]||(a[14]=e=>D.value=!1)},null,8,["is-opened"])])}}}))}}}));
