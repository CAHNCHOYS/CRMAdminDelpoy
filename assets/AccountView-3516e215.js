import{d as M,u as R,x as X,r as p,y as O,o as D,c as F,b as e,e as o,l as n,t as q,f as s,j as I,m as B,i as a,k as Y,h as Z,p as ee,n as te,_ as oe,q as ae}from"./index-138f5097.js";import{u as G,a as H,b as T}from"./useFormSchemas-56e55025.js";const se=n("div",{class:"text-h5 mb-4"},"Общая информация об аккаунте",-1),le=n("div",{class:"text-h6"},"Данные были успешно обновлены!",-1),re=n("p",{class:"text-h6"},"Ошибка: ",-1),ne={class:"d-flex flex-sm-row flex-column align-sm-center"},ue=n("span",{class:"text-h6"},"Обновить данные ",-1),de=M({__name:"AccountInfo",setup(U){const c=R(),A=X(()=>{var r,t,g;return{name:((r=c.currentUser)==null?void 0:r.name)||"user logged out",email:((t=c.currentUser)==null?void 0:t.email)||"user logged out",country:((g=c.currentUser)==null?void 0:g.country)||"user logged out",avatar:[]}}),{updateInfoShchema:x}=G(),{handleSubmit:i,isSubmitting:V}=H({validationSchema:x,initialValues:A}),{value:y,errorMessage:w}=T("name"),{value:f,errorMessage:S}=T("email"),{value:k,errorMessage:b}=T("country"),{value:_,errorMessage:P}=T("avatar"),m=p(!1),u=p(!1),E=p(""),N=i(async r=>{let t=new FormData;t.append("name",r.name),t.append("email",r.email),t.append("country",r.country),t.append("avatar",r.avatar[0],_.value[0].name),t.append("id",String(c.currentUser.id));const g=await O({url:"/UpdateUserInfo",method:"patch",body:t,settings:{headers:{"Content-Type":"multipart/form-data"}}});if("error"in g)u.value=!0,E.value=g.error,setTimeout(()=>u.value=!1,3500);else{const $=await c.updateUserToken();$.error?(u.value=!0,E.value=$.error,setTimeout(()=>u.value=!1,3500)):$.isTokenUpdated&&(m.value=!0,setTimeout(()=>m.value=!1,3500))}}),C=p("");async function l(r){const t=r.target.files[0];C.value=URL.createObjectURL(t),console.log(URL.createObjectURL(t))}function h(){C.value=""}return(r,t)=>{const g=a("v-snackbar"),$=a("v-avatar"),L=a("v-file-input"),d=a("v-col"),z=a("v-text-field"),J=a("v-select"),K=a("v-btn"),Q=a("v-row"),W=a("v-form");return D(),F("div",null,[se,e(g,{location:"right bottom","max-width":400,color:"success",modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=v=>m.value=v)},{default:o(()=>[le]),_:1},8,["modelValue"]),e(g,{location:"right bottom",color:"error","max-width":400,modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=v=>u.value=v)},{default:o(()=>[re,n("p",null,q(E.value),1)]),_:1},8,["modelValue"]),e(W,{onSubmit:B(s(N),["prevent"]),enctype:"multipart/form-data"},{default:o(()=>[e(Q,{align:"center"},{default:o(()=>[e(d,{md:"6",cols:"12"},{default:o(()=>[n("div",ne,[e($,{size:"80",class:"mr-sm-3 mb-sm-0 mb-4 border mx-auto",image:C.value||`http://localhost:3000/UserAvatars/${s(c).currentUser.avatar}`},null,8,["image"]),e(L,{modelValue:s(_),"onUpdate:modelValue":t[2]||(t[2]=v=>I(_)?_.value=v:null),"error-messages":s(P),"show-size":"","prepend-icon":"mdi-camera","hide-details":"auto",label:"Загрузите ваш аватар",accept:".jpg, .png, .jpeg, .svg , .webp",onChange:l,"onClick:clear":h},null,8,["modelValue","error-messages"])])]),_:1}),e(d,{sm:"6",cols:"12"},{default:o(()=>[e(z,{modelValue:s(y),"onUpdate:modelValue":t[3]||(t[3]=v=>I(y)?y.value=v:null),"error-messages":s(w),label:"Ваше имя"},null,8,["modelValue","error-messages"])]),_:1}),e(d,{sm:"6",cols:"12"},{default:o(()=>[e(z,{modelValue:s(f),"onUpdate:modelValue":t[4]||(t[4]=v=>I(f)?f.value=v:null),"error-messages":s(S),label:"Ваша почта"},null,8,["modelValue","error-messages"])]),_:1}),e(d,{sm:"6",cols:"12"},{default:o(()=>[e(J,{modelValue:s(k),"onUpdate:modelValue":t[5]||(t[5]=v=>I(k)?k.value=v:null),"error-messages":s(b),items:["Россия","Беларусь","Латвия","Украина","Казахстан","Узбекистан"],label:"Страна проживания"},null,8,["modelValue","error-messages"])]),_:1}),e(d,{cols:"12"},{default:o(()=>[e(K,{type:"submit",variant:"flat",loading:s(V),color:"green"},{default:o(()=>[ue]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}}}),ce=n("div",{class:"text-h5 mb-3"},"Безопасность",-1),ie=n("p",{class:"text-h6 mb-1"},"Ошибка:",-1),me={class:"text-h6"},pe=n("p",{class:"text-h6"},"Пароль был успешно обновлен !",-1),_e=n("span",{class:"text-white text-h6"},"Обновить пароль",-1),ve=M({__name:"AccountSecurity",setup(U){const{updatePasswordSchema:c}=G(),{handleSubmit:A,isSubmitting:x,resetForm:i}=H({validationSchema:c}),{value:V,errorMessage:y}=T("oldPassword"),{value:w,errorMessage:f}=T("newPassword"),{value:S,errorMessage:k}=T("newPasswordConfirm"),b=p(!1),_=p(!1),P=p(""),m=p(!1),u=p(!1),E=R(),N=A(async C=>{const l=E.currentUser.id;let h=await O({url:"/UpdateUserPassword",method:"patch",body:{...C,id:l}});if(console.log(h),"error"in h)b.value=!0,P.value=h.error,setTimeout(()=>b.value=!1,3500);else if(h.isInfoUpdated){const r=await E.updateUserToken();r.error?(b.value=!0,P.value=r.error,setTimeout(()=>b.value=!1,3500)):r.isTokenUpdated&&(_.value=!0,setTimeout(()=>_.value=!1,3500),i())}});return(C,l)=>{const h=a("v-snackbar"),r=a("v-text-field"),t=a("v-col"),g=a("v-btn"),$=a("v-row"),L=a("v-form");return D(),F("div",null,[ce,e(h,{modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=d=>b.value=d),color:"error",location:"bottom right"},{default:o(()=>[ie,n("p",me,q(P.value),1)]),_:1},8,["modelValue"]),e(h,{modelValue:_.value,"onUpdate:modelValue":l[1]||(l[1]=d=>_.value=d),color:"success",location:"bottom right"},{default:o(()=>[pe]),_:1},8,["modelValue"]),e(L,{onSubmit:B(s(N),["prevent"])},{default:o(()=>[e($,null,{default:o(()=>[e(t,{cols:"12"},{default:o(()=>[e(r,{modelValue:s(V),"onUpdate:modelValue":l[2]||(l[2]=d=>I(V)?V.value=d:null),"error-messages":s(y),label:"Старый пароль",type:u.value?"text":"password","append-inner-icon":u.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":l[3]||(l[3]=d=>u.value=!u.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1}),e(t,{sm:"6",cols:"12"},{default:o(()=>[e(r,{label:"Новый пароль",modelValue:s(w),"onUpdate:modelValue":l[4]||(l[4]=d=>I(w)?w.value=d:null),"error-messages":s(f),type:m.value?"text":"password","append-inner-icon":m.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":l[5]||(l[5]=d=>m.value=!m.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])]),_:1}),e(t,{sm:"6",cols:"12"},{default:o(()=>[e(r,{modelValue:s(S),"onUpdate:modelValue":l[6]||(l[6]=d=>I(S)?S.value=d:null),"error-messages":s(k),label:"Повторите новый пароль",type:m.value?"text":"password"},null,8,["modelValue","error-messages","type"])]),_:1}),e(t,{cols:"12"},{default:o(()=>[e(g,{type:"submit",loading:s(x),variant:"flat",color:"green"},{default:o(()=>[_e]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}}}),j=U=>(ee("data-v-b12ba411"),U=U(),te(),U),fe=j(()=>n("div",{class:"text-h5 mb-4"},"Удаление аккаунта",-1)),be={class:"text-h6"},ge=j(()=>n("p",{class:"text-h6"},"Отменить это действие будет невозможно",-1)),we={class:"mb-2"},he=j(()=>n("span",{class:"font-weight-bold"},"Я хочу удалить аккаунт ",-1)),xe=j(()=>n("span",{class:"text-h6"},"Удалить аккаунт",-1)),Ve=M({__name:"AccountDeletion",setup(U){const c=R(),A=Z(),x=p(!1),i=p(!1),V=p(""),y=async()=>{if(!x.value||!window.confirm("Вы точно уверены?"))return;const w=await O({method:"delete",url:"/DeleteAccount"+c.currentUser.id});"error"in w?(i.value=!0,V.value=w.error,setTimeout(()=>i.value=!1,3500)):(c.logOutUser(),A.push({name:"login-page"}))};return(w,f)=>{const S=a("v-snackbar"),k=a("v-alert-title"),b=a("v-alert"),_=a("v-checkbox"),P=a("v-btn"),m=a("v-form");return D(),F("div",null,[fe,e(S,{modelValue:i.value,"onUpdate:modelValue":f[0]||(f[0]=u=>i.value=u),location:"bottom right",color:"error"},{default:o(()=>[n("p",be,q(V.value),1)]),_:1},8,["modelValue"]),e(m,{onSubmit:B(y,["prevent"])},{default:o(()=>[e(b,{border:"end",variant:"tonal",color:"red-darken-2"},{default:o(()=>[e(k,{class:"text-h6 mb-1"},{default:o(()=>[Y("Вы уверены что хотите удалить аккаунт?")]),_:1}),ge]),_:1}),n("p",we,[e(_,{modelValue:x.value,"onUpdate:modelValue":f[1]||(f[1]=u=>x.value=u),rules:[u=>!!u||"Подтвердите удаление аккаунта"],required:"",color:"red-darken-2",class:"text-red-darken-4"},{label:o(()=>[he]),_:1},8,["modelValue","rules"])]),e(P,{type:"submit",color:"error"},{default:o(()=>[xe]),_:1})]),_:1},8,["onSubmit"])])}}});const Ue=oe(Ve,[["__scopeId","data-v-b12ba411"]]),ye={key:0},Se=n("div",{class:"title text-h2 mb-5"},"Аккаунт",-1),$e=M({__name:"AccountView",setup(U){const c=R();return(A,x)=>{const i=a("v-card");return s(c).currentUser?(D(),F("div",ye,[Se,e(i,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:o(()=>[e(de)]),_:1}),e(i,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:o(()=>[e(ve)]),_:1}),e(i,{color:"white",elevation:"2",class:"pa-5 rounded-lg mx-sm-0 mx-n5"},{default:o(()=>[e(Ue)]),_:1})])):ae("",!0)}}});export{$e as default};
