import{d as D,r as O,u as P,A as G,a as H,i as J,h as K,w as Q,c as W,b as e,e as t,f as s,g as X,j as Y,k as a,o as Z,l as f,t as y,m as i,n as ee,p as S,q as te,s as oe,_ as se}from"./index-6bc77bae.js";import{u as ae}from"./alert-ad4a9987.js";import{u as re,a as ne,b as k}from"./useFormSchemas-2bba9048.js";const le=""+new URL("bg-ffc91902.png",import.meta.url).href,v=c=>(te("data-v-82b06e6a"),c=c(),oe(),c),ie={class:"fullscreen h-100 d-flex justify-center align-center"},ce={class:"text-white text-h6"},de=v(()=>i("div",{class:"form-title text-center text-h4 py-4"},"Авторизация",-1)),ue=v(()=>i("span",{class:"text-white text-h6 font-weight-medium"},"Войти",-1)),me={class:"mt-2"},_e=v(()=>i("span",{class:"text-decoration-underline text-green"}," Зарегистрироваться ",-1)),pe=D({__name:"LoginView",setup(c){const{loginSchema:V}=re(),{handleSubmit:M,isSubmitting:h,resetForm:A}=ne({validationSchema:V}),{value:m,errorMessage:E}=k("email"),{value:_,errorMessage:F}=k("password"),d=O(!1),u=P(),r=ae(),n=X(),x=Y(),T=M(async b=>{try{const{data:o}=await G.login(b);u.setToken(o.token),u.setUser(o.user),await u.fetchData(),H.defaults.headers.common.Authorization=`Bearer ${o.token}`,r.showMessage("success","Авторизация успешна, вскоре вы будете переведены на сайт"),setTimeout(()=>{n.query.redirectedFrom?x.push({name:n.query.redirectedFrom}):x.push("/")},3500)}catch(o){J(o)?r.showMessage("error",K(o)):r.showMessage("error","Ошибка при авторизации, попробуйте позже")}finally{A()}});return Q(()=>{n.query.redirectedFrom&&!n.query.isExpiredToken&&r.showMessage("error",`Для доступа к странице ${n.query.redirectedFrom} необходимо авторизироваться`),n.query.isExpiredToken&&(r.showMessage("error","Сеанс авторизации истек, войдите в аккаунт снова!"),u.logOutUser())}),(b,o)=>{const q=a("v-alert-title"),U=a("v-alert"),B=a("v-dialog-transition"),I=a("v-card-title"),p=a("v-icon"),w=a("v-text-field"),g=a("v-col"),z=a("v-btn"),C=a("router-link"),L=a("v-row"),R=a("v-form"),N=a("v-card-actions"),$=a("v-card"),j=a("v-img");return Z(),W("div",ie,[e(B,null,{default:t(()=>[e(U,{class:"alert",type:s(r).messageType,"max-width":400,modelValue:s(r).isMessageShown,"onUpdate:modelValue":o[0]||(o[0]=l=>s(r).isMessageShown=l)},{default:t(()=>[e(q,{class:"text-h4 mb-2"},{default:t(()=>[f(y(s(r).messageType==="error"?"Ошибка":"Уведомление"),1)]),_:1}),i("div",ce,y(s(r).messageText),1)]),_:1},8,["type","modelValue"])]),_:1}),e($,{class:"form-card flex-grow-1 pb-8 rounded-lg","max-width":486,elevation:0},{default:t(()=>[de,e(N,{class:"pt-4 pb-1 px-lg-10 px-md-8 px-4"},{default:t(()=>[e(R,{onSubmit:ee(s(T),["prevent"]),class:"w-100"},{default:t(()=>[e(I,{class:"text-indigo-darken-2 text-center mb-2"},{default:t(()=>[f(" Введите ваши данные")]),_:1}),e(L,null,{default:t(()=>[e(g,{cols:"12"},{default:t(()=>[e(w,{modelValue:s(m),"onUpdate:modelValue":o[1]||(o[1]=l=>S(m)?m.value=l:null),"error-messages":s(E),"bg-color":"rgba(229, 229, 229, 0.25)",placeholder:"Ваша почта",hint:"Ваша почта при регистрации",clearable:""},{"prepend-inner":t(()=>[e(p,{icon:"mdi-email",class:"icon mr-lg-3 mr-1",size:"large"})]),_:1},8,["modelValue","error-messages","bg-color"])]),_:1}),e(g,{cols:"12"},{default:t(()=>[e(w,{modelValue:s(_),"onUpdate:modelValue":o[3]||(o[3]=l=>S(_)?_.value=l:null),"error-messages":s(F),"bg-color":"rgba(229, 229, 229, 0.25)",placeholder:"Ваш пароль",hint:"Ваш пароль при регистрации",type:d.value?"text":"password",clearable:""},{"prepend-inner":t(()=>[e(p,{icon:"mdi-lock",class:"icon mr-lg-3 mr-1",size:"large"})]),"append-inner":t(()=>[e(p,{onClick:o[2]||(o[2]=l=>d.value=!d.value),class:"text-dark-blue",icon:d.value?"mdi-eye":"mdi-eye-off",size:"large"},null,8,["icon"])]),_:1},8,["modelValue","error-messages","bg-color","type"])]),_:1}),e(g,null,{default:t(()=>[e(z,{type:"submit",loading:s(h),disabled:s(h)||s(r).isMessageShown,block:"",color:"dark-blue",variant:"flat"},{default:t(()=>[ue]),_:1},8,["loading","disabled"]),i("p",me,[e(C,{to:{name:"register-page"},class:"text-black text-h6"},{default:t(()=>[f("Нет аккаунта? "),_e]),_:1})])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1}),e(j,{class:"bg-image",cover:"",src:s(le),alt:"OfficePic"},null,8,["src"])])}}});const he=se(pe,[["__scopeId","data-v-82b06e6a"]]);export{he as default};
