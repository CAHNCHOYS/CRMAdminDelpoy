import{d as E,r as I,u as q,A as B,a as U,i as z,h as R,w as D,c as L,b as e,e as s,V as N,f as $,g as t,j,k as O,l as P,o as G,m as H,n as J,p,t as V,q as n,s as K,v as Q,x as W,y as X,z as Y,B as g,C as b,D as v,E as f,F as Z,G as ee,H as se,I as ae,_ as te}from"./index-42528f6a.js";import{u as oe}from"./alert-45d0e397.js";import{u as re,a as le,b as y}from"./useFormSchemas-05520230.js";const ne=""+new URL("bg-ffc91902.png",import.meta.url).href,_=i=>(se("data-v-33716225"),i=i(),ae(),i),ie={class:"fullscreen h-100 d-flex justify-center align-center"},de={class:"text-white text-h6"},ce=_(()=>n("div",{class:"form-title text-center text-h4 py-4"},"Авторизация",-1)),ue=_(()=>n("span",{class:"text-white text-h6 font-weight-medium"},"Войти",-1)),me={class:"mt-2"},pe=_(()=>n("span",{class:"text-decoration-underline text-green"}," Зарегистрироваться ",-1)),ge=E({__name:"LoginView",setup(i){const{loginSchema:S}=re(),{handleSubmit:k,isSubmitting:h,resetForm:T}=le({validationSchema:S}),{value:u,errorMessage:A}=y("email"),{value:m,errorMessage:F}=y("password"),d=I(!1),c=q(),o=oe(),r=O(),x=P(),M=k(async w=>{try{const{data:a}=await B.login(w);c.setToken(a.token),c.setUser(a.user),await c.fetchData(),U.defaults.headers.common.Authorization=`Bearer ${a.token}`,o.showMessage("success","Авторизация успешна, вскоре вы будете переведены на сайт"),setTimeout(()=>{r.query.redirectedFrom?x.push({name:r.query.redirectedFrom}):x.push("/")},3500)}catch(a){z(a)?o.showMessage("error",R(a)):o.showMessage("error","Ошибка при авторизации, попробуйте позже")}finally{T()}});return D(()=>{r.query.redirectedFrom&&!r.query.isExpiredToken&&o.showMessage("error",`Для доступа к странице ${r.query.redirectedFrom} необходимо авторизироваться`),r.query.isExpiredToken&&(o.showMessage("error","Сеанс авторизации истек, войдите в аккаунт снова!"),c.logOutUser())}),(w,a)=>{const C=ee("router-link");return G(),L("div",ie,[e(N,null,{default:s(()=>[e(H,{class:"alert",type:t(o).messageType,"max-width":400,modelValue:t(o).isMessageShown,"onUpdate:modelValue":a[0]||(a[0]=l=>t(o).isMessageShown=l)},{default:s(()=>[e(J,{class:"text-h4 mb-2"},{default:s(()=>[p(V(t(o).messageType==="error"?"Ошибка":"Уведомление"),1)]),_:1}),n("div",de,V(t(o).messageText),1)]),_:1},8,["type","modelValue"])]),_:1}),e($,{class:"form-card flex-grow-1 pb-8 rounded-lg","max-width":486,elevation:0},{default:s(()=>[ce,e(K,{class:"pt-4 pb-1 px-lg-10 px-md-8 px-4"},{default:s(()=>[e(Q,{onSubmit:W(t(M),["prevent"]),class:"w-100"},{default:s(()=>[e(X,{class:"text-indigo-darken-2 text-center mb-2"},{default:s(()=>[p(" Введите ваши данные")]),_:1}),e(Y,null,{default:s(()=>[e(g,{cols:"12"},{default:s(()=>[e(b,{modelValue:t(u),"onUpdate:modelValue":a[1]||(a[1]=l=>v(u)?u.value=l:null),"error-messages":t(A),"bg-color":"rgba(229, 229, 229, 0.25)",placeholder:"Ваша почта",hint:"Ваша почта при регистрации",clearable:""},{"prepend-inner":s(()=>[e(f,{icon:"mdi-email",class:"icon mr-lg-3 mr-1",size:"large"})]),_:1},8,["modelValue","error-messages","bg-color"])]),_:1}),e(g,{cols:"12"},{default:s(()=>[e(b,{modelValue:t(m),"onUpdate:modelValue":a[3]||(a[3]=l=>v(m)?m.value=l:null),"error-messages":t(F),"bg-color":"rgba(229, 229, 229, 0.25)",placeholder:"Ваш пароль",hint:"Ваш пароль при регистрации",type:d.value?"text":"password",clearable:""},{"prepend-inner":s(()=>[e(f,{icon:"mdi-lock",class:"icon mr-lg-3 mr-1",size:"large"})]),"append-inner":s(()=>[e(f,{onClick:a[2]||(a[2]=l=>d.value=!d.value),class:"text-dark-blue",icon:d.value?"mdi-eye":"mdi-eye-off",size:"large"},null,8,["icon"])]),_:1},8,["modelValue","error-messages","bg-color","type"])]),_:1}),e(g,null,{default:s(()=>[e(Z,{type:"submit",loading:t(h),disabled:t(h)||t(o).isMessageShown,block:"",color:"dark-blue",variant:"flat"},{default:s(()=>[ue]),_:1},8,["loading","disabled"]),n("p",me,[e(C,{to:{name:"register-page"},class:"text-black text-h6"},{default:s(()=>[p("Нет аккаунта? "),pe]),_:1})])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1}),e(j,{class:"bg-image",cover:"",src:t(ne),alt:"OfficePic"},null,8,["src"])])}}});const xe=te(ge,[["__scopeId","data-v-33716225"]]);export{xe as default};
