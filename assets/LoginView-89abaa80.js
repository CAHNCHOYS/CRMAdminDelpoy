import{d as q,r as B,u as I,A as U,a as z,i as R,h as D,w as L,c as N,b as e,e as s,V as $,f as j,g as t,j as O,k as P,l as G,o as H,m as J,n as K,p as c,t as w,q as u,s as b,v as Q,x as W,y as X,z as Y,B as g,C as V,D as y,E as f,F as Z,G as ee,H as se,I as ae,_ as te}from"./index-619baa70.js";import{u as oe}from"./alert-163d7f92.js";import{u as re,a as le,b as v}from"./useFormSchemas-8a5fa9a3.js";const ne=""+new URL("bg-ffc91902.png",import.meta.url).href,S=n=>(se("data-v-643b41f6"),n=n(),ae(),n),ie={class:"fullscreen h-100 d-flex justify-center align-center"},de={class:"text-white text-h6"},ce=S(()=>u("span",{class:"text-white text-h6 font-weight-medium"},"Войти",-1)),ue={class:"mt-2"},me=S(()=>u("span",{class:"text-decoration-underline text-green"}," Зарегистрироваться ",-1)),pe=q({__name:"LoginView",setup(n){const{loginSchema:k}=re(),{handleSubmit:T,isSubmitting:_,resetForm:A}=le({validationSchema:k}),{value:m,errorMessage:F}=v("email"),{value:p,errorMessage:M}=v("password"),i=B(!1),d=I(),o=oe(),r=P(),h=G(),C=T(async x=>{try{const{data:a}=await U.login(x);d.setToken(a.accessToken),d.setUser(a.user),await d.fetchData(),z.defaults.headers.common.Authorization=`Bearer ${a.accessToken}`,o.showMessage("success","Авторизация успешна, вскоре вы будете переведены на сайт"),setTimeout(()=>{r.query.redirectedFrom?h.push({name:r.query.redirectedFrom}):h.push("/")},3500)}catch(a){console.log(a),R(a)?o.showMessage("error",D(a)):o.showMessage("error","Ошибка при авторизации, попробуйте позже")}finally{A()}});return L(()=>{r.query.redirectedFrom&&!r.query.isExpiredToken&&o.showMessage("error",`Для доступа к странице ${r.query.redirectedFrom} необходимо авторизироваться`),r.query.isExpiredToken&&(o.showMessage("error","Сеанс авторизации истек, войдите в аккаунт снова!"),d.logOutUser())}),(x,a)=>{const E=ee("router-link");return H(),N("div",ie,[e($,null,{default:s(()=>[e(J,{class:"alert",type:t(o).messageType,"max-width":400,modelValue:t(o).isMessageShown,"onUpdate:modelValue":a[0]||(a[0]=l=>t(o).isMessageShown=l)},{default:s(()=>[e(K,{class:"text-h4 mb-2"},{default:s(()=>[c(w(t(o).messageType==="error"?"Ошибка":"Уведомление"),1)]),_:1}),u("div",de,w(t(o).messageText),1)]),_:1},8,["type","modelValue"])]),_:1}),e(j,{class:"form-card flex-grow-1 pb-8 rounded-lg","max-width":486,elevation:0},{default:s(()=>[e(b,{class:"form-title text-center text-h4 pa-0 py-4"},{default:s(()=>[c("Авторизация")]),_:1}),e(Q,{class:"pt-4 pb-1 px-lg-10 px-md-8 px-4"},{default:s(()=>[e(W,{onSubmit:X(t(C),["prevent"]),class:"w-100"},{default:s(()=>[e(b,{class:"text-indigo-darken-2 text-center mb-2"},{default:s(()=>[c(" Введите ваши данные")]),_:1}),e(Y,null,{default:s(()=>[e(g,{cols:"12"},{default:s(()=>[e(V,{modelValue:t(m),"onUpdate:modelValue":a[1]||(a[1]=l=>y(m)?m.value=l:null),"error-messages":t(F),"bg-color":"rgba(229, 229, 229, 0.25)",placeholder:"Ваша почта",hint:"Ваша почта при регистрации",clearable:""},{"prepend-inner":s(()=>[e(f,{icon:"mdi-email",class:"icon mr-lg-3 mr-1",size:"large"})]),_:1},8,["modelValue","error-messages","bg-color"])]),_:1}),e(g,{cols:"12"},{default:s(()=>[e(V,{modelValue:t(p),"onUpdate:modelValue":a[3]||(a[3]=l=>y(p)?p.value=l:null),"error-messages":t(M),"bg-color":"rgba(229, 229, 229, 0.25)",placeholder:"Ваш пароль",hint:"Ваш пароль при регистрации",type:i.value?"text":"password",clearable:""},{"prepend-inner":s(()=>[e(f,{icon:"mdi-lock",class:"icon mr-lg-3 mr-1",size:"large"})]),"append-inner":s(()=>[e(f,{onClick:a[2]||(a[2]=l=>i.value=!i.value),class:"text-dark-blue",icon:i.value?"mdi-eye":"mdi-eye-off",size:"large"},null,8,["icon"])]),_:1},8,["modelValue","error-messages","bg-color","type"])]),_:1}),e(g,null,{default:s(()=>[e(Z,{type:"submit",loading:t(_),disabled:t(_)||t(o).isMessageShown,block:"",color:"dark-blue",variant:"flat"},{default:s(()=>[ce]),_:1},8,["loading","disabled"]),u("p",ue,[e(E,{to:{name:"register-page"},class:"text-black text-h6"},{default:s(()=>[c("Нет аккаунта? "),me]),_:1})])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1}),e(O,{class:"bg-image",cover:"",src:t(ne),alt:"OfficePic"},null,8,["src"])])}}});const he=te(pe,[["__scopeId","data-v-643b41f6"]]);export{he as default};
