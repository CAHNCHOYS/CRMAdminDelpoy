System.register(["./index-legacy-1913095e.js","./alert-legacy-54ef0e32.js","./ElementsTable.vue_vue_type_script_setup_true_lang-legacy-c4071cfe.js","./useFormSchemas-legacy-0b14383d.js"],(function(e,a){"use strict";var l,t,r,o,s,u,d,i,c,n,m,v,p,g,f,h,y,_,b,P,x,S,M,V,k,w,U,A,q,C,T,E,D;return{setters:[e=>{l=e.r,t=e.D,r=e.P,o=e.i,s=e.h,u=e.d,d=e.z,i=e.E,c=e.v,n=e.y,m=e.e,v=e.j,p=e.k,g=e.o,f=e.b,h=e.n,y=e.f,_=e.p,b=e.l,P=e.t,x=e.m,S=e.u,M=e.B,V=e.c,k=e.x,w=e.g},e=>{U=e.u},e=>{A=e.u,q=e.a,C=e._},e=>{T=e.u,E=e.a,D=e.b}],execute:function(){const a=x("p",{class:"text-h6 font-weight-bold mb-4"},"Редактирование товара",-1),N=x("p",{class:"text-h6 mb-2"},"Загрузка категорий....",-1),F=u({__name:"ProductEditDialog",props:{isActive:{type:Boolean},product:null,isSearchActive:{type:Boolean}},emits:["closeModal","updateSearchProducts"],setup(e,{emit:l}){const t=e,u=d((()=>({name:t.product?.name||"Товар не был выбран",price:t.product?.price||0,count:t.product?.count||0,categoryId:t.product?.categoryId||0}))),{userProductSchema:x}=T(),{handleSubmit:S,isSubmitting:M,resetForm:V}=E({validationSchema:x,initialValues:u}),{value:k,errorMessage:w}=D("name"),{value:A,errorMessage:q}=D("price"),{value:C,errorMessage:F}=D("count"),{value:I,errorMessage:$}=D("categoryId"),j=i(),B=U(),{productsCategories:L,categoriesErrorMessage:z,isCategoriesLoading:Q}=c(j),O=v(),G=S((async e=>{try{await r.updateProduct(e,t.product.id);const a=L.value.find((a=>a.id===e.categoryId)).name;j.updateUserProduct({...e,category:a,id:t.product.id}),t.isSearchActive&&l("updateSearchProducts"),B.showMessage("success","Товар был изменен")}catch(a){if(o(a)){if(401===a.response?.status)return void O.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"products-page"}});B.showMessage("error",s(a))}else B.showMessage("error","Ошибка при обновлении товара!")}finally{V(),l("closeModal")}}));return(l,t)=>{const r=p("v-card-title"),o=p("v-text-field"),s=p("v-col"),u=p("v-progress-linear"),d=p("v-sheet"),i=p("v-autocomplete"),c=p("v-alert-title"),v=p("v-alert"),x=p("v-btn"),S=p("v-row"),V=p("v-form"),U=p("v-card-actions"),T=p("v-card"),E=p("v-dialog");return g(),n(E,{transition:"dialog-bottom-transition","max-width":"500","onUpdate:modelValue":t[5]||(t[5]=e=>l.$emit("closeModal")),"model-value":e.isActive},{default:m((()=>[f(T,{class:"pa-5",color:"white",elevation:"4"},{default:m((()=>[f(r,null,{default:m((()=>[a])),_:1}),f(U,null,{default:m((()=>[f(V,{onSubmit:h(y(G),["prevent"])},{default:m((()=>[f(S,null,{default:m((()=>[f(s,{cols:"12"},{default:m((()=>[f(o,{modelValue:y(k),"onUpdate:modelValue":t[0]||(t[0]=e=>_(k)?k.value=e:null),"error-messages":y(w),label:"Название товара"},null,8,["modelValue","error-messages"])])),_:1}),f(s,{cols:"12"},{default:m((()=>[y(Q)?(g(),n(d,{key:0},{default:m((()=>[N,f(u,{indeterminate:"",height:"6",color:"green"})])),_:1})):y(z)?(g(),n(d,{key:2},{default:m((()=>[f(v,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:m((()=>[f(c,{class:"text-h6"},{default:m((()=>[b(P(y(z)),1)])),_:1})])),_:1})])),_:1})):(g(),n(i,{key:1,modelValue:y(I),"onUpdate:modelValue":t[1]||(t[1]=e=>_(I)?I.value=e:null),label:"Категория товара","error-messages":y($),items:y(L),"item-title":"name",clearable:!1,"item-value":"id","no-data-text":"Нет категорий"},null,8,["modelValue","error-messages","items"]))])),_:1}),f(s,{sm:"6",cols:"12"},{default:m((()=>[f(o,{modelValue:y(C),"onUpdate:modelValue":t[2]||(t[2]=e=>_(C)?C.value=e:null),modelModifiers:{number:!0},"error-messages":y(F),label:"Количество",type:"number"},null,8,["modelValue","error-messages"])])),_:1}),f(s,{sm:"6",cols:"12"},{default:m((()=>[f(o,{modelValue:y(A),"onUpdate:modelValue":t[3]||(t[3]=e=>_(A)?A.value=e:null),modelModifiers:{number:!0},"error-messages":y(q),label:"Цена",type:"number",suffix:"руб"},null,8,["modelValue","error-messages"])])),_:1}),f(s,{cols:"12"},{default:m((()=>[f(x,{color:"green-darken-4",variant:"flat",loading:y(M),type:"submit"},{default:m((()=>[b(" Сохранить ")])),_:1},8,["loading"]),f(x,{color:"blue-darken-4",variant:"flat",onClick:t[4]||(t[4]=e=>l.$emit("closeModal"))},{default:m((()=>[b(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"])}}}),I=x("p",{class:"font-weight-bold text-h5"},"Подтверждение удаления",-1),$={class:"text-h6"},j={class:"text-red"},B=x("span",{class:"text-white"},"Нет",-1),L=u({__name:"ProductDeleteDialog",props:{product:null,isActive:{type:Boolean},isSearchActive:{type:Boolean}},emits:["closeModal","updateSearchProducts"],setup(e,{emit:a}){const t=e,u=l(!1),d=i(),c=U(),h=v(),y=async()=>{try{u.value=!0,await r.deleteProduct(t.product.id),d.deleteUserProduct(t.product.id),t.isSearchActive&&a("updateSearchProducts"),c.showMessage("success","Товар был успешно удален")}catch(e){if(o(e)){if(401===e.response?.status)return void h.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"products-page"}});c.showMessage("error",s(e))}else c.showMessage("error","Ошибка при удалении товара!")}finally{u.value=!1,a("closeModal")}};return(a,l)=>{const r=p("v-card-title"),o=p("v-card-text"),s=p("v-btn"),d=p("v-card-actions"),i=p("v-card"),c=p("v-dialog");return g(),n(c,{"model-value":e.isActive,"max-width":450,persistent:"",transition:"dialog-bottom-transition"},{default:m((()=>[f(i,{class:"pa-4"},{default:m((()=>[f(r,{class:"pa-0 mb-3"},{default:m((()=>[I])),_:1}),f(o,{class:"pa-0 mb-4"},{default:m((()=>[x("p",$,[b(" Вы уверены что хотите удалить товар "),x("span",j,P(t.product.name),1),b(" из списка? ")])])),_:1}),f(d,{class:"justify-center"},{default:m((()=>[f(s,{onClick:l[0]||(l[0]=e=>a.$emit("closeModal")),height:"40",color:"blue-darken-4",variant:"flat"},{default:m((()=>[B])),_:1}),f(s,{height:"40",loading:u.value,color:"error",variant:"flat",onClick:y},{default:m((()=>[b("Да")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["model-value"])}}}),z=x("p",{class:"text-h6 font-weight-bold mb-4"},"Добавление нового товара",-1),Q=x("p",{class:"text-h6 mb-2"},"Загрузка категорий....",-1),O=u({__name:"ProductAddDialog",props:{isActive:{type:Boolean}},emits:["closeModal"],setup(e,{emit:a}){const{userProductSchema:l}=T(),{handleSubmit:t,isSubmitting:u,resetForm:d}=E({validationSchema:l}),{value:x,errorMessage:S}=D("name"),{value:M,errorMessage:V}=D("categoryId"),{value:k,errorMessage:w}=D("count"),{value:A,errorMessage:q}=D("price"),C=i(),N=U(),{productsCategories:F,categoriesErrorMessage:I,isCategoriesLoading:$}=c(C),j=v(),B=t((async e=>{try{const{data:a}=await r.addProduct(e);console.log(e),C.addUserProduct({...e,...a}),N.showMessage("success",`Товар ${e.name} был успешно добавлен!`)}catch(l){if(o(l)){if(401===l.response?.status)return void j.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"products-page"}});N.showMessage("error",s(l))}else N.showMessage("error","Ошибка при добавлении товара !")}finally{d(),a("closeModal")}}));return(a,l)=>{const t=p("v-card-title"),r=p("v-text-field"),o=p("v-col"),s=p("v-progress-linear"),d=p("v-sheet"),i=p("v-autocomplete"),c=p("v-alert-title"),v=p("v-alert"),U=p("v-btn"),C=p("v-row"),T=p("v-form"),E=p("v-card-actions"),D=p("v-card"),N=p("v-dialog");return g(),n(N,{transition:"dialog-bottom-transition","max-width":"500","onUpdate:modelValue":l[5]||(l[5]=e=>a.$emit("closeModal")),scrollable:"","model-value":e.isActive},{default:m((()=>[f(D,{class:"pa-5",color:"white",elevation:"4"},{default:m((()=>[f(t,null,{default:m((()=>[z])),_:1}),f(E,null,{default:m((()=>[f(T,{onSubmit:h(y(B),["prevent"])},{default:m((()=>[f(C,null,{default:m((()=>[f(o,{cols:"12"},{default:m((()=>[f(r,{modelValue:y(x),"onUpdate:modelValue":l[0]||(l[0]=e=>_(x)?x.value=e:null),"error-messages":y(S),label:"Название товара"},null,8,["modelValue","error-messages"])])),_:1}),f(o,{cols:"12"},{default:m((()=>[y($)?(g(),n(d,{key:0},{default:m((()=>[Q,f(s,{indeterminate:"",height:"6",color:"green"})])),_:1})):y(I)?(g(),n(d,{key:2},{default:m((()=>[f(v,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:m((()=>[f(c,{class:"text-h6"},{default:m((()=>[b(P(y(I)),1)])),_:1})])),_:1})])),_:1})):(g(),n(i,{key:1,modelValue:y(M),"onUpdate:modelValue":l[1]||(l[1]=e=>_(M)?M.value=e:null),label:"Категория товара","error-messages":y(V),items:y(F),"item-title":"name",clearable:!1,"item-value":"id","no-data-text":"Нет категорий"},null,8,["modelValue","error-messages","items"]))])),_:1}),f(o,{sm:"6",cols:"12"},{default:m((()=>[f(r,{modelValue:y(k),"onUpdate:modelValue":l[2]||(l[2]=e=>_(k)?k.value=e:null),modelModifiers:{number:!0},"error-messages":y(w),label:"Количество",type:"number"},null,8,["modelValue","error-messages"])])),_:1}),f(o,{sm:"6",cols:"12"},{default:m((()=>[f(r,{modelValue:y(A),"onUpdate:modelValue":l[3]||(l[3]=e=>_(A)?A.value=e:null),modelModifiers:{number:!0},"error-messages":y(q),label:"Цена",suffix:"руб",type:"number"},null,8,["modelValue","error-messages"])])),_:1}),f(o,{cols:"12"},{default:m((()=>[f(U,{color:"green-darken-4",variant:"flat",loading:y(u),type:"submit"},{default:m((()=>[b(" Добавить ")])),_:1},8,["loading"]),f(U,{color:"blue-darken-4",variant:"flat",onClick:l[4]||(l[4]=e=>a.$emit("closeModal"))},{default:m((()=>[b(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"])}}}),G={key:0},H={class:"text-h6"},J=x("h2",{class:"title text-h2 mb-5"},"Товары",-1),K={class:"text-h6"};e("default",u({__name:"ProductsView",setup(e){const a=i(),u=U(),h=S(),T=l([{fieldText:"Имя",fieldName:"name"},{fieldText:"Цена(руб)",fieldName:"price"},{fieldText:"Кол-во",fieldName:"count"},{fieldText:"Категория",fieldName:"category"}]),E=l("name"),{userProducts:D,productsErrorMessage:N,productsCategories:I}=c(a);M((async()=>{I.value.length||a.getAllProductsCategories()}));const{itemToEdit:$,isAddDialogActive:j,isEditDialogActive:B,isDeleteDialogActive:z,openDialog:Q}=A(),R=w(),W=v(),{searchName:X,searchPrices:Y,searchedProducts:Z,isSearchActive:ee,isSearchLoading:ae,isSearchFormActive:le,resetSearch:te,addSearchQuery:re,searchUserProducts:oe}=((e,a,u)=>{const d=U(),i=l([+e.query.startPrice||1,+e.query.endPrice||99999]),c=l(e.query.productName||""),n=l([]),m=l(!1),v=l(!1),p=l(!1),g=async()=>{try{v.value=!0;const{data:a}=await r.getSearchedProducts({startPrice:e.query.startPrice,endPrice:e.query.endPrice,productName:e.query.productName,userId:u});n.value=a.products,console.log(n.value),m.value=!0}catch(a){o(a)?d.showMessage("error",s(a)):d.showMessage("error","Ошибка при поиске товара(")}finally{v.value=!1}};return t([()=>e.query.startPrice,()=>e.query.endPrice,()=>e.query.productName],(async()=>{(e.query.startPrice||e.query.endPrice)&&g()}),{immediate:!0}),{searchPrices:i,searchName:c,isSearchActive:m,searchedProducts:n,isSearchLoading:v,isSearchFormActive:p,searchUserProducts:g,addSearchQuery:()=>{a.push({name:"products-page",query:{...e.query,productName:c.value,startPrice:i.value[0],endPrice:i.value[1]}})},resetSearch:()=>{c.value="",i.value=[1,99999],m.value=!1,n.value=[],a.push({name:"products-page",query:{}})}}})(R,W,h.currentUser.id),se=d((()=>ee.value?Z.value:D.value)),{currentPage:ue,paginatedElements:de,totalPages:ie,isInverseSort:ce,elemetsPerPage:ne,setSortField:me}=q({tableElements:se,pageName:"products-page",sortField:E,route:R,router:W});return(e,a)=>{const l=p("v-snackbar"),t=p("TableActions"),r=p("v-text-field"),o=p("v-col"),s=p("v-range-slider"),d=p("v-btn"),i=p("v-row"),c=p("v-form"),v=p("v-expand-transition"),S=p("v-card-title"),M=p("v-alert-title"),w=p("v-alert"),U=p("v-progress-circular"),A=p("v-sheet"),q=p("v-pagination"),D=p("v-card");return y(h).currentUser?(g(),V("div",G,[f(l,{modelValue:y(u).isMessageShown,"onUpdate:modelValue":a[0]||(a[0]=e=>y(u).isMessageShown=e),"max-width":500,color:y(u).messageType},{default:m((()=>[x("p",H,P(y(u).messageText),1)])),_:1},8,["modelValue","color"]),J,f(D,{color:"white",elevation:"3",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:m((()=>[y(N)?k("",!0):(g(),n(S,{key:0,class:"pa-0"},{default:m((()=>[f(t,{count:y(ne),"onUpdate:count":[a[1]||(a[1]=e=>_(ne)?ne.value=e:null),a[2]||(a[2]=e=>ne.value=e)],onToggleAddDialog:a[3]||(a[3]=e=>j.value=!0),onToggleSearch:a[4]||(a[4]=e=>le.value=!y(le)),"is-badge-active":!!e.$route.query.startPrice},{default:m((()=>[b(" Все товары ")])),_:1},8,["count","is-badge-active"]),f(v,null,{default:m((()=>[y(le)?(g(),n(c,{key:0,class:"mb-8"},{default:m((()=>[f(i,{align:"center"},{default:m((()=>[f(o,{sm:"6",cols:"12"},{default:m((()=>[f(r,{modelValue:y(X),"onUpdate:modelValue":a[5]||(a[5]=e=>_(X)?X.value=e:null),variant:"outlined",label:"Название товара"},null,8,["modelValue"])])),_:1}),f(o,{sm:"6",cols:"12",class:"pr-7"},{default:m((()=>[f(s,{modelValue:y(Y),"onUpdate:modelValue":a[6]||(a[6]=e=>_(Y)?Y.value=e:null),min:"1",step:"10",max:"99999",color:"blue-grey-darken-2",label:"Цена:"},null,8,["modelValue"])])),_:1}),f(o,{cols:"auto"},{default:m((()=>[f(i,null,{default:m((()=>[f(o,null,{default:m((()=>[f(d,{variant:"flat",color:"green-darken-3",onClick:y(re),disabled:y(ae)},{default:m((()=>[b(" Искать ")])),_:1},8,["onClick","disabled"])])),_:1}),f(o,null,{default:m((()=>[f(d,{variant:"flat",color:"red-darken-4",onClick:y(te),disabled:y(ae)},{default:m((()=>[b(" Сбросить поиск ")])),_:1},8,["onClick","disabled"])])),_:1}),f(o,null,{default:m((()=>[f(d,{variant:"flat",color:"blue-darken-4",onClick:a[7]||(a[7]=e=>le.value=!1),disabled:y(ae)},{default:m((()=>[b(" Закрыть ")])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):k("",!0)])),_:1})])),_:1})),y(N)?(g(),n(w,{key:1,type:"error",border:"end",variant:"tonal"},{default:m((()=>[f(M,{class:"mb-2 text-h5"},{default:m((()=>[b(" Ошибка при загрузке товаров ")])),_:1}),x("p",K,P(y(N)),1)])),_:1})):y(ae)?k("",!0):(g(),n(C,{key:2,items:y(de),fields:T.value,"is-inverse-sort":y(ce),"no-data-text":"Товары не найдены","current-sort-field":E.value,"onUpdate:currentSortField":[a[8]||(a[8]=e=>E.value=e),a[9]||(a[9]=e=>y(me)(e))],onOpenDialog:a[10]||(a[10]=(e,a)=>y(Q)(e,a))},null,8,["items","fields","is-inverse-sort","current-sort-field"])),y(ae)?(g(),n(A,{key:3,class:"text-center mb-2"},{default:m((()=>[f(U,{indeterminate:"",size:"48",color:"green"})])),_:1})):k("",!0),y(se).length?(g(),n(q,{key:4,length:y(ie),modelValue:y(ue),"onUpdate:modelValue":a[11]||(a[11]=e=>_(ue)?ue.value=e:null),rounded:"circle","total-visible":7,color:"indigo-darken-4"},null,8,["length","modelValue"])):k("",!0)])),_:1}),y($)?(g(),n(F,{key:0,product:y($),onCloseModal:a[12]||(a[12]=e=>B.value=!1),"is-active":y(B),"is-search-active":y(ee),onUpdateSearchProducts:y(oe)},null,8,["product","is-active","is-search-active","onUpdateSearchProducts"])):k("",!0),y($)?(g(),n(L,{key:1,"is-active":y(z),product:y($),onCloseModal:a[13]||(a[13]=e=>z.value=!1),"is-search-active":y(ee),onUpdateSearchProducts:y(oe)},null,8,["is-active","product","is-search-active","onUpdateSearchProducts"])):k("",!0),f(O,{onCloseModal:a[14]||(a[14]=e=>j.value=!1),"is-active":y(j)},null,8,["is-active"])])):k("",!0)}}}))}}}));
