import{d as R,r as h,o as c,c as y,q as p,al as N,am as V,t as T,b as s,C as W,e as o,E as C,an as F,ao as U,_ as X,a as b,u as Y,P as ee,S as te,i as k,h as A,g as m,U as ae,O as _,z as se,m as L,M as oe,Z as re,a0 as I,ap as z,aq as P,B as le,x as q,y as ne,p as w,ar as ie,n as G,s as de,a3 as ue,v as ce,F as pe,f as H,a2 as ve,T as O}from"./index-1cb64e4a.js";import{u as ge}from"./alert-18323748.js";const fe={class:"d-flex align-center"},me={class:"flex-grow-1"},he=R({__name:"Note",props:{note:null},emits:["deleteNote","dragstart","dragend","updateNote"],setup(g,{emit:u}){const D=g,v=h(!1),$=()=>{u("updateNote",D.note),v.value=!1};return(l,i)=>(c(),y("div",{class:"note py-3 px-4 bg-white mb-3",onDragstart:i[3]||(i[3]=r=>l.$emit("dragstart",r,g.note.id)),onDragend:i[4]||(i[4]=r=>l.$emit("dragend",r))},[p("div",fe,[N(p("div",{class:"text-h6 flex-grow-1 pr-1"},T(g.note.title),513),[[V,!v.value]]),N(p("div",me,[s(W,{modelValue:g.note.title,"onUpdate:modelValue":i[0]||(i[0]=r=>g.note.title=r),density:"comfortable",variant:"underlined",clearable:!1,"bg-color":"white"},null,8,["modelValue"])],512),[[V,v.value]]),p("div",null,[s(U,null,{default:o(({props:r,isHovering:n})=>[s(C,F({icon:"mdi-trash-can",size:"large",color:n?"red-darken-3":"grey",onClick:i[1]||(i[1]=f=>l.$emit("deleteNote",g.note.id))},r),null,16,["color"])]),_:1}),s(U,null,{default:o(({props:r,isHovering:n})=>[N(s(C,F({onClick:i[2]||(i[2]=f=>v.value=!v.value),icon:"mdi-pencil",size:"large",color:n?"blue":"grey"},r),null,16,["color"]),[[V,!v.value]])]),_:1}),s(U,null,{default:o(({props:r,isHovering:n})=>[N(s(C,F({onClick:$,style:{cursor:"pointer"},icon:"mdi-content-save-all",size:"large",color:n?"green":"grey"},r),null,16,["color"]),[[V,v.value]])]),_:1})])])],32))}});const ye=X(he,[["__scopeId","data-v-44834e74"]]);class _e{async getNotes(u){return b.get(`/Notes/${u}`)}async updateNote(u){return await b.patch("/Notes",u)}async deleteNote(u){return await b.delete(`/Notes/${u}`)}async addNote(u){return await b.post("/Notes",u)}}const S=new _e,we={class:"text-h6"},Ne=p("div",{class:"text-h2 mb-8 title"},"Ваши заметки",-1),Ve={key:0,class:""},xe=p("p",{class:"mb-3 text-h6"},"Загрузка заметок ...",-1),be={key:0,color:"transparent","max-height":700,style:{overflow:"auto","max-height":"700px"}},ke=["onClick"],Ae=p("p",{class:"mb-2"},"Загрузка...",-1),Ce=R({__name:"NotesView",setup(g){const u=h([{title:"В процессе",isFormActive:!1,addText:""},{title:"Сделать потом",isFormActive:!1,addText:""},{title:"Сделано",isFormActive:!1,addText:""}]),D=(e,t)=>{e.target.classList.add("dragging"),e.dataTransfer.setData("id",t.toString())},v=e=>{e.target.classList.remove("dragging")},$=async(e,t)=>{var d;const a=(d=e.dataTransfer)==null?void 0:d.getData("id");if(a){const B=r.value.find(Q=>Q.id===+a);B.type=t,await E(B)}},l=ge(),i=Y(),r=h([]),n=h(!1),f=h(!1),x=h(null),M=ee(()=>function(e){return r.value.filter(t=>t.type===e)});te(async()=>{f.value=!0;try{const{data:e}=await S.getNotes(i.currentUser.id);r.value=e.notes}catch(e){k(e)?x.value=A(e):x.value="Ошибка при загрузке заметок!"}f.value=!1});const E=async e=>{n.value=!0;try{await S.updateNote(e)}catch(t){k(t)?l.showMessage("error",A(t)):l.showMessage("error","Ошибка при добавлении заметки!")}n.value=!1},Z=async(e,t)=>{if(!(e.length<1)){n.value=!0;try{const{data:a}=await S.addNote({title:e,type:t,userId:i.currentUser.id});r.value.push({id:a.noteId,title:e,type:t})}catch(a){k(a)?l.showMessage("error",A(a)):l.showMessage("error","Ошибка при добавлении заметки!")}n.value=!1}},j=async e=>{n.value=!0;try{await S.deleteNote(e),r.value=r.value.filter(t=>t.id!=e)}catch(t){k(t)?l.showMessage("error",A(t)):l.showMessage("error","Ошибка при добавлении заметки!")}n.value=!1},J=(e,t)=>{O.from(e,{opacity:0,scale:0,ease:"sine.out",duration:.6,onComplete:t})},K=(e,t)=>{O.to(e,{duration:.6,ease:"sine.out",opacity:0,scale:0,onComplete:t})};return(e,t)=>(c(),y("div",null,[s(ae,{modelValue:m(l).isMessageShown,"onUpdate:modelValue":t[0]||(t[0]=a=>m(l).isMessageShown=a),color:m(l).messageType},{default:o(()=>[p("p",we,T(m(l).messageText),1)]),_:1},8,["modelValue","color"]),Ne,f.value?(c(),y("div",Ve,[xe,s(I,{color:"green",height:"4",indeterminate:""})])):(c(),_(se,{key:1,class:"row"},{default:o(()=>[(c(!0),y(z,null,P(u.value,a=>(c(),_(le,{key:a.title,onDragover:t[1]||(t[1]=q(()=>{},["prevent"])),onDrop:d=>$(d,a.title)},{default:o(()=>[s(H,{color:"blue-grey-darken-1 pa-4"},{default:o(()=>[s(ne,{class:"text-h4 text-white mb-5 pa-0"},{default:o(()=>[w(T(a.title),1)]),_:2},1024),m(M)(a.title).length?(c(),y("div",be,[s(ie,{onEnter:J,onLeave:K,css:!1,appear:""},{default:o(()=>[(c(!0),y(z,null,P(m(M)(a.title),d=>(c(),_(ye,{key:d.id,note:d,onDeleteNote:j,onUpdateNote:E,draggable:"true",onDragstart:D,onDragend:v},null,8,["note"]))),128))]),_:2},1024)])):(c(),_(L,{key:1,color:"white",class:"mb-2","border-color":"white"},{default:o(()=>[s(G,null,{default:o(()=>[w("Пока нет заметок, добавьте хоть одну !")]),_:1})]),_:1})),s(de,{class:"d-flex flex-column pa-0 align-stretch",style:{"min-height":"auto"}},{default:o(()=>[p("div",{onClick:d=>a.isFormActive=!a.isFormActive,style:{cursor:"pointer"}},[s(C,{icon:a.isFormActive?"mdi-minus":"mdi-plus"},null,8,["icon"]),w(" Добавить заметку ")],8,ke),s(ue,null,{default:o(()=>[N(s(ce,{onSubmit:q(d=>{Z(a.addText,a.title),a.addText=""},["prevent"])},{default:o(()=>[s(W,{"bg-color":"white",color:"black",placeholder:"Задача...",modelValue:a.addText,"onUpdate:modelValue":d=>a.addText=d,class:"my-2 white-input",rules:[d=>!!d||"Поле обязательное для ввода"]},null,8,["modelValue","onUpdate:modelValue","rules"]),s(pe,{type:"submit",variant:"flat",color:"green"},{default:o(()=>[w("Добавить")]),_:1})]),_:2},1032,["onSubmit"]),[[V,a.isFormActive]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onDrop"]))),128))]),_:1})),!f.value&&x.value?(c(),_(L,{key:2,type:"error",border:"end",variant:"tonal"},{default:o(()=>[s(G,{class:"mb-2"},{default:o(()=>[w(" Ошибка при загрузке товаров ")]),_:1}),p("p",null,T(x.value),1)]),_:1})):oe("",!0),s(re,{modelValue:n.value,"onUpdate:modelValue":t[2]||(t[2]=a=>n.value=a),scrim:!1,persistent:"",width:"auto"},{default:o(()=>[s(H,{color:"indigo-darken-4"},{default:o(()=>[s(ve,null,{default:o(()=>[Ae,s(I,{indeterminate:"",color:"white",class:"mb-0"})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{Ce as default};
