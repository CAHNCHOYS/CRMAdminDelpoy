import{d as q,r as B,u as I,a as U,A as z,b as R,i as D,h as L,w as N,c as $,e,f as s,V as j,g as P,j as t,k as G,l as H,m as J,o as O,n as K,p as Q,q as c,t as w,s as d,v as V,x as W,y as X,z as Y,B as Z,C as g,D as b,E as y,F as f,G as ee,H as se,I as ae,J as te,_ as oe}from"./index-0479616c.js";import{u as re,a as le,b as v}from"./useFormSchemas-2643e2d8.js";const ne=""+new URL("bg-ffc91902.png",import.meta.url).href,S=n=>(ae("data-v-02e8fc3c"),n=n(),te(),n),ie={class:"fullscreen h-100 d-flex justify-center align-center"},ce={class:"text-white text-h6"},de=S(()=>d("span",{class:"text-white text-h6 font-weight-medium"},"Войти",-1)),ue={class:"mt-2"},me=S(()=>d("span",{class:"text-decoration-underline text-green"}," Зарегистрироваться ",-1)),pe=q({__name:"LoginView",setup(n){const{loginSchema:k}=re(),{handleSubmit:T,isSubmitting:_,resetForm:A}=le({validationSchema:k}),{value:u,errorMessage:F}=v("email"),{value:m,errorMessage:M}=v("password"),i=B(!1),p=I(),o=U(),r=H(),h=J(),C=T(async x=>{try{const{data:a}=await z.login(x);p.setToken(a.accessToken),p.setUser(a.user),await p.fetchData(),R.defaults.headers.common.Authorization=`Bearer ${a.accessToken}`,o.showMessage("success","Авторизация успешна, вскоре вы будете переведены на сайт"),setTimeout(()=>{r.query.redirectedFrom?h.push({name:r.query.redirectedFrom}):h.push("/")},3500)}catch(a){console.log(a),D(a)?o.showMessage("error",L(a)):o.showMessage("error","Ошибка при авторизации, попробуйте позже")}finally{A()}});return N(()=>{r.query.redirectedFrom&&!r.query.isExpiredToken&&o.showMessage("error",`Для доступа к странице ${r.query.redirectedFrom} необходимо авторизироваться`),r.query.isExpiredToken&&o.showMessage("error","Сеанс авторизации истек, войдите в аккаунт снова!")}),(x,a)=>{const E=se("router-link");return O(),$("div",ie,[e(j,null,{default:s(()=>[e(K,{class:"alert",type:t(o).messageType,"max-width":400,modelValue:t(o).isMessageShown,"onUpdate:modelValue":a[0]||(a[0]=l=>t(o).isMessageShown=l)},{default:s(()=>[e(Q,{class:"text-h4 mb-2"},{default:s(()=>[c(w(t(o).messageType==="error"?"Ошибка":"Уведомление"),1)]),_:1}),d("div",ce,w(t(o).messageText),1)]),_:1},8,["type","modelValue"])]),_:1}),e(P,{class:"form-card flex-grow-1 pb-8 rounded-lg","max-width":486,elevation:0},{default:s(()=>[e(V,{class:"form-title text-center text-h4 pa-0 py-4"},{default:s(()=>[c("Авторизация")]),_:1}),e(W,{class:"pt-4 pb-1 px-lg-10 px-md-8 px-4"},{default:s(()=>[e(X,{onSubmit:Y(t(C),["prevent"]),class:"w-100"},{default:s(()=>[e(V,{class:"text-indigo-darken-2 text-center mb-2"},{default:s(()=>[c(" Введите ваши данные")]),_:1}),e(Z,null,{default:s(()=>[e(g,{cols:"12"},{default:s(()=>[e(b,{modelValue:t(u),"onUpdate:modelValue":a[1]||(a[1]=l=>y(u)?u.value=l:null),"error-messages":t(F),"bg-color":"rgba(229, 229, 229, 0.25)",placeholder:"Ваша почта",hint:"Ваша почта при регистрации",clearable:""},{"prepend-inner":s(()=>[e(f,{icon:"mdi-email",class:"icon mr-lg-3 mr-1",size:"large"})]),_:1},8,["modelValue","error-messages","bg-color"])]),_:1}),e(g,{cols:"12"},{default:s(()=>[e(b,{modelValue:t(m),"onUpdate:modelValue":a[3]||(a[3]=l=>y(m)?m.value=l:null),"error-messages":t(M),"bg-color":"rgba(229, 229, 229, 0.25)",placeholder:"Ваш пароль",hint:"Ваш пароль при регистрации",type:i.value?"text":"password",clearable:""},{"prepend-inner":s(()=>[e(f,{icon:"mdi-lock",class:"icon mr-lg-3 mr-1",size:"large"})]),"append-inner":s(()=>[e(f,{onClick:a[2]||(a[2]=l=>i.value=!i.value),class:"text-dark-blue",icon:i.value?"mdi-eye":"mdi-eye-off",size:"large"},null,8,["icon"])]),_:1},8,["modelValue","error-messages","bg-color","type"])]),_:1}),e(g,null,{default:s(()=>[e(ee,{type:"submit",loading:t(_),disabled:t(_)||t(o).isMessageShown,block:"",color:"dark-blue",variant:"flat"},{default:s(()=>[de]),_:1},8,["loading","disabled"]),d("p",ue,[e(E,{to:{name:"register-page"},class:"text-black text-h6"},{default:s(()=>[c("Нет аккаунта? "),me]),_:1})])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1}),e(G,{class:"bg-image",cover:"",src:t(ne),alt:"OfficePic"},null,8,["src"])])}}});const _e=oe(pe,[["__scopeId","data-v-02e8fc3c"]]);export{_e as default};
