System.register(["./index-legacy-bdf57a8f.js","./alert-legacy-4db1546e.js","./ElementsTable.vue_vue_type_script_setup_true_lang-legacy-193ad41f.js","./useFormSchemas-legacy-4726c74c.js"],(function(e,a){"use strict";var l,t,r,s,o,u,d,i,c,n,m,g,p,v,f,h,y,_,b,P,S,k,V,x,w,M,U,D,A,C,q,T,E,F,N,I,$,B,j,L,z,O,Q,G,J,W,X,Y,Z,H,K,R,ee;return{setters:[e=>{l=e.r,t=e.W,r=e.X,s=e.i,o=e.h,u=e.d,d=e.P,i=e.Y,c=e.J,n=e.O,m=e.e,g=e.Z,p=e.l,v=e.o,f=e.b,h=e.y,y=e.s,_=e.v,b=e.x,P=e.g,S=e.z,k=e.B,V=e.C,x=e.D,w=e.$,M=e.a0,U=e.a1,D=e.m,A=e.n,C=e.p,q=e.t,T=e.F,E=e.f,F=e.q,N=e.a2,I=e.u,$=e.S,B=e.c,j=e.U,L=e.M,z=e.k,O=e.a3,Q=e.a4,G=e.a5,J=e.a6,W=e.G},e=>{X=e.u},e=>{Y=e.u,Z=e.a,H=e._},e=>{K=e.u,R=e.a,ee=e.b}],execute:function(){const a=F("p",{class:"text-h6 font-weight-bold mb-4"},"Редактирование товара",-1),ae=F("p",{class:"text-h6 mb-2"},"Загрузка категорий....",-1),le=u({__name:"ProductEditDialog",props:{isActive:{type:Boolean},product:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchProducts"],setup(e,{emit:l}){const t=e,u=d((()=>({name:t.product?.name||"Товар не был выбран",price:t.product?.price||0,count:t.product?.count||0,categoryId:t.product?.categoryId||0}))),{userProductSchema:F}=K(),{handleSubmit:N,isSubmitting:I,resetForm:$}=R({validationSchema:F,initialValues:u}),{value:B,errorMessage:j}=ee("name"),{value:L,errorMessage:z}=ee("price"),{value:O,errorMessage:Q}=ee("count"),{value:G,errorMessage:J}=ee("categoryId"),W=i(),Y=X(),{productsCategories:Z,categoriesErrorMessage:H,isCategoriesLoading:le}=c(W),te=p(),re=N((async e=>{try{await r.updateProduct(e,t.product.id);const a=Z.value.find((a=>a.id===e.categoryId)).name;W.updateUserProduct({...e,category:a,id:t.product.id}),t.isSearchActive&&l("updateSearchProducts"),Y.showMessage("success","Товар был изменен")}catch(a){if(s(a)){if(401===a.response?.status)return void te.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"products-page"}});Y.showMessage("error",o(a))}else Y.showMessage("error","Ошибка при обновлении товара!")}finally{$(),l("closeDialog")}}));return(l,t)=>(v(),n(g,{transition:"dialog-bottom-transition","max-width":"500","onUpdate:modelValue":t[5]||(t[5]=e=>l.$emit("closeDialog")),"model-value":e.isActive},{default:m((()=>[f(E,{class:"pa-5",color:"white",elevation:"4"},{default:m((()=>[f(h,null,{default:m((()=>[a])),_:1}),f(y,null,{default:m((()=>[f(_,{onSubmit:b(P(re),["prevent"])},{default:m((()=>[f(S,null,{default:m((()=>[f(k,{cols:"12"},{default:m((()=>[f(V,{modelValue:P(B),"onUpdate:modelValue":t[0]||(t[0]=e=>x(B)?B.value=e:null),"error-messages":P(j),label:"Название товара"},null,8,["modelValue","error-messages"])])),_:1}),f(k,{cols:"12"},{default:m((()=>[P(le)?(v(),n(w,{key:0},{default:m((()=>[ae,f(M,{indeterminate:"",height:"6",color:"green"})])),_:1})):P(H)?(v(),n(w,{key:2},{default:m((()=>[f(D,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:m((()=>[f(A,{class:"text-h6"},{default:m((()=>[C(q(P(H)),1)])),_:1})])),_:1})])),_:1})):(v(),n(U,{key:1,modelValue:P(G),"onUpdate:modelValue":t[1]||(t[1]=e=>x(G)?G.value=e:null),label:"Категория товара","error-messages":P(J),items:P(Z),"item-title":"name",clearable:!1,"item-value":"id","no-data-text":"Нет категорий"},null,8,["modelValue","error-messages","items"]))])),_:1}),f(k,{sm:"6",cols:"12"},{default:m((()=>[f(V,{modelValue:P(O),"onUpdate:modelValue":t[2]||(t[2]=e=>x(O)?O.value=e:null),modelModifiers:{number:!0},"error-messages":P(Q),label:"Количество",type:"number"},null,8,["modelValue","error-messages"])])),_:1}),f(k,{sm:"6",cols:"12"},{default:m((()=>[f(V,{modelValue:P(L),"onUpdate:modelValue":t[3]||(t[3]=e=>x(L)?L.value=e:null),modelModifiers:{number:!0},"error-messages":P(z),label:"Цена",type:"number",suffix:"руб"},null,8,["modelValue","error-messages"])])),_:1}),f(k,{cols:"12"},{default:m((()=>[f(T,{color:"green-darken-4",variant:"flat",loading:P(I),type:"submit"},{default:m((()=>[C(" Сохранить ")])),_:1},8,["loading"]),f(T,{color:"blue-darken-4",variant:"flat",onClick:t[4]||(t[4]=e=>l.$emit("closeDialog"))},{default:m((()=>[C(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),te=F("p",{class:"font-weight-bold text-h5"},"Подтверждение удаления",-1),re={class:"text-h6"},se={class:"text-red"},oe=F("span",{class:"text-white"},"Нет",-1),ue=u({__name:"ProductDeleteDialog",props:{product:null,isActive:{type:Boolean},isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchProducts"],setup(e,{emit:a}){const t=e,u=l(!1),d=i(),c=X(),_=p(),b=async()=>{try{u.value=!0,await r.deleteProduct(t.product.id),d.deleteUserProduct(t.product.id),t.isSearchActive&&a("updateSearchProducts"),c.showMessage("success","Товар был успешно удален")}catch(e){if(s(e)){if(401===e.response?.status)return void _.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"products-page"}});c.showMessage("error",o(e))}else c.showMessage("error","Ошибка при удалении товара!")}finally{u.value=!1,a("closeDialog")}};return(a,l)=>(v(),n(g,{"model-value":e.isActive,"max-width":450,persistent:"",transition:"dialog-bottom-transition"},{default:m((()=>[f(E,{class:"pa-4"},{default:m((()=>[f(h,{class:"pa-0 mb-3"},{default:m((()=>[te])),_:1}),f(N,{class:"pa-0 mb-4"},{default:m((()=>[F("p",re,[C(" Вы уверены что хотите удалить товар "),F("span",se,q(t.product.name),1),C(" из списка? ")])])),_:1}),f(y,{class:"justify-center"},{default:m((()=>[f(T,{onClick:l[0]||(l[0]=e=>a.$emit("closeDialog")),height:"40",color:"blue-darken-4",variant:"flat"},{default:m((()=>[oe])),_:1}),f(T,{height:"40",loading:u.value,color:"error",variant:"flat",onClick:b},{default:m((()=>[C("Да")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),de=F("p",{class:"text-h6 font-weight-bold mb-4"},"Добавление нового товара",-1),ie=F("p",{class:"text-h6 mb-2"},"Загрузка категорий....",-1),ce=u({__name:"ProductAddDialog",props:{isActive:{type:Boolean}},emits:["closeDialog"],setup(e,{emit:a}){const{userProductSchema:l}=K(),{handleSubmit:t,isSubmitting:u,resetForm:d}=R({validationSchema:l}),{value:F,errorMessage:N}=ee("name"),{value:I,errorMessage:$}=ee("categoryId"),{value:B,errorMessage:j}=ee("count"),{value:L,errorMessage:z}=ee("price"),O=i(),Q=X(),{productsCategories:G,categoriesErrorMessage:J,isCategoriesLoading:W}=c(O),Y=p(),Z=t((async e=>{try{const{data:a}=await r.addProduct(e),l=G.value.find((a=>a.id===e.categoryId)).name;O.addUserProduct({...e,id:a.productId,category:l}),Q.showMessage("success",`Товар ${e.name} был успешно добавлен!`)}catch(l){if(s(l)){if(401===l.response?.status)return void Y.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"products-page"}});Q.showMessage("error",o(l))}else Q.showMessage("error","Ошибка при добавлении товара !")}finally{d(),a("closeDialog")}}));return(a,l)=>(v(),n(g,{transition:"dialog-bottom-transition","max-width":"500","onUpdate:modelValue":l[5]||(l[5]=e=>a.$emit("closeDialog")),scrollable:"","model-value":e.isActive},{default:m((()=>[f(E,{class:"pa-5",color:"white",elevation:"4"},{default:m((()=>[f(h,null,{default:m((()=>[de])),_:1}),f(y,null,{default:m((()=>[f(_,{onSubmit:b(P(Z),["prevent"])},{default:m((()=>[f(S,null,{default:m((()=>[f(k,{cols:"12"},{default:m((()=>[f(V,{modelValue:P(F),"onUpdate:modelValue":l[0]||(l[0]=e=>x(F)?F.value=e:null),"error-messages":P(N),label:"Название товара"},null,8,["modelValue","error-messages"])])),_:1}),f(k,{cols:"12"},{default:m((()=>[P(W)?(v(),n(w,{key:0},{default:m((()=>[ie,f(M,{indeterminate:"",height:"6",color:"green"})])),_:1})):P(J)?(v(),n(w,{key:2},{default:m((()=>[f(D,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:m((()=>[f(A,{class:"text-h6"},{default:m((()=>[C(q(P(J)),1)])),_:1})])),_:1})])),_:1})):(v(),n(U,{key:1,modelValue:P(I),"onUpdate:modelValue":l[1]||(l[1]=e=>x(I)?I.value=e:null),label:"Категория товара","error-messages":P($),items:P(G),"item-title":"name",clearable:!1,"item-value":"id","no-data-text":"Нет категорий"},null,8,["modelValue","error-messages","items"]))])),_:1}),f(k,{sm:"6",cols:"12"},{default:m((()=>[f(V,{modelValue:P(B),"onUpdate:modelValue":l[2]||(l[2]=e=>x(B)?B.value=e:null),modelModifiers:{number:!0},"error-messages":P(j),label:"Количество",type:"number"},null,8,["modelValue","error-messages"])])),_:1}),f(k,{sm:"6",cols:"12"},{default:m((()=>[f(V,{modelValue:P(L),"onUpdate:modelValue":l[3]||(l[3]=e=>x(L)?L.value=e:null),modelModifiers:{number:!0},"error-messages":P(z),label:"Цена",suffix:"руб",type:"number"},null,8,["modelValue","error-messages"])])),_:1}),f(k,{cols:"12"},{default:m((()=>[f(T,{color:"green-darken-4",variant:"flat",loading:P(u),type:"submit"},{default:m((()=>[C(" Добавить ")])),_:1},8,["loading"]),f(T,{color:"blue-darken-4",variant:"flat",onClick:l[4]||(l[4]=e=>a.$emit("closeDialog"))},{default:m((()=>[C(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),ne={key:0},me={class:"text-h6"},ge=F("h2",{class:"title text-h2 mb-5"},"Товары",-1),pe=F("span",{class:"text-wrap"}," Сбросить поиск",-1),ve={class:"text-h6"};e("default",u({__name:"ProductsView",setup(e){const a=i(),u=X(),g=I(),y=l([{fieldText:"Имя",fieldName:"name"},{fieldText:"Цена(руб)",fieldName:"price"},{fieldText:"Кол-во",fieldName:"count"},{fieldText:"Категория",fieldName:"category"}]),b=l("name"),{userProducts:M,productsErrorMessage:U,productsCategories:N}=c(a);$((async()=>{N.value.length||a.getAllProductsCategories()}));const{itemToEdit:K,isAddDialogActive:R,isEditDialogActive:ee,isDeleteDialogActive:ae,openDialog:te}=Y(),re=z(),se=p(),{searchName:oe,searchPrices:de,searchedProducts:ie,isSearchActive:fe,isSearchLoading:he,isSearchFormActive:ye,resetSearch:_e,addSearchQuery:be,searchUserProducts:Pe}=((e,a,u)=>{const d=X(),i=l([+e.query.startPrice||1,+e.query.endPrice||99999]),c=l(e.query.productName||""),n=l([]),m=l(!1),g=l(!1),p=l(!1),v=async()=>{try{g.value=!0;const{data:a}=await r.getSearchedProducts({startPrice:e.query.startPrice,endPrice:e.query.endPrice,productName:e.query.productName,userId:u});n.value=a.products,console.log(n.value),m.value=!0}catch(a){s(a)?d.showMessage("error",o(a)):d.showMessage("error","Ошибка при поиске товара(")}finally{g.value=!1}};return t([()=>e.query.startPrice,()=>e.query.endPrice,()=>e.query.productName],(async()=>{(e.query.startPrice||e.query.endPrice)&&v()}),{immediate:!0}),{searchPrices:i,searchName:c,isSearchActive:m,searchedProducts:n,isSearchLoading:g,isSearchFormActive:p,searchUserProducts:v,addSearchQuery:()=>{a.push({name:"products-page",query:{...e.query,productName:c.value,startPrice:i.value[0],endPrice:i.value[1]}})},resetSearch:()=>{c.value="",i.value=[1,99999],m.value=!1,n.value=[],a.push({name:"products-page",query:{}})}}})(re,se,g.currentUser.id),Se=d((()=>fe.value?ie.value:M.value)),{currentPage:ke,paginatedElements:Ve,totalPages:xe,isInverseSort:we,elementsPerPageCount:Me,setSortField:Ue}=Z({tableElements:Se,pageName:"products-page",sortField:b,route:re,router:se});return(e,a)=>{const l=W("TableActions");return P(g).currentUser?(v(),B("div",ne,[f(j,{modelValue:P(u).isMessageShown,"onUpdate:modelValue":a[0]||(a[0]=e=>P(u).isMessageShown=e),color:P(u).messageType,"location-strategy":"connected"},{default:m((()=>[F("p",me,q(P(u).messageText),1)])),_:1},8,["modelValue","color"]),ge,f(E,{color:"white",elevation:"3",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:m((()=>[P(U)?L("",!0):(v(),n(h,{key:0,class:"pa-0"},{default:m((()=>[f(l,{count:P(Me),"onUpdate:count":a[1]||(a[1]=e=>x(Me)?Me.value=e:null),onToggleAddDialog:a[2]||(a[2]=e=>R.value=!0),onToggleSearch:a[3]||(a[3]=e=>ye.value=!P(ye)),"is-badge-active":!!e.$route.query.startPrice},{default:m((()=>[C(" Все товары ")])),_:1},8,["count","is-badge-active"]),f(O,null,{default:m((()=>[P(ye)?(v(),n(_,{key:0,class:"mb-8"},{default:m((()=>[f(S,{align:"center"},{default:m((()=>[f(k,{sm:"6",cols:"12",class:"mb-sm-0 mb-2"},{default:m((()=>[f(V,{modelValue:P(oe),"onUpdate:modelValue":a[4]||(a[4]=e=>x(oe)?oe.value=e:null),variant:"outlined",label:"Название товара"},null,8,["modelValue"])])),_:1}),f(k,{sm:"6",cols:"12",class:"pr-7"},{default:m((()=>[f(Q,{modelValue:P(de),"onUpdate:modelValue":a[5]||(a[5]=e=>x(de)?de.value=e:null),min:"1",step:"10",max:"99999",color:"blue-grey-darken-2",label:"Цена:"},null,8,["modelValue"])])),_:1}),f(k,{sm:"auto",cols:"12"},{default:m((()=>[f(S,null,{default:m((()=>[f(k,{sm:"auto",cols:"6"},{default:m((()=>[f(T,{variant:"flat",color:"green-darken-3",onClick:P(be),disabled:P(he),block:""},{default:m((()=>[C(" Искать ")])),_:1},8,["onClick","disabled"])])),_:1}),f(k,{sm:"auto",cols:"6"},{default:m((()=>[f(T,{variant:"flat",color:"red-darken-4",onClick:P(_e),disabled:P(he),block:""},{default:m((()=>[pe])),_:1},8,["onClick","disabled"])])),_:1}),f(k,{sm:"auto",cols:"12"},{default:m((()=>[f(T,{variant:"flat",color:"blue-darken-4",onClick:a[6]||(a[6]=e=>ye.value=!1),disabled:P(he),block:""},{default:m((()=>[C(" Закрыть ")])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):L("",!0)])),_:1})])),_:1})),P(U)?(v(),n(D,{key:1,type:"error",border:"end",variant:"tonal"},{default:m((()=>[f(A,{class:"mb-2 text-h5"},{default:m((()=>[C(" Ошибка при загрузке товаров ")])),_:1}),F("p",ve,q(P(U)),1)])),_:1})):P(he)?L("",!0):(v(),n(H,{key:2,items:P(Ve),fields:y.value,"current-sort-field":b.value,onUpdateSortField:a[7]||(a[7]=e=>P(Ue)(e)),"is-inverse-sort":P(we),"no-data-text":"Товары не найдены",onOpenDialog:a[8]||(a[8]=(e,a)=>P(te)(e,a))},null,8,["items","fields","current-sort-field","is-inverse-sort"])),P(he)?(v(),n(w,{key:3,class:"text-center mb-2"},{default:m((()=>[f(G,{indeterminate:"",size:"48",color:"green"})])),_:1})):L("",!0),P(Se).length?(v(),n(J,{key:4,length:P(xe),modelValue:P(ke),"onUpdate:modelValue":a[9]||(a[9]=e=>x(ke)?ke.value=e:null),rounded:"circle","total-visible":7,color:"indigo-darken-4"},null,8,["length","modelValue"])):L("",!0)])),_:1}),P(K)?(v(),n(le,{key:0,"is-active":P(ee),onCloseDialog:a[10]||(a[10]=e=>ee.value=!1),product:P(K),"is-search-active":P(fe),onUpdateSearchProducts:P(Pe)},null,8,["is-active","product","is-search-active","onUpdateSearchProducts"])):L("",!0),P(K)?(v(),n(ue,{key:1,"is-active":P(ae),onCloseDialog:a[11]||(a[11]=e=>ae.value=!1),product:P(K),"is-search-active":P(fe),onUpdateSearchProducts:P(Pe)},null,8,["is-active","product","is-search-active","onUpdateSearchProducts"])):L("",!0),f(ce,{onCloseDialog:a[12]||(a[12]=e=>R.value=!1),"is-active":P(R)},null,8,["is-active"])])):L("",!0)}}}))}}}));
