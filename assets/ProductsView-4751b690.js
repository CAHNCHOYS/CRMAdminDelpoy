import{r as $,x as W,z as $e,g as se,h as ae,w as Ve,d as G,o as f,c as B,l as d,t as R,k as C,b as e,e as t,A as te,i as l,p as ne,n as re,_ as ce,B as ue,y as ke,C as X,v as A,m as de,f as o,j as E,q,s as ee,a as Se,F as oe,D as le,E as Ce,G as Me,H as Ue,I as Ee,J as Ie,T as Ae}from"./index-138f5097.js";import{u as ie,a as ve,b as N}from"./useFormSchemas-56e55025.js";const De=(n=$([]),v)=>{const m=se(),a=ae(),i=$(+m.query.currentPage||1),p=$(10),g=W(()=>Math.ceil(n.value.length/p.value)),r=$(!1),b=u=>{v.value===u?r.value=!r.value:r.value=!1,v.value=u},h=u=>{i.value=u},V=W(()=>{const u=n.value.length;let y=(i.value-1)*p.value;y>u&&(h(Math.ceil(u/p.value)),y=(i.value-1)*p.value);let k=y+p.value;const x=n.value.slice(y,k);return r.value?[...x].sort((w,M)=>w[v.value]>M[v.value]?-1:1):[...x].sort((w,M)=>w[v.value]>M[v.value]?1:-1)});return $e(i,()=>{a.push({name:"products-page",query:{...m.query,currentPage:i.value}})}),{currentPage:i,paginatedProducts:V,totalPages:g,isInverseSort:r,productsByPage:p,setSortField:b}},Te=n=>{const v=se(),m=ae(),a=$([+v.query.startPrice||1,+v.query.endPrice||999999]),i=$(v.query.name||""),p=W(()=>n.value.filter(b=>b.price>a.value[0]&&b.price<a.value[1]).filter(b=>b.name.toLowerCase().includes(i.value.toLowerCase()))),g=()=>{i.value="",a.value=[1,999999]};return Ve(r=>{console.log("watchEffect called");const b=i.value,h=a.value[0],V=a.value[1],u=setTimeout(()=>{m.push({name:"products-page",query:{...v.query,name:b,startPrice:h,endPrice:V}})},800);r(()=>{clearInterval(u)})}),{searchName:i,searchPrices:a,filteredProducts:p,resetSearch:g}},Y=n=>(ne("data-v-0c1d4abb"),n=n(),re(),n),Be={class:"d-sm-table-row d-block"},Re={class:"d-sm-table-cell d-flex justify-space-between h-auto pa-0 py-2"},qe=Y(()=>d("div",{class:"d-sm-none d-block font-weight-bold pr-1"},"Название:",-1)),Fe={class:"text-sm-left text-right"},Le={class:"d-sm-table-cell d-flex justify-space-between h-auto pa-0 py-2"},Ne=Y(()=>d("div",{class:"d-sm-none d-block font-weight-bold pr-1"},"Цена:",-1)),je={class:"d-sm-table-cell d-flex justify-space-between h-auto pa-0 py-2"},ze=Y(()=>d("div",{class:"d-sm-none d-block font-weight-bold pr-1"},"Кол-во:",-1)),Ge={class:"d-sm-table-cell d-flex justify-space-between h-auto pa-0 py-2"},Je=Y(()=>d("div",{class:"d-sm-none d-block font-weight-bold pr-1"},"Категория:",-1)),Oe={class:"d-sm-table-cell d-flex justify-end h-auto pa-0 py-2"},He={class:"d-flex flex-wrap"},Ke=G({__name:"UserProductRow",props:{product:null},emits:["openDialog"],setup(n,{emit:v}){return(m,a)=>{const i=l("v-btn"),p=l("v-tooltip");return f(),B("tr",Be,[d("td",Re,[qe,d("div",Fe,R(n.product.name),1)]),d("td",Le,[Ne,C(" "+R(n.product.price)+"₽ ",1)]),d("td",je,[ze,C(" "+R(n.product.count),1)]),d("td",Ge,[Je,C(" "+R(n.product.category),1)]),d("td",Oe,[d("div",He,[e(p,{text:"Удалить",location:"left","no-click-animation":""},{activator:t(({props:g})=>[e(i,te(g,{variant:"flat",icon:"mdi-trash-can",onClick:a[0]||(a[0]=r=>m.$emit("openDialog",n.product,"delete")),color:"error",class:"mr-2"}),null,16)]),_:1}),e(p,{text:"Редактировать",location:"right","no-click-animation":""},{activator:t(({props:g})=>[e(i,te(g,{variant:"flat",icon:"mdi-pencil",color:"info",onClick:a[1]||(a[1]=r=>m.$emit("openDialog",n.product,"edit"))}),null,16)]),_:1})])])])}}});const Qe=ce(Ke,[["__scopeId","data-v-0c1d4abb"]]),me=()=>{const n=$([]),v=$(!1),m=$("");return ue(async()=>{console.log("I am mounted");const a=await ke({url:"/ProductCategories",method:"get"});"error"in a?(v.value=!0,m.value=a.error):(console.log(a.data),n.value=a.data)}),{categories:n,isCategoriesLoadError:v,categoriesLoadErrorMessage:m}},We=d("p",{class:"text-h6 font-weight-bold mb-4"},"Редактирование товара",-1),Xe={key:1,class:"text-h6 text-red"},Ye=G({__name:"ProductEditDialog",props:{isActive:{type:Boolean},product:null},emits:["closeModal"],setup(n,{emit:v}){const m=n,a=W(()=>{var _,P,I,S;return{name:((_=m.product)==null?void 0:_.name)||"Товар не был выбран",price:((P=m.product)==null?void 0:P.price)||0,count:((I=m.product)==null?void 0:I.count)||0,categoryId:((S=m.product)==null?void 0:S.categoryId)||0}}),{userProductSchema:i}=ie(),{handleSubmit:p,isSubmitting:g}=ve({validationSchema:i,initialValues:a}),{value:r,errorMessage:b}=N("name"),{value:h,errorMessage:V}=N("price"),{value:u,errorMessage:y}=N("count"),{value:k,errorMessage:x}=N("categoryId"),{categories:w,isCategoriesLoadError:M,categoriesLoadErrorMessage:J}=me(),{updateUserProduct:O}=X(),D=p(async _=>{await O(_,m.product.id),v("closeModal")});return(_,P)=>{const I=l("v-card-title"),S=l("v-text-field"),F=l("v-col"),j=l("v-select"),L=l("v-btn"),H=l("v-row"),z=l("v-form"),s=l("v-card-actions"),K=l("v-card"),U=l("v-dialog");return f(),A(U,{transition:"dialog-bottom-transition","max-width":"500","onUpdate:modelValue":P[5]||(P[5]=T=>_.$emit("closeModal")),"model-value":n.isActive},{default:t(()=>[e(K,{class:"pa-5",color:"white",elevation:"4"},{default:t(()=>[e(I,null,{default:t(()=>[We]),_:1}),e(s,null,{default:t(()=>[e(z,{onSubmit:de(o(D),["prevent"])},{default:t(()=>[e(H,null,{default:t(()=>[e(F,{cols:"12"},{default:t(()=>[e(S,{modelValue:o(r),"onUpdate:modelValue":P[0]||(P[0]=T=>E(r)?r.value=T:null),"error-messages":o(b),label:"Название товара"},null,8,["modelValue","error-messages"])]),_:1}),e(F,{cols:"12"},{default:t(()=>[o(w).length?(f(),A(j,{key:0,modelValue:o(k),"onUpdate:modelValue":P[1]||(P[1]=T=>E(k)?k.value=T:null),label:"Категория товара","error-messages":o(x),items:o(w),"item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])):q("",!0),o(M)?(f(),B("p",Xe,R(o(J)),1)):q("",!0)]),_:1}),e(F,{sm:"6",cols:"12"},{default:t(()=>[e(S,{modelValue:o(u),"onUpdate:modelValue":P[2]||(P[2]=T=>E(u)?u.value=T:null),"error-messages":o(y),label:"Количество",type:"number"},null,8,["modelValue","error-messages"])]),_:1}),e(F,{sm:"6",cols:"12"},{default:t(()=>[e(S,{modelValue:o(h),"onUpdate:modelValue":P[3]||(P[3]=T=>E(h)?h.value=T:null),"error-messages":o(V),label:"Цена",type:"number",suffix:"руб"},null,8,["modelValue","error-messages"])]),_:1}),e(F,{cols:"12"},{default:t(()=>[e(L,{color:"green-darken-4",variant:"flat",loading:o(g),type:"submit"},{default:t(()=>[C(" Сохранить ")]),_:1},8,["loading"]),e(L,{color:"blue-darken-4",variant:"flat",onClick:P[4]||(P[4]=T=>_.$emit("closeModal"))},{default:t(()=>[C(" Отмена ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),Ze=d("p",{class:"font-weight-bold text-h5"},"Подтверждение удаления",-1),et={class:"text-h6"},tt={class:"text-red"},ot=d("span",{class:"text-white"},"Нет",-1),lt=G({__name:"ProductDeleteDialog",props:{product:null,isActive:{type:Boolean}},emits:["closeModal"],setup(n,{emit:v}){const m=n,a=X(),{deleteUserProduct:i}=a,{isProductActionLoading:p}=ee(a),g=async()=>{p.value=!0,await i(m.product.id),p.value=!1,v("closeModal")};return(r,b)=>{const h=l("v-card-title"),V=l("v-card-text"),u=l("v-btn"),y=l("v-card-actions"),k=l("v-card"),x=l("v-dialog");return f(),A(x,{"model-value":n.isActive,"max-width":450,persistent:""},{default:t(()=>[e(k,{class:"pa-4"},{default:t(()=>[e(h,{class:"pa-0 mb-3"},{default:t(()=>[Ze]),_:1}),e(V,{class:"pa-0"},{default:t(()=>{var w;return[d("p",et,[C(" Вы уверены что хотите удалить товар "),d("span",tt,R((w=m.product)==null?void 0:w.name),1),C(" с базы данных ? ")])]}),_:1}),e(y,{class:"justify-center"},{default:t(()=>[e(u,{onClick:b[0]||(b[0]=w=>r.$emit("closeModal")),height:"40",color:"blue-darken-4",variant:"flat"},{default:t(()=>[ot]),_:1}),e(u,{height:"40",loading:o(p),color:"error",variant:"flat",onClick:g},{default:t(()=>[C("Да")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),st=d("p",{class:"text-h6 font-weight-bold mb-4"},"Добавление нового товара",-1),at={key:1,class:"text-h6 text-red"},nt=G({__name:"ProductAddDialog",props:{isActive:{type:Boolean}},emits:["closeModal"],setup(n,{emit:v}){const{userProductSchema:m}=ie(),{handleSubmit:a,isSubmitting:i,resetForm:p}=ve({validationSchema:m}),{value:g,errorMessage:r}=N("name"),{value:b,errorMessage:h}=N("categoryId"),{value:V,errorMessage:u}=N("count"),{value:y,errorMessage:k}=N("price"),{addUserProduct:x}=X(),{categories:w,isCategoriesLoadError:M,categoriesLoadErrorMessage:J}=me(),O=a(async D=>{await x(D),p(),v("closeModal")});return(D,_)=>{const P=l("v-card-title"),I=l("v-text-field"),S=l("v-col"),F=l("v-select"),j=l("v-btn"),L=l("v-row"),H=l("v-form"),z=l("v-card-actions"),s=l("v-card"),K=l("v-dialog");return f(),A(K,{transition:"dialog-bottom-transition","max-width":"500","onUpdate:modelValue":_[5]||(_[5]=U=>D.$emit("closeModal")),"model-value":n.isActive},{default:t(()=>[e(s,{class:"pa-5",color:"white",elevation:"4"},{default:t(()=>[e(P,null,{default:t(()=>[st]),_:1}),e(z,null,{default:t(()=>[e(H,{onSubmit:de(o(O),["prevent"])},{default:t(()=>[e(L,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[e(I,{modelValue:o(g),"onUpdate:modelValue":_[0]||(_[0]=U=>E(g)?g.value=U:null),"error-messages":o(r),label:"Название товара"},null,8,["modelValue","error-messages"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[o(w).length?(f(),A(F,{key:0,modelValue:o(b),"onUpdate:modelValue":_[1]||(_[1]=U=>E(b)?b.value=U:null),label:"Категория товара","error-messages":o(h),items:o(w),"item-title":"name","item-value":"id"},null,8,["modelValue","error-messages","items"])):q("",!0),o(M)?(f(),B("p",at,R(o(J)),1)):q("",!0)]),_:1}),e(S,{sm:"6",cols:"12"},{default:t(()=>[e(I,{modelValue:o(V),"onUpdate:modelValue":_[2]||(_[2]=U=>E(V)?V.value=U:null),"error-messages":o(u),label:"Количество",type:"number"},null,8,["modelValue","error-messages"])]),_:1}),e(S,{sm:"6",cols:"12"},{default:t(()=>[e(I,{modelValue:o(y),"onUpdate:modelValue":_[3]||(_[3]=U=>E(y)?y.value=U:null),"error-messages":o(k),label:"Цена",suffix:"руб",type:"number"},null,8,["modelValue","error-messages"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(j,{color:"green-darken-4",variant:"flat",loading:o(i),type:"submit"},{default:t(()=>[C(" Добавить ")]),_:1},8,["loading"]),e(j,{color:"blue-darken-4",variant:"flat",onClick:_[4]||(_[4]=U=>D.$emit("close"))},{default:t(()=>[C(" Отмена ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),rt=G({__name:"ProductsSearchForm",props:{searchName:null,searchPrices:null},emits:["update:searchName","update:searchPrices","resetSearch","close"],setup(n,{emit:v}){const m=n,a=$(m.searchName),i=$(m.searchPrices),p=()=>{a.value="",i.value=[1,999999],v("resetSearch")};return(g,r)=>{const b=l("v-text-field"),h=l("v-col"),V=l("v-range-slider"),u=l("v-btn"),y=l("v-row"),k=l("v-form");return f(),A(k,null,{default:t(()=>[e(y,{align:"center"},{default:t(()=>[e(h,{sm:"6",cols:"12"},{default:t(()=>[e(b,{modelValue:a.value,"onUpdate:modelValue":[r[0]||(r[0]=x=>a.value=x),r[1]||(r[1]=x=>g.$emit("update:searchName",a.value))],variant:"outlined",label:"Название товара"},null,8,["modelValue"])]),_:1}),e(h,{sm:"6",cols:"12"},{default:t(()=>[e(V,{modelValue:i.value,"onUpdate:modelValue":[r[2]||(r[2]=x=>i.value=x),r[3]||(r[3]=x=>g.$emit("update:searchPrices",i.value))],"thumb-label":"always",min:"1",step:"10",max:"999999",strict:"",color:"blue-grey-darken-2",label:"Цена:","hide-details":"auto"},null,8,["modelValue"])]),_:1}),e(h,{cols:"auto"},{default:t(()=>[e(y,null,{default:t(()=>[e(h,null,{default:t(()=>[e(u,{variant:"flat",color:"red-darken-4",onClick:p},{default:t(()=>[C(" Сбросить поиск ")]),_:1})]),_:1}),e(h,null,{default:t(()=>[e(u,{variant:"flat",color:"blue-darken-4",onClick:r[4]||(r[4]=x=>g.$emit("close"))},{default:t(()=>[C(" Закрыть поиск ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),Z=n=>(ne("data-v-2fbcf10c"),n=n(),re(),n),ct={class:"text-h6"},ut=Z(()=>d("div",{class:"title text-h2 mb-5"},"Товары",-1)),dt={key:0},it=Z(()=>d("div",{class:"text-center mb-3 text-h6"},"Идет загрузка...",-1)),vt={class:"h-auto"},mt={class:"d-none d-sm-table-row"},_t=["onClick"],pt=Z(()=>d("th",{class:"text-left text-h6"},"Действия",-1)),ft={class:"d-sm-none d-block mb-2"},gt={key:0},bt={key:1},ht=Z(()=>d("tr",null,[d("td",{class:"py-2 text-h6 text-center font-weight-bold",colspan:"12"}," Не удалось найти ни одного товара по заданным фильтрам( ")],-1)),yt=[ht],xt={key:3,class:"text-h6"},Pt=G({__name:"ProductsView",setup(n){const v=X(),m=Se(),{userProducts:a,loadProductsError:i,isProductsFetching:p,isProductsError:g}=ee(v),{isMessageShown:r,messageText:b,messageType:h}=ee(m);ue(async()=>{a.value.length||await v.fetchUserProducts()});const V=$([{text:"Имя",field:"name"},{text:"Цена(руб)",field:"price"},{text:"Кол-во",field:"count"},{text:"Категория",field:"category"}]),u=$(V.value[0].field),y=$(!1),k=$(!1),x=$(!1),w=$(!1),M=$(null),J=(z,s)=>{console.log(s),M.value=z,s==="delete"?y.value=!0:s==="edit"&&(x.value=!0)},{filteredProducts:O,searchName:D,searchPrices:_,resetSearch:P}=Te(a),{currentPage:I,paginatedProducts:S,totalPages:F,isInverseSort:j,productsByPage:L,setSortField:H}=De(O,u);return(z,s)=>{const K=l("v-snackbar"),U=l("TableActions"),T=l("v-progress-linear"),_e=l("v-expand-transition"),pe=l("v-icon"),fe=l("v-hover"),ge=l("v-select"),be=l("v-table"),he=l("v-alert-title"),ye=l("v-alert"),xe=l("v-pagination"),Pe=l("v-card");return f(),B("div",null,[e(K,{modelValue:o(r),"onUpdate:modelValue":s[0]||(s[0]=c=>E(r)?r.value=c:null),location:"right bottom","max-width":500,color:o(h)},{default:t(()=>[d("p",ct,R(o(b)),1)]),_:1},8,["modelValue","color"]),ut,e(Pe,{color:"white",elevation:"3",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:t(()=>[e(U,{count:o(L),"onUpdate:count":[s[1]||(s[1]=c=>E(L)?L.value=c:null),s[2]||(s[2]=c=>L.value=c)],onToggleAddDialog:s[3]||(s[3]=c=>k.value=!0),onToggleSearch:s[4]||(s[4]=c=>w.value=!w.value)},{default:t(()=>[C(" Все товары("+R(o(a).length)+") ",1)]),_:1},8,["count"]),o(p)?(f(),B("div",dt,[it,e(T,{color:"green",height:"4",indeterminate:""})])):q("",!0),e(_e,null,{default:t(()=>[w.value?(f(),A(rt,{key:0,"search-name":o(D),"onUpdate:searchName":[s[5]||(s[5]=c=>E(D)?D.value=c:null),s[7]||(s[7]=c=>D.value=c)],"search-prices":o(_),"onUpdate:searchPrices":[s[6]||(s[6]=c=>E(_)?_.value=c:null),s[8]||(s[8]=c=>_.value=c)],onClose:s[9]||(s[9]=c=>w.value=!1),onResetSearch:o(P),class:"mb-8"},null,8,["search-name","search-prices","onResetSearch"])):q("",!0)]),_:1}),o(a).length?(f(),A(be,{key:1,density:"comfortable"},{default:t(()=>[d("thead",vt,[d("tr",mt,[(f(!0),B(oe,null,le(V.value,c=>(f(),B("th",{key:c.text,class:"text-left text-h6",onClick:Q=>o(H)(c.field)},[e(fe,null,{default:t(({isHovering:Q,props:we})=>[d("p",Ce(Me(we)),[C(R(c.text)+" ",1),Ue(e(pe,{style:Ie([{position:"absolute"},{opacity:Q&&u.value!=c.field?.6:1}]),icon:o(j)&&u.value==c.field?"mdi-arrow-up-thin":"mdi-arrow-down-thin"},null,8,["icon","style"]),[[Ee,u.value===c.field||Q]])],16)]),_:2},1024)],8,_t))),128)),pt]),d("div",ft,[e(ge,{modelValue:u.value,"onUpdate:modelValue":s[10]||(s[10]=c=>u.value=c),variant:"underlined",label:"Сортировать по",items:V.value,"item-title":"text","item-value":"field"},null,8,["modelValue","items"])])]),o(S).length?(f(),B("tbody",gt,[e(Ae,{name:"list"},{default:t(()=>[(f(!0),B(oe,null,le(o(S),(c,Q)=>(f(),A(Qe,{product:c,key:c.id,onOpenDialog:J},null,8,["product"]))),128))]),_:1})])):(f(),B("tbody",bt,yt))]),_:1})):q("",!0),o(g)?(f(),A(ye,{key:2,type:"error",border:"end",variant:"tonal"},{default:t(()=>[e(he,{class:"mb-2"},{default:t(()=>[C(" Ошибка при загрузке товаров ")]),_:1}),d("p",null,R(o(i)),1)]),_:1})):o(a).length===0&&!o(p)?(f(),B("p",xt," Пока в таблице нет товаров, добавьте хоть один ")):q("",!0),e(xe,{length:o(F),modelValue:o(I),"onUpdate:modelValue":s[11]||(s[11]=c=>E(I)?I.value=c:null),rounded:"circle","total-visible":7,color:"primary"},null,8,["length","modelValue"])]),_:1}),M.value?(f(),A(Ye,{key:0,product:M.value,onCloseModal:s[12]||(s[12]=c=>x.value=!1),"is-active":x.value},null,8,["product","is-active"])):q("",!0),M.value?(f(),A(lt,{key:1,"is-active":y.value,product:M.value,onCloseModal:s[13]||(s[13]=c=>y.value=!1)},null,8,["is-active","product"])):q("",!0),e(nt,{onCloseModal:s[14]||(s[14]=c=>k.value=!1),"is-active":k.value},null,8,["is-active"])])}}});const Vt=ce(Pt,[["__scopeId","data-v-2fbcf10c"]]);export{Vt as default};
