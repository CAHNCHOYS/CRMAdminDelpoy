System.register(["./index-legacy-9bb8cf7f.js","./useLogoutHandler-legacy-692f2d2e.js","./alert-legacy-1f2322f2.js","./useFormSchemas-legacy-1f7ae4a9.js"],(function(e,a){"use strict";var l,t,r,o,s,d,u,n,i,c,m,p,g,f,v,h,_,y,b,V,k,D,S,w,O,M,x,U,N,C,q,A,E,F,I,T,$,j,P,B,L,z,Q,G,H,J,W,Y,Z,K,R,X,ee,ae;return{setters:[e=>{l=e.r,t=e.W,r=e.au,o=e.i,s=e.h,d=e.d,u=e.Y,n=e.aj,i=e.ak,c=e.J,m=e.O,p=e.e,g=e.Z,f=e.o,v=e.b,h=e.s,_=e.p,y=e.v,b=e.x,V=e.y,k=e.g,D=e.z,S=e.B,w=e.a1,O=e.D,M=e.$,x=e.m,U=e.n,N=e.t,C=e.C,q=e.F,A=e.f,E=e.q,F=e.a2,I=e.ah,T=e.u,$=e.P,j=e.c,P=e.U,B=e.M,L=e.k,z=e.l,Q=e.a3,G=e.a5,H=e.a6,J=e.G},e=>{W=e.u,Y=e.a,Z=e.b,K=e._},e=>{R=e.u},e=>{X=e.u,ee=e.a,ae=e.b}],execute:function(){const a=E("span",{class:"px-5 text-wrap"},"Очистить ",-1),le=d({__name:"OrdersAddDialog",props:{isOpened:{type:Boolean}},emits:["closeDialog"],setup(e,{emit:l}){const t=u(),d=n(),E=i(),F=R(),{userProducts:I,productsErrorMessage:T}=c(t),{customers:$,customersErrorMessage:j}=c(d),{userOrderSchema:P}=X(),{handleSubmit:B,isSubmitting:L,resetForm:z}=ee({validationSchema:P}),{value:Q,errorMessage:G}=ae("customerId"),{value:H,errorMessage:J}=ae("productId"),{value:Y,errorMessage:Z}=ae("productCount"),{value:K,errorMessage:le}=ae("date"),{handleLogout:te}=W("orders-page"),re=B((async e=>{try{const{data:a}=await r.addOrder(e);e.date=e.date.split("-").reverse().join("-"),E.addOrder({...e,...a}),F.showMessage("success","Заказ был успешно добавлен!"),z()}catch(a){if(o(a)){if(401===a.response?.status)return void(await te());F.showMessage("error",s(a))}else F.showMessage("error","Ошибка при добавлении заказа")}finally{l("closeDialog")}}));return(l,t)=>(f(),m(g,{"model-value":e.isOpened,"onUpdate:modelValue":t[6]||(t[6]=e=>l.$emit("closeDialog")),width:"auto",scrollable:"",transition:"dialog-bottom-transition"},{default:p((()=>[v(A,{width:"450",color:"white",class:"pa-4"},{default:p((()=>[v(h,{class:"font-weight-bold text-h6 mb-3"},{default:p((()=>[_(" Добавление заказа ")])),_:1}),v(y,null,{default:p((()=>[v(b,{onSubmit:V(k(re),["prevent"])},{default:p((()=>[v(D,null,{default:p((()=>[v(S,{cols:"12"},{default:p((()=>[k(j)?(f(),m(M,{key:1},{default:p((()=>[v(x,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:p((()=>[v(U,{class:"text-h6"},{default:p((()=>[_(N(k(j)),1)])),_:1})])),_:1})])),_:1})):(f(),m(w,{key:0,modelValue:k(Q),"onUpdate:modelValue":t[0]||(t[0]=e=>O(Q)?Q.value=e:null),"error-messages":k(G),label:"Клиент",items:k($),"item-title":"fullName","item-value":"id","no-data-text":"Клиенты не найдены"},null,8,["modelValue","error-messages","items"]))])),_:1}),v(S,{cols:"12"},{default:p((()=>[k(T)?(f(),m(M,{key:1},{default:p((()=>[v(x,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:p((()=>[v(U,{class:"text-h6"},{default:p((()=>[_(N(k(T)),1)])),_:1})])),_:1})])),_:1})):(f(),m(w,{key:0,modelValue:k(H),"onUpdate:modelValue":t[1]||(t[1]=e=>O(H)?H.value=e:null),"error-messages":k(J),label:"Товар",items:k(I),"item-title":"name","item-value":"id","no-data-text":"Товары не найдены"},null,8,["modelValue","error-messages","items"]))])),_:1}),v(S,{cols:"12"},{default:p((()=>[v(C,{type:"number",modelValue:k(Y),"onUpdate:modelValue":t[2]||(t[2]=e=>O(Y)?Y.value=e:null),modelModifiers:{number:!0},label:"Количество товара","error-messages":k(Z)},null,8,["modelValue","error-messages"])])),_:1}),v(S,{cols:"12"},{default:p((()=>[v(C,{modelValue:k(K),"onUpdate:modelValue":t[3]||(t[3]=e=>O(K)?K.value=e:null),"error-messages":k(le),type:"date"},null,8,["modelValue","error-messages"])])),_:1}),v(S,{cols:"12"},{default:p((()=>[v(D,null,{default:p((()=>[v(S,{sm:"auto",cols:"12"},{default:p((()=>[v(q,{color:"green-darken-4",variant:"flat",type:"submit",block:"",loading:k(L)},{default:p((()=>[_(" Добавить ")])),_:1},8,["loading"])])),_:1}),v(S,{sm:"5",cols:"6"},{default:p((()=>[v(q,{color:"error",variant:"flat",onClick:t[4]||(t[4]=e=>k(z)()),block:""},{default:p((()=>[a])),_:1})])),_:1}),v(S,{sm:"auto",cols:"6"},{default:p((()=>[v(q,{color:"blue-darken-4",block:"",variant:"flat",onClick:t[5]||(t[5]=e=>l.$emit("closeDialog"))},{default:p((()=>[_(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),te={class:"text-h6"},re={class:"text-error"},oe=d({__name:"OrdersDeleteDialog",props:{isOpened:{type:Boolean},order:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchOrders"],setup(e,{emit:a}){const t=e,d=l(!1),u=R(),n=i(),{handleLogout:c}=W("orders-page"),b=async()=>{try{d.value=!0,await r.deleteOrder(t.order.id),n.deleteOrder(t.order.id),t.isSearchActive&&a("updateSearchOrders"),u.showMessage("success","Заказ был успешно удален!")}catch(e){o(e)?(401===e.response?.status&&await c(),u.showMessage("error",s(e))):u.showMessage("error","Ошибка при удалении заказа")}finally{d.value=!1,a("closeDialog")}};return(a,l)=>(f(),m(g,{scrollable:"",width:"auto","model-value":e.isOpened,"onUpdate:modelValue":l[1]||(l[1]=e=>a.$emit("closeDialog")),persistent:""},{default:p((()=>[v(A,{width:"450",elevation:"3",class:"pa-4"},{default:p((()=>[v(h,{class:"font-weight-bold text-h6 mb-4 pa-0"},{default:p((()=>[_("Удаление заказа")])),_:1}),v(F,{class:"mb-4 pa-0"},{default:p((()=>[E("p",te,[_(" Вы уверены что хотите удалить заказ за "+N(e.order.date)+" клиента ",1),E("span",re,N(e.order.customerFullName),1),_(" ? ")])])),_:1}),v(y,{class:"pa-0"},{default:p((()=>[v(q,{onClick:l[0]||(l[0]=e=>a.$emit("closeDialog")),height:"40",color:"blue-darken-4",variant:"flat"},{default:p((()=>[_(" Нет ")])),_:1}),v(q,{height:"40",color:"error",variant:"flat",loading:d.value,onClick:b},{default:p((()=>[_("Да")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),se=d({__name:"OrdersEditDialog",props:{isOpened:{type:Boolean},order:null,isSearchActive:{type:Boolean}},emits:["closeDialog","updateSearchOrders"],setup(e,{emit:a}){const l=e,t=I((()=>{const e=l.order.date.split("-");return e[2]+"-"+e[1]+"-"+e[0]})),d=I((()=>({productCount:l.order.productCount,productId:l.order.productId,customerId:l.order.customerId,date:t.value}))),{userOrderSchema:E}=X(),{isSubmitting:F,resetForm:T,handleSubmit:$}=ee({validationSchema:E,initialValues:d}),{value:j,errorMessage:P}=ae("customerId"),{value:B,errorMessage:L}=ae("productId"),{value:z,errorMessage:Q}=ae("productCount"),{value:G,errorMessage:H}=ae("date"),J=n(),Y=u(),Z=i(),K=R(),{customers:le,customersErrorMessage:te}=c(J),{userProducts:re,productsErrorMessage:oe}=c(Y),{handleLogout:se}=W("orders-page"),de=$((async e=>{try{const{data:t}=await r.updateOrder(e,l.order.id);e.date=e.date.split("-").reverse().join("-"),Z.updateOrder({...e,...t}),l.isSearchActive&&a("updateSearchOrders"),K.showMessage("success","Заказ был успешно обновлен")}catch(t){if(o(t)){if(401===t.response?.status)return void(await se());K.showMessage("error",s(t))}else K.showMessage("error","Ошибка при добавлении заказа")}finally{a("closeDialog"),T()}}));return(a,l)=>(f(),m(g,{"model-value":e.isOpened,"onUpdate:modelValue":l[5]||(l[5]=e=>a.$emit("closeDialog")),width:"auto",scrollable:"",transition:"dialog-bottom-transition"},{default:p((()=>[v(A,{width:"450",color:"white",class:"pa-4"},{default:p((()=>[v(h,{class:"font-weight-bold text-h6 mb-3"},{default:p((()=>[_(" Редактирование заказа ")])),_:1}),v(y,null,{default:p((()=>[v(b,{onSubmit:V(k(de),["prevent"])},{default:p((()=>[v(D,null,{default:p((()=>[v(S,{cols:"12"},{default:p((()=>[k(te)?(f(),m(M,{key:1},{default:p((()=>[v(x,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:p((()=>[v(U,{class:"text-h6"},{default:p((()=>[_(N(k(te)),1)])),_:1})])),_:1})])),_:1})):(f(),m(w,{key:0,modelValue:k(j),"onUpdate:modelValue":l[0]||(l[0]=e=>O(j)?j.value=e:null),"error-messages":k(P),label:"Клиент",items:k(le),"item-title":"fullName","item-value":"id","no-data-text":"Клиенты не найдены"},null,8,["modelValue","error-messages","items"]))])),_:1}),v(S,{cols:"12"},{default:p((()=>[k(oe)?(f(),m(M,{key:1},{default:p((()=>[v(x,{type:"error",border:"end",variant:"outlined",class:"pa-2"},{default:p((()=>[v(U,{class:"text-h6"},{default:p((()=>[_(N(k(oe)),1)])),_:1})])),_:1})])),_:1})):(f(),m(w,{key:0,modelValue:k(B),"onUpdate:modelValue":l[1]||(l[1]=e=>O(B)?B.value=e:null),"error-messages":k(L),label:"Товар",items:k(re),"item-title":"name","item-value":"id","no-data-text":"Товары не найдены"},null,8,["modelValue","error-messages","items"]))])),_:1}),v(S,{cols:"12"},{default:p((()=>[v(C,{modelValue:k(z),"onUpdate:modelValue":l[2]||(l[2]=e=>O(z)?z.value=e:null),modelModifiers:{number:!0},label:"Количество товара","error-messages":k(Q),type:"number"},null,8,["modelValue","error-messages"])])),_:1}),v(S,{cols:"12"},{default:p((()=>[v(C,{modelValue:k(G),"onUpdate:modelValue":l[3]||(l[3]=e=>O(G)?G.value=e:null),"error-messages":k(H),type:"date"},null,8,["modelValue","error-messages"])])),_:1}),v(S,{cols:"12"},{default:p((()=>[v(D,null,{default:p((()=>[v(S,{sm:"auto",cols:"12"},{default:p((()=>[v(q,{color:"green-darken-4",variant:"flat",type:"submit",block:"",loading:k(F)},{default:p((()=>[_(" Сохранить ")])),_:1},8,["loading"])])),_:1}),v(S,{sm:"auto",cols:"12"},{default:p((()=>[v(q,{color:"blue-darken-4",block:"",variant:"flat",onClick:l[4]||(l[4]=e=>a.$emit("closeDialog"))},{default:p((()=>[_(" Отмена ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["model-value"]))}}),de={class:"text-h6"},ue=E("h2",{class:"title text-h2 mb-5"},"Заказы",-1),ne=E("span",{class:"text-wrap"}," Сбросить поиск",-1);e("default",d({__name:"OrdersView",setup(e){const a=l([{fieldText:"Клиент",fieldName:"customerFullName"},{fieldText:"Товар",fieldName:"productName"},{fieldText:"Количество товара",fieldName:"productCount"},{fieldText:"Дата",fieldName:"date"}]),d=l("customerFullName"),u=T(),n=i(),c=R(),{itemToEdit:g,isAddDialogActive:y,isEditDialogActive:b,isDeleteDialogActive:V,openDialog:w}=Y(),U=L(),F=z(),{isSearchFormActive:I,isSearchLoading:W,isSearchActive:X,startDate:ee,endDate:ae,searchedOrders:te,customerName:re,productName:ie,addSearchQuery:ce,resetSearch:me,searchOrders:pe}=((e,a,d)=>{const u=R(),n=l(!1),i=l(!1),c=l(!1),m=l([]),p=l("2023-01-01"),g=l("2024-01-01"),f=l(""),v=l(""),h=async()=>{try{if(!e.query.startDate&&!e.query.endDate)return;c.value=!0;const{data:a}=await r.getSerachedOrders({userId:d,product:e.query.productName,customer:e.query.customerName,startDate:e.query.startDate,endDate:e.query.endDate});m.value=a.orders,i.value=!0}catch(a){o(a)?u.showMessage("error",s(a)):u.showMessage("error","Ошибка при поиске заказов")}finally{c.value=!1}};return t([()=>e.query.startDate,()=>e.query.endDate,()=>e.query.customerName,()=>e.query.productName],(async()=>{(e.query.startDate||e.query.endDate)&&h()}),{immediate:!0}),{isSearchLoading:c,isSearchFormActive:n,isSearchActive:i,startDate:p,endDate:g,customerName:f,productName:v,searchedOrders:m,resetSearch:()=>{p.value="2023-01-01",g.value="2024-01-01",f.value="",v.value="",i.value=!1,m.value=[],a.push({name:"orders-page",query:{}})},addSearchQuery:()=>{a.push({name:"orders-page",query:{startDate:p.value,endDate:g.value,customerName:f.value,productName:v.value}})},searchOrders:h}})(U,F,u.currentUser.id),ge=$((()=>X.value?te.value:n.orders)),{currentPage:fe,paginatedElements:ve,isInverseSort:he,elementsPerPageCount:_e,totalPages:ye,setSortField:be}=Z({tableElements:ge,pageName:"orders-page",sortField:d,route:U,router:F});return(e,l)=>{const t=J("TableActions");return f(),j("div",null,[v(P,{modelValue:k(c).isMessageShown,"onUpdate:modelValue":l[0]||(l[0]=e=>k(c).isMessageShown=e),color:k(c).messageType,"location-strategy":"connected"},{default:p((()=>[E("p",de,N(k(c).messageText),1)])),_:1},8,["modelValue","color"]),ue,v(A,{elevation:"3",color:"white",class:"pa-5 rounded-lg mx-sm-0 mx-n5"},{default:p((()=>[k(n).ordersErrorMessage?B("",!0):(f(),m(h,{key:0,class:"pa-0"},{default:p((()=>[v(t,{count:k(_e),"onUpdate:count":l[1]||(l[1]=e=>O(_e)?_e.value=e:null),onToggleAddDialog:l[2]||(l[2]=e=>y.value=!0),onToggleSearch:l[3]||(l[3]=e=>I.value=!k(I)),"is-badge-active":!(!e.$route.query.startDate&&!e.$route.query.endDate)},{default:p((()=>[_(" Все заказы ")])),_:1},8,["count","is-badge-active"]),v(Q,null,{default:p((()=>[k(I)?(f(),m(D,{key:0,class:"mb-5"},{default:p((()=>[v(S,{sm:"6",cols:"12"},{default:p((()=>[v(D,null,{default:p((()=>[v(S,{cols:"6"},{default:p((()=>[v(C,{modelValue:k(ee),"onUpdate:modelValue":l[4]||(l[4]=e=>O(ee)?ee.value=e:null),type:"date",label:"Начальная дата",clearable:!1},null,8,["modelValue"])])),_:1}),v(S,{cols:"6"},{default:p((()=>[v(C,{modelValue:k(ae),"onUpdate:modelValue":l[5]||(l[5]=e=>O(ae)?ae.value=e:null),type:"date",label:"Конечная дата",clearable:!1},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),v(S,{cols:"6"},{default:p((()=>[v(C,{modelValue:k(re),"onUpdate:modelValue":l[6]||(l[6]=e=>O(re)?re.value=e:null),label:"Клиент"},null,8,["modelValue"])])),_:1}),v(S,{cols:"6"},{default:p((()=>[v(C,{modelValue:k(ie),"onUpdate:modelValue":l[7]||(l[7]=e=>O(ie)?ie.value=e:null),label:"Товар"},null,8,["modelValue"])])),_:1}),v(S,{md:"6",cols:"12"},{default:p((()=>[v(D,null,{default:p((()=>[v(S,{sm:"auto",cols:"6"},{default:p((()=>[v(q,{onClick:k(ce),variant:"flat",color:"green-darken-3",block:""},{default:p((()=>[_(" Искать ")])),_:1},8,["onClick"])])),_:1}),v(S,{sm:"auto",cols:"6"},{default:p((()=>[v(q,{onClick:k(me),variant:"flat",color:"red-darken-4",block:""},{default:p((()=>[ne])),_:1},8,["onClick"])])),_:1}),v(S,{sm:"auto",cols:"12"},{default:p((()=>[v(q,{variant:"flat",color:"blue-darken-4",onClick:l[8]||(l[8]=e=>I.value=!1),block:""},{default:p((()=>[_(" Закрыть ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):B("",!0)])),_:1})])),_:1})),k(n).ordersErrorMessage?(f(),m(M,{key:1},{default:p((()=>[v(x,{variant:"outlined",border:"end",type:"error"},{default:p((()=>[E("p",null,N(k(n).ordersErrorMessage),1)])),_:1})])),_:1})):k(W)?B("",!0):(f(),m(K,{key:2,items:k(ve),fields:a.value,"current-sort-field":d.value,onUpdateSortField:l[9]||(l[9]=e=>k(be)(e)),"is-inverse-sort":k(he),onOpenDialog:l[10]||(l[10]=(e,a)=>k(w)(e,a)),"no-data-text":"Заказы не найдены"},null,8,["items","fields","current-sort-field","is-inverse-sort"])),k(W)?(f(),m(M,{key:3,class:"text-center mb-2"},{default:p((()=>[v(G,{indeterminate:"",size:"32",color:"green"})])),_:1})):B("",!0),k(ge).length?(f(),m(H,{key:4,length:k(ye),modelValue:k(fe),"onUpdate:modelValue":l[11]||(l[11]=e=>O(fe)?fe.value=e:null),rounded:"circle","total-visible":7,color:"deep-purple-darken-4"},null,8,["length","modelValue"])):B("",!0)])),_:1}),k(g)?(f(),m(se,{key:0,"is-search-active":k(X),"is-opened":k(b),onCloseDialog:l[12]||(l[12]=e=>b.value=!1),onUpdateSearchOrders:k(pe),order:k(g)},null,8,["is-search-active","is-opened","onUpdateSearchOrders","order"])):B("",!0),k(g)?(f(),m(oe,{key:1,"is-search-active":k(X),onUpdateSearchOrders:k(pe),onCloseDialog:l[13]||(l[13]=e=>V.value=!1),"is-opened":k(V),order:k(g)},null,8,["is-search-active","onUpdateSearchOrders","is-opened","order"])):B("",!0),v(le,{"is-opened":k(y),onCloseDialog:l[14]||(l[14]=e=>y.value=!1)},null,8,["is-opened"])])}}}))}}}));
