import{d as Y,r as b,o as v,c as w,m as g,T as S,U as D,t as L,b as t,e as a,V as I,k as s,_ as re,a as F,u as le,z as ie,B as de,i as M,h as E,f as u,y as k,x as ce,p as ue,W as G,X as P,n as R,l as V,Y as _e,C as X}from"./index-6bc77bae.js";import{u as j}from"./alert-ad4a9987.js";const ve={class:"d-flex align-center"},pe={class:"flex-grow-1"},me=Y({__name:"Note",props:{note:null},emits:["deleteNote","dragstart","dragend","updateNote"],setup(i,{emit:l}){const p=i,n=b(!1),h=()=>{l("updateNote",p.note),n.value=!1};return(m,d)=>{const T=s("v-text-field"),N=s("v-icon"),x=s("v-hover");return v(),w("div",{class:"note py-3 px-4 bg-white mb-3",onDragstart:d[3]||(d[3]=e=>m.$emit("dragstart",e,i.note.id)),onDragend:d[4]||(d[4]=e=>m.$emit("dragend",e))},[g("div",ve,[S(g("div",{class:"text-h6 flex-grow-1 pr-1"},L(i.note.title),513),[[D,!n.value]]),S(g("div",pe,[t(T,{modelValue:i.note.title,"onUpdate:modelValue":d[0]||(d[0]=e=>i.note.title=e),density:"comfortable",variant:"underlined",clearable:!1,"bg-color":"white"},null,8,["modelValue"])],512),[[D,n.value]]),g("div",null,[t(x,null,{default:a(({props:e,isHovering:o})=>[t(N,I({icon:"mdi-trash-can",size:"large",color:o?"red-darken-3":"grey",onClick:d[1]||(d[1]=y=>m.$emit("deleteNote",i.note.id))},e),null,16,["color"])]),_:1}),t(x,null,{default:a(({props:e,isHovering:o})=>[S(t(N,I({onClick:d[2]||(d[2]=y=>n.value=!n.value),icon:"mdi-pencil",size:"large",color:o?"blue":"grey"},e),null,16,["color"]),[[D,!n.value]])]),_:1}),t(x,null,{default:a(({props:e,isHovering:o})=>[S(t(N,I({onClick:h,style:{cursor:"pointer"},icon:"mdi-content-save-all",size:"large",color:o?"green":"grey"},e),null,16,["color"]),[[D,n.value]])]),_:1})])])],32)}}});const fe=re(me,[["__scopeId","data-v-44834e74"]]);class ge{async getNotes(l){return F.get(`/Notes/${l}`)}async updateNote(l){return await F.patch("/Notes",l)}async deleteNote(l){return await F.delete(`/Notes/${l}`)}async addNote(l){return await F.post("/Notes",l)}}const B=new ge,he=()=>{const i=j(),l=le(),p=b([]),n=b(!1),h=b(!1),m=b(null),d=ie(()=>function(e){return p.value.filter(o=>o.type===e)});return de(async()=>{h.value=!0;try{const{data:e}=await B.getNotes(l.currentUser.id);p.value=e.notes}catch(e){M(e)?m.value=E(e):m.value="Ошибка при загрузке заметок!"}h.value=!1}),{deleteNoteAction:async e=>{n.value=!0;try{await B.deleteNote(e),p.value=p.value.filter(o=>o.id!=e)}catch(o){M(o)?i.showMessage("error",E(o)):i.showMessage("error","Ошибка при добавлении заметки!")}n.value=!1},updateNoteAction:async e=>{n.value=!0;try{await B.updateNote(e)}catch(o){M(o)?i.showMessage("error",E(o)):i.showMessage("error","Ошибка при добавлении заметки!")}n.value=!1},addNoteAction:async(e,o)=>{if(!(e.length<1)){n.value=!0;try{const{data:y}=await B.addNote({title:e,type:o,userId:l.currentUser.id});p.value.push({id:y.noteId,title:e,type:o})}catch(y){M(y)?i.showMessage("error",E(y)):i.showMessage("error","Ошибка при добавлении заметки!")}n.value=!1}},isActionLoading:n,isNotesFetching:h,fetchNotesError:m,notes:p,filterNotesByType:d}},ye={class:"text-h6"},Ne=g("div",{class:"text-h2 mb-8 title"},"Ваши заметки",-1),xe={key:0,class:""},we=g("p",{class:"mb-3 text-h6"},"Загрузка заметок ...",-1),be={key:0,color:"transparent","max-height":700,style:{overflow:"auto","max-height":"700px"}},Ae=["onClick"],ke=g("p",{class:"mb-2"},"Загрузка...",-1),De=Y({__name:"NotesView",setup(i){const l=j(),{notes:p,filterNotesByType:n,isActionLoading:h,isNotesFetching:m,fetchNotesError:d,addNoteAction:T,updateNoteAction:N,deleteNoteAction:x}=he(),e=b([{title:"В процессе",isFormActive:!1,addText:""},{title:"Сделать потом",isFormActive:!1,addText:""},{title:"Сделано",isFormActive:!1,addText:""}]),o=(_,c)=>{_.target.classList.add("dragging"),_.dataTransfer.setData("id",c.toString())},y=_=>{_.target.classList.remove("dragging")},q=async(_,c)=>{var A;const C=(A=_.dataTransfer)==null?void 0:A.getData("id");if(C){const U=p.value.find($=>$.id===+C);U.type=c,await N(U)}},H=(_,c)=>{X.from(_,{opacity:0,scale:0,ease:"sine.out",duration:.6,onComplete:c})},J=(_,c)=>{X.to(_,{duration:.6,ease:"sine.out",opacity:0,scale:0,onComplete:c})};return(_,c)=>{const C=s("v-snackbar"),A=s("v-progress-linear"),U=s("v-card-title"),$=s("v-alert-title"),z=s("v-alert"),K=s("v-icon"),O=s("v-text-field"),Q=s("v-btn"),Z=s("v-form"),ee=s("v-expand-transition"),te=s("v-card-actions"),W=s("v-card"),oe=s("v-col"),ae=s("v-row"),se=s("v-card-text"),ne=s("v-dialog");return v(),w("div",null,[t(C,{modelValue:u(l).isMessageShown,"onUpdate:modelValue":c[0]||(c[0]=r=>u(l).isMessageShown=r),color:u(l).messageType},{default:a(()=>[g("p",ye,L(u(l).messageText),1)]),_:1},8,["modelValue","color"]),Ne,u(m)?(v(),w("div",xe,[we,t(A,{color:"green",height:"4",indeterminate:""})])):(v(),k(ae,{key:1,class:"row"},{default:a(()=>[(v(!0),w(G,null,P(e.value,r=>(v(),k(oe,{key:r.title,onDragover:c[1]||(c[1]=R(()=>{},["prevent"])),onDrop:f=>q(f,r.title)},{default:a(()=>[t(W,{color:"blue-grey-darken-1 pa-4"},{default:a(()=>[t(U,{class:"text-h4 text-white mb-5 pa-0"},{default:a(()=>[V(L(r.title),1)]),_:2},1024),u(n)(r.title).length?(v(),w("div",be,[t(_e,{onEnter:H,onLeave:J,css:!1,appear:""},{default:a(()=>[(v(!0),w(G,null,P(u(n)(r.title),f=>(v(),k(fe,{key:f.id,note:f,onDeleteNote:u(x),onUpdateNote:u(N),draggable:"true",onDragstart:o,onDragend:y},null,8,["note","onDeleteNote","onUpdateNote"]))),128))]),_:2},1024)])):(v(),k(z,{key:1,color:"white",class:"mb-2","border-color":"white"},{default:a(()=>[t($,null,{default:a(()=>[V("Пока нет заметок, добавьте хоть одну !")]),_:1})]),_:1})),t(te,{class:"d-flex flex-column pa-0 align-stretch",style:{"min-height":"auto"}},{default:a(()=>[g("div",{onClick:f=>r.isFormActive=!r.isFormActive,style:{cursor:"pointer"}},[t(K,{icon:r.isFormActive?"mdi-minus":"mdi-plus"},null,8,["icon"]),V(" Добавить заметку ")],8,Ae),t(ee,null,{default:a(()=>[S(t(Z,{onSubmit:R(f=>{u(T)(r.addText,r.title),r.addText=""},["prevent"])},{default:a(()=>[t(O,{"bg-color":"white",color:"black",placeholder:"Задача...",modelValue:r.addText,"onUpdate:modelValue":f=>r.addText=f,class:"my-2 white-input",rules:[f=>!!f||"Поле обязательное для ввода"]},null,8,["modelValue","onUpdate:modelValue","rules"]),t(Q,{type:"submit",variant:"flat",color:"green"},{default:a(()=>[V("Добавить")]),_:1})]),_:2},1032,["onSubmit"]),[[D,r.isFormActive]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onDrop"]))),128))]),_:1})),!u(m)&&u(d)?(v(),k(z,{key:2,type:"error",border:"end",variant:"tonal"},{default:a(()=>[t($,{class:"mb-2"},{default:a(()=>[V(" Ошибка при загрузке товаров ")]),_:1}),g("p",null,L(u(d)),1)]),_:1})):ce("",!0),t(ne,{modelValue:u(h),"onUpdate:modelValue":c[2]||(c[2]=r=>ue(h)?h.value=r:null),scrim:!1,persistent:"",width:"auto"},{default:a(()=>[t(W,{color:"indigo-darken-4"},{default:a(()=>[t(se,null,{default:a(()=>[ke,t(A,{indeterminate:"",color:"white",class:"mb-0"})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{De as default};
