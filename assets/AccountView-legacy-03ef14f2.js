System.register(["./index-legacy-8b0be313.js","./useFormSchemas-legacy-4c013c40.js","./alert-legacy-299e871f.js"],(function(e,a){"use strict";var l,s,t,o,r,n,u,d,m,c,i,p,v,g,h,f,w,b,x,y,_,V,U,M,S,k,j,C,A,I=document.createElement("style");return I.textContent=".text[data-v-4164d402]{font-weight:600}\n",document.head.appendChild(I),{setters:[e=>{l=e.d,s=e.u,t=e.z,o=e.A,r=e.i,n=e.h,u=e.r,d=e.o,m=e.c,c=e.b,i=e.e,p=e.m,v=e.f,g=e.p,h=e.n,f=e.j,w=e.k,b=e.t,x=e.l,y=e.q,_=e.s,V=e._,U=e.B,M=e.C,S=e.x},e=>{k=e.u,j=e.a,C=e.b},e=>{A=e.u}],execute:function(){const a=p("div",{class:"text-h5 mb-4"},"Общая информация об аккаунте",-1),I={class:"d-flex flex-sm-row flex-column align-sm-center"},F=p("span",{class:"text-h6"},"Обновить данные ",-1),P=l({__name:"AccountInfo",emits:["showMessage"],setup(e,{emit:l}){const b=s(),x=t((()=>({name:b.currentUser?.name||"user logged out",email:b.currentUser?.email||"user logged out",country:b.currentUser?.country||"user logged out",avatar:[]}))),{updateInfoShchema:y}=k(),{handleSubmit:_,isSubmitting:V}=j({validationSchema:y,initialValues:x}),{value:U,errorMessage:M}=C("name"),{value:S,errorMessage:A}=C("email"),{value:P,errorMessage:T}=C("country"),{value:q,errorMessage:L}=C("avatar"),R=f(),z=_((async e=>{try{let a=new FormData;a.append("name",e.name),a.append("email",e.email),a.append("country",e.country),a.append("avatar",e.avatar[0],q.value[0].name),await o.updateInfo(a);const{data:s}=await o.getUser();b.setUser(s.user),l("showMessage","success","Данные были обновлены!")}catch(a){r(a)?(401===a.response?.status&&R.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"account-page"}}),l("showMessage","error",n(a))):l("showMessage","error","Ошибка при изменении данных!")}})),E=u("");function O(e){const a=e.target.files[0];E.value=URL.createObjectURL(a),console.log(URL.createObjectURL(a))}function D(){E.value=""}return(e,l)=>{const s=w("v-avatar"),t=w("v-file-input"),o=w("v-col"),r=w("v-text-field"),n=w("v-select"),u=w("v-btn"),f=w("v-row"),x=w("v-form");return d(),m("div",null,[a,c(x,{onSubmit:h(v(z),["prevent"]),enctype:"multipart/form-data"},{default:i((()=>[c(f,{align:"center"},{default:i((()=>[c(o,{md:"6",cols:"12"},{default:i((()=>[p("div",I,[c(s,{size:"80",class:"mr-sm-3 mb-sm-0 mb-4 border mx-auto",image:E.value||`http://localhost:3000/UserAvatars/${v(b).currentUser.avatar}`},null,8,["image"]),c(t,{modelValue:v(q),"onUpdate:modelValue":l[0]||(l[0]=e=>g(q)?q.value=e:null),"error-messages":v(L),"show-size":"","prepend-icon":"mdi-camera","hide-details":"auto",label:"Загрузите ваш аватар",accept:".jpg, .png, .jpeg, .svg , .webp",onChange:O,"onClick:clear":D},null,8,["modelValue","error-messages"])])])),_:1}),c(o,{sm:"6",cols:"12"},{default:i((()=>[c(r,{modelValue:v(U),"onUpdate:modelValue":l[1]||(l[1]=e=>g(U)?U.value=e:null),"error-messages":v(M),label:"Ваше имя"},null,8,["modelValue","error-messages"])])),_:1}),c(o,{sm:"6",cols:"12"},{default:i((()=>[c(r,{modelValue:v(S),"onUpdate:modelValue":l[2]||(l[2]=e=>g(S)?S.value=e:null),"error-messages":v(A),label:"Ваша почта"},null,8,["modelValue","error-messages"])])),_:1}),c(o,{sm:"6",cols:"12"},{default:i((()=>[c(n,{modelValue:v(P),"onUpdate:modelValue":l[3]||(l[3]=e=>g(P)?P.value=e:null),"error-messages":v(T),items:["Россия","Беларусь","Латвия","Украина","Казахстан","Узбекистан"],label:"Страна проживания"},null,8,["modelValue","error-messages"])])),_:1}),c(o,{cols:"12"},{default:i((()=>[c(u,{type:"submit",variant:"flat",loading:v(V),color:"green"},{default:i((()=>[F])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["onSubmit"])])}}}),T=p("div",{class:"text-h5 mb-3"},"Безопасность",-1),q=p("span",{class:"text-white text-h6"},"Обновить пароль",-1),L=l({__name:"AccountSecurity",emits:["showMessage"],setup(e,{emit:a}){const{updatePasswordSchema:l}=k(),{handleSubmit:t,isSubmitting:p,resetForm:b}=j({validationSchema:l}),{value:x,errorMessage:y}=C("oldPassword"),{value:_,errorMessage:V}=C("newPassword"),{value:U,errorMessage:M}=C("newPasswordConfirm"),S=u(!1),A=u(!1),I=s(),F=f(),P=t((async e=>{try{await o.updatePassword(e);const{data:l}=await o.getUser();I.setUser(l.user),a("showMessage","success","Пароль был успешно имзенен"),b()}catch(l){if(r(l)){if(401===l.response?.status)return void F.push({name:"login-page",query:{isExpiredToken:"true",redirectedFrom:"account-page"}});a("showMessage","error",n(l))}else a("showMessage","error","Ошибка при изменении пароля!")}}));return(e,a)=>{const l=w("v-text-field"),s=w("v-col"),t=w("v-btn"),o=w("v-row"),r=w("v-form");return d(),m("div",null,[T,c(r,{onSubmit:h(v(P),["prevent"])},{default:i((()=>[c(o,null,{default:i((()=>[c(s,{cols:"12"},{default:i((()=>[c(l,{modelValue:v(x),"onUpdate:modelValue":a[0]||(a[0]=e=>g(x)?x.value=e:null),"error-messages":v(y),label:"Старый пароль",type:A.value?"text":"password","append-inner-icon":A.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":a[1]||(a[1]=e=>A.value=!A.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])])),_:1}),c(s,{sm:"6",cols:"12"},{default:i((()=>[c(l,{label:"Новый пароль",modelValue:v(_),"onUpdate:modelValue":a[2]||(a[2]=e=>g(_)?_.value=e:null),"error-messages":v(V),type:S.value?"text":"password","append-inner-icon":S.value?"mdi-eye":"mdi-eye-off","onClick:appendInner":a[3]||(a[3]=e=>S.value=!S.value)},null,8,["modelValue","error-messages","type","append-inner-icon"])])),_:1}),c(s,{sm:"6",cols:"12"},{default:i((()=>[c(l,{modelValue:v(U),"onUpdate:modelValue":a[4]||(a[4]=e=>g(U)?U.value=e:null),"error-messages":v(M),label:"Повторите новый пароль",type:S.value?"text":"password"},null,8,["modelValue","error-messages","type"])])),_:1}),c(s,{cols:"12"},{default:i((()=>[c(t,{type:"submit",loading:v(p),variant:"flat",color:"green"},{default:i((()=>[q])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["onSubmit"])])}}}),R=e=>(y("data-v-4164d402"),e=e(),_(),e),z=R((()=>p("div",{class:"text-h5 mb-4"},"Удаление аккаунта",-1))),E={class:"text-h6"},O=R((()=>p("p",{class:"text-h6"},"Отменить это действие будет невозможно",-1))),D={class:"mb-2"},B=R((()=>p("span",{class:"font-weight-bold"},"Я хочу удалить аккаунт ",-1))),$=R((()=>p("span",{class:"text-h6"},"Удалить аккаунт",-1))),G=V(l({__name:"AccountDeletion",emits:["showMessage"],setup(e,{emit:a}){const l=s(),t=f(),v=u(!1),g=u(!1),y=u(""),_=async()=>{if(v.value&&window.confirm("Вы точно уверены?"))try{await o.deleteAccount(l.currentUser.id),l.logOutUser(),t.push({name:"login-page"})}catch(e){g.value=!0,r(e)?a("showMessage","error",n(e)):a("showMessage","error","Ошибка при удалении профиля!"),setTimeout((()=>g.value=!1),3500)}};return(e,a)=>{const l=w("v-snackbar"),s=w("v-alert-title"),t=w("v-alert"),o=w("v-checkbox"),r=w("v-btn"),n=w("v-form");return d(),m("div",null,[z,c(l,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value=e),location:"bottom right",color:"error"},{default:i((()=>[p("p",E,b(y.value),1)])),_:1},8,["modelValue"]),c(n,{onSubmit:h(_,["prevent"])},{default:i((()=>[c(t,{border:"end",variant:"tonal",color:"red-darken-2"},{default:i((()=>[c(s,{class:"text-h6 mb-1"},{default:i((()=>[x("Вы уверены что хотите удалить аккаунт?")])),_:1}),O])),_:1}),p("p",D,[c(o,{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=e=>v.value=e),rules:[e=>!!e||"Подтвердите удаление аккаунта"],required:"",color:"red-darken-2",class:"text-red-darken-4"},{label:i((()=>[B])),_:1},8,["modelValue","rules"])]),c(r,{type:"submit",color:"error"},{default:i((()=>[$])),_:1})])),_:1},8,["onSubmit"])])}}}),[["__scopeId","data-v-4164d402"]]),H={key:0},J={class:"text-h6"},K=p("div",{class:"title text-h2 mb-5 anim"},"Аккаунт",-1),N={class:"account-items"};e("default",l({__name:"AccountView",setup(e){const a=s(),l=A(),t=(e,a)=>{l.showMessage(e,a)};return U((()=>{M.from(".account-items > *",{y:"-70%",opacity:0,duration:.8,stagger:.4,ease:"power3.out"})})),(e,s)=>{const o=w("v-snackbar"),r=w("v-card");return v(a).currentUser?(d(),m("div",H,[c(o,{modelValue:v(l).isMessageShown,"onUpdate:modelValue":s[0]||(s[0]=e=>v(l).isMessageShown=e),color:v(l).messageType,location:"bottom right"},{default:i((()=>[p("p",J,b(v(l).messageText),1)])),_:1},8,["modelValue","color"]),K,p("div",N,[p("div",null,[c(r,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:i((()=>[c(P,{onShowMessage:t})])),_:1})]),p("div",null,[c(r,{color:"white",elevation:"2",class:"pa-5 mb-6 rounded-lg mx-sm-0 mx-n5"},{default:i((()=>[c(L,{onShowMessage:t})])),_:1})]),p("div",null,[c(r,{color:"white",elevation:"2",class:"pa-5 rounded-lg mx-sm-0 mx-n5"},{default:i((()=>[c(G,{onShowMessage:t})])),_:1})])])])):S("",!0)}}}))}}}));
